<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>DEXç§æœ‰RPCèŠ‚ç‚¹ï¼šä»æ¦‚å¿µåˆ°å®è·µ</title>
    <url>/2025/10/11/DEX%E7%A7%81%E6%9C%89RPC%E8%8A%82%E7%82%B9%EF%BC%9A%E4%BB%8E%E6%A6%82%E5%BF%B5%E5%88%B0%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[DEXç§æœ‰RPCèŠ‚ç‚¹ï¼šä»æ¦‚å¿µåˆ°å®è·µ
å‰è¨€
åœ¨åŒºå—é“¾çš„ä¸–ç•Œé‡Œï¼ŒRPCèŠ‚ç‚¹å°±åƒæ˜¯è¿æ¥ç”¨æˆ·ä¸åŒºå—é“¾ç½‘ç»œçš„æ¡¥æ¢ã€‚DEXï¼ˆå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼‰ä½œä¸ºåŒºå—é“¾åº”ç”¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¾€å¾€éœ€è¦æ›´ç¨³å®šã€æ›´é«˜æ•ˆçš„RPCæœåŠ¡ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨DEXç§æœ‰RPCèŠ‚ç‚¹çš„æ¶æ„ã€éƒ¨ç½²å®è·µï¼Œå¹¶é€šè¿‡è¡Œä¸šæ¡ˆä¾‹åˆ†æå…¶å®é™…åº”ç”¨ã€‚
RPCèŠ‚ç‚¹åŸºç¡€æ¦‚å¿µ
ä»€ä¹ˆæ˜¯RPCèŠ‚ç‚¹ï¼Ÿ
RPCï¼ˆRemote Procedure Callï¼‰èŠ‚ç‚¹æ˜¯åŒºå—é“¾ç½‘ç»œçš„APIç½‘å…³ï¼Œæä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

äº¤æ˜“æäº¤ï¼šæ¥æ”¶å¹¶éªŒè¯äº¤æ˜“ï¼Œè½¬å‘ç»™éªŒè¯è€…ç½‘ç»œ
æ•°æ®æŸ¥è¯¢ï¼šæä¾›è´¦æˆ·ä½™é¢ã€äº¤æ˜“å†å²ç­‰åŒºå—é“¾æ•°æ®
ç½‘ç»œçŠ¶æ€ï¼šè¿”å›å½“å‰åŒºå—é«˜åº¦ã€ç½‘ç»œè´Ÿè½½ç­‰ä¿¡æ¯

å…¬æœ‰ vs ç§æœ‰RPCèŠ‚ç‚¹



ç‰¹æ€§
å…¬æœ‰èŠ‚ç‚¹
ç§æœ‰èŠ‚ç‚¹




æ§åˆ¶æƒ
ç¬¬ä¸‰æ–¹æ§åˆ¶
DEXå®Œå…¨æ§åˆ¶


æ€§èƒ½
å—é™ä¸”ä¸ç¨³å®š
å¯ä¼˜åŒ–è°ƒé…


æˆæœ¬
æŒ‰ä½¿ç”¨ä»˜è´¹
å›ºå®šåŸºç¡€è®¾æ–½æˆæœ¬


éšç§
æ•°æ®å¯èƒ½è¢«åˆ†æ
å®Œå…¨æ•°æ®å®‰å…¨


å¯ç”¨æ€§
å¯èƒ½é™æµæˆ–å®•æœº
é«˜å¯ç”¨æ¶æ„



DEXç§æœ‰RPCèŠ‚ç‚¹çš„æ¶æ„è®¾è®¡
æ ¸å¿ƒç»„ä»¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load Balancer â”‚    â”‚   RPC Nodes     â”‚    â”‚   Cache Layer   â”‚
â”‚   (Nginx&#x2F;HAProxy)â”‚â”€â”€â”€â”€â”‚   (Solana       â”‚â”€â”€â”€â”€â”‚   (Redis)       â”‚
â”‚                 â”‚    â”‚   Validator)    â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Solana Mainnetâ”‚
                    â”‚   Validators    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
éƒ¨ç½²æ¶æ„
1. åŸºç¡€éƒ¨ç½²
# ä½¿ç”¨SolanaéªŒè¯è€…è½¯ä»¶è¿è¡ŒRPCèŠ‚ç‚¹
solana-validator \
  --identity /path/to/validator-keypair.json \
  --ledger /path/to/ledger \
  --accounts-db /path/to/accounts-db \
  --rpc-port 8899 \
  --no-voting \
  --accounts-db-cache-size-mb 8192 \
  --enable-rpc-transaction-history \
  --entrypoint entrypoint.mainnet-beta.solana.com:8001
2. é«˜å¯ç”¨éƒ¨ç½²
# Docker Composeé…ç½®ç¤ºä¾‹
version: '3.8'
services:
  rpc-node-1:
    image: solana-validator:latest
    environment:
      - SOLANA_RPC_CONFIG=/etc/solana/rpc-config.yml
    volumes:
      - ./ledger:/solana/ledger
      - ./accounts:/solana/accounts
    ports:
      - "8899:8899"

  rpc-node-2:
    # ç±»ä¼¼é…ç½®...

  load-balancer:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
3. ç›‘æ§é…ç½®
# Prometheusç›‘æ§é…ç½®
scrape_configs:
  - job_name: 'solana-rpc'
    static_configs:
      - targets: ['rpc-node-1:8899', 'rpc-node-2:8899']
    metrics_path: '/metrics'
è¡Œä¸šæ¡ˆä¾‹åˆ†æ
Raydiumæ¡ˆä¾‹
Raydiumä½œä¸ºSolanaä¸Šæœ€å¤§çš„DEXä¹‹ä¸€ï¼Œé‡‡ç”¨äº†ç§æœ‰RPCèŠ‚ç‚¹é›†ç¾¤ï¼š
æŠ€æœ¯ç‰¹ç‚¹ï¼š

å¤šèŠ‚ç‚¹å†—ä½™éƒ¨ç½²
è‡ªå®šä¹‰ç¼“å­˜å±‚ä¼˜åŒ–
å®æ—¶äº¤æ˜“æ•°æ®åˆ†æ

æ€§èƒ½æå‡ï¼š

TPSä»æ ‡å‡†RPCçš„1000+æå‡åˆ°5000+
äº¤æ˜“ç¡®è®¤æ—¶é—´å‡å°‘30%
99.9%çš„æœåŠ¡å¯ç”¨æ€§

Orcaæ¡ˆä¾‹
Orcaé€šè¿‡ç§æœ‰RPCèŠ‚ç‚¹å®ç°äº†ï¼š
åˆ›æ–°åŠŸèƒ½ï¼š

é¢„äº¤æ˜“æ¨¡æ‹Ÿ
MEVä¿æŠ¤æœºåˆ¶
è‡ªå®šä¹‰è·¯ç”±ç®—æ³•

æ¶æ„ä¼˜åŠ¿ï¼š

ä¸“å±çš„äº¤æ˜“è·¯å¾„ä¼˜åŒ–
å®æ—¶æ»‘ç‚¹è®¡ç®—
æ™ºèƒ½gasè´¹ä¼˜åŒ–

Jupiterèšåˆå™¨
Jupiterä½œä¸ºSolanaçš„äº¤æ˜“èšåˆå™¨ï¼Œç»´æŠ¤äº†å¤§è§„æ¨¡ç§æœ‰RPCåŸºç¡€è®¾æ–½ï¼š
è§„æ¨¡åŒ–éƒ¨ç½²ï¼š

å…¨çƒå¤šåŒºåŸŸèŠ‚ç‚¹åˆ†å¸ƒ
æ™ºèƒ½æµé‡è°ƒåº¦
å®æ—¶æ€§èƒ½ç›‘æ§

æŠ€æœ¯äº®ç‚¹ï¼š

æ¯«ç§’çº§è·¯ç”±å†³ç­–
è·¨DEXæœ€ä¼˜è·¯å¾„è®¡ç®—
å®æ—¶ä»·æ ¼å–‚ä»·

ç§æœ‰RPCèŠ‚ç‚¹çš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ
æŠ€æœ¯æŒ‘æˆ˜
1. æ•°æ®åŒæ­¥é—®é¢˜
æŒ‘æˆ˜ï¼š åŒºå—é“¾æ•°æ®é‡å·¨å¤§ï¼ŒåŒæ­¥æ—¶é—´é•¿
è§£å†³æ–¹æ¡ˆï¼š
# ä½¿ç”¨å¿«ç…§åŠ é€ŸåŒæ­¥
solana-validator --snapshot-path /solana-snapshots \
                 --incremental-snapshot-path /solana-incremental-snapshots
2. æ€§èƒ½ä¼˜åŒ–
æŒ‘æˆ˜ï¼š é«˜å¹¶å‘è¯·æ±‚ä¸‹çš„æ€§èƒ½ç“¶é¢ˆ
è§£å†³æ–¹æ¡ˆï¼š

å¤šèŠ‚ç‚¹è´Ÿè½½å‡è¡¡
æ•°æ®åº“ä¼˜åŒ–ï¼ˆaccounts-dbç¼“å­˜ï¼‰
ç½‘ç»œå±‚ä¼˜åŒ–

3. æˆæœ¬æ§åˆ¶
æŒ‘æˆ˜ï¼š åŸºç¡€è®¾æ–½æˆæœ¬é«˜æ˜‚
è§£å†³æ–¹æ¡ˆï¼š

äº‘æœåŠ¡å¼¹æ€§ä¼¸ç¼©
å­˜å‚¨ä¼˜åŒ–ï¼ˆå†å²æ•°æ®å½’æ¡£ï¼‰
æ™ºèƒ½ç¼“å­˜ç­–ç•¥

è¿ç»´æŒ‘æˆ˜
1. ç›‘æ§å‘Šè­¦
# Grafanaå‘Šè­¦è§„åˆ™
groups:
  - name: solana-rpc
    rules:
      - alert: RPCNodeDown
        expr: up&#123;job="solana-rpc"&#125; == 0
        for: 5m
        labels:
          severity: critical
2. è‡ªåŠ¨æ‰©å®¹
# Kubernetes HPAé…ç½®
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: rpc-node-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: rpc-node
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
å®æ–½æŒ‡å—
éƒ¨ç½²æ­¥éª¤


ç¯å¢ƒå‡†å¤‡
# ç³»ç»Ÿè¦æ±‚
- CPU: 16+ cores
- RAM: 128GB+
- Storage: 2TB+ NVMe SSD
- Network: 1Gbps+


èŠ‚ç‚¹é…ç½®
# RPCé…ç½®
[rpc]
enable = true
port = 8899
host = "0.0.0.0"
cors = ["*"]
transaction_history = true


å®‰å…¨é…ç½®
# é˜²ç«å¢™è®¾ç½®
ufw allow 8899/tcp
ufw allow 8001/tcp  # P2Pç«¯å£


ç›‘æ§éƒ¨ç½²
# å®‰è£…ç›‘æ§å·¥å…·
docker run -d --name prometheus -p 9090:9090 prom/prometheus
docker run -d --name grafana -p 3000:3000 grafana/grafana


æœ€ä½³å®è·µ
1. å®¹é‡è§„åˆ’

æ ¹æ®é¢„æœŸTPSè§„åˆ’èŠ‚ç‚¹æ•°é‡
é¢„ç•™30%ç¼“å†²å®¹é‡
å®šæœŸæ€§èƒ½æµ‹è¯•å’Œè°ƒä¼˜

2. å¤‡ä»½ç­–ç•¥
# å®šæœŸå¿«ç…§å¤‡ä»½
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
solana-validator --snapshot-path /backup/snapshot_$DATE
3. å‡çº§ç­–ç•¥

æ»šåŠ¨å‡çº§é¿å…æœåŠ¡ä¸­æ–­
ç°åº¦å‘å¸ƒæ–°ç‰ˆæœ¬
å®Œå–„çš„å›æ»šæœºåˆ¶

æœªæ¥å±•æœ›
æŠ€æœ¯è¶‹åŠ¿


Layer 2è§£å†³æ–¹æ¡ˆ

çŠ¶æ€é€šé“
ä¾§é“¾é›†æˆ
è·¨é“¾æ¡¥æ¥



AIä¼˜åŒ–

æ™ºèƒ½è·¯ç”±
é¢„æµ‹æ€§æ‰©å®¹
å¼‚å¸¸æ£€æµ‹



å»ä¸­å¿ƒåŒ–RPCç½‘ç»œ

P2P RPCç½‘ç»œ
æ¿€åŠ±æœºåˆ¶
ç¤¾åŒºæ²»ç†



è¡Œä¸šå‘å±•
éšç€DeFiç”Ÿæ€çš„æˆç†Ÿï¼Œç§æœ‰RPCèŠ‚ç‚¹å°†æˆä¸ºDEXçš„æ ¸å¿ƒç«äº‰åŠ›ï¼š

æ€§èƒ½ä¼˜åŠ¿ï¼šæ›´å¿«çš„äº¤æ˜“ç¡®è®¤ï¼Œæ›´ä½çš„å»¶è¿Ÿ
æˆæœ¬æ•ˆç›Šï¼šé•¿æœŸæ¥çœ‹æ›´ç»æµ
åˆ›æ–°ç©ºé—´ï¼šæ”¯æŒæ›´å¤šå®šåˆ¶åŒ–åŠŸèƒ½

æ€»ç»“
DEXç§æœ‰RPCèŠ‚ç‚¹ä¸ä»…æ˜¯æŠ€æœ¯åŸºç¡€è®¾æ–½ï¼Œæ›´æ˜¯ä¸šåŠ¡ç«äº‰åŠ›çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡ã€ç²¾ç»†åŒ–çš„è¿ç»´ç®¡ç†ï¼Œä»¥åŠå¯¹è¡Œä¸šè¶‹åŠ¿çš„æŠŠæ¡ï¼ŒDEXå¯ä»¥æ„å»ºå‡ºæ›´åŠ ç¨³å®šã€é«˜æ•ˆã€å®‰å…¨çš„äº¤æ˜“ç¯å¢ƒã€‚
åœ¨åŒºå—é“¾å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼ŒåŸºç¡€è®¾æ–½çš„å»ºè®¾å¾€å¾€å†³å®šäº†ä¸€ä¸ªé¡¹ç›®çš„ä¸Šé™ã€‚å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºæ­£åœ¨æ¢ç´¢ç§æœ‰RPCèŠ‚ç‚¹çš„å¼€å‘è€…æä¾›æœ‰ä»·å€¼çš„å‚è€ƒã€‚

å‚è€ƒèµ„æ–™ï¼š

Solanaå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.solana.com/
RaydiumæŠ€æœ¯åšå®¢ï¼šhttps://raydium.io/blog/
Orcaå¼€å‘è€…æ–‡æ¡£ï¼šhttps://www.orca.so/docs


æœ¬æ–‡ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚åŒºå—é“¾æŠ€æœ¯å¿«é€Ÿå‘å±•ï¼Œæ–‡ä¸­ä¿¡æ¯å¯èƒ½éšæ—¶é—´å˜åŒ–ã€‚
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>RPC</tag>
        <tag>DEX</tag>
        <tag>åŒºå—é“¾åŸºç¡€è®¾æ–½</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part1]</title>
    <url>/2025/07/08/Rust%E5%9F%BA%E7%A1%80-part1/</url>
    <content><![CDATA[RuståŸºç¡€[part1]
å®‰è£…
âœ  rust curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh
å®‰è£…æˆåŠŸ

éªŒè¯
âœ  rust rustc --version
zsh: command not found: rustc
å› ä¸ºæˆ‘æ˜¯ç”¨çš„æ˜¯zshï¼Œæ‰€ä»¥zshé…ç½®æ–‡ä»¶éœ€è¦åŠ å…¥é…ç½®
âœ  rust echo 'export PATH="$HOME/.cargo/bin:$PATH"' >> ~/.zshrc
âœ  rust source ~/.zshrc
âœ  rust rustc --version
rustc 1.88.0 (6b00bc388 2025-06-23)
å®‰è£…æˆåŠŸï¼
å…¶ä»–å‘½ä»¤ï¼š
âœ  rust rustup update # å®‰è£…
âœ  rust rustup self uninstall # å¸è½½
VsCodeæ’ä»¶
rustè¯­è¨€æ”¯æŒï¼š

ruståŒ…æ”¯æŒï¼š

tomlæ”¯æŒï¼š

rustc
åˆ›å»ºç›®å½•
mkdir hello-world
cd hello-world
åˆ›å»ºæºæ–‡ä»¶main.rs
fn main() &#123;
    println!("Hello, world!");
&#125;
ç»ˆç«¯è¾“å…¥ rustc main.rs ä¼šå¾—åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶çš„æ–‡ä»¶mian
æ‰§è¡Œmian ä¼šå¾—åˆ°è¾“å‡º

cargo
åˆå§‹åŒ–


åˆå§‹åŒ–é¡¹ç›® cargo new [é¡¹ç›®å] 


æ„å»º cargo buildå¹¶è¿è¡Œ./target/debug/hello_cargo ï¼›æˆ–è€…ç›´æ¥ä½¿ç”¨cargo run


å½“é¡¹ç›®æœ€ç»ˆå‡†å¤‡å¥½å‘å¸ƒæ—¶ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯¹ Rust é¡¹ç›®è¿›è¡Œä¼˜åŒ–ç¼–è¯‘ï¼š
cargo build --release  

è¾“å‡ºç›®å½•ï¼šç¼–è¯‘äº§ç‰©ä¼šç”Ÿæˆåœ¨ target/release ç›®å½•ä¸‹ï¼ˆå¼€å‘é˜¶æ®µé»˜è®¤çš„ cargo build ä¼šè¾“å‡ºåˆ° target/debugï¼‰ã€‚
ä¼˜åŒ–ç‰¹æ€§ï¼š--release ä¼šå¯ç”¨ Rust ç¼–è¯‘å™¨çš„æ€§èƒ½ä¼˜åŒ–ï¼ˆå¦‚ä»£ç å†…è”ã€å¾ªç¯å±•å¼€ã€å†—ä½™ä»£ç æ¶ˆé™¤ç­‰ï¼‰ï¼Œä½¿æœ€ç»ˆç¨‹åºçš„è¿è¡Œé€Ÿåº¦æ˜¾è‘—æå‡ã€‚

ä¾èµ–
crateæ˜¯Rustçš„ä¸€ä¸ªä»£ç åº“ï¼Œå¯ä»¥åŒ…å«ä»»æ„èƒ½è¢«å…¶ä»–ç¨‹åºä½¿ç”¨çš„ä»£ç ï¼Œä½†æ˜¯ä¸èƒ½åªæ‰§è¡Œã€‚
cargo.tomlä¸­ [dependencies]  å¢åŠ é…ç½®
[dependencies]
rand="0.8.5"
é‡æ–°æ„å»ºæ‰§è¡Œcargo build ä¼šä»cargo.ioæ‹‰åˆ°æŒ‡å®šçš„ä¾èµ–ç‰ˆæœ¬åˆ°cargo.lockä¸­ã€‚
æ‰§è¡Œcargo updateä¼šå¿½ç•¥cargo.lock çš„ç‰ˆæœ¬ï¼Œä»cargo.ioæ‹‰åˆ°æœ€æ–°çš„ä¾èµ–ç‰ˆæœ¬
é…ç½®å›½å†…é•œåƒ
âœ  hello_cargo git:(main) touch ~/.cargo/config.toml
âœ  hello_cargo git:(main) vim ~/.cargo/config.toml
ç¬¬ä¸€ç§é…ç½®ï¼š
[registries]
ustc = &#123; index = "sparse+https://mirrors.ustc.edu.cn/crates.io-index/" &#125;
å‰ç¼€ sparse+ å¯ç”¨ç¨€ç–æ¨¡å¼ï¼Œæ¯”ä¼ ç»Ÿå…¨é‡ç´¢å¼•æ›´å¿«
Cargo.toml æŒ‡å®šé•œåƒåœ°å€
[dependencies]
rand = &#123;registry = "ustc", version = "0.8.5"&#125;
ç¬¬äºŒç§é…ç½®
ç›´æ¥è¦†ç›–åŸcargo.io ï¼Œä¸ç”¨æŒ‡å®šé•œåƒåœ°å€äº†
[source.crates-io]
replace-with = "ustc"

[source.ustc]
registry = "sparse+https://mirrors.ustc.edu.cn/crates.io-index/"
é‡æ–°buildä¸€é
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>MeteoraæŠ€æœ¯æ·±æ½œï¼šSolanaç”Ÿæ€çš„ä¸‹ä¸€ä»£åŠ¨æ€AMMåè®®</title>
    <url>/2025/10/12/Meteora-Solana%E4%B8%8A%E7%9A%84%E4%B8%8B%E4%B8%80%E4%BB%A3%E5%8A%A8%E6%80%81%E6%B5%81%E5%8A%A8%E6%80%A7AMM/</url>
    <content><![CDATA[MeteoraæŠ€æœ¯æ·±æ½œï¼šSolanaç”Ÿæ€çš„ä¸‹ä¸€ä»£åŠ¨æ€AMMåè®®
å¼•è¨€
åœ¨Solanaç”Ÿæ€AMMåè®®ç«äº‰æ—¥ç›Šæ¿€çƒˆçš„2025å¹´ï¼ŒMeteoraå‡­å€Ÿå…¶åˆ›æ–°çš„åŠ¨æ€æµåŠ¨æ€§ç®¡ç†æœºåˆ¶ï¼ˆDLMMï¼‰å’Œä¼˜ç§€çš„èµ„æœ¬æ•ˆç‡ï¼Œåœ¨DEXèµ›é“ä¸­å´­éœ²å¤´è§’ã€‚ä½œä¸ºSolanaç”Ÿæ€çš„é‡è¦åŸºç¡€è®¾æ–½ï¼ŒMeteoraä¸ä»…ç»§æ‰¿äº†CLMMçš„é«˜æ•ˆæ€§ï¼Œè¿˜é€šè¿‡åŠ¨æ€è°ƒæ•´æœºåˆ¶è§£å†³äº†ä¼ ç»ŸAMMçš„ç—›ç‚¹ã€‚æœ¬æ–‡å°†ä»æŠ€æœ¯æ¶æ„ã€å®ç°ç»†èŠ‚å’Œç”Ÿæ€ä»·å€¼ç­‰è§’åº¦æ·±åº¦è§£æMeteoraåè®®ã€‚
DLMMè¡Œä¸šå‘å±•è¶‹åŠ¿
2025å¹´AMMåˆ›æ–°æµªæ½®
2025å¹´AMMé¢†åŸŸå‘ˆç°ä¸‰å¤§å‘å±•è¶‹åŠ¿ï¼Œæ¨åŠ¨äº†Meteoraç­‰åˆ›æ–°åè®®çš„å¿«é€Ÿå‘å±•ï¼š

åŠ¨æ€æµåŠ¨æ€§ç®¡ç†ï¼šä¼ ç»ŸCLMMçš„é™æ€åŒºé—´å·²æ— æ³•æ»¡è¶³å¸‚åœºéœ€æ±‚ï¼ŒåŠ¨æ€è°ƒæ•´æˆä¸ºå¿…ç„¶è¶‹åŠ¿
AIè¾…åŠ©åšå¸‚ï¼šæœºå™¨å­¦ä¹ ç®—æ³•å¼€å§‹èå…¥AMMï¼Œå®ç°æ™ºèƒ½ä»·æ ¼å‘ç°å’Œé£é™©ç®¡ç†
å¤šé“¾AMMåŸç”ŸåŒ–ï¼šè·¨é“¾AMMåè®®æ¶Œç°ï¼ŒMeteoraç‡å…ˆå®ç°å¤šé“¾éƒ¨ç½²ç­–ç•¥
æœºæ„çº§è§£å†³æ–¹æ¡ˆï¼šä¼ ç»Ÿé‡‘èå¼€å§‹é‡‡ç”¨DeFiåŸºç¡€è®¾æ–½ï¼Œå¯¹AMMæå‡ºæ›´é«˜è¦æ±‚
MEVé˜²æŠ¤æ·±åŒ–ï¼šSUAVEç­‰MEVè§£å†³æ–¹æ¡ˆä¸AMMæ·±åº¦é›†æˆ

Meteoraçš„ç”Ÿæ€å®šä½
Meteoraåœ¨Solanaç”Ÿæ€ä¸­å æ®ç‹¬ç‰¹åœ°ä½ï¼š

æŠ€æœ¯åˆ›æ–°é¢†å¯¼è€…ï¼šç‡å…ˆå®ç°åŠ¨æ€æµåŠ¨æ€§ç®¡ç†ï¼ŒTVLçªç ´30äº¿ç¾å…ƒ
ç”Ÿæ€åä½œæ¢çº½ï¼šä¸Jupiterã€Raydiumç­‰åè®®æ·±åº¦åˆä½œï¼Œå½¢æˆæµåŠ¨æ€§ç”Ÿæ€
æœºæ„é‡‡ç”¨å…ˆé”‹ï¼šå¤šå®¶ä¼ ç»Ÿæœºæ„é€‰æ‹©Meteoraä½œä¸ºSolanaç”Ÿæ€å…¥å£
å¤šé“¾æ‰©å¼ æ ·æœ¬ï¼šé€šè¿‡Wormholeæ¡¥æ¥æ‰©å±•åˆ°ä»¥å¤ªåŠç­‰é“¾çš„æˆåŠŸæ¡ˆä¾‹

Meteoraæ ¸å¿ƒæŠ€æœ¯æ¶æ„
DLMMåˆ›æ–°æœºåˆ¶
Meteoraçš„DLMMï¼ˆDynamic Liquidity Market Makerï¼‰æ˜¯å…¶æ ¸å¿ƒåˆ›æ–°ï¼Œé€šè¿‡æ™ºèƒ½åˆçº¦è‡ªåŠ¨è°ƒæ•´æµåŠ¨æ€§åˆ†å¸ƒï¼Œå®ç°èµ„æœ¬æ•ˆç‡æœ€å¤§åŒ–ã€‚
åŠ¨æ€æ± æ ¸å¿ƒç»“æ„ä½“
// MeteoraåŠ¨æ€æ± æ ¸å¿ƒç»“æ„ä½“ï¼ˆåŸºäºAnchoræ¡†æ¶ï¼‰
#[account]
pub struct DynamicPool &#123;
    pub pool_creator: Pubkey,
    pub token_mint_a: Pubkey,
    pub token_mint_b: Pubkey,
    pub token_vault_a: Pubkey,
    pub token_vault_b: Pubkey,

    // åŠ¨æ€è°ƒæ•´å‚æ•°
    pub target_price_range: PriceRange,
    pub rebalance_threshold: u64,
    pub last_rebalance_timestamp: i64,

    // æµåŠ¨æ€§çŠ¶æ€
    pub current_price: u128,
    pub liquidity: u128,
    pub fee_growth_global_a: u128,
    pub fee_growth_global_b: u128,

    // ç­–ç•¥å‚æ•°
    pub strategy_params: StrategyParameters,
    pub performance_metrics: PerformanceMetrics,
&#125;
ä»·æ ¼åŒºé—´åŠ¨æ€è°ƒæ•´
// åŠ¨æ€ä»·æ ¼åŒºé—´ç»“æ„ä½“
#[derive(AnchorSerialize, AnchorDeserialize, Clone)]
pub struct PriceRange &#123;
    pub lower_tick: i32,
    pub upper_tick: i32,
    pub target_liquidity_percentage: u8, // ç›®æ ‡æµåŠ¨æ€§å æ¯”
&#125;

// ç­–ç•¥å‚æ•°å®šä¹‰
#[derive(AnchorSerialize, AnchorDeserialize, Clone)]
pub struct StrategyParameters &#123;
    pub volatility_adjustment: bool,
    pub mean_reversion_enabled: bool,
    pub auto_compound: bool,
    pub max_slippage_tolerance: u64,
&#125;
è‡ªåŠ¨åŒ–åšå¸‚å¼•æ“
Meteoraçš„è‡ªåŠ¨åŒ–åšå¸‚å¼•æ“æ˜¯å…¶æŠ€æœ¯äº®ç‚¹ï¼Œé€šè¿‡å†…ç½®ç­–ç•¥å®ç°æµåŠ¨æ€§ç®¡ç†çš„æ™ºèƒ½åŒ–ã€‚
è‡ªé€‚åº”æµåŠ¨æ€§åˆ†é…
// è‡ªé€‚åº”æµåŠ¨æ€§åˆ†é…ç®—æ³•
pub fn calculate_optimal_range(
    current_price: u128,
    historical_volatility: f64,
    pool_tvl: u64,
) -> PriceRange &#123;
    let volatility_multiplier = if historical_volatility > 0.05 &#123;
        2.0 // é«˜æ³¢åŠ¨ç‡æ—¶æ‰©å¤§åŒºé—´
    &#125; else &#123;
        1.0 // ä½æ³¢åŠ¨ç‡æ—¶ç¼©å°åŒºé—´
    &#125;;

    let price_range_width = (BASE_RANGE_WIDTH as f64 * volatility_multiplier) as i32;

    PriceRange &#123;
        lower_tick: price_to_tick(current_price) - price_range_width,
        upper_tick: price_to_tick(current_price) + price_range_width,
        target_liquidity_percentage: 100,
    &#125;
&#125;
æ™ºèƒ½é‡æ–°å¹³è¡¡æœºåˆ¶
// æ™ºèƒ½é‡æ–°å¹³è¡¡å‡½æ•°
pub fn rebalance_pool(ctx: Context&lt;RebalancePool>) -> Result&lt;()> &#123;
    let pool = &amp;mut ctx.accounts.pool;

    // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°å¹³è¡¡
    let current_price = get_current_price()?;
    let price_deviation = calculate_price_deviation(current_price, pool.target_price_range)?;

    if price_deviation > pool.rebalance_threshold &#123;
        // æ‰§è¡Œé‡æ–°å¹³è¡¡ç­–ç•¥
        let optimal_range = calculate_optimal_range(
            current_price,
            pool.performance_metrics.volatility,
            pool.liquidity,
        );

        // æ›´æ–°æ± å­å‚æ•°
        pool.target_price_range = optimal_range;
        pool.last_rebalance_timestamp = Clock::get()?.unix_timestamp;

        emit!(PoolRebalanced &#123;
            old_range: pool.target_price_range,
            new_range: optimal_range,
            timestamp: pool.last_rebalance_timestamp,
        &#125;);
    &#125;

    Ok(())
&#125;
æ•°å­¦è®¡ç®—ä¼˜åŒ–
ä»·æ ¼è®¡ç®—å…¬å¼
Meteoraä½¿ç”¨ä¼˜åŒ–çš„æ•°å­¦å…¬å¼å®ç°é«˜æ•ˆçš„ä»·æ ¼è®¡ç®—ï¼š
// ä»·æ ¼è®¡ç®—æ ¸å¿ƒå‡½æ•°
pub fn calculate_price_from_sqrt_price(sqrt_price: u128) -> f64 &#123;
    let price = (sqrt_price as f64).powi(2) / (2.0_f64).powi(64);
    price
&#125;

// Tickåˆ°ä»·æ ¼è½¬æ¢
pub fn tick_to_sqrt_price(tick: i32) -> u128 &#123;
    let tick_f = tick as f64;
    let sqrt_price = 1.0001_f64.powf(tick_f / 2.0);
    (sqrt_price * 2.0_f64.powi(64)) as u128
&#125;
æ»‘ç‚¹è®¡ç®—ä¼˜åŒ–
// ä¼˜åŒ–æ»‘ç‚¹è®¡ç®—
pub fn calculate_slippage(
    amount_in: u64,
    pool_liquidity: u128,
    fee_rate: u16,
) -> u64 &#123;
    if pool_liquidity == 0 &#123;
        return u64::MAX; // æ— é™æ»‘ç‚¹
    &#125;

    let fee_adjusted_input = amount_in * (1000 - fee_rate as u64) / 1000;
    let slippage = fee_adjusted_input * 1000 / pool_liquidity as u64;

    slippage.min(1000) // æœ€å¤§1%æ»‘ç‚¹ä¿æŠ¤
&#125;
Rustå®ç°æ·±åº¦è§£æ
å†…å­˜ç®¡ç†ä¼˜åŒ–
é›¶æ‹·è´è®¾è®¡
Meteoraå¤§é‡ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯æå‡æ€§èƒ½ï¼š
// é›¶æ‹·è´è´¦æˆ·å®šä¹‰
#[zero_copy]
pub struct Position &#123;
    pub pool: Pubkey,
    pub owner: Pubkey,
    pub liquidity: u128,
    pub lower_tick: i32,
    pub upper_tick: i32,
    pub tokens_owed_a: u64,
    pub tokens_owed_b: u64,
    pub fee_growth_inside_a: u128,
    pub fee_growth_inside_b: u128,
&#125;

// é«˜æ•ˆè´¦æˆ·çº¦æŸ
#[derive(Accounts)]
pub struct ModifyLiquidity&lt;'info> &#123;
    #[account(
        constraint = pool.pool_creator == pool_creator.key() @ MeteoraError::InvalidPoolCreator
    )]
    pub pool: Box&lt;Account&lt;'info, DynamicPool>>,

    #[account(
        mut,
        constraint = position.pool == pool.key() @ MeteoraError::InvalidPositionPool
    )]
    pub position: Box&lt;Account&lt;'info, Position>>,
&#125;
æ ˆä¸Šå†…å­˜åˆ†é…
// æ ˆä¸Šè®¡ç®—é¿å…å †åˆ†é…
pub struct SwapCalculation &#123;
    pub amount_a: u64,
    pub amount_b: u64,
    pub sqrt_price_limit: u128,
    pub amount_specified_is_input: bool,
    pub a_to_b: bool,
    pub fee_amount: u64,
&#125;

impl SwapCalculation &#123;
    pub fn calculate_swap(
        &amp;self,
        pool: &amp;DynamicPool,
        tick_arrays: &amp;[TickArray],
    ) -> SwapResult &#123;
        // æ ˆä¸Šå˜é‡å£°æ˜
        let mut current_tick = pool.current_tick_index;
        let mut current_sqrt_price = pool.current_price;
        let mut amount_remaining = if self.amount_specified_is_input &#123;
            self.amount_a
        &#125; else &#123;
            self.amount_b
        &#125;;

        // ä¸»è®¡ç®—å¾ªç¯...
        SwapResult &#123;
            amount_a,
            amount_b,
            next_sqrt_price,
        &#125;
    &#125;
&#125;
é”™è¯¯å¤„ç†æ¨¡å¼
è‡ªå®šä¹‰é”™è¯¯ç±»å‹
// é”™è¯¯å®šä¹‰
#[error_code]
pub enum MeteoraError &#123;
    #[msg("Invalid tick range")]
    InvalidTickRange,
    #[msg("Insufficient liquidity")]
    InsufficientLiquidity,
    #[msg("Price limit reached")]
    PriceLimitReached,
    #[msg("Rebalance threshold not met")]
    RebalanceThresholdNotMet,
    #[msg("Strategy not authorized")]
    StrategyNotAuthorized,
&#125;

// é”™è¯¯å¤„ç†å‡½æ•°
pub fn validate_strategy_params(
    params: &amp;StrategyParameters,
    authority: &amp;Pubkey,
) -> Result&lt;()> &#123;
    if !is_authorized_strategy(authority) &#123;
        return Err(MeteoraError::StrategyNotAuthorized.into());
    &#125;

    if params.max_slippage_tolerance > 1000 &#123;
        return Err(MeteoraError::InvalidTickRange.into());
    &#125;

    Ok(())
&#125;
é«˜çº§ç‰¹æ€§å®ç°
åŠ¨æ€è´¹ç”¨æœºåˆ¶
Meteoraå®ç°äº†åŠ¨æ€è´¹ç”¨è°ƒæ•´ï¼Œæ ¹æ®å¸‚åœºæ¡ä»¶è‡ªåŠ¨ä¼˜åŒ–è´¹ç‡ï¼š
// åŠ¨æ€è´¹ç”¨è®¡ç®—
pub fn calculate_dynamic_fee(
    base_fee: u16,
    volatility: f64,
    pool_utilization: f64,
) -> u16 &#123;
    let volatility_multiplier = if volatility > 0.03 &#123;
        2.0 // é«˜æ³¢åŠ¨ç‡æ—¶æé«˜è´¹ç‡
    &#125; else if volatility &lt; 0.01 &#123;
        0.8 // ä½æ³¢åŠ¨ç‡æ—¶é™ä½è´¹ç‡
    &#125; else &#123;
        1.0
    &#125;;

    let utilization_multiplier = if pool_utilization > 0.8 &#123;
        1.5 // é«˜åˆ©ç”¨ç‡æ—¶æé«˜è´¹ç‡
    &#125; else if pool_utilization &lt; 0.3 &#123;
        0.9 // ä½åˆ©ç”¨ç‡æ—¶é™ä½è´¹ç‡
    &#125; else &#123;
        1.0
    &#125;;

    ((base_fee as f64 * volatility_multiplier * utilization_multiplier) as u16).min(1000)
&#125;
å¤åˆæŒ‡ä»¤ä¼˜åŒ–
// å¤åˆæŒ‡ä»¤å®šä¹‰
#[derive(Accounts)]
pub struct SwapAndRebalance&lt;'info> &#123;
    pub pool: Account&lt;'info, DynamicPool>,
    pub position: Account&lt;'info, Position>,
    /// CHECK: Strategy program will validate this
    pub strategy_authority: UncheckedAccount&lt;'info>,
    pub token_account_a: Account&lt;'info, TokenAccount>,
    pub token_account_b: Account&lt;'info, TokenAccount>,
&#125;

// å¤åˆæŒ‡ä»¤å¤„ç†
pub fn swap_and_rebalance(ctx: Context&lt;SwapAndRebalance>, data: SwapData) -> Result&lt;()> &#123;
    // ç¬¬ä¸€é˜¶æ®µï¼šæ‰§è¡Œäº¤æ¢
    let swap_result = perform_swap(&amp;ctx.accounts.pool, &amp;data)?;

    // ç¬¬äºŒé˜¶æ®µï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°å¹³è¡¡
    if should_rebalance(&amp;ctx.accounts.pool, &amp;swap_result) &#123;
        let rebalance_ix = Instruction &#123;
            program_id: ctx.accounts.strategy_authority.key(),
            accounts: vec![
                AccountMeta::new_readonly(ctx.accounts.strategy_authority.key(), true),
                AccountMeta::new(ctx.accounts.pool.key(), false),
            ],
            data: rebalance_data,
        &#125;;

        invoke(&amp;rebalance_ix, &amp;[ctx.accounts.strategy_authority.to_account_info()])?;
    &#125;

    Ok(())
&#125;
æŠ€æœ¯è¦ç‚¹æ€»ç»“
DLMMä¸ä¼ ç»ŸAMMå¯¹æ¯”



ç‰¹æ€§
CPMM
CLMM
DLMM (Meteora)




æµåŠ¨æ€§åˆ†å¸ƒ
å…¨èŒƒå›´
é™æ€é›†ä¸­
åŠ¨æ€è°ƒæ•´


èµ„æœ¬æ•ˆç‡
ä½
é«˜
æé«˜


è‡ªåŠ¨åŒ–ç¨‹åº¦
æ— 
ä½
é«˜


ç»´æŠ¤æˆæœ¬
ä½
ä¸­
ä¸­ä½


æ— å¸¸æŸå¤±
é«˜
ä¸­
ä½



åˆ›æ–°ä¼˜åŠ¿åˆ†æ

åŠ¨æ€æµåŠ¨æ€§ç®¡ç†ï¼šè‡ªåŠ¨è°ƒæ•´ä»·æ ¼åŒºé—´ï¼Œé€‚åº”å¸‚åœºå˜åŒ–
æ™ºèƒ½é‡æ–°å¹³è¡¡ï¼šåŸºäºå¸‚åœºæ•°æ®ä¼˜åŒ–æµåŠ¨æ€§åˆ†å¸ƒ
è‡ªåŠ¨åŒ–ç­–ç•¥ï¼šå†…ç½®å¤šç§åšå¸‚ç­–ç•¥ï¼Œé™ä½LPé—¨æ§›
å¤åˆæŒ‡ä»¤ä¼˜åŒ–ï¼šå‡å°‘äº¤æ˜“Gasæˆæœ¬ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

é£é™©ç®¡ç†æœºåˆ¶
Meteoraé€šè¿‡å¤šå±‚é˜²æŠ¤é™ä½åè®®é£é™©ï¼š

æ»‘ç‚¹ä¿æŠ¤ï¼šæœ€å¤§æ»‘ç‚¹é™åˆ¶å’Œäº¤æ˜“å¤±è´¥ä¿æŠ¤
é¢„è¨€æœºé›†æˆï¼šå¤šæºä»·æ ¼é¢„è¨€æœºé˜²æ­¢æ“çºµ
æµåŠ¨æ€§ä¿æŠ¤ï¼šæœ€å°æµåŠ¨æ€§é˜ˆå€¼å’Œç´§æ€¥æš‚åœæœºåˆ¶
ç­–ç•¥å®¡è®¡ï¼šè‡ªåŠ¨åŒ–ç­–ç•¥çš„ä»£ç å®¡è®¡å’Œé£é™©è¯„ä¼°

ç”Ÿæ€åˆä½œä¸æ‰©å¼ 
Solanaç”Ÿæ€æ•´åˆ
Meteoraæ·±åº¦æ•´åˆSolanaç”Ÿæ€ï¼š

Jupiterèšåˆï¼šé›†æˆJupiterè·¯ç”±ï¼Œæä¾›æœ€ä½³ä»·æ ¼å‘ç°
Raydiumåä½œï¼šä¸Raydiumå½¢æˆæµåŠ¨æ€§äº’è¡¥
é’±åŒ…é›†æˆï¼šæ”¯æŒä¸»æµSolanaé’±åŒ…çš„åŸç”Ÿé›†æˆ
è·¨åè®®æ¡¥æ¥ï¼šé€šè¿‡Wormholeå®ç°å¤šé“¾èµ„äº§æ¡¥æ¥

å¤šé“¾æ‰©å¼ ç­–ç•¥
Meteoraçš„å¤šé“¾æ‰©å¼ è®¡åˆ’ï¼š

ä»¥å¤ªåŠéƒ¨ç½²ï¼šé€šè¿‡Wormholeæ¡¥æ¥æ‰©å±•åˆ°ä»¥å¤ªåŠä¸»ç½‘
Layer2æ”¯æŒï¼šé›†æˆArbitrumã€Optimismç­‰Layer2ç½‘ç»œ
æ–°å…´ç”Ÿæ€ï¼šæ‰©å±•åˆ°Aptosã€SUIç­‰é«˜æ€§èƒ½åŒºå—é“¾
è·¨é“¾AMMï¼šå®ç°åŸç”Ÿçš„è·¨é“¾æµåŠ¨æ€§åè®®

æœªæ¥å‘å±•æ–¹å‘
2025å¹´æŠ€æœ¯æ¼”è¿›

AIé©±åŠ¨ç­–ç•¥ï¼šé›†æˆæœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ç°æ™ºèƒ½æµåŠ¨æ€§ç®¡ç†
é›¶çŸ¥è¯†éšç§ï¼šé›†æˆZKè¯æ˜æŠ€æœ¯ï¼Œæä¾›éšç§ä¿æŠ¤äº¤æ˜“
æ„å›¾å¯¼å‘è®¾è®¡ï¼šä¸CowSwapç­‰åè®®åˆä½œï¼Œå®ç°æ„å›¾é©±åŠ¨AMM
æœºæ„çº§åŠŸèƒ½ï¼šå¼€å‘é’ˆå¯¹æœºæ„ç”¨æˆ·çš„æ‰˜ç®¡å’Œæ¸…ç®—æœåŠ¡
é‡å­å®‰å…¨åŠ å¯†ï¼šä¸ºåé‡å­æ—¶ä»£åšå‡†å¤‡çš„åŠ å¯†ç®—æ³•ç ”ç©¶

ç”Ÿæ€ä»·å€¼å±•æœ›
Meteoraä½œä¸ºä¸‹ä¸€ä»£AMMåè®®çš„ä»·å€¼ï¼š

æŠ€æœ¯æ ‡æ†ï¼šä¸ºè¡Œä¸šæ ‘ç«‹åŠ¨æ€æµåŠ¨æ€§ç®¡ç†æ ‡å‡†
ç”Ÿæ€æ¡¥æ¢ï¼šè¿æ¥Solanaä¸å…¶ä»–åŒºå—é“¾ç”Ÿæ€
åˆ›æ–°å­µåŒ–ï¼šä¸ºDeFiåˆ›æ–°é¡¹ç›®æä¾›åŸºç¡€è®¾æ–½
æœºæ„å…¥å£ï¼šé™ä½ä¼ ç»Ÿé‡‘èè¿›å…¥DeFiçš„é—¨æ§›

ç»“è®º
Meteoraä½œä¸ºSolanaç”Ÿæ€çš„ä¸‹ä¸€ä»£åŠ¨æ€AMMåè®®ï¼Œä¸ä»…ç»§æ‰¿äº†CLMMçš„é«˜æ•ˆæ€§ï¼Œæ›´é€šè¿‡åˆ›æ–°çš„åŠ¨æ€è°ƒæ•´æœºåˆ¶è§£å†³äº†ä¼ ç»ŸAMMçš„ç—›ç‚¹ã€‚å…¶ä¼˜ç§€çš„Rustå®ç°ã€æ™ºèƒ½çš„è‡ªåŠ¨åŒ–ç­–ç•¥å’Œå‰ç»çš„å¤šé“¾å¸ƒå±€ï¼Œä½¿å…¶æˆä¸º2025å¹´AMMèµ›é“çš„é‡è¦åŠ›é‡ã€‚
é€šè¿‡æ·±å…¥ç†è§£Meteoraçš„æŠ€æœ¯æ¶æ„å’Œåˆ›æ–°æœºåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æŠŠæ¡ä¸‹ä¸€ä»£AMMçš„å‘å±•æ–¹å‘ï¼Œä¸ºSolanaç”Ÿæ€å’Œæ›´å¹¿æ³›çš„DeFié¢†åŸŸè´¡çŒ®åˆ›æ–°è§£å†³æ–¹æ¡ˆã€‚

æœ¬æ–‡å†…å®¹åŸºäºå…¬å¼€æŠ€æœ¯æ–‡æ¡£å’ŒæŠ€æœ¯åˆ†æï¼Œä»…ä¾›å­¦ä¹ å‚è€ƒã€‚åŠ å¯†è´§å¸æŠ•èµ„å…·æœ‰é«˜é£é™©ï¼Œè¯·è°¨æ…å†³ç­–ã€‚
]]></content>
      <categories>
        <category>Eco Insights</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>DEX</tag>
        <tag>Rust</tag>
        <tag>DeFi</tag>
        <tag>Meteora</tag>
        <tag>DLMM</tag>
        <tag>AMM</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part2]_å˜é‡å’Œå¯å˜ç±»å‹</title>
    <url>/2025/07/10/Rust%E5%9F%BA%E7%A1%80-part2-%E5%8F%98%E9%87%8F%E5%92%8C%E5%8F%AF%E5%8F%98%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[RuståŸºç¡€[part2]_å˜é‡å’Œå¯å˜ç±»å‹
å¯å˜å˜é‡ä¸ä¸å¯å˜å˜é‡
å¯ä»¥ä¸æŒ‡å®šæ•°æ®ç±»å‹
å¯å˜å˜é‡â€”â€”mutable
fn immutable() &#123;
    let x = 5;
    println!("The value of x is: &#123;&#125;", x);
&#125;
ä¸å¯å˜å˜é‡â€”â€”immutable
fn mutable() &#123;
    let mut y = 10;
    println!("The value of y is: &#123;&#125;", y);
    y = 15;
    println!("The value of y is now: &#123;&#125;", y);
&#125;
å¸¸é‡â€”â€”constants


éœ€è¦åˆ¶å®šæ˜ç¡®çš„æ•°æ®ç±»å‹ï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨å¤§å†™å­—æ¯


éœ€è¦ä½¿ç”¨å¸¸é‡è¡¨è¾¾å¼è¿›è¡Œèµ‹å€¼


ä¸æ”¯æŒé‡å®šä¹‰ï¼ˆé®è”½ï¼‰



const NUM: i32 = 5;
const THREE_HOURS: i32 = 60 * 60 * 3;
ä¸å¯å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«

å¸¸é‡åœ¨ç¼–è¯‘æœŸå°±å°±ç¡®å®šäº†å€¼ï¼Œä¸èƒ½åœ¨è¿è¡Œæ—¶è¿›è¡Œæ”¹å˜ï¼› ä¸å¯å˜é‡çŸ¥é“è¿è¡ŒæœŸæ‰èƒ½ç¡®è®¤ä¸‹æ¥ã€‚
å¸¸é‡ä¸å¯ä¿®æ”¹ï¼Œä¸å¯å˜å˜é‡å¯ä»¥é€šè¿‡shadowingæ¥è¿›è¡Œä¿®æ”¹
å¸¸é‡å¿…é¡»å£°æ˜ç±»å‹ï¼Œä¸å¯å˜å˜é‡ä¸éœ€è¦å£°æ˜ç±»å‹ã€‚
å¸¸é‡å¿…é¡»ä½¿ç”¨å¤§å†™å­—æ¯ã€‚

é™æ€å˜é‡â€”â€”static
éœ€è¦é€šè¿‡mutæ¥æŒ‡å®šå¯å˜ï¼Œ unsafe å—æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºé™æ€å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯èƒ½ä¼šå¼•å‘æ•°æ®ç«äº‰é—®é¢˜ã€‚
static mut NUMBER: i32 = 10;

fn static_num() &#123;
    unsafe &#123;
        println!("static NUMBER: &#123;&#125;", NUMBER);
    &#125;// è¿™é‡Œå¯ä»¥è®¿é—®é™æ€å˜é‡NUMBER 
&#125;
ä½œç”¨åŸŸscopeå’Œé®è”½shadowing
fn binding() &#123;
    // ç»‘å®šç”Ÿå­˜äºmainå‡½æ•°ä¸­
    let long_lived_binding = 1;
    
    // ä»£ç å—ï¼Œ æ¯”mainå‡½æ•°æ‹¥æœ‰æ›´å°çš„ä½œç”¨åŸŸ
    &#123;
        // ç»‘å®šç”Ÿå­˜äºä»£ç å—ä¸­
        // è¿™é‡Œçš„short_lived_bindingåªåœ¨è¿™ä¸ªä»£ç å—ä¸­æœ‰æ•ˆ
        let short_lived_binding = 2;
        println!("short_lived_binding: &#123;&#125;", short_lived_binding);
        // é®è”½ï¼Œåœ¨ä½œç”¨åŸŸä¸­å¯ä»¥é®è”½æˆåŠŸ
        let short_lived_binding = 3;
        println!("short_lived_binding after shadowing: &#123;&#125;", short_lived_binding);

        println!("long_lived_binding: &#123;&#125;", long_lived_binding);
        // é®è”½é•¿æœŸç»‘å®šçš„å˜é‡
        // è¿™é‡Œçš„long_lived_bindingä¼šé®è”½å¤–å±‚çš„åŒåå˜é‡
        let long_lived_binding = 4;
        println!("long_lived_binding after shadowing: &#123;&#125;", long_lived_binding);
    &#125;
    println!("long_lived_binding after block: &#123;&#125;", long_lived_binding);
    // println!("short_lived_binding after block: &#123;&#125;", short_lived_binding); // è¿™é‡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºshort_lived_bindingåœ¨ä»£ç å—å¤–ä¸å¯è§
    // é®è”½é•¿æœŸç»‘å®šçš„å˜é‡
    let long_lived_binding = 5_f32;
    println!("long_lived_binding after shadowing: &#123;&#125;", long_lived_binding);

&#125;

]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>OrcaæŠ€æœ¯å†…å¹•ï¼šå¤šé“¾æ—¶ä»£çš„DEXæ–°èŒƒå¼</title>
    <url>/2025/10/07/Orca-Solana%E4%B8%8A%E7%9A%84%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E4%BA%A4%E6%98%93%E6%89%80/</url>
    <content><![CDATA[Orcaï¼šSolanaä¸Šçš„é«˜æ€§èƒ½AMM DEXæ·±åº¦è§£æ
å¼•è¨€
åœ¨2025å¹´DEXèµ›é“ç«äº‰ç™½çƒ­åŒ–çš„èƒŒæ™¯ä¸‹ï¼ŒOrcaä½œä¸ºSolanaç”Ÿæ€çš„é¢†å¯¼è€…AMMåè®®ï¼Œå‡­å€Ÿå…¶ç‹¬ç‰¹çš„Whirlpoolæœºåˆ¶å’Œä¼˜ç§€çš„Rustå®ç°ï¼Œå·²æˆä¸ºå…¨çƒæœ€å¤§çš„Solana DEXã€‚æœ¬æ–‡å°†ä»æŠ€æœ¯å®ç°è§’åº¦æ·±åº¦è§£æOrcaåè®®çš„è®¾è®¡ç†å¿µå’ŒRustä»£ç ç»“æ„ï¼Œæ¢è®¨å…¶åœ¨å¤šé“¾æ—¶ä»£çš„åˆ›æ–°å‘å±•ã€‚

ğŸ“– è‹±æ–‡ç‰ˆæœ¬: Orca Deep Dive: The New Paradigm of DEX in the Multi-Chain Era

DEXè¡Œä¸šæœ€æ–°åŠ¨æ€
2025å¹´DEXå‘å±•è¶‹åŠ¿

AIé©±åŠ¨äº¤æ˜“ï¼šé›†æˆæœºå™¨å­¦ä¹ ç®—æ³•çš„æ™ºèƒ½åšå¸‚å•†å…´èµ·ï¼ŒOrcaå¼€å§‹æ¢ç´¢AIè¾…åŠ©çš„ä»·æ ¼å‘ç°æœºåˆ¶
æ„å›¾é©±åŠ¨äº¤æ˜“ï¼šCowSwapã€1inch Fusionç­‰æ„å›¾å¯¼å‘çš„èšåˆå™¨è·å¾—å¸‚åœºè®¤å¯ï¼ŒOrcaé›†æˆæ„å›¾è·¯ç”±
å¤šé“¾èšåˆDEXï¼šè·¨é“¾æ¡¥æ¥æŠ€æœ¯æˆç†Ÿï¼ŒOrcaé€šè¿‡Wormholeå’ŒLayerZeroæ‰©å±•åˆ°å¤šé“¾ç”Ÿæ€
ä¸“ä¸šåŒ–AMMï¼šé’ˆå¯¹ç‰¹å®šèµ„äº§ç±»å‹çš„AMMå¿«é€Ÿå‘å±•ï¼ŒOrcaæ¨å‡ºä¸“æ³¨ç¨³å®šå¸å’ŒLSTçš„æ± å­
MEVé˜²æŠ¤å¢å¼ºï¼šFlashbots Protectç­‰MEVè§£å†³æ–¹æ¡ˆè¢«æ›´å¤šDEXé›†æˆï¼ŒOrcaé‡‡ç”¨SUAVEç½‘ç»œ
é›¶çŸ¥è¯†è¯æ˜é›†æˆï¼šéšç§ä¿æŠ¤äº¤æ˜“æˆä¸ºè¶‹åŠ¿ï¼ŒOrcaå¼€å§‹æµ‹è¯•ZKéšç§æ± 
RWAèµ„äº§ä»£å¸åŒ–ï¼šç°å®ä¸–ç•Œèµ„äº§ä¸Šé“¾ï¼ŒOrcaä¸ºRWAèµ„äº§æä¾›æµåŠ¨æ€§

Orcaçš„å¸‚åœºåœ°ä½
Orcaåœ¨Solanaç”Ÿæ€ä¸­å æ®é¢†å¯¼åœ°ä½ï¼š

TVLæ’åç¬¬ä¸€ï¼šè¶…è¶ŠRaydiumæˆä¸ºSolanaæœ€å¤§DEXï¼ŒTVLè¶…è¿‡50äº¿ç¾å…ƒ
æ—¥äº¤æ˜“é‡çªç ´ï¼šæ—¥å‡äº¤æ˜“é‡è¶…è¿‡10äº¿ç¾å…ƒï¼Œåˆ›å†å²æ–°é«˜
ç”Ÿæ€ä¸»å¯¼åœ°ä½ï¼šä¸Jupiterã€Raydiumã€Meteoraç­‰åè®®æ·±åº¦åˆä½œï¼Œå½¢æˆæµåŠ¨æ€§è”ç›Ÿ
å¤šé“¾æ‰©å¼ ï¼šé€šè¿‡Wormholeæ¡¥æ¥æ‰©å±•åˆ°ä»¥å¤ªåŠã€Arbitrumã€Optimismç­‰é“¾
æœºæ„é‡‡ç”¨ï¼šå¤šå®¶ä¼ ç»Ÿé‡‘èæœºæ„é›†æˆOrcaè¿›è¡ŒåŠ å¯†èµ„äº§äº¤æ˜“

Orcaæ ¸å¿ƒæŠ€æœ¯æ¶æ„
Whirlpoolæœºåˆ¶è¯¦è§£
Orcaçš„Whirlpoolæ˜¯å…¶æ ¸å¿ƒåˆ›æ–°ï¼Œå€Ÿé‰´äº†Uniswap V3çš„é›†ä¸­æµåŠ¨æ€§æ¦‚å¿µï¼Œä½†é’ˆå¯¹Solanaè¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ã€‚
æ ¸å¿ƒæ•°æ®ç»“æ„
// Whirlpoolæ ¸å¿ƒç»“æ„ä½“ï¼ˆåŸºäºAnchoræ¡†æ¶ï¼‰
#[account]
pub struct Whirlpool &#123;
    pub whirlpools_config: Pubkey,
    pub whirlpool_bump: [u8; 1],

    // äº¤æ˜“å¯¹ä¿¡æ¯
    pub token_mint_a: Pubkey,
    pub token_mint_b: Pubkey,
    pub token_vault_a: Pubkey,
    pub token_vault_b: Pubkey,

    // è´¹ç‡å’Œtickç›¸å…³
    pub fee_rate: u16,
    pub protocol_fee_rate: u16,
    pub tick_spacing: u16,
    pub tick_spacing_seed: u8,

    // æµåŠ¨æ€§çŠ¶æ€
    pub current_tick_index: i32,
    pub sqrt_price: u128,
    pub liquidity: u128,
    pub fee_growth_global_a: u128,
    pub fee_growth_global_b: u128,
&#125;
Tickç³»ç»Ÿå®ç°
// Tickæ•°ç»„ç®¡ç†
#[account(zero_copy)]
pub struct TickArray &#123;
    pub whirlpool: Pubkey,
    pub start_tick_index: i32,
    pub ticks: [Tick; 88], // æ¯ä¸ªæ•°ç»„åŒ…å«88ä¸ªticks
&#125;

// å•ä¸ªTickç»“æ„
#[zero_copy]
pub struct Tick &#123;
    pub initialized: bool,
    pub liquidity_net: i128,
    pub fee_growth_outside_a: u128,
    pub fee_growth_outside_b: u128,
    // ... å…¶ä»–å­—æ®µ
&#125;
æ•°å­¦è®¡ç®—ä¼˜åŒ–
ä»·æ ¼è®¡ç®—å…¬å¼
Orcaä½¿ç”¨Q64.64å®šç‚¹æ•°è¿›è¡Œä»·æ ¼è®¡ç®—ï¼Œç¡®ä¿ç²¾åº¦å’Œgasæ•ˆç‡ï¼š
// ä»·æ ¼è®¡ç®—æ ¸å¿ƒé€»è¾‘
pub fn calculate_price_from_sqrt_price(sqrt_price: u128) -> f64 &#123;
    let price = (sqrt_price as f64).powi(2) / (2.0_f64.powi(64));
    price
&#125;

// Tickä»·æ ¼è®¡ç®—
pub fn tick_index_to_sqrt_price(tick_index: i32) -> u128 &#123;
    let tick = tick_index as f64;
    let sqrt_price = 1.0001_f64.powf(tick / 2.0);
    (sqrt_price * 2.0_f64.powi(64)) as u128
&#125;
Rustå®ç°æ·±åº¦è§£æ
å†…å­˜ç®¡ç†ä¼˜åŒ–
é›¶æ‹·è´è®¾è®¡
Orcaå¤§é‡ä½¿ç”¨é›¶æ‹·è´ï¼ˆzero-copyï¼‰æŠ€æœ¯å‡å°‘å†…å­˜åˆ†é…ï¼š
// é›¶æ‹·è´è´¦æˆ·å®šä¹‰
#[zero_copy]
pub struct Position &#123;
    pub whirlpool: Pubkey,
    pub position_mint: Pubkey,
    pub liquidity: u128,
    pub tick_lower_index: i32,
    pub tick_upper_index: i32,
    pub fee_growth_inside_a: u128,
    pub fee_growth_inside_b: u128,
&#125;

// è´¦æˆ·çº¦æŸä¼˜åŒ–
#[derive(Accounts)]
pub struct ModifyLiquidity&lt;'info> &#123;
    #[account(
        constraint = whirlpool.whirlpool_bump == [] @ WhirlpoolError::InvalidWhirlpoolBump
    )]
    pub whirlpool: Box&lt;Account&lt;'info, Whirlpool>>,
&#125;
æ ˆä¸Šå†…å­˜åˆ†é…
// ä½¿ç”¨æ•°ç»„è€ŒéVecå‡å°‘å †åˆ†é…
pub struct SwapCalculation &#123;
    pub amount_a: u64,
    pub amount_b: u64,
    pub sqrt_price_limit: u128,
    pub amount_specified_is_input: bool,
    pub a_to_b: bool,
&#125;

// å…³é”®è®¡ç®—å‡½æ•°
impl SwapCalculation &#123;
    pub fn calculate_swap(
        &amp;self,
        whirlpool: &amp;Whirlpool,
        tick_arrays: &amp;[TickArray],
    ) -> SwapResult &#123;
        // æ ˆä¸Šè®¡ç®—ï¼Œé¿å…åŠ¨æ€åˆ†é…
        let mut current_tick = whirlpool.current_tick_index;
        let mut current_sqrt_price = whirlpool.sqrt_price;
        let mut amount_remaining = if self.amount_specified_is_input &#123;
            self.amount_a
        &#125; else &#123;
            self.amount_b
        &#125;;

        // ä¸»å¾ªç¯é€»è¾‘...
    &#125;
&#125;
é”™è¯¯å¤„ç†æ¨¡å¼
è‡ªå®šä¹‰é”™è¯¯ç±»å‹
// é”™è¯¯å®šä¹‰
#[error_code]
pub enum WhirlpoolError &#123;
    #[msg("Invalid tick index")]
    InvalidTickIndex,
    #[msg("Insufficient liquidity")]
    InsufficientLiquidity,
    #[msg("Price limit reached")]
    PriceLimitReached,
    #[msg("Zero amount specified")]
    ZeroAmountSpecified,
&#125;

// é”™è¯¯å¤„ç†å‡½æ•°
pub fn validate_tick_range(
    tick_lower: i32,
    tick_upper: i32,
    tick_spacing: u16,
) -> Result&lt;()> &#123;
    if tick_lower >= tick_upper &#123;
        return Err(WhirlpoolError::InvalidTickIndex.into());
    &#125;
    if tick_lower % tick_spacing as i32 != 0 &#123;
        return Err(WhirlpoolError::InvalidTickIndex.into());
    &#125;
    Ok(())
&#125;
é«˜çº§ç‰¹æ€§å®ç°
åè®®è´¹ç”¨æœºåˆ¶
// åè®®è´¹ç”¨æ”¶é›†
pub fn collect_protocol_fee(
    whirlpool: &amp;mut Account&lt;Whirlpool>,
    fee_authority: &amp;Signer,
    token_owner_account_a: &amp;mut Account&lt;TokenAccount>,
    token_owner_account_b: &amp;mut Account&lt;TokenAccount>,
) -> Result&lt;()> &#123;
    let fee_amount_a = whirlpool.fee_growth_global_a
        .checked_sub(protocol_fee_owed_a)
        .unwrap();
    let fee_amount_b = whirlpool.fee_growth_global_b
        .checked_sub(protocol_fee_owed_b)
        .unwrap();

    // è½¬ç§»åè®®è´¹ç”¨...
    Ok(())
&#125;
è·¨æŒ‡ä»¤ä¼˜åŒ–
Orcaä½¿ç”¨è·¨æŒ‡ä»¤ä¼˜åŒ–çš„è®¾è®¡æ¨¡å¼ï¼š
// å¤åˆæŒ‡ä»¤å®šä¹‰
#[derive(Accounts)]
pub struct SwapWithPartner&lt;'info> &#123;
    pub whirlpool: Account&lt;'info, Whirlpool>,
    pub partner: Account&lt;'info, Partner>,
    /// CHECK: Partner program will validate this
    pub partner_authority: UncheckedAccount&lt;'info>,
    pub partner_token_account: Account&lt;'info, TokenAccount>,
&#125;

// å¤åˆæŒ‡ä»¤å¤„ç†
pub fn swap_with_partner(ctx: Context&lt;SwapWithPartner>, data: SwapData) -> Result&lt;()> &#123;
    // ç¬¬ä¸€é˜¶æ®µï¼šæ ‡å‡†äº¤æ¢
    let mut swap_result = perform_swap(&amp;ctx.accounts.whirlpool, &amp;data)?;

    // ç¬¬äºŒé˜¶æ®µï¼šä¼™ä¼´ç¨‹åºå¤„ç†
    let partner_ix = Instruction &#123;
        program_id: ctx.accounts.partner.key(),
        accounts: vec![
            AccountMeta::new_readonly(ctx.accounts.partner_authority.key(), true),
            AccountMeta::new(ctx.accounts.partner_token_account.key(), false),
        ],
        data: partner_data,
    &#125;;

    invoke(&amp;partner_ix, &amp;[ctx.accounts.partner_authority.to_account_info()])?;
    Ok(())
&#125;
æŠ€æœ¯è¦ç‚¹æ€»ç»“
æ ¸å¿ƒæœºåˆ¶å¯¹æ¯”
Whirlpool vs ä¼ ç»ŸAMMçš„åŒºåˆ«ï¼š

æµåŠ¨æ€§ç®¡ç†ï¼šé›†ä¸­æµåŠ¨æ€§ vs å…¨èŒƒå›´æµåŠ¨æ€§
ä»·æ ¼å‘ç°ï¼šTickç³»ç»Ÿç®¡ç† vs ç®€å•æ’å®šä¹˜ç§¯
èµ„æœ¬æ•ˆç‡ï¼šæ›´é«˜çš„èµ„é‡‘åˆ©ç”¨ç‡ vs æ›´ç®€å•çš„å®ç°

é›¶æ‹·è´æŠ€æœ¯çš„ä¼˜åŠ¿
é›¶æ‹·è´æŠ€æœ¯åœ¨Orcaä¸­çš„åº”ç”¨å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼š

å‡å°‘åºåˆ—åŒ–å¼€é”€ï¼šç›´æ¥å†…å­˜è®¿é—®ï¼Œé¿å…ä¸å¿…è¦çš„æ‹·è´æ“ä½œ
æ ˆä¸Šå†…å­˜åˆ†é…ï¼šä½¿ç”¨å›ºå®šå¤§å°æ•°ç»„è€ŒéåŠ¨æ€åˆ†é…
æ›´å¥½çš„gasæ•ˆç‡ï¼šé™ä½äº¤æ˜“æˆæœ¬ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

ä»·æ ¼æ“çºµé˜²æŠ¤
Orcaé€šè¿‡å¤šå±‚æœºåˆ¶é˜²æ­¢ä»·æ ¼æ“çºµï¼š

Tické—´è·æ§åˆ¶ï¼šé™åˆ¶æµåŠ¨æ€§ä½ç½®çš„ç²’åº¦
é¢„è¨€æœºä»·æ ¼éªŒè¯ï¼šé›†æˆé“¾ä¸Šä»·æ ¼é¢„è¨€æœº
æ»‘ç‚¹ä¿æŠ¤æœºåˆ¶ï¼šæœ€å¤§æ»‘ç‚¹é™åˆ¶å’Œäº¤æ˜“å¤±è´¥ä¿æŠ¤

æœªæ¥å‘å±•æ–¹å‘
2025å¹´æŠ€æœ¯æ¼”è¿›

AIæ™ºèƒ½åšå¸‚ï¼šé›†æˆæœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ç°åŠ¨æ€è´¹ç‡è°ƒæ•´å’Œæ™ºèƒ½ä»·æ ¼å‘ç°
å¤šé“¾èšåˆæ‰©å¼ ï¼šé€šè¿‡LayerZeroå’ŒWormholeå®ç°çœŸæ­£çš„è·¨é“¾AMM
é›¶çŸ¥è¯†éšç§æ± ï¼šé›†æˆZKè¯æ˜æŠ€æœ¯ï¼Œä¸ºæœºæ„ç”¨æˆ·æä¾›éšç§ä¿æŠ¤äº¤æ˜“
æ„å›¾é©±åŠ¨é›†æˆï¼šä¸CowSwapç­‰æ„å›¾åè®®æ·±åº¦åˆä½œï¼Œæä¾›æ›´æ™ºèƒ½çš„äº¤æ˜“è·¯ç”±
RWAèµ„äº§æ”¯æŒï¼šæ¨å‡ºä¸“ä¸ºç°å®ä¸–ç•Œèµ„äº§ä»£å¸åŒ–è®¾è®¡çš„AMMæ± 
MEVé˜²æŠ¤å‡çº§ï¼šé‡‡ç”¨SUAVEç½‘ç»œå’ŒFlashbots Protectçš„æœ€æ–°é˜²æŠ¤æœºåˆ¶
é‡å­å®‰å…¨åŠ å¯†ï¼šä¸ºåé‡å­æ—¶ä»£åšå‡†å¤‡ï¼Œç ”ç©¶æŠ—é‡å­è®¡ç®—çš„åŠ å¯†ç®—æ³•

ç”Ÿæ€åˆä½œä¸æ‰©å¼ 
Orcaåœ¨2025å¹´æ·±åŒ–ç”Ÿæ€åˆä½œï¼š

æµåŠ¨æ€§è”ç›Ÿï¼šä¸Jupiterã€Raydiumã€Meteoraå½¢æˆSolanaæµåŠ¨æ€§è”ç›Ÿ
è·¨é“¾æ¡¥æ¥ï¼šæ·±åº¦é›†æˆWormholeï¼Œå®ç°å¤šé“¾èµ„äº§çš„æ— ç¼æµåŠ¨
æœºæ„çº§é›†æˆï¼šä¸ä¼ ç»Ÿé‡‘èæœºæ„åˆä½œï¼Œæä¾›æ‰˜ç®¡å’Œæ¸…ç®—æœåŠ¡
Layer2æ‰©å¼ ï¼šæ”¯æŒArbitrumã€Optimismã€Baseç­‰ä»¥å¤ªåŠLayer2ç½‘ç»œ
æ–°å…´ç”Ÿæ€ï¼šæ‰©å±•åˆ°TONã€SUIã€Aptosç­‰é«˜æ€§èƒ½åŒºå—é“¾ç½‘ç»œ

ç»“è®º
Orcaä½œä¸ºSolanaç”Ÿæ€çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œä¸ä»…å±•ç¤ºäº†Ruståœ¨é«˜æ€§èƒ½DeFiåº”ç”¨ä¸­çš„å¼ºå¤§èƒ½åŠ›ï¼Œä¹Ÿå¼•é¢†ç€2025å¹´DEXæŠ€æœ¯åˆ›æ–°çš„æµªæ½®ã€‚é€šè¿‡æ·±å…¥ç†è§£å…¶æŠ€æœ¯å®ç°ï¼Œå¼€å‘è€…å¯ä»¥åœ¨å¤šé“¾æ—¶ä»£æ›´å¥½åœ°åº”ç”¨è¿™äº›å…ˆè¿›çš„AMMè®¾è®¡æ¨¡å¼å’Œè·¨é“¾æŠ€æœ¯ç†å¿µï¼Œä¸ºä¸‹ä¸€ä»£å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„å‘å±•è´¡çŒ®åŠ›é‡ã€‚

æœ¬æ–‡å†…å®¹åŸºäºå…¬å¼€æŠ€æœ¯æ–‡æ¡£å’ŒæŠ€æœ¯åˆ†æï¼Œä»…ä¾›å­¦ä¹ å‚è€ƒã€‚åŠ å¯†è´§å¸æŠ•èµ„å…·æœ‰é«˜é£é™©ï¼Œè¯·è°¨æ…å†³ç­–ã€‚
]]></content>
      <categories>
        <category>Eco Insights</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>DEX</tag>
        <tag>Rust</tag>
        <tag>DeFi</tag>
        <tag>AMM</tag>
        <tag>Orca</tag>
        <tag>Whirlpool</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part5]_å¼•ç”¨ã€æ•°ç»„ä¸åˆ‡ç‰‡</title>
    <url>/2025/07/12/Rust%E5%9F%BA%E7%A1%80-part5-%E5%BC%95%E7%94%A8/</url>
    <content><![CDATA[RuståŸºç¡€[part5]_å¼•ç”¨

ä¸å¯å˜å¼•ç”¨ï¼šé€šè¿‡ä¸å¯å˜å¼•ç”¨ï¼Œå¯ä»¥è¯»å–å˜é‡ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿä¿®æ”¹æ•°æ®ã€‚ä¸€ä¸ªå˜é‡å¯ä»¥æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨ï¼Œä½†ä¸èƒ½ä¸å¯å˜å¼•ç”¨å…±å­˜ã€‚
å¯å˜å¼•ç”¨ï¼šé€šè¿‡å¯å˜å¼•ç”¨ï¼Œå¯ä»¥è¯»å–å’Œä¿®æ”¹æ•°æ®ã€‚ä¸€ä¸ªå˜é‡åœ¨æŸä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œä¸”ä¸èƒ½ä¸ä¸å¯å˜å¼•ç”¨å…±å­˜ã€‚

å¼•ç”¨è§„åˆ™

åŒä¸€æ—¶é—´(ç”Ÿå‘½å‘¨æœŸ)å†…ï¼Œä¸€ä¸ªå˜é‡åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨æˆ–å¤šä¸ªä¸å¯å˜å¼•ç”¨

å¤šä¸ªä¸å¯å˜å¼•ç”¨å¯ä»¥å…±å­˜
å¯å˜å¼•ç”¨å¿…é¡»æ˜¯ç‹¬å çš„ï¼ˆä¸èƒ½ä¸å…¶ä»–å¼•ç”¨å…±å­˜ï¼‰


å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆï¼ˆRustä¿è¯å¼•ç”¨æ°¸è¿œä¸ä¼šæŒ‡å‘æ— æ•ˆå†…å­˜ï¼‰

ç¤ºä¾‹1ï¼šé”™è¯¯ç¤ºèŒƒ
pub fn reference_example() &#123;
    let mut s: String = String::from("Hello");
    // åˆ›å»ºä¸å¯å˜å¼•ç”¨
    let s1: &amp;String = &amp;s;
    // åˆ›å»ºå¯å˜å¼•ç”¨ï¼ˆé”™è¯¯ï¼šæ­¤æ—¶så·²æœ‰ä¸å¯å˜å¼•ç”¨ï¼‰
    let s2: &amp;mut String = &amp;mut s;
  
    // é”™è¯¯ï¼šä¸èƒ½åˆ›å»ºå¤šä¸ªå¯å˜å¼•ç”¨
    let s3: &amp;mut String = &amp;mut s;
    
    // é”™è¯¯ï¼šåŒä¸€ç”Ÿå‘½å‘¨æœŸå†…åŒæ—¶ä½¿ç”¨ä¸å¯å˜å’Œå¯å˜å¼•ç”¨
    println!("s1: &#123;&#125;, s2: &#123;&#125;", s1, s2); 
&#125;

ç¤ºä¾‹ 2ï¼šæ­£ç¡®ç¤ºèŒƒ
pub fn reference_example() &#123;
    let mut s: String = String::from("Hello");
    
    // ç¬¬ä¸€é˜¶æ®µï¼šä»…ä½¿ç”¨ä¸å¯å˜å¼•ç”¨
    let s1: &amp;String = &amp;s;
    println!("s1: &#123;&#125;", s1); 
    // s1åœ¨æ­¤å¤„ä¸å†ä½¿ç”¨
    
    // ç¬¬äºŒé˜¶æ®µï¼šåˆ›å»ºå¯å˜å¼•ç”¨ï¼ˆs1å·²ä¸å†æ´»è·ƒï¼‰
    let s2: &amp;mut String = &amp;mut s;
    println!("s2: &#123;&#125;", s2);
&#125;
åˆ‡ç‰‡(Slices)
æ•°ç»„åˆ‡ç‰‡
let a = [1, 2, 3];
   let b = &amp; a[0..1];
   let c = &amp; a[0..=1];
å­—ç¬¦ä¸²åˆ‡ç‰‡
æ˜¯å¯¹å­—ç¬¦ä¸²éƒ¨åˆ†å†…å®¹çš„å¼•ç”¨
// å­—ç¬¦ä¸²å¼•ç”¨
    let s = String::from("Hello, Rust!");
    let slice1: &amp;str = &amp;s[0..5]; // "Hello"
    let slice2: &amp;str = &amp;s[7..]; // "Rust!"
    let slice3: &amp;str = &amp;s[..]; // "Hello, Rust!"
æ‚¬å‚å¼•ç”¨ï¼ˆDangling Referenceï¼‰
ç”Ÿå‘½å‘¨æœŸæ ¸å¿ƒè§„åˆ™ï¼šå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡» â‰¤ è¢«å¼•ç”¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ
é”™è¯¯ç¤ºä¾‹1ï¼š
pub fn dangling_pointer_example() &#123;
    let r: &amp;String;
    &#123;
        let s = String::from("Hello"); // sçš„ç”Ÿå‘½å‘¨æœŸä»…åœ¨&#123;&#125;å†…
        r = &amp;s;                        // rå¼•ç”¨sï¼Œä½†så³å°†è¢«é”€æ¯
    &#125; // såœ¨æ­¤å¤„è¢«é‡Šæ”¾
    println!("r: &#123;&#125;", r); // é”™è¯¯ï¼šrå¼•ç”¨çš„så·²ä¸å­˜åœ¨ï¼ˆæ‚¬å‚å¼•ç”¨ï¼‰
&#125;
å…³é”®ç‚¹ï¼š

sçš„ç”Ÿå‘½å‘¨æœŸï¼šä»åˆ›å»ºåˆ°&#125;ç»“æŸã€‚
rçš„ç”Ÿå‘½å‘¨æœŸï¼šä»åˆ›å»ºåˆ°å‡½æ•°ç»“æŸï¼ˆè¦†ç›–sçš„ç”Ÿå‘½å‘¨æœŸï¼‰ã€‚
é”™è¯¯åŸå› ï¼šrå­˜æ´»æ—¶é—´è¶…è¿‡sï¼Œå¯¼è‡´å¼•ç”¨æ— æ•ˆã€‚

é”™è¯¯ç¤ºä¾‹2ï¼š
fn get_a() -> &amp;String &#123; // é”™è¯¯ï¼šè¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨
    let s = String::from("a");
    &amp;s // å‡½æ•°ç»“æŸåsè¢«é”€æ¯ï¼Œå¼•ç”¨æ‚¬ç©º
&#125;
å…³é”®ç‚¹ï¼š

è¿”å›å¼•ç”¨çš„åˆæ³•æ€§ï¼šåªèƒ½è¿”å›å‚æ•°æˆ–å…¨å±€å˜é‡çš„å¼•ç”¨ï¼Œä¸èƒ½è¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨ã€‚

æ­£ç¡®ç¤ºä¾‹ï¼š
ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼ˆLifetime Annotationï¼‰
pub fn lifetime_example() &#123;
    let large = longest("a", "ab");
    println!("The longest string is: &#123;&#125;", large);

    // ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼šç¡®ä¿è¿”å›çš„å¼•ç”¨ä¸å‚æ•°ç”Ÿå‘½å‘¨æœŸä¸€è‡´
    fn longest&lt;'a>(x: &amp;'a str, y: &amp;'a str) -> &amp;'a str &#123;
        if x.len() > y.len() &#123; x &#125; else &#123; y &#125;
    &#125;
&#125;
å…³é”®ç‚¹ï¼š

'açš„å«ä¹‰ï¼šå‚æ•°xå’Œyä»¥åŠè¿”å›å€¼çš„å¼•ç”¨å¿…é¡»è‡³å°‘å­˜æ´»åˆ°'aç»“æŸã€‚
ç¼–è¯‘å™¨æ£€æŸ¥ï¼š

éªŒè¯xå’Œyçš„å®é™…ç”Ÿå‘½å‘¨æœŸæ˜¯å¦æ»¡è¶³'aã€‚
ç¡®ä¿è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸä¸è¶…è¿‡'aã€‚


å®é™…æ•ˆæœï¼šè¿”å›çš„å¼•ç”¨åœ¨è°ƒç”¨è€…çš„ä½œç”¨åŸŸå†…æœ‰æ•ˆï¼ˆå¦‚largeçš„ç”Ÿå‘½å‘¨æœŸè¦†ç›–longestçš„è°ƒç”¨ï¼‰ã€‚

æ€»ç»“ï¼šé¿å…æ‚¬å‚å¼•ç”¨çš„3ç§æ–¹å¼

è¿”å›æ‰€æœ‰æƒï¼ˆå¦‚fn get_a() -&gt; Stringï¼‰ï¼šè½¬ç§»å€¼çš„æ§åˆ¶æƒï¼Œæ— éœ€å¼•ç”¨ã€‚
å¼•ç”¨å¤–éƒ¨å˜é‡ï¼ˆå¦‚fn get_a(s: &amp;String) -&gt; &amp;Stringï¼‰ï¼šç¡®ä¿è¢«å¼•ç”¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¶³å¤Ÿé•¿ã€‚
ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼ˆå¦‚fn longest&lt;'a&gt;(x: &amp;'a str) -&gt; &amp;'a strï¼‰ï¼šæ˜ç¡®å¼•ç”¨çš„åˆæ³•å­˜æ´»èŒƒå›´ã€‚

]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part7]_æšä¸¾ã€ç»“æ„ä½“</title>
    <url>/2025/07/14/Rust%E5%9F%BA%E7%A1%80-part7-%E6%9E%9A%E4%B8%BE%E3%80%81%E7%BB%93%E6%9E%84%E4%BD%93/</url>
    <content><![CDATA[RuståŸºç¡€[part7]_æšä¸¾ã€ç»“æ„ä½“
æšä¸¾
æšä¸¾ç”¨äºè¡¨ç¤ºä¸€ä¸ªå€¼å¯èƒ½æ˜¯å¤šç§å˜ä½“ï¼ˆVariantï¼‰ä¸­çš„ä¸€ç§ã€‚æ¯ä¸ªå˜ä½“å¯ä»¥æœ‰ä¸åŒçš„æ•°æ®ç±»å‹ï¼š
enum Message &#123;
    Quit,                   // æ— æ•°æ®
    Move &#123; x: i32, y: i32 &#125;, // å¸¦å‘½åæ•°æ®ï¼ˆç±»ä¼¼ç»“æ„ä½“ï¼‰
    Write(String),          // å¸¦å•ä¸ªå€¼ï¼ˆç±»ä¼¼å…ƒç»„ï¼‰
    ChangeColor(i32, i32, i32), // å¸¦å¤šä¸ªå€¼ï¼ˆç±»ä¼¼å…ƒç»„ï¼‰
&#125;
åŸºæœ¬ä½¿ç”¨
enum Pets &#123;
    Cat(String),
    Dog &#123; name: String, age: usize &#125;,
&#125;

fn print_pet_info() &#123;
    let a = Pets::Cat("Whiskers".to_string());
    let b = Pets::Dog &#123;
        name: "Buddy".to_string(),
        age: 5,
    &#125;;

    // Debug trait allows us to print the enum variants
    println!("cat is &#123;:?&#125;", a);
    println!("dog is &#123;:?&#125;", b);
  
    //implæ˜¯ç”¨æ¥ä¸ºæšä¸¾æˆ–ç»“æ„ä½“å®šä¹‰æ–¹æ³•çš„
    impl Pets &#123;
        fn speak(&amp;self) &#123;
            println!("hi");
        &#125;
    &#125;
    a.speak();

    // å…³è”å‡½æ•°æ˜¯ä¸ç±»å‹ç›¸å…³çš„å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ç±»å‹åç›´æ¥è°ƒç”¨
    // å…³è”å‡½æ•°ä¸éœ€è¦å®ä¾‹åŒ–å¯¹è±¡å°±å¯ä»¥è°ƒç”¨
    impl Pets &#123;
        fn log(name: String) &#123;
            println!("Logging pet: &#123;&#125;", name);
        &#125;
    &#125;

    Pets::log("Whiskers".to_string());
&#125;
è¯­æ³•&amp;è§„èŒƒ


è¯­æ³•

field-less enum
unit-only enum



è§„èŒƒ


Pascal Case


snake_case




ç”¨æ³•
æšä¸¾é€šå¸¸ä¸æ¨¡å¼åŒ¹é…ï¼ˆmatchï¼‰ç»“åˆä½¿ç”¨ï¼Œä»¥å¤„ç†ä¸åŒçš„å˜ä½“ï¼š
match &amp; if let
// match è¯­å¥ï¼š
    // ç”¨äºæ¨¡å¼åŒ¹é…ï¼Œå¯ä»¥æ ¹æ®æšä¸¾çš„ä¸åŒå˜ä½“æ‰§è¡Œä¸åŒçš„ä»£ç 
    match a &#123;
        Pets::Cat(_) => &#123;
            println!("This is a cat");
        &#125;
        Pets::Bird => &#123;
            println!("This is a bird");
        &#125;
        Pets::Dog &#123; name, age &#125; => &#123;
            println!("This is a dog named &#123;&#125; and age &#123;&#125;", name, age);
        &#125;
        // è¿™é‡Œçš„ _ æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œè¡¨ç¤ºåŒ¹é…æ‰€æœ‰æœªè¢«å‰é¢åˆ†æ”¯åŒ¹é…çš„æƒ…å†µ
        _ => &#123;
            println!("This is not a cat");
        &#125;
    &#125;


// if let è¯­å¥ï¼š
    // ç”¨äºç®€åŒ–æ¨¡å¼åŒ¹é…ï¼Œå½“åªå…³å¿ƒæŸä¸ªç‰¹å®šå˜ä½“æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ if let
    // è¿™ç§æ–¹å¼å¯ä»¥é¿å…ä½¿ç”¨ match çš„å†—é•¿è¯­æ³•
    if let Pets::Dog &#123; name, age &#125; = &amp;b &#123;
        println!("This is a dog named &#123;&#125; and age &#123;&#125;", name, age);
    &#125; else &#123;
        println!("This is not a dog");
    &#125;
Option
Option çš„ä½œç”¨æ˜¯å®‰å…¨åœ°è¡¨è¾¾â€œæœ‰å€¼â€æˆ–â€œæ²¡æœ‰å€¼â€çš„æƒ…å†µï¼Œé¿å…ç©ºæŒ‡é’ˆï¼ˆnullï¼‰å¸¦æ¥çš„è¿è¡Œæ—¶é”™è¯¯ã€‚åœ¨ Rust é‡Œæ²¡æœ‰ nullï¼Œæ‰€æœ‰â€œå¯èƒ½ä¸ºç©ºâ€çš„åœºæ™¯éƒ½ç”¨ Option æ¥è¡¨è¾¾ã€‚

ä½ å†™çš„å‡½æ•°æœ‰æ—¶å¯èƒ½æ‰¾ä¸åˆ°ç»“æœã€è¯»å–ä¸åˆ°æ•°æ®ã€æˆ–è€…å‚æ•°å¯èƒ½ä¸ºç©ºï¼Œè¿™æ—¶ç”¨ Option è¿”å› Some(å€¼) æˆ– Noneã€‚
è¿™æ ·ç¼–è¯‘å™¨ä¼šå¼ºåˆ¶ä½ æ£€æŸ¥â€œæœ‰æ²¡æœ‰å€¼â€ï¼Œé˜²æ­¢å¿˜è®°åˆ¤æ–­å¯¼è‡´ç¨‹åºå´©æºƒã€‚

 fn option_example() &#123;
    let some_value: Option&lt;i32> = Some(42);
    let none_value: Option&lt;i32> = None;
    // ä½¿ç”¨ match å¤„ç† Option
    match some_value &#123;
        Some(val) => println!("Got a value: &#123;&#125;", val), // Some åˆ†æ”¯
        None => println!("No value found"),            // None åˆ†æ”¯
    &#125;

    if let Some(val) = none_value &#123;
        println!("Got a value: &#123;&#125;", val);
    &#125; else &#123;
        println!("No value found");
    &#125;
&#125;
Result
result æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæ“ä½œçš„ç»“æœï¼ŒResult&lt;T, E&gt; æœ‰ä¸¤ä¸ªå˜ä½“ï¼šOk(T) å’Œ Err(E)ï¼›Ok(T) è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå¹¶åŒ…å«ä¸€ä¸ªå€¼ Tï¼ŒErr(E) è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼Œå¹¶åŒ…å«ä¸€ä¸ªé”™è¯¯å€¼ Eï¼›Result&lt;T, E&gt; å¸¸ç”¨äºå¤„ç†å¯èƒ½å¤±è´¥çš„æ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å–ã€ç½‘ç»œè¯·æ±‚ç­‰

å¯ä»¥æé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯è¯»æ€§
å¯ä»¥é¿å…å¼‚å¸¸å¤„ç†ï¼ˆexception handlingï¼‰çš„å¤æ‚æ€§

fn result_example() &#123;
    let ok_value: Result&lt;i32, &amp;str> = Ok(42);
    let err_value: Result&lt;i32, &amp;str> = Err("Error occurred");

    match ok_value &#123;
        Ok(val) => println!("Got a value: &#123;&#125;", val), // Ok åˆ†æ”¯
        Err(err) => println!("Error: &#123;&#125;", err),      // Err åˆ†æ”¯
    &#125;

    if let Err(err) = err_value &#123;
        println!("Error: &#123;&#125;", err);
    &#125;
&#125;
Option &amp; Result è½¬æ¢
option-&gt; result: ok_or()
fn option_result_convert() &#123;
    let some_value: Option&lt;i32> = Some(42);
    let none_value: Option&lt;i32> = None;

    // Option è½¬ Result
    let result_from_some: Result&lt;i32, &amp;str> = some_value.ok_or("No value found");
    let result_from_none: Result&lt;i32, &amp;str> = none_value.ok_or("No value found");

    match result_from_some &#123;
        Ok(val) => println!("Got a value: &#123;&#125;", val),
        Err(err) => println!("Error: &#123;&#125;", err),
    &#125;

    match result_from_none &#123;
        Ok(val) => println!("Got a value: &#123;&#125;", val),
        Err(err) => println!("Error: &#123;&#125;", err),
    &#125;

&#125;

result-&gt; option: ok()
fn option_result_convert() &#123;

    // Result è½¬ Option
    let ok_value: Result&lt;i32, &amp;str> = Ok(42);
    let err_value: Result&lt;i32, &amp;str> = Err("Error occurred");
    let option_from_ok: Option&lt;i32> = ok_value.ok();
    let option_from_err: Option&lt;i32> = err_value.ok();
    match option_from_ok &#123;
        Some(val) => println!("Got a value: &#123;&#125;", val),
        None => println!("No value found"),
    &#125;
    match option_from_err &#123;
        Some(val) => println!("Got a value: &#123;&#125;", val),
        None => println!("No value found"),
    &#125;
&#125;
å¸¸è§apiç¤ºä¾‹
fn enum_api_example() &#123;
    let option1 = Some(5);
    let option2: Option&lt;i32> = None;

    let option_mapped = option1.map(|x: i32| x * 2); // ä½¿ç”¨ map æ–¹æ³•å¯¹ Some å€¼è¿›è¡Œæ“ä½œ
    println!("Option1 after map: &#123;:?&#125;", option_mapped); // å¯¹ Some å€¼è¿›è¡Œæ“ä½œ
    let option2_mapped = option2.map(|x: i32| x * 2); // å¯¹ None å€¼è¿›è¡Œæ“ä½œæ—¶ä¸ä¼šæ‰§è¡Œé—­åŒ…
    println!("Option2 after map: &#123;:?&#125;", option2_mapped); // å¯¹ None å€¼è¿›è¡Œæ“ä½œ

    option1.and_then(|x: i32| Some(x * 2)); // and_then æ–¹æ³•ç”¨äºé“¾å¼è°ƒç”¨
    option2.and_then(|x: i32| Some(x * 2)); // å¯¹ None å€¼è¿›è¡Œæ“ä½œæ—¶ä¸ä¼šæ‰§è¡Œé—­åŒ…
    let option1_or_else = option1.or_else(|| Some(0)); // or_else æ–¹æ³•ç”¨äºæä¾›é»˜è®¤å€¼
    println!("Option1 or else: &#123;:?&#125;", option1_or_else); // å¯¹ Some å€¼æä¾›é»˜è®¤å€¼
    let option2_or_else = option2.or_else(|| Some(10)); // å¯¹ None å€¼æä¾›é»˜è®¤å€¼
    println!("Option2 or else: &#123;:?&#125;", option2_or_else); // å¯¹ None å€¼æä¾›é»˜è®¤å€¼
    option1.unwrap_or(0); // unwrap_or æ–¹æ³•ç”¨äºè·å– Some å€¼æˆ–æä¾›é»˜è®¤å€¼
    option2.unwrap_or(0); // å¯¹ None å€¼æä¾›é»˜è®¤å€¼
    option1.is_some(); // æ£€æŸ¥æ˜¯å¦ä¸º Some å€¼
    option2.is_some(); // æ£€æŸ¥æ˜¯å¦ä¸º Some å€¼
    option1.is_none(); // æ£€æŸ¥æ˜¯å¦ä¸º None å€¼

    let result: Result&lt;i32, i32> = Ok(1);
    let error: Result&lt;(), &amp;str> = Err("An error occurred");
    result.map(|_| println!("Success!")); // ä½¿ç”¨ map æ–¹æ³•å¯¹ Ok å€¼è¿›è¡Œæ“ä½œ
    error.map(|_| println!("Success!")); // å¯¹ Err å€¼è¿›è¡Œæ“ä½œæ—¶
    // ä¸ä¼šæ‰§è¡Œé—­åŒ…
    result.and_then(|val| Ok(val)); // and_then æ–¹æ³•ç”¨äºé“¾å¼è°ƒç”¨ è¿”å›çš„æ˜¯resultç±»å‹
    error.and_then(|val| Ok(val)); // å¯¹ Err å€¼è¿›è¡Œæ“ä½œæ—¶ä¸ä¼šæ‰§è¡Œé—­åŒ…
    // âš ï¸ or_elseåªä¼šåœ¨ Err åˆ†æ”¯æ‰§è¡Œ
    result.or_else(|val: i32| Err(val)); // or_else æ–¹æ³•ç”¨äºæä¾›é»˜è®¤å€¼
    error.or_else(|_| Err(())); // å¯¹ Err å€¼æä¾›é»˜è®¤å€¼
    result.unwrap_or_else(|val: i32| 1); // unwrap_or_else è¿”å›çš„æ˜¯æœ€ç»ˆçš„å€¼
    error.unwrap_or_else(|val| &#123;
        println!("Error occurred: &#123;&#125;", val);
        ()
    &#125;); // å¯¹ Err å€¼æä¾›é»˜è®¤å€¼
    result.is_ok(); // æ£€æŸ¥æ˜¯å¦ä¸º Ok å€¼
    error.is_ok(); // æ£€æŸ¥æ˜¯å¦ä¸º Ok å€¼
    result.is_err(); // æ£€æŸ¥æ˜¯å¦ä¸º Err å€¼
    error.is_err(); // æ£€æŸ¥æ˜¯å¦ä¸º Err å€¼
&#125;


âš ï¸ å‘

unwrap_or_else å¾—åˆ°çš„æ˜¯æœ€ç»ˆçš„å€¼ï¼ˆTï¼‰ã€‚
or_else å¾—åˆ°çš„æ˜¯å¦ä¸€ä¸ª Option/Resultï¼ˆOption æˆ– Result&lt;T, E&gt;ï¼‰ã€‚
or_else åªä¼šåœ¨ Err çš„æ—¶å€™è°ƒç”¨é—­åŒ…ï¼Œè€Œé—­åŒ…å‚æ•° val çš„ç±»å‹åº”è¯¥æ˜¯ Eï¼ˆä¹Ÿå°±æ˜¯ Err çš„ç±»å‹ï¼‰ï¼Œè€Œä¸æ˜¯ Ok çš„ç±»å‹


ç»ƒä¹ ï¼š
åˆ†æenumçš„å†…å­˜å¤§å°
#[test]
fn enum_size_analysis() &#123;
    use std::mem::size_of;

    enum MyEnum &#123;
        A(u8, u8),
        B,
        C &#123;&#125;,
    &#125;
    enum EnumA1 &#123;
        A = 255,
    &#125;
    enum EnumA2 &#123;
        A = 255,
        B,
    &#125;

    println!("MyEnum size: &#123;&#125; bytes", size_of::&lt;MyEnum>());
    println!("EnumA1 size: &#123;&#125; bytes", size_of::&lt;EnumA1>());
    println!("EnumA2 size: &#123;&#125; bytes", size_of::&lt;EnumA2>());
&#125;
ç»“æ„ä½“
åˆ›å»º
struct User &#123;
    active: bool,
    username: String,
    email: String,
    sign_in_count: u64,
&#125;
pub fn struct_example() &#123;
    // åˆ›å»ºç»“æ„ä½“å®ä¾‹
    // 1.æ¯ä¸ªå­—æ®µéƒ½éœ€è¦å®ä¾‹åŒ–
    // 2.å­—æ®µé¡ºåºå¯ä»¥ä»»æ„
    // 3.å­—æ®µåé€—å·åˆ†éš”
    let username = String::from("someusername123");
    let user1 = User &#123;
        active: true,
        username, // ç®€å†™
        email: String::from("someone@example.com"),
        sign_in_count: 1,
    &#125;;

    let user2 = User &#123;
        email: String::from("another@example.com"),
        ..user1 // ç»“æ„ä½“æ›´æ–°è¯­æ³•ï¼Œæ²¡æœ‰é€—å·
    &#125;;
&#125;
å¸¸è§ä½¿ç”¨
// 1. è®¿é—®å­—æ®µ
println!("The username is &#123;&#125;", user1.email);

//2 ä¿®æ”¹ç»“æ„ä½“å­—æ®µï¼ˆå¯å˜æ€§ï¼‰
  //      æ•´ä¸ªå®ä¾‹å¿…é¡»æ˜¯å¯å˜çš„
  let mut user1 = User &#123;
      active: true,
      username: String::from("someusername123"),
      email: String::from("someone@example.com"),
      sign_in_count: 1,
  &#125;;
  user1.email = String::from("anotheremail@example.com");


å…ƒç¥–ç»“æ„ä½“(tuple struct)

struct Color(i32, i32, i32);
struct Point(i32, i32, i32);
//3 ä½¿ç”¨å…ƒç»„ç»“æ„ä½“
fn tuple_strut() &#123;
    struct Color(i32, i32, i32);
    struct Point(i32, i32, i32);
    let black = Color(0, 0, 0);
    println!("&#123;&#125;", black.0);
&#125;
å•å…ƒç»“æ„ä½“(unit-like struct)
// å•å…ƒç»“æ„ä½“
fn unit_struct() &#123;
    // å•å…ƒç»“æ„ä½“åˆ›å»º
    let always_equal = AlwaysEqual;
    // æˆ‘ä»¬ä¸å…³å¿ƒAlwaysEqualå®ä¾‹ä¸­çš„ä»»ä½•å†…å®¹ï¼Œæˆ‘ä»¬åªå…³å¿ƒå…¶ç±»å‹ï¼Œç„¶åå¯ä»¥ä¸ºå®ƒå®ç°æŸä¸ªç‰¹å¾
    impl SomeTrait for AlwaysEqual &#123;
        // å‡½æ•°ä½“çœç•¥
    &#125;
&#125;

//å•å…ƒç»“æ„ä½“
struct AlwaysEqual;

æ‰€æœ‰æƒ
&#123;//3 æ‰€æœ‰æƒ
    let user1 = User &#123;
        active: true,
        username: String::from("someusername123"),
        email: String::from("someone@example.com"),
        sign_in_count: 1,
    &#125;;

    let email = user1.email;
    println!("&#123;&#125;", user1.email);// æ‰€æœ‰æƒè½¬ç§»


    print_user(user1);// è¿™é‡Œä¹Ÿä¼šæŠ¥é”™
&#125;

fn print_user(user: User) &#123;
    println!("&#123;:?&#125;", user);
&#125;
--------------------------------------------------
error[E0382]: borrow of moved value: `user1.email`
  --> src/struct_example.rs:44:20
   |
43 |     let email = user1.email;
   |                 ----------- value moved here
44 |     println!("&#123;&#125;", user1.email);// æ‰€æœ‰æƒè½¬ç§»
   |                    ^^^^^^^^^^^ value borrowed here after move


ä¸€æ—¦ç»“æ„ä½“ä¸­æŸä¸€ä¸ªå­—æ®µå‘ç”Ÿäº†æ‰€æœ‰æƒç§»åŠ¨ï¼Œé‚£ä¹ˆæ•´ä¸ªç»“æ„ä½“éƒ½ä¼šä¸èƒ½å†èµ‹å€¼äº†
ä½¿ç”¨æ²¡æœ‰å®ç°copyç‰¹æ€§çš„ç±»å‹ï¼Œéƒ½ä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»ã€‚


å®šä¹‰æ–¹æ³•
/**
 * ç»“æ„ä½“æ–¹æ³•çš„ä½¿ç”¨
 */

struct Rectangle &#123;
    width: u32,
    height: u32,
&#125;

impl Rectangle &#123;
    fn new(width: u32, height: u32) -> Self &#123;
              // new æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ª Self çš„å®ä¾‹
        Self &#123; width, height &#125;
    &#125;
    fn set_width(&amp;mut self, width: u32) &#123;
        self.width = width;
    &#125;
    fn area(&amp;self) -> u32 &#123;
        self.width * self.height
    &#125;

    fn is_wide(&amp;self) -> bool &#123;
        self.width > self.height
    &#125;

    fn can_hold(&amp;self, other: &amp;Rectangle) -> bool &#123;
        self.width > other.width &amp;&amp; self.height > other.height
    &#125;
&#125;


#[test]
fn struct_function_example() &#123;
    let rect1 = Rectangle &#123;
        width: 30,
        height: 50,
    &#125;;
    println!(
        "The area of the rectangle is &#123;&#125; square pixels.",
        rect1.area()
    );
    let mut rect2 = Rectangle &#123;
        width: 30,
        height: 50,
    &#125;;
    rect2.set_width(20);
    println!(
        "The area of the rectangle is &#123;&#125; square pixels.",
        rect2.area()
    );
  
    if rect2.is_wide() &#123;
        println!("The rectangle is wide.");
    &#125; else &#123;
        println!("The rectangle is not wide.");
    &#125;

    // ä½¿ç”¨new
    let rect3 = Rectangle::new(30, 50);

    // can_hold
    println!(
        "The area of the rectangle is &#123;&#125; square pixels.",
        Rectangle::area(&amp;rect3)
    );
&#125;

å®ç°trait
å®ç°äº†é€šç”¨çš„è®¡ç®—é€»è¾‘
trait Shape &#123;
    fn area(&amp;self) -> u32;
&#125;

impl Shape for Rectangle &#123;
    fn area(&amp;self) -> u32 &#123;
        self.width * self.height
    &#125;
&#125;

trait Shape &#123;
    fn area(&amp;self) -> u32;
&#125;

impl Shape for Rectangle &#123;
    fn area(&amp;self) -> u32 &#123;
        self.width * self.height
    &#125;
&#125;

impl Shape for Circle &#123;
    fn area(&amp;self) -> u32 &#123;
        3 * self.radius * self.radius
    &#125;
&#125;

// æ–°å»ºä¸€ä¸ªåœ†å½¢
struct Circle &#123;
    radius: u32,
&#125;
impl Circle &#123;
    fn new(radius: u32) -> Self &#123;
        Circle &#123; radius &#125;
    &#125;
&#125;


/**
 * é€šè¿‡impl Traitå¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œ
 * è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯ä»»ä½•å®ç°äº†Shape traitçš„ç±»å‹ã€‚
 * è¿™ä¸ªå‡½æ•°å¯ä»¥ä¼ å…¥åœ†å½¢å’ŒçŸ©å½¢ï¼Œéƒ½å¯ä»¥è¿›è¡Œareaè®¡ç®—ï¼Œå®ç°äº†é€šç”¨çš„è®¡ç®—é€»è¾‘
 */
fn print_area(shape: &amp;impl Shape) &#123;
    println!("&#123;&#125;", shape.area());
&#125;

#[test]
fn test_trait_impl() &#123;
    // ä½¿ç”¨traité€šç”¨è®¡ç®—
    let rect4 = Rectangle::new(30, 50);
    let circle1 = Circle::new(100);
    print_area(&amp;rect4);
    print_area(&amp;circle1);
&#125;

è‡ªå·±å®ç°Display
å¦‚æœæˆ‘ä»¬æƒ³æ‰“å°å‡ºæ¥æ•´ä¸ªçŸ©å½¢ï¼Œè¯¥å¦‚ä½•å¤„ç†å‘¢
use std::fmt::Display;

impl Display for Rectangle &#123;
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;'_>) -> std::fmt::Result &#123;
        for _ in 0..self.height &#123;
            let mut s = String::new();
            for w in 0..self.width &#123;
                s.push('6');
            &#125;
            write!(f, "&#123;&#125;\n", s);
        &#125;

        Ok(())
    &#125;
&#125;

#[test]
fn print_the_rectangle() &#123;
    let rect1 = Rectangle &#123;
        width: 30,
        height: 50,
    &#125;;
    println!("&#123;&#125;", rect1);
&#125;

æˆåŠŸï¼š

è‡ªå·±å®ç°debug
ä¸€èˆ¬å¯ä»¥é€šè¿‡æ´¾ç”Ÿæ¥å®ç°debug
#[derive(Debug)]
struct Rectangle &#123;
    width: u32,
    height: u32,
&#125;
å°±å¯ä»¥ä½¿ç”¨&quot;&#123;:?&#125;&quot; æ‰“å°ç»“æ„ä½“
#[test]
fn print_the_rectangle() &#123;
    let rect1 = Rectangle &#123;
        width: 30,
        height: 50,
    &#125;;

    println!("&#123;:?&#125;", rect1);
&#125;
----------------------------
Rectangle &#123; width: 30, height: 50 &#125;

ä¸ä½¿ç”¨æ´¾ç”Ÿ,è‡ªå·±å®ç°ï¼š
use std::fmt::Debug;
impl Debug for Rectangle &#123;
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;'_>) -> std::fmt::Result &#123;
        write!(
            f,
            "Rectangle: width: &#123;&#125;, height: &#123;&#125;",
            self.width, self.height
        );

        Ok(())
    &#125;
&#125;
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part8]_æ¨¡å¼åŒ¹é…ã€å¸¸è§é›†åˆ</title>
    <url>/2025/07/15/Rust%E5%9F%BA%E7%A1%80-part8-%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D%E3%80%81%E5%B8%B8%E8%A7%81%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[RuståŸºç¡€[part8]_æ¨¡å¼åŒ¹é…ã€å¸¸è§é›†åˆ
æ¨¡å¼åŒ¹é…
æ£€æŸ¥æ•°æ®ç»“æ„ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œç®€æ´æ€§ï¼Œå‡å°‘é”™è¯¯ï¼Œå°¤å…¶åœ¨å¤„ç†å¤æ‚æ•°æ®ç»“æ„çš„æ—¶å€™
åŸºç¡€æ¨¡å¼åŒ¹é…
fn match_example() &#123;
    let x = 5;
    // å¿…é¡»è¦æœ‰æ‰€æœ‰å¯èƒ½çš„case
    match x &#123;
        1 => println!("one"),
        2 => println!("two"),
        3 => println!("three"),
        _ => println!("something else"),
    &#125;
&#125;
å®ˆå«
åœ¨æ¨¡å¼åŒ¹é…ä¸­ï¼Œå¯ä»¥æ€»ä½¿ç”¨å®ˆå«æ¥æ·»åŠ é¢å¤–çš„æ¡ä»¶åˆ¤æ–­ã€‚
let x = 5;
match x &#123;
    n if n > 5 => println!("x is greater than 5"),
    _ => println!("x is less than or equal to 5"),
&#125;
ç»‘å®š
åœ¨æ¨¡å¼åŒ¹é…ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç»‘å®šæ¥å°†æ¨¡å¼ä¸­çš„å€¼ç»‘å®šåˆ°å˜é‡ä¸Š
@ 0..=5è¿™ä¸ªæ˜¯ç”¨æ¥æŒ‡å®šèŒƒå›´çš„
// ç»‘å®šï¼šå¯ä»¥æŠŠåŒ¹é…åˆ°çš„å€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ä¸Š
    let enum1 = MyEnum::Hello &#123; a: 5 &#125;;
    match enum1 &#123;
        MyEnum::Hello &#123; a: val @ 0..=5 &#125; => println!("x is &#123;&#125;", val),
        MyEnum::Hello &#123; a: val @ 5.. &#125; => println!("x is &#123;&#125;", val),
        MyEnum::B(s) => println!("s is &#123;&#125;", s),
        MyEnum::C => println!("C"),
        _ => println!("something else"),
    &#125;
åº”ç”¨åœºæ™¯


å¤„ç†é”™è¯¯
/**
 * åŒ¹é…æ¨¡å¼åº”ç”¨åœºæ™¯
 */
fn pattern_match_example() &#123; 
    // 1 åŒ¹é…é”™è¯¯
    match divide(3, 2) &#123;
        Ok(result) => println!("Result: &#123;&#125;", result),
        Err(error) => println!("Error: &#123;&#125;", error),
    &#125;
&#125;

fn divide(a: i32, b: i32) -> Result&lt;i32, String> &#123;
    if b == 0 &#123;
        return Err("Division by zero is not allowed".to_string());
    &#125; else &#123;
        Ok(a / b)
    &#125;
&#125;



è§£æå‘½ä»¤è¡Œå‚æ•°


è§£æé…ç½®æ–‡ä»¶


è§£ææ•°æ®åŒ…


è§£æXMLæˆ–JSON


é«˜çº§åŒ¹é…æŠ€å·§
åµŒå¥—æ¨¡å¼
è¿™é‡Œ Message::Move &#123; x, y &#125; æ˜¯ä¸€ä¸ªåµŒå¥—æ¨¡å¼ï¼Œå› ä¸ºå®ƒï¼š

åŒ¹é…å¤–å±‚æšä¸¾å˜ä½“ Message::Move
åŒæ—¶è§£æ„äº†å†…éƒ¨çš„ç»“æ„ä½“å­—æ®µ &#123; x: i32, y: i32 &#125;

è¿™æ ·ä½ å°±å¯ä»¥åœ¨ä¸€ä¸ªæ­¥éª¤ä¸­ç›´æ¥è®¿é—®åˆ° x å’Œ yã€‚
enum Message &#123;
      Quit,
      Move &#123; x: i32, y: i32 &#125;,
      Write(String),
      ChangeColor(i32, i32, i32),
  &#125;
  let msg = Message::Move &#123; x: 10, y: 20 &#125;;

  match msg &#123;
      Message::Quit => println!("Quit"),
      Message::Move &#123; x, y &#125; => println!("Move to (&#123;&#125;, &#123;&#125;)", x, y),
      Message::Write(text) => println!("Write: &#123;&#125;", text),
      Message::ChangeColor(r, g, b) => println!("Change color to (&#123;&#125;, &#123;&#125;, &#123;&#125;)", r, g, b),// å¯ä»¥ä½¿ç”¨enumä¸­çš„å‚æ•°
  &#125;
åŒ¹é…æ¨¡å¼å’Œè¿­ä»£å™¨ï¼šç»“åˆiterå’Œmatchä½¿ç”¨

for (a, b) ä¸­çš„æ‹¬å·ç»“æ„æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ¨¡å¼åŒ¹é…è¯­æ³•
å®ƒå’Œ match ä¸€æ ·å¯ä»¥è§£æ„å…ƒç»„ã€ç»“æ„ä½“ã€æšä¸¾ç­‰å¤æ‚ç±»å‹
iter() æä¾›äº†è¿­ä»£å™¨çš„èƒ½åŠ›ï¼Œmatchï¼ˆæˆ–æ¨¡å¼åŒ¹é…ï¼‰æä¾›äº†ç»“æ„è§£æ„çš„èƒ½åŠ›
æ‰€ä»¥è¿™æ®µä»£ç ä½“ç°äº† iter å’Œ match çš„ç»“åˆä½¿ç”¨

fn iterator_match_example() &#123; 
    let vec1 = vec![1, 2, 3];
    let vec2 = vec![4, 5, 6];
    for (a, b) in vec1.iter().zip(vec2)  &#123;
        println!("&#123;&#125; + &#123;&#125; = &#123;&#125;", a, b, a+b);
    &#125;
&#125;
if let å’Œwhile letï¼š ç®€åŒ–å•ä¸ªæ¨¡å¼åŒ¹é…
fn if_let_example() &#123;
    let option = Some(5);
    if let Some(x) = option &#123;
        println!("&#123;&#125;", x);
    &#125;
&#125;

fn while_let_example() &#123;
    let mut vec = vec![1, 2, 3];
    while let Some(x) = vec.pop() &#123;
        println!("&#123;&#125;", x);
    &#125;
&#125;
refå’Œref mut

å€Ÿç”¨æ•°æ®è€Œä¸è½¬ç§»æ‰€æœ‰æƒï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦å€Ÿç”¨æ•°æ®è€Œä¸æ˜¯è½¬ç§»æ‰€æœ‰æƒã€‚ä¾‹å¦‚åœ¨é€’å½’æ•°æ®ç»“æ„ä¸­ï¼Œå€Ÿç”¨æ•°æ®å¯ä»¥é¿å…æ‰€æœ‰æƒè½¬ç§»å¸¦æ¥çš„å¤æ‚æ€§
å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼šä½¿ç”¨ref mut å¯ä»¥åœ¨æ¨¡å¼åŒ¹é…æ—¶å¯¹å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ— éœ€è½¬ç§»æ‰€æœ‰æƒ

fn ref_example() &#123;
    let x = 5;
    match x &#123;
        ref var => println!("&#123;&#125;", var),
        _ => &#123;&#125;
    &#125;
&#125;

fn ref_mut_example() &#123;
    let mut x = 5;
    match x &#123;
        ref mut var => &#123;
            *var += 1;
        &#125;
        _ => &#123;&#125;
    &#125;
&#125;

ç»ƒä¹ 
ç›®æ ‡

ç†è§£å¦‚ä½•ä½¿ç”¨ Rust çš„æ¨¡å¼åŒ¹é…åŠŸèƒ½è§£æ JSON æ•°æ®ã€‚
å­¦ä¼šä½¿ç”¨ serde_json åº“è¿›è¡Œ JSON å¤„ç†ã€‚
ç»ƒä¹ åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ä½¿ç”¨æ¨¡å¼åŒ¹é…ã€‚

è¦æ±‚

ä½¿ç”¨ serde_json åº“è§£æ JSON å­—ç¬¦ä¸²ã€‚
ä½¿ç”¨æ¨¡å¼åŒ¹é…æå– JSON å¯¹è±¡ä¸­çš„ä¸åŒå­—æ®µã€‚
å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€åµŒå¥—å¯¹è±¡ç­‰ï¼‰ã€‚

ç¤ºä¾‹
å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«ç”¨æˆ·ä¿¡æ¯çš„ JSON å­—ç¬¦ä¸²ï¼š
&#123;
  "name": "Alice",
  "age": 30,
  "email": "alice@example.com",
  "address": &#123;
    "street": "123 Main St",
    "city": "Wonderland"
  &#125;,
  "phone_numbers": ["123-456-7890", "987-654-3210"]
&#125;
ç­”æ¡ˆï¼š
use serde_json::&#123;Result, Value&#125;;
use std::fmt;

// å®šä¹‰é”™è¯¯ç±»å‹ï¼ˆæ›¿ä»£ç®€å•çš„ String é”™è¯¯ï¼‰
#[derive(Debug)]
enum ParseError &#123;
    Json(serde_json::Error),
    FieldMissing(&amp;'static str),
    TypeMismatch(&amp;'static str, &amp;'static str), // å­—æ®µå + æœŸæœ›ç±»å‹
    NumberRange(&amp;'static str), // æ•°å­—è¶…å‡ºèŒƒå›´
&#125;

impl fmt::Display for ParseError &#123;
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -> fmt::Result &#123;
        match self &#123;
            ParseError::Json(e) => write!(f, "JSON è§£æé”™è¯¯: &#123;e&#125;"),
            ParseError::FieldMissing(field) => write!(f, "å­—æ®µç¼ºå¤±: &#123;field&#125;"),
            ParseError::TypeMismatch(field, expect) => &#123;
                write!(f, "å­—æ®µ &#123;field&#125; ç±»å‹é”™è¯¯ï¼ŒæœŸæœ› &#123;expect&#125;")
            &#125;
            ParseError::NumberRange(field) => write!(f, "å­—æ®µ &#123;field&#125; æ•°å€¼è¶…å‡ºèŒƒå›´"),
        &#125;
    &#125;
&#125;

impl From&lt;serde_json::Error> for ParseError &#123;
    fn from(e: serde_json::Error) -> Self &#123;
        ParseError::Json(e)
    &#125;
&#125;

#[derive(Debug)]
struct Address &#123;
    street: String,
    city: String,
&#125;

#[derive(Debug)]
struct Info &#123;
    name: String,
    age: u32,
    email: String,
    address: Address,
    phone_numbers: Vec&lt;String>,
&#125;

// è§£æå‡½æ•°ï¼šä½¿ç”¨æ¨¡å¼åŒ¹é…æå–å­—æ®µï¼Œè¿”å› Result å¤„ç†é”™è¯¯
fn parse_json(json: &amp;str) -> Result&lt;Info, ParseError> &#123;
    let value: Value = serde_json::from_str(json)?;

    // 1. æå– nameï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰
    let name = match value.get("name") &#123;
        Some(Value::String(s)) => s.to_string(),
        Some(_) => return Err(ParseError::TypeMismatch("name", "å­—ç¬¦ä¸²")),
        None => return Err(ParseError::FieldMissing("name")),
    &#125;;

    // 2. æå– ageï¼ˆéè´Ÿæ•´æ•°ï¼Œä¸”åœ¨ u32 èŒƒå›´å†…ï¼‰
    let age = match value.get("age") &#123;
        Some(Value::Number(n)) => &#123;
            n.as_u64()
                .ok_or(ParseError::TypeMismatch("age", "éè´Ÿæ•´æ•°"))?
                .try_into()
                .map_err(|_| ParseError::NumberRange("age"))?
        &#125;
        Some(_) => return Err(ParseError::TypeMismatch("age", "æ•°å­—")),
        None => return Err(ParseError::FieldMissing("age")),
    &#125;;

    // 3. æå– emailï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰
    let email = match value.get("email") &#123;
        Some(Value::String(s)) => s.to_string(),
        Some(_) => return Err(ParseError::TypeMismatch("email", "å­—ç¬¦ä¸²")),
        None => return Err(ParseError::FieldMissing("email")),
    &#125;;

    // 4. æå–åµŒå¥—å¯¹è±¡ address
    let address = match value.get("address") &#123;
        Some(Value::Object(obj)) => &#123;
            let street = match obj.get("street") &#123;
                Some(Value::String(s)) => s.to_string(),
                Some(_) => return Err(ParseError::TypeMismatch("address.street", "å­—ç¬¦ä¸²")),
                None => return Err(ParseError::FieldMissing("address.street")),
            &#125;;
            let city = match obj.get("city") &#123;
                Some(Value::String(s)) => s.to_string(),
                Some(_) => return Err(ParseError::TypeMismatch("address.city", "å­—ç¬¦ä¸²")),
                None => return Err(ParseError::FieldMissing("address.city")),
            &#125;;
            Address &#123; street, city &#125;
        &#125;
        Some(_) => return Err(ParseError::TypeMismatch("address", "å¯¹è±¡")),
        None => return Err(ParseError::FieldMissing("address")),
    &#125;;

    // 5. æå–æ•°ç»„ phone_numbersï¼ˆå…ƒç´ ä¸ºå­—ç¬¦ä¸²ï¼‰
    let phone_numbers = match value.get("phone_numbers") &#123;
        Some(Value::Array(arr)) => &#123;
            arr.iter()
                .map(|elem| match elem &#123;
                    Value::String(s) => Ok(s.to_string()),
                    _ => Err(ParseError::TypeMismatch("phone_numbers å…ƒç´ ", "å­—ç¬¦ä¸²")),
                &#125;)
                .collect::&lt;Result&lt;Vec&lt;_>, _>>()?
        &#125;
        Some(_) => return Err(ParseError::TypeMismatch("phone_numbers", "æ•°ç»„")),
        None => return Err(ParseError::FieldMissing("phone_numbers")),
    &#125;;

    Ok(Info &#123;
        name,
        age,
        email,
        address,
        phone_numbers,
    &#125;)
&#125;

fn main() &#123;
    let json_str = r#"
    &#123;
        "name": "Alice",
        "age": 30,
        "email": "alice@example.com",
        "address": &#123;
            "street": "123 Main St",
            "city": "Wonderland"
        &#125;,
        "phone_numbers": ["123-456-7890", "987-654-3210"]
    &#125;
    "#;

    match parse_json(json_str) &#123;
        Ok(info) => println!("è§£æç»“æœ:\n&#123;:#?&#125;", info),
        Err(e) => eprintln!("è§£æå¤±è´¥: &#123;e&#125;"),
    &#125;
&#125;
å¸¸è§é›†åˆ
Vec
åŸºæœ¬ç”¨æ³•

åˆ›å»ºå’Œåˆå§‹åŒ–
æ·»åŠ å…ƒç´ 
è®¿é—®å…ƒç´ 
ä¿®æ”¹å…ƒç´ 
éå†å…ƒç´ 

// åˆ›å»ºä¸€ä¸ªç©ºçš„vec
    let mut v: Vec&lt;i32> = Vec::new();
    // ä½¿ç”¨å®æ¥åˆ›å»ºä¸€ä¸ªveck k
    let mut v1: Vec&lt;i32> = vec![1, 2, 3];

    // æ·»åŠ å…ƒç´ 
    v.push(5);

    // è®¿é—®å…ƒç´ 
    // 1.ä½¿ç”¨ç´¢å¼•
    let third: &amp;i32 = &amp;v[2];
    println!("The third element is &#123;&#125;", third);
    // 2.ä½¿ç”¨getæ–¹æ³•
    match v.get(2) &#123;
        Some(third) => println!("The third element is &#123;&#125;", third),
        None => println!("There is no third element."),
    &#125;

    // ä¿®æ”¹å…ƒç´ 
    v[0] = 4;

    // è¿­ä»£å…ƒç´ 
    for i in &amp;v &#123;
        println!("&#123;&#125;", i);
    &#125;
é«˜é˜¶ç”¨æ³•ï¼š
// è¿›é˜¶çš„ç”¨æ³•
  // 1.ä½¿ç”¨æšä¸¾æ¥å­˜å‚¨å¤šç§ç±»å‹
  enum SpreadsheetCell &#123;
      Int(i32),
      Float(f64),
      Text(String),
  &#125;

  let row = vec![
      SpreadsheetCell::Int(3),
      SpreadsheetCell::Text(String::from("blue")),
      SpreadsheetCell::Float(10.12),
  ];

  // 2.å®¹é‡ä¸é‡æ–°åˆ†é…
  let mut v = Vec::with_capacity(10);
  v.push(1);
  println!("&#123;&#125;", v.capacity());

å¸¸è§é”™è¯¯:


ä¸å®‰å…¨çš„ç´¢å¼•è®¿é—®ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨match
// ä¸å®‰å…¨çš„ç´¢å¼•è®¿é—®
    let v2 = vec![1, 2, 3, 4, 5];
    // println!("&#123;&#125;", v2[100]); // è¿è¡Œæ—¶ä¼šå‡ºé”™



å¯å˜å¼•ç”¨ä¸ä¸å¯å˜å¼•ç”¨çš„æ··ç”¨

// å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨æ··ç”¨
    let mut v3 = vec![1, 2, 3, 4, 5];
    let first = &amp;v3[0];
    v3.push(6); // è¿™é‡Œä¼šæŠ¥é”™
    println!("&#123;&#125;", first);

---------------
cannot borrow `v3` as mutable because it is also borrowed as immutable
mutable borrow occurs hererustcClick for full compiler diagnostic

ä¿®å¤çš„è¯å¯ä»¥åˆ†ä¸¤ç§ï¼Œå¯ä»¥ä¿®æ”¹pushçš„é¡ºåºï¼Œæˆ–è€…ä½¿ç”¨ä½œç”¨åŸŸçš„ç‰¹æ€§æ¥æ§åˆ¶å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
// ç¬¬ä¸€ç§
v3.push(6);
let first: &amp;i32 = &amp;v3[0];

// ç¬¬äºŒç§
&#123;
        let first: &amp;i32 = &amp;v3[0];
        println!("&#123;&#125;", first);
    &#125;
    v3.push(6);


HashMap
åŸºæœ¬æ“ä½œ
// åŸºæœ¬æ“ä½œ
  let mut scores: HashMap&lt;String, i32> = HashMap::new();
  scores.insert(String::from("Blue"), 10);
  scores.insert(String::from("Yellow"), 50);

  // è·å–å…ƒç´ 
  let team_name = String::from("Blue");
  let score: Option&lt;&amp;i32> = scores.get(&amp;team_name);

  match score &#123;
      Some(score) => println!("&#123;&#125;", score),
      None => println!("None"),
  &#125;

  // éå†
  for (key, value) in &amp;scores &#123;
      println!("&#123;&#125; : &#123;&#125;", key, value);
  &#125;
è¿›é˜¶æ“ä½œ


æ›´æ–°å“ˆå¸Œè¡¨
// æ›´æ–°
   scores.insert(String::from("Blue"), 25);
   scores.entry(String::from("Blue")).or_insert(50);
  


åˆå¹¶å“ˆå¸Œè¡¨
// åˆå¹¶ä¸¤ä¸ªé›†åˆ
  let mut map1 = HashMap::new();
  map1.insert(1, "one");
  let mut map2 = HashMap::new();
  map2.insert(2, "two");
  map2.insert(3, "three");
  for (k, v) in &amp;map2 &#123;
      map1.entry(*k).or_insert(&amp;v);
  &#125;
  println!("&#123;:?&#125;", map1);


å¸¸è§é™·é˜±


å“ˆå¸Œå†²çª


æ‰€æœ‰æƒé—®é¢˜


fn hashmap_ownership() &#123;
    let mut scores = HashMap::new();
    let team_name = String::from("Blue");
    let team_score = 10;
    scores.insert(team_name, team_score);
    println!("&#123;:?&#125;", scores);

    println!("&#123;&#125;", team_name); // è¿™é‡Œä¼šæŠ¥é”™
ä¿®æ”¹ä¸º.clone()
scores.insert(team_name.clone(), team_score.clone());
ç»ƒä¹ 

ä½¿ç”¨Vecå®ç°ä¸€ä¸ªç®€å•çš„æ ˆ

struct Stack&lt;T> &#123;
    elements: Vec&lt;T>,
&#125;

impl&lt;T> Stack&lt;T> &#123;
    // åˆå§‹åŒ–ç©ºæ ˆ
    fn new() -> Self &#123;
        Stack &#123;
            elements: Vec::new(),
        &#125;
    &#125;

    // å…¥æ ˆï¼šå‘å°¾éƒ¨æ·»åŠ å…ƒç´ 
    fn push(&amp;mut self, item: T) &#123;
        self.elements.push(item);
    &#125;

    // å‡ºæ ˆï¼šç§»é™¤å¹¶è¿”å›å°¾éƒ¨å…ƒç´ ï¼ˆç©ºæ ˆæ—¶è¿”å› Noneï¼‰
    fn pop(&amp;mut self) -> Option&lt;T> &#123;
        self.elements.pop()
    &#125;

    // æŸ¥çœ‹æ ˆé¡¶ï¼šè¿”å›å°¾éƒ¨å…ƒç´ çš„å¼•ç”¨ï¼ˆç©ºæ ˆæ—¶è¿”å› Noneï¼‰
    fn peek(&amp;self) -> Option&lt;&amp;T> &#123;
        self.elements.last()
    &#125;
&#125;
#[test]
// æµ‹è¯•ç”¨ä¾‹
fn main() &#123;
    let mut stack = Stack::new();
    stack.push(1);
    stack.push(2);
    stack.push(3);

    println!("æ ˆé¡¶å…ƒç´ ï¼ˆpeekï¼‰: &#123;:?&#125;", stack.peek()); // è¾“å‡º: Some(3)
    println!("å‡ºæ ˆå…ƒç´ ï¼ˆpopï¼‰: &#123;:?&#125;", stack.pop()); // è¾“å‡º: Some(3)
    println!("å‡ºæ ˆåæ ˆé¡¶: &#123;:?&#125;", stack.peek()); // è¾“å‡º: Some(2)
&#125;


ä½¿ç”¨HashMapå®ç°å­—é¢‘ç»Ÿè®¡å™¨

/**
 * é€šè¿‡hashmapè®¡ç®—å•è¯é¢‘ç‡
 */

fn count_frequency(s: &amp;str) -> HashMap&lt;&amp;str, i32> &#123;
    let mut letters: HashMap&lt;&amp;str, i32> = HashMap::new();
    for ch in s.split_whitespace() &#123;
        letters
            .entry(ch)
            .and_modify(|counter| *counter += 1)
            .or_insert(1);
    &#125;
    return letters;
&#125;

#[test]
fn test_count_frequency() &#123;
    let s = "hello world hello rust";
    let letters = count_frequency(s);
    println!("&#123;:?&#125;", letters);
&#125;


ä½¿ç”¨Vecå’ŒHashMapå®ç°ä¸€ä¸ªç®€å•çš„ä¹¦ç±åº“å­˜ç®¡ç†ç³»ç»Ÿï¼š

// åº“å­˜ç®¡ç†ç³»ç»Ÿ
struct InventorySystem &#123;
    books: Vec&lt;Book>,                 // å­˜å‚¨æ‰€æœ‰ä¹¦ç±
    id_to_index: HashMap&lt;u32, usize>, // ID -> Vecç´¢å¼•çš„æ˜ å°„
    next_id: u32,                     // ä¸‹ä¸€ä¸ªå¯ç”¨IDï¼ˆè‡ªå¢ï¼‰
&#125;

impl InventorySystem &#123;
    // åˆå§‹åŒ–ç©ºç³»ç»Ÿ
    fn new() -> Self &#123;
        InventorySystem &#123;
            books: Vec::new(),
            id_to_index: HashMap::new(),
            next_id: 1, // IDä»1å¼€å§‹
        &#125;
    &#125;

    // æ·»åŠ ä¹¦ç±ï¼šè‡ªåŠ¨åˆ†é…IDï¼Œè¿”å›æ–°ä¹¦ç±ID
    fn add_book(&amp;mut self, title: String, author: String, quantity: u32) -> u32 &#123;
        let id = self.next_id;
        self.next_id += 1;

        let book = Book &#123;
            id,
            title,
            author,
            quantity,
        &#125;;
        let index = self.books.len();
        self.books.push(book);
        self.id_to_index.insert(id, index); // è®°å½•IDä¸ç´¢å¼•çš„æ˜ å°„

        id
    &#125;

    // æŒ‰IDæŸ¥è¯¢ä¹¦ç±ï¼šè¿”å›Option&lt;&amp;Book>ï¼ˆä¸å­˜åœ¨åˆ™è¿”å›Noneï¼‰
    fn get_book(&amp;self, id: u32) -> Option&lt;&amp;Book> &#123;
        self.id_to_index.get(&amp;id).map(|&amp;index| &amp;self.books[index]) // é€šè¿‡ç´¢å¼•å–ä¹¦ç±å¼•ç”¨
    &#125;

    // æŒ‰æ ‡é¢˜æ¨¡ç³ŠæŸ¥è¯¢ï¼šè¿”å›æ‰€æœ‰åŒ…å«è¯¥æ ‡é¢˜çš„ä¹¦ç±
    fn search_by_title(&amp;self, title: &amp;str) -> Vec&lt;&amp;Book> &#123;
        self.books
            .iter()
            .filter(|book| book.title.contains(title))
            .collect()
    &#125;

    // æ›´æ–°åº“å­˜ï¼šæŒ‰IDä¿®æ”¹æ•°é‡ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ
    fn update_quantity(&amp;mut self, id: u32, new_quantity: u32) -> bool &#123;
        if let Some(&amp;index) = self.id_to_index.get(&amp;id) &#123;
            self.books[index].quantity = new_quantity;
            true
        &#125; else &#123;
            false
        &#125;
    &#125;

    // åˆ é™¤ä¹¦ç±ï¼šæŒ‰IDåˆ é™¤ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ
    // ï¼ˆæ³¨ï¼šåˆ é™¤æ—¶å°†æœ€åä¸€æœ¬ä¹¦ç§»åˆ°è¢«åˆ ä½ç½®ï¼Œä¿è¯Vecç´¢å¼•ä¸€è‡´æ€§ï¼‰
    fn remove_book(&amp;mut self, id: u32) -> bool &#123;
        if let Some(index) = self.id_to_index.remove(&amp;id) &#123;
            // è‹¥åˆ é™¤çš„ä¸æ˜¯æœ€åä¸€æœ¬ä¹¦ï¼Œå°†æœ€åä¸€æœ¬ä¹¦ç§»åˆ°åˆ é™¤ä½ç½®
            if index &lt; self.books.len() - 1 &#123;
                let last_book = self.books.pop().unwrap(); // å–å‡ºæœ€åä¸€æœ¬ä¹¦
                self.books[index] = last_book.clone(); // è¦†ç›–åˆ°åˆ é™¤ä½ç½®
                self.id_to_index.insert(last_book.id, index); // æ›´æ–°æœ€åä¸€æœ¬ä¹¦çš„ç´¢å¼•æ˜ å°„
            &#125; else &#123;
                self.books.pop(); // åˆ é™¤æœ€åä¸€æœ¬ä¹¦ï¼Œæ— éœ€è°ƒæ•´æ˜ å°„
            &#125;
            true
        &#125; else &#123;
            false
        &#125;
    &#125;
&#125;

// æµ‹è¯•ç”¨ä¾‹
#[test]
fn test_inventory_system() &#123;
    let mut inventory = InventorySystem::new();

    // æ·»åŠ ä¹¦ç±
    let id1 = inventory.add_book("Rustç¼–ç¨‹å…¥é—¨".to_string(), "å¼ ä¸‰".to_string(), 10);
    let id2 = inventory.add_book("Effective Rust".to_string(), "æå››".to_string(), 5);

    // æŸ¥è¯¢ä¹¦ç±
    println!("ä¹¦ç±1: &#123;&#125;", inventory.get_book(id1).unwrap());
    println!("ä¹¦ç±2: &#123;&#125;", inventory.get_book(id2).unwrap());

    // æ›´æ–°åº“å­˜
    inventory.update_quantity(id1, 20);
    println!("æ›´æ–°åä¹¦ç±1: &#123;&#125;", inventory.get_book(id1).unwrap());

    // æ¨¡ç³ŠæŸ¥è¯¢
    let results = inventory.search_by_title("Rust");
    println!("å«'Rust'çš„ä¹¦ç±:");
    for book in results &#123;
        println!("&#123;&#125;", book);
    &#125;

    // åˆ é™¤ä¹¦ç±
    inventory.remove_book(id2);
    println!("åˆ é™¤ä¹¦ç±2åï¼ŒæŸ¥è¯¢æ˜¯å¦å­˜åœ¨: &#123;:?&#125;", inventory.get_book(id2));
&#125;


]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part3]_å‡½æ•°ã€æµç¨‹æ§åˆ¶</title>
    <url>/2025/07/10/Rust%E5%9F%BA%E7%A1%80-part3-%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[RuståŸºç¡€[part3]_å‡½æ•°ã€æµç¨‹æ§åˆ¶
å‡½æ•°
ç»„æˆå’Œå®šä¹‰
fn add(i: i32, j: i32) -> i32 &#123;
    i + j
&#125;

å£°æ˜å‡½æ•°çš„å…³é”®å­— fn
å‡½æ•°åadd()
å‚æ•°iå’Œjå’Œå‚æ•°ç±»å‹ i32
è¿”å›å€¼ç±»å‹`i32``
å‡½æ•°é¢˜i+j

å‡½æ•°è¿”å›
è¿”å›å½¢æ€
i+j å’Œ return i+j;
å¯ä»¥æœ‰ä¸¤ç§å½¢æ€

return + åˆ†å·
æ— return + æ— åˆ†å·

æ— è¿”å›å€¼çš„æƒ…å†µï¼š
å°±è¿”å› ()
fn add(i: i32, j: i32) -> () &#123;
  
&#125;
æ°¸ä¸è¿”å›å€¼çš„æƒ…å†µï¼š
!è¡¨ç¤ºå‡½æ•°æ°¸ä¸è¿”å›ï¼Œä¾‹å¦‚panic!å®ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå‡½æ•°ä¸ä¼šè¿”å›ã€‚
fn add_one(i: i32, j: i32) -> ! &#123;
    panic!("weeee");
&#125;
æ­»å¾ªç¯ä¹Ÿä¸ä¼šè¿”å›
fn infinite_loop() -> ! &#123;
    loop &#123;
        // æ°¸è¿œä¸ä¼šè¿”å›
    &#125;
&#125;

æµç¨‹æ§åˆ¶
ifè¯­æ³•
 // if_else();
  let number = 3;
  if number &lt; 5 &#123;
      println!("Condition was true");
  &#125; else &#123;
      println!("Condition was false");
  &#125;
	
// else if
	let number = 3;
  if number % 4 == 0&#123;
      println!("Condition was true");
  &#125; else if number % 3 == 0 &#123;
      println!("Condition was true for number % 3");
  &#125; else if number % 2 == 0 &#123;
      println!("Condition was true for number % 2");
  &#125; else &#123;
      println!("Condition was false");
  &#125;

let è¯­å¥ä¸­ä½¿ç”¨ifï¼Œéœ€è¦æ³¨æ„åˆ†å·ç»“å°¾ã€‚
let condition = true;
   let number = if condition &#123; 5 &#125; else &#123; 6 &#125;;
   println!("The value of number is: &#123;&#125;", number);
loopå¾ªç¯
//loop å¾ªç¯
    loop &#123;
        println!("This is an infinite loop");
    &#125;

breakã€ continue
ä½¿ç”¨break å…³é”®å­—æ¥å‘Šè¯‰ç¨‹åºåœæ­¢å¾ªç¯ï¼Œä½¿ç”¨continueå…³é”®å­—æ¥å‘Šè¯‰ç¨‹åºç»§ç»­å¾ªç¯ã€‚
letè¯­å¥ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨loopè¿”å›, éœ€è¦æ³¨æ„åˆ†å·ç»“å°¾ã€‚
// letè¯­å¥ä¸­ä½¿ç”¨loop
   let result = loop &#123;
       count += 1;
       if count == 10 &#123;
           println!("Breaking the loop at count: &#123;&#125;", count);
           break count * 2; // è¿”å›å€¼
       &#125;
   &#125;;
å¤šå±‚loop
breaké€€å‡ºå†…å±‚å¾ªç¯ï¼Œå¯ä»¥ä½¿ç”¨å‘½åloopçš„æ–¹æ³•æ¥é€€å‡ºæŒ‡å®šçš„å¾ªç¯ã€‚æ ‡ç­¾çš„è¯­æ³•æ˜¯ä½¿ç”¨å•å¼•å·ï¼ˆ'ï¼‰åè·Ÿä¸€ä¸ªæ ‡è¯†ç¬¦
// å¤šå±‚å¾ªç¯å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¥æ§åˆ¶è·³å‡ºç‰¹å®šçš„å¾ªç¯å±‚çº§
   // æ ‡ç­¾å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨å¤šå±‚åµŒå¥—å¾ªç¯ä¸­è·³å‡ºç‰¹å®šçš„å¾ªç¯å±‚çº§
   // æ ‡ç­¾çš„è¯­æ³•æ˜¯ä½¿ç”¨å•å¼•å·ï¼ˆ'ï¼‰åè·Ÿä¸€ä¸ªæ ‡è¯†ç¬¦
   let mut i = 0;
   'outerloop: loop &#123;
       loop &#123;
           i += 1;
           println!("Inner loop iteration with i: &#123;&#125;", i);
           if i == 2 &#123;
               println!("Breaking out of the inner loop at i: &#123;&#125;", i);
               break; // è·³å‡ºå†…å±‚å¾ªç¯
           &#125;
           if i == 3 &#123;
               println!("Breaking out of the outer loop at i: &#123;&#125;", i);
               break 'outerloop; // è·³å‡ºå¤–å±‚å¾ªç¯
           &#125;
       &#125;
   &#125;
while æ¡ä»¶å¾ªç¯
fn while_example() &#123;
    let mut count: i32 = 0;
    while count &lt; 5 &#123;
        count += 1;
        println!("Current count: &#123;&#125;", count);
    &#125;
&#125;
åœ¨rustä¸­å¦‚æœæ˜¯æ¡ä»¶åˆ¤æ–­çš„å¾ªç¯ï¼Œä½¿ç”¨whileæ˜¯æ¯”è¾ƒä¾¿æ·çš„ï¼Œå¦‚æœéœ€è¦éå†é›†åˆçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨for
foréå†é›†åˆ
fn for_example() &#123;
    let numbers = [1, 2, 3, 4, 5];
    for i in numbers &#123;
        println!("Current number: &#123;&#125;", i)
    &#125;

    // ç›´æ¥éå†æ•°å€¼ï¼Œé€†åºä½¿ç”¨rev()
    for i in (1..=4).rev() &#123;
        println!("Current number in range: &#123;&#125;", i);
    &#125;
&#125;
æ‰€æœ‰æƒè½¬ç§»ä¸å€Ÿç”¨ï¼š
æ˜¯Rustä¸­çš„å¾ªç¯è®¿é—®è§„åˆ™
1. æœªå®ç°Copy traitçš„ç±»å‹ï¼šæ‰€æœ‰æƒä¼šè½¬ç§»ï¼ˆMoveè¯­ä¹‰ï¼‰
åƒVecè¿™ç±»é›†åˆç±»å‹æ²¡æœ‰å®ç°Copy traitï¼Œå½“ç›´æ¥ç”¨å®ƒä»¬è¿›è¡Œå¾ªç¯éå†ï¼ˆfor v in vecï¼‰æ—¶ï¼Œå¾ªç¯ä¼šè·å–vecçš„æ‰€æœ‰æƒï¼ˆå³â€œæ‰€æœ‰æƒè½¬ç§»â€ï¼‰ã€‚

å¾ªç¯ç»“æŸåï¼Œvecçš„æ‰€æœ‰æƒå·²è¢«æ¶ˆè€—ï¼Œæ— æ³•å†è¢«è®¿é—®ï¼ˆç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼‰ã€‚

let mut vec = vec![1, 2, 3, 4, 5];
// ç›´æ¥éå†vecï¼šæ‰€æœ‰æƒè½¬ç§»ç»™å¾ªç¯å˜é‡v
for v in vec &#123;
    println!("Current value: &#123;&#125;", v); // æ­¤æ—¶væ˜¯vecä¸­å…ƒç´ çš„æ‰€æœ‰æƒæŒæœ‰è€…
&#125;

// âŒ é”™è¯¯ï¼švecçš„æ‰€æœ‰æƒå·²è½¬ç§»ï¼Œæ— æ³•å†ä½¿ç”¨
println!("Vector after loop: &#123;:?&#125;", vec); 
2. è§£å†³åŠæ³•ï¼šç”¨â€œå€Ÿç”¨â€é¿å…æ‰€æœ‰æƒè½¬ç§»
è‹¥æƒ³åœ¨å¾ªç¯åç»§ç»­ä½¿ç”¨vecï¼Œéœ€é€šè¿‡å¼•ç”¨ï¼ˆ&amp;ï¼‰ è¿›è¡Œâ€œå€Ÿç”¨â€ï¼Œè€Œéç›´æ¥è½¬ç§»æ‰€æœ‰æƒã€‚æ ¹æ®æ˜¯å¦éœ€è¦ä¿®æ”¹å…ƒç´ ï¼Œåˆ†ä¸ºä¸¤ç§å€Ÿç”¨æ–¹å¼ï¼š
ï¼ˆ1ï¼‰ä¸å¯å˜å€Ÿç”¨ï¼ˆ&amp;vecï¼‰ï¼šä»…è¯»å–ï¼Œä¸ä¿®æ”¹
ç”¨&amp;vecè¿›è¡Œéå†ï¼Œå¾ªç¯è·å–çš„æ˜¯vecçš„ä¸å¯å˜å¼•ç”¨ï¼Œæ‰€æœ‰æƒä»å½’åŸå˜é‡æ‰€æœ‰ã€‚

å¾ªç¯ä¸­åªèƒ½è¯»å–å…ƒç´ ï¼Œä¸èƒ½ä¿®æ”¹ã€‚

let vec = vec![1, 2, 3, 4, 5];
// ä¸å¯å˜å€Ÿç”¨ï¼š&amp;vecè¡¨ç¤ºâ€œä¸´æ—¶å€Ÿç”¨vecçš„è¯»å–æƒâ€
for v in &amp;vec &#123;
    println!("Current value: &#123;&#125;", v); // væ˜¯&amp;i32ç±»å‹ï¼ˆä¸å¯å˜å¼•ç”¨ï¼‰
&#125;

// âœ… åˆæ³•ï¼švecæ‰€æœ‰æƒæœªè½¬ç§»ï¼Œå¯ç»§ç»­ä½¿ç”¨
println!("Vector after loop: &#123;:?&#125;", vec); 
ï¼ˆ2ï¼‰å¯å˜å€Ÿç”¨ï¼ˆ&amp;mut vecï¼‰ï¼šéœ€è¦ä¿®æ”¹å…ƒç´ 
è‹¥è¦åœ¨å¾ªç¯ä¸­ä¿®æ”¹å…ƒç´ ï¼Œéœ€ç”¨&amp;mut vecè¿›è¡Œå¯å˜å€Ÿç”¨ï¼Œæ­¤æ—¶å¾ªç¯å˜é‡væ˜¯&amp;mut i32ï¼ˆå¯å˜å¼•ç”¨ï¼‰ã€‚

ä¿®æ”¹å…ƒç´ æ—¶éœ€ç”¨*vè§£å¼•ç”¨ï¼ˆè·å–å¼•ç”¨æŒ‡å‘çš„å®é™…å€¼ï¼‰ã€‚

let mut vec = vec![1, 2, 3, 4, 5];
// å¯å˜å€Ÿç”¨ï¼š&amp;mut vecè¡¨ç¤ºâ€œä¸´æ—¶å€Ÿç”¨vecçš„ä¿®æ”¹æƒâ€
for v in &amp;mut vec &#123;
    if *v == 3 &#123;
        *v += 10; // âœ… è§£å¼•ç”¨åä¿®æ”¹ï¼š3 â†’ 13
    &#125;
    println!("Current value: &#123;&#125;", v); // væ˜¯&amp;mut i32ï¼Œæ‰“å°æ—¶è‡ªåŠ¨è§£å¼•ç”¨
&#125;

// âœ… åˆæ³•ï¼šæ‰€æœ‰æƒæœªè½¬ç§»ï¼Œä¿®æ”¹åçš„å€¼å·²ä¿ç•™
println!("Vector after loop: &#123;:?&#125;", vec); // è¾“å‡º [1, 2, 13, 4, 5]
3. å®ç°Copy traitçš„ç±»å‹ï¼šæ‰€æœ‰æƒä¸è½¬ç§»ï¼ˆCopyè¯­ä¹‰ï¼‰
åƒæ•´æ•°ã€å¸ƒå°”å€¼ç­‰åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä»¥åŠç”±å®ƒä»¬ç»„æˆçš„æ•°ç»„ï¼ˆ[i32; n]ï¼‰ï¼Œéƒ½å®ç°äº†Copy traitã€‚

å¾ªç¯éå†è¿™ç±»ç±»å‹æ—¶ï¼Œä¼šè‡ªåŠ¨å¤åˆ¶å…ƒç´ ï¼ˆè€Œéè½¬ç§»æ‰€æœ‰æƒï¼‰ï¼ŒåŸå˜é‡çš„æ‰€æœ‰æƒä»ä¿ç•™ï¼Œå¾ªç¯åå¯æ­£å¸¸ä½¿ç”¨ã€‚

let arr = [1, 2, 3, 4, 5]; // æ•°ç»„å…ƒç´ æ˜¯i32ï¼ˆå®ç°äº†Copyï¼‰
// éå†arrï¼šä¼šå¤åˆ¶æ¯ä¸ªå…ƒç´ ç»™vï¼Œè€Œéè½¬ç§»æ‰€æœ‰æƒ
for v in arr &#123;
    println!("Current value: &#123;&#125;", v); // væ˜¯å¤åˆ¶çš„i32å€¼
&#125;

// âœ… åˆæ³•ï¼šarrçš„æ‰€æœ‰æƒæœªè½¬ç§»ï¼Œå¯ç»§ç»­ä½¿ç”¨
println!("Array after loop: &#123;:?&#125;", arr); // è¾“å‡º [1, 2, 3, 4, 5]
æ ¸å¿ƒåŒºåˆ«æ€»ç»“



ç±»å‹ç‰¹å¾
å¾ªç¯æ–¹å¼
æ‰€æœ‰æƒçŠ¶æ€
å¾ªç¯åèƒ½å¦ä½¿ç”¨åŸå˜é‡




æœªå®ç°Copyï¼ˆå¦‚Vecï¼‰
for v in vec
æ‰€æœ‰æƒè½¬ç§»ç»™v
ä¸èƒ½ï¼ˆå·²è¢«æ¶ˆè€—ï¼‰


æœªå®ç°Copyï¼ˆå¦‚Vecï¼‰
for v in &amp;vec
ä»…å€Ÿå‡ºä¸å¯å˜å¼•ç”¨
èƒ½ï¼ˆæ‰€æœ‰æƒä»ä¿ç•™ï¼‰


æœªå®ç°Copyï¼ˆå¦‚Vecï¼‰
for v in &amp;mut vec
ä»…å€Ÿå‡ºå¯å˜å¼•ç”¨
èƒ½ï¼ˆæ‰€æœ‰æƒä»ä¿ç•™ï¼‰


å®ç°Copyï¼ˆå¦‚[i32; n]ï¼‰
for v in arr
å…ƒç´ è¢«å¤åˆ¶ï¼Œæ‰€æœ‰æƒä¸è½¬ç§»
èƒ½ï¼ˆåŸå˜é‡æœªè¢«ä¿®æ”¹ï¼‰



]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part6]_æ•°ç»„ä¸åˆ‡ç‰‡_å­—ç¬¦ä¸²</title>
    <url>/2025/07/13/Rust%E5%9F%BA%E7%A1%80-part6-%E6%95%B0%E7%BB%84%E4%B8%8E%E5%88%87%E7%89%87-%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    <content><![CDATA[RuståŸºç¡€[part6]_æ•°ç»„ä¸åˆ‡ç‰‡ã€å­—ç¬¦ä¸²
æ•°ç»„
æ•°ç»„çš„ç±»å‹æ ¼å¼:[T; N]

å›ºå®šé•¿åº¦ï¼šå¿…é¡»åœ¨ç¼–è¯‘æ—¶æŒ‡å®šé•¿åº¦ Nï¼Œä¸”æ— æ³•æ‰©å®¹ã€‚
å¯å˜ï¼šå¦‚æœå£°æ˜ä¸º mutï¼Œå¯ä»¥ä¿®æ”¹å…ƒç´ å€¼ï¼Œä½†ä¸èƒ½æ”¹å˜é•¿åº¦ã€‚
å­˜å‚¨åœ¨æ ˆä¸Šï¼ˆé™¤éè¢«è£…ç®±åˆ°å †ä¸Šï¼Œå¦‚ Box&lt;[T; N]&gt;ï¼‰ã€‚

å®šä¹‰
let arr = [1, 2, 3, 4, 5];
   println!("Array: &#123;:?&#125;", arr);
é»˜è®¤åˆå§‹å€¼
// é»˜è®¤åˆå§‹å€¼
   let arr1: [i32; 4] = [10; 4];
   println!("Array with default value: &#123;:?&#125;", arr1);
æ•°ç»„é•¿åº¦
// æ•°ç»„é•¿åº¦
   println!("Array length: &#123;&#125;", arr1.len());
éå†
for index in 0..arr.len() &#123;
        // éå†ç´¢å¼•
        println!("Element at index &#123;&#125;: &#123;&#125;", index, arr[index]);
    &#125;
    for element in arr1.iter() &#123;
        // ä½¿ç”¨è¿­ä»£å™¨éå†
        println!("Element: &#123;&#125;", element)
    &#125;
    arr1.iter().for_each(|x: &amp;i32| println!("Element: &#123;&#125;", x)); // ä½¿ç”¨é—­åŒ…éå†

æ•°ç»„çš„å€¼ä¼ é€’
    // æ•°ç»„å€¼ä¼ é€’
    println!("Before update: &#123;:?&#125;", arr2);
    update(arr2);
    println!("After update: &#123;:?&#125;", arr2); // æ³¨æ„è¿™é‡Œçš„ arr2 ä»ç„¶æ˜¯åŸæ¥çš„å€¼ï¼Œå› ä¸ºæ•°ç»„æ˜¯å€¼ä¼ é€’
fn update(mut arr: [i32; 5]) &#123;
    println!("Updating array: &#123;:?&#125;", arr);
    for index in 0..arr.len() &#123;
        arr[index] = 100; // ä¿®æ”¹æ¯ä¸ªå…ƒç´ 
    &#125;
    println!("Updated array inside function: &#123;:?&#125;", arr);
&#125;

è¾“å‡ºï¼šä¸»å‡½æ•°ä¸­çš„æ•°ç»„å¹¶æœªæ”¹å˜ï¼Œå› ä¸ºæ˜¯å€¼ä¼ é€’
Before update: [10, 2, 3, 4, 5]
Updating array: [10, 2, 3, 4, 5]
Updated array inside function: [100, 100, 100, 100, 100]
After update: [10, 2, 3, 4, 5]
æ•°ç»„çš„å¼•ç”¨ä¼ é€’
 // æ•°ç»„å¼•ç”¨ä¼ é€’
    println!("Before update_mut: &#123;:?&#125;", arr2);
    update_mut(&amp;mut arr2);
    println!("After update_mut: &#123;:?&#125;", arr2); // è¿™é‡Œçš„ arr2 å·²ç»è¢«ä¿®æ”¹ï¼Œå› ä¸ºä¼ é€’çš„æ˜¯å¯å˜å¼•ç”¨

fn update_mut(arr: &amp;mut [i32; 5]) &#123;
    println!("Updating array with mutable reference: &#123;:?&#125;", arr);
    for index in 0..arr.len() &#123;
        arr[index] = 100; // ä¿®æ”¹æ¯ä¸ªå…ƒç´ 
    &#125;
    println!("Updated array with mutable reference: &#123;:?&#125;", arr);
&#125;
è¾“å‡ºï¼š
Before update_mut: [10, 2, 3, 4, 5]
Updating array with mutable reference: [10, 2, 3, 4, 5]
Updated array with mutable reference: [100, 100, 100, 100, 100]
After update_mut: [100, 100, 100, 100, 100]
æ•°ç»„çš„åˆ‡ç‰‡
ä¹Ÿå°±æ˜¯sliceç±»å‹ï¼Œä»–è¡¨ç¤ºä»åŒ…å«å¤šä¸ªå…ƒç´ çš„å®¹å™¨ä¸­å–å¾—å±€éƒ¨æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåˆ‡ç‰‡æ“ä½œã€‚ ä¸åŒè¯­è¨€å¯¹åˆ‡ç‰‡çš„æ”¯æŒæœ‰æ‰€ä¸åŒã€‚ Rustå¯ä»¥æ”¯æŒSliceæ“ä½œï¼ŒRustä¸­çš„åˆ‡ç‰‡æ“ä½œåªå…è®¸è·å–ä¸€æ®µè¿ç»­çš„å±€éƒ¨æ•°æ®ã€‚æ”¯æŒçš„æœ‰Arrayã€Stringã€Vecã€‚

âš ï¸ Sliceåˆ‡ç‰‡ æ˜¯å•ç‹¬çš„ç±»å‹
åˆ‡ç‰‡çš„ç±»å‹æ˜¯ &amp;[T]ï¼ˆä¸å¯å˜åˆ‡ç‰‡ï¼‰æˆ– &amp;mut [T]ï¼ˆå¯å˜åˆ‡ç‰‡ï¼‰ï¼Œå®ƒä¸åŒ…å«é•¿åº¦ä¿¡æ¯ã€‚
åˆ‡ç‰‡ä¹Ÿæ˜¯ä¸€ç§å¼•ç”¨ï¼Œä¸åŒ…å«æ‰€æœ‰æƒ

å†…å­˜ç»“æ„ï¼Œåˆ‡ç‰‡ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

æŒ‡å‘æ•°æ®èµ·å§‹ä½ç½®çš„æŒ‡é’ˆï¼ˆæŒ‡å‘æ•°ç»„æˆ– Vec çš„å†…å­˜ï¼‰ã€‚
é•¿åº¦å­—æ®µï¼ˆlenï¼‰ï¼Œè¡¨ç¤ºåˆ‡ç‰‡åŒ…å«çš„å…ƒç´ ä¸ªæ•°ã€‚

è¿™é‡Œä»¥Arrayçš„åˆ‡ç‰‡ç¤ºä¾‹ï¼š
fn slice_example() &#123;
    let arr = [1, 2, 3, 4, 5];
    let slice1: &amp;[i32] = &amp;arr[1..3]; // åŒ…å«ç´¢å¼•1å’Œ2çš„å…ƒç´ 
    println!("Slice from index 1 to 3: &#123;:?&#125;", slice1);

    let slice2: &amp;[i32] = &amp;arr[..3]; // åŒ…å«å‰3ä¸ªå…ƒç´ 
    println!("Slice of first three elements: &#123;:?&#125;", slice2);

    let slice3: &amp;[i32] = &amp;arr[2..]; // ä»ç´¢å¼•2å¼€å§‹åˆ°æœ«å°¾
    println!("Slice from index 2 to end: &#123;:?&#125;", slice3);
&#125;
å¸¸ç”¨çš„å‡½æ•°


len ()ï¼šå– slice å…ƒç´ ä¸ªæ•°


is_empty ()ï¼šåˆ¤æ–­ slice æ˜¯å¦ä¸ºç©º


contains ()ï¼šåˆ¤æ–­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ 


repeat ()ï¼šé‡å¤ slice æŒ‡å®šæ¬¡æ•°


reverse ()ï¼šåè½¬ slice


join ()ï¼šå°†å„å…ƒç´ å‹å¹³ (flatten) å¹¶é€šè¿‡æŒ‡å®šçš„åˆ†éš”ç¬¦è¿æ¥èµ·æ¥


swap ()ï¼šäº¤æ¢ä¸¤ä¸ªç´¢å¼•å¤„çš„å…ƒç´ ï¼Œå¦‚ s.swap (1,3)


windows ()ï¼šä»¥æŒ‡å®šå¤§å°çš„çª—å£è¿›è¡Œæ»šåŠ¨è¿­ä»£
for i in arr.windows(3) &#123;
        // éå†æ•°ç»„çš„çª—å£
        println!("Window of size 3: &#123;:?&#125;", i);
    &#125;
Window of size 3: [1, 2, 3]
Window of size 3: [2, 3, 4]
Window of size 3: [3, 4, 5]


starts_with ()ï¼šåˆ¤æ–­ slice æ˜¯å¦ä»¥æŸä¸ª slice å¼€å¤´


ç»ƒä¹  âš ï¸

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ answer ï¼Œä½¿å¾— answer[i] ç­‰äº nums é™¤ nums[i] ä¹‹å¤–çš„æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ã€‚ ä»»ä½•å‰ç¼€æˆ–åç¼€çš„ä¹˜ç§¯ nums éƒ½ä¿è¯é€‚åˆ 32 ä½æ•´æ•°ã€‚ æ‚¨å¿…é¡»ç¼–å†™ä¸€ä¸ªèƒ½å¤ŸåŠæ—¶è¿è¡Œ O(n) ä¸”æ— éœ€ä½¿ç”¨é™¤æ³•è¿ç®—çš„ç®—æ³•ã€‚
ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šnums = [1,2,3,4] è¾“å‡ºï¼š[24,12,8,6]
ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šnums = [-1,1,0,-3,3] è¾“å‡ºï¼š[0,0,9,0,0] é™åˆ¶ï¼š 2 &lt;= nums.length &lt;= 10^5 -30 &lt;= nums[i] &lt;= 30 ä»»ä½•å‰ç¼€æˆ–åç¼€çš„ä¹˜ç§¯ nums éƒ½ä¿è¯é€‚åˆ 32 ä½æ•´æ•°ã€‚
è¿›é˜¶ï¼šä½ èƒ½ä»¥ O(1) é¢å¤–ç©ºé—´å¤æ‚åº¦è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿï¼ˆè¾“å‡ºæ•°ç»„ä¸ç®—ä½œç©ºé—´å¤æ‚åº¦åˆ†æçš„é¢å¤–ç©ºé—´ã€‚ï¼‰

#[test]
fn feature_array_practice() &#123;
    let nums: [i32; 4] = [1, 2, 3, 4];
    let answer: Vec&lt;i32> = arr_practice(&amp;nums[..]);
    println!("Result of arr_practice: &#123;:?&#125;", answer);
&#125;

fn arr_practice(nums: &amp;[i32]) -> Vec&lt;i32> &#123;
    let n: usize = nums.len();
    let mut answer = vec![1; n]; // åˆå§‹åŒ–ä¸ºå…¨1

    for i in 1..n &#123;
        answer[i] = answer[i - 1] * nums[i - 1];
    &#125;
    let mut suffix = 1;
    for i in (0..n).rev() &#123;
        answer[i] *= suffix;
        suffix *= nums[i];
    &#125;

    answer
&#125;
å­—ç¬¦ä¸²
æ˜¯å­—ç¬¦ç»„æˆçš„è¿ç»­é›†åˆ
Rustå­—ç¬¦æ˜¯Unicodeç±»å‹ï¼Œæ¯ä¸ªå­—ç¬¦å å››ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯åœ¨å­—ç¬¦ä¸²é‡Œé¢ä¸ä¸€æ ·ï¼Œå­—ç¬¦ä¸²æ˜¯UTF-8ç¼–ç ã€‚ä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ‰€å çš„å­—èŠ‚æ•°çš„å˜åŒ–çš„å››åˆ†ä¹‹ä¸€ã€‚
Rust çš„å­—ç¬¦ä¸²ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š

strï¼ˆå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼‰ï¼šå®ƒæ˜¯ä¸å¯å˜çš„å¼•ç”¨ç±»å‹ï¼Œé•¿åº¦å›ºå®šï¼Œé€šå¸¸ä»¥å€Ÿç”¨çš„å½¢å¼å­˜åœ¨ï¼Œå³&amp;strã€‚
Stringï¼šè¿™æ˜¯ä¸€ä¸ªåœ¨å †ä¸Šåˆ†é…å†…å­˜çš„å¯å¢é•¿ç±»å‹ï¼Œå…·å¤‡æ‰€æœ‰æƒã€‚

åˆ›å»ºå­—ç¬¦ä¸²
// åˆ›å»ºStringç±»å‹
let s1 = String::new(); // ç©ºå­—ç¬¦ä¸²
let s2 = "åˆå§‹å†…å®¹".to_string(); // ä»&amp;strè½¬æ¢
let s3 = String::from("ç›´æ¥åˆ›å»º"); // ä½¿ç”¨fromå‡½æ•°

// åˆ›å»º&amp;strç±»å‹ï¼ˆå­—ç¬¦ä¸²å­—é¢é‡ï¼‰
let s4: &amp;str = "è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡";
String -&gt;&amp;str
ä¸‰ç§
pub fn string_example() &#123;
    let s3 = String::from("Rust");
     say_hello(&amp;s3); // Rustè‡ªåŠ¨è§£å¼•ç”¨s3ï¼Œ&amp;Stringä¼šè‡ªåŠ¨è½¬æ¢ä¸º&amp;str
    say_hello(s3.as_str()); // æ˜¾å¼è½¬æ¢ä¸º&amp;str
    say_hello(&amp;s3[..]); // é€šè¿‡åˆ‡ç‰‡è½¬æ¢ä¸º&amp;str
&#125;

fn say_hello(s: &amp;str) &#123;
    println!("Hello, &#123;&#125;!", s);
&#125;
å„ç§è½¬æ¢æ–¹å¼

å­—ç¬¦ä¸²æ‹¼æ¥
éƒ½æ˜¯åŸæœ‰çš„å­—ç¬¦ä¸²æ·»åŠ ï¼Œéœ€è¦å¯å˜
let mut s = String::from("Hello");
s.push(' '); // æ·»åŠ å•ä¸ªå­—ç¬¦
s.push_str("world!"); // æ·»åŠ å­—ç¬¦ä¸²åˆ‡ç‰‡

let s2 = format!("&#123;&#125; &#123;&#125;", s, "Rust"); // æ ¼å¼åŒ–æ‹¼æ¥
å­—ç¬¦ä¸²æŸ¥æ‰¾ä¸æ›¿æ¢
æ˜¯è¿”å›çš„æ–°çš„å­—ç¬¦ä¸²ï¼Œä¸éœ€è¦å¯å˜
let s = "Hello, world!";
let contains = s.contains("world"); // true
let replaced = s.replace("world", "Rust"); // "Hello, Rust!"
å…¶ä»–å¸¸è§æ“ä½œ
let mut s = String::from("Hello");
s.pop(); // åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦
   println!("After pop: &#123;&#125;", s);

   s.remove(0); // åˆ é™¤ç¬¬ä¸€ä¸ªå­—ç¬¦
   println!("After remove: &#123;&#125;", s);

   s.truncate(3); // æˆªæ–­å­—ç¬¦ä¸²åˆ°æŒ‡å®šé•¿åº¦
   println!("After truncate: &#123;&#125;", s);

   s.clear(); // æ¸…ç©ºå­—ç¬¦ä¸²
   println!("After clear: &#123;&#125;", s); 

   // å­—ç¬¦ä¸²è¿æ¥
   let s4 = String::from("Hello");
   let s5 = String::from(", Rust!");
   let s6 = s4 + &amp;s5; // ä½¿ç”¨ + è¿ç®—ç¬¦è¿æ¥å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ &amp;s5 ä¼ é€’å¼•ç”¨
   println!("After concat: &#123;&#125;", s6);
 //format
   let s7 = format!("&#123;&#125;&#123;&#125;", s5, " is awesome!"); // ä½¿ç”¨ format! å®è¿æ¥å­—ç¬¦ä¸²

	// è½¬ä¹‰




æ€§èƒ½è€ƒé‡

æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼Œformat!å®æ¯”+è¿ç®—ç¬¦æ›´é«˜æ•ˆã€‚
é¢‘ç¹ä¿®æ”¹å­—ç¬¦ä¸²å»ºè®®ä½¿ç”¨Stringã€‚

ç»ƒä¹ 

// ä¿®å¤æ‰€æœ‰é”™è¯¯ï¼Œå¹¶ä¸”ä¸è¦æ–°å¢ä»£ç è¡Œ
fn main() &#123;
    let mut s = String::from("hello");
    s.push(',');
    s.push_str(" world");
    s += "!";//å­—é¢é‡ ä¸èƒ½ç”¨to_string()

    println!("&#123;&#125;", s)
&#125;
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part4]_åŸºæœ¬ç±»å‹,æ‰€æœ‰æƒ</title>
    <url>/2025/07/11/Rust%E5%9F%BA%E7%A1%80%5Bpart4%5D_%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B,%E6%89%80%E6%9C%89%E6%9D%83/</url>
    <content><![CDATA[RuståŸºç¡€[part4]_åŸºæœ¬ç±»å‹,æ‰€æœ‰æƒ
Rustç±»å‹
æ¦‚è§ˆ
ä»¥ä¸‹æ˜¯æ•´åˆåçš„ Rust ç±»å‹è¯´æ˜è¡¨æ ¼ï¼š



ç±»å‹
è¯´æ˜
å€¼




i8ã€i16ã€i32ã€i64ã€i128ã€u8ã€u16ã€u32ã€u64ã€u128
ç»™å®šä½å®½çš„æœ‰ç¬¦å·æ•´æ•°å’Œæ— ç¬¦å·æ•´æ•°
42ã€-5i8ã€0x400u16ã€0o100i16ã€20_922_789_888_000u64ã€b'*'ï¼ˆu8 å­—èŠ‚å­—é¢é‡ï¼‰


isizeã€usize
ä¸æœºå™¨å­—ï¼ˆ32 ä½æˆ– 64 ä½ï¼‰ä¸€æ ·å¤§çš„æœ‰ç¬¦å·æ•´æ•°å’Œæ— ç¬¦å·æ•´æ•°
137ã€-0b0101_0010isizeã€0xffff_fc00usize


f32ã€f64
å•ç²¾åº¦ IEEE æµ®ç‚¹æ•°å’ŒåŒç²¾åº¦ IEEE æµ®ç‚¹æ•°
1.61803ã€3.14f32ã€6.0221e23f64


bool
å¸ƒå°”å€¼
trueã€false


char
Unicode å­—ç¬¦ï¼Œ32 ä½å®½ï¼ˆ4 å­—èŠ‚ï¼‰
'*'ã€'\n'ã€'å­—'ã€'\x7f'ã€'\u&#123;...&#125;'ï¼ˆUnicode è½¬ä¹‰ï¼‰


(char, u8, i32)
å…ƒç»„ï¼Œå…è®¸æ··åˆç±»å‹
('%', 0x7f, -1)


()
â€œå•å…ƒâ€ï¼ˆç©ºå…ƒç»„ï¼‰
()


struct S &#123; x: f32, y: f32 &#125;
å…·åå­—æ®µå‹ç»“æ„ä½“
S &#123; x: 120.0, y: 209.0 &#125;


struct T(i32, char);
å…ƒç»„å‹ç»“æ„ä½“
T (120, 'X')


struct E;
å•å…ƒå‹ç»“æ„ä½“ï¼Œæ— å­—æ®µ
E


enum Attend &#123; OnTime, Late(u32) &#125;
æšä¸¾ï¼Œæˆ–ä»£æ•°æ•°æ®ç±»å‹
Attend::Late(5)ã€Attend::OnTime


Box&lt;Attend&gt;
Boxï¼šæŒ‡å‘å †ä¸­å€¼çš„æ‹¥æœ‰å‹æŒ‡é’ˆ
Box::new(Late(15))


&amp;i32ã€&amp;mut i32
å…±äº«å¼•ç”¨å’Œå¯å˜å¼•ç”¨ï¼šéæ‹¥æœ‰å‹æŒ‡é’ˆï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸èƒ½è¶…å‡ºå¼•ç”¨ç›®æ ‡
&amp;s.yã€&amp;mut v


String
UTF-8 å­—ç¬¦ä¸²ï¼ŒåŠ¨æ€åˆ†é…å¤§å°
&quot; ãƒ©ãƒ¼ãƒ¡ãƒ³ : ramen&quot;.to_string()


&amp;str
å¯¹ str çš„å¼•ç”¨ï¼šæŒ‡å‘ UTF-8 æ–‡æœ¬çš„éæ‹¥æœ‰å‹æŒ‡é’ˆ
&quot; ãã° : soba&quot;ã€&amp;s[0..12]


[f64; 4]ã€[u8; 256]
æ•°ç»„ï¼Œå›ºå®šé•¿åº¦ï¼Œå…¶å…ƒç´ ç±»å‹éƒ½ç›¸åŒ
[1.0, 0.0, 0.0, 1.0]ã€[b' '; 256]


Vec&lt;f64&gt;
å‘é‡ï¼Œå¯å˜é•¿åº¦ï¼Œå…¶å…ƒç´ ç±»å‹éƒ½ç›¸åŒ
vec![0.367, 2.718, 7.389]


&amp;[u8]ã€*mut [u8]
å¯¹åˆ‡ç‰‡ï¼ˆæ•°ç»„æˆ–å‘é‡æŸä¸€éƒ¨åˆ†ï¼‰çš„å¼•ç”¨ï¼ŒåŒ…å«æŒ‡é’ˆå’Œé•¿åº¦
&amp;v[10..20]ã€&amp;mut a[..]


Option&lt;&amp;str&gt;
å¯é€‰å€¼ï¼šæˆ–è€…ä¸º Noneï¼ˆæ— å€¼ï¼‰ï¼Œæˆ–è€…ä¸º Some(v)ï¼ˆæœ‰å€¼ï¼Œå…¶å€¼ä¸º vï¼‰
Some(&quot;Dr.&quot;)ã€None


Result
å¯èƒ½å¤±è´¥çš„æ“ä½œç»“æœï¼šæˆ–è€…ä¸ºæˆåŠŸå€¼ Ok(v)ï¼Œæˆ–è€…ä¸ºé”™è¯¯å€¼ Err(e)
Ok(4096)ã€Err(Error::last_os_error())


&amp;dyn Anyã€&amp;mut dyn Read
ç‰¹å‹å¯¹è±¡ï¼Œæ˜¯å¯¹ä»»ä½•å®ç°äº†ä¸€ç»„ç»™å®šæ–¹æ³•çš„å€¼çš„å¼•ç”¨
value as &amp;dyn Anyã€&amp;mut file as &amp;mut dyn Read


fn(&amp;str) -&gt; bool
å‡½æ•°æŒ‡é’ˆ
str::is_empty


ï¼ˆé—­åŒ…ç±»å‹æ²¡æœ‰æ˜¾å¼ä¹¦å†™å½¢å¼ï¼‰
é—­åŒ…
`


x..=y
åºåˆ—
1..=4



æ•´å‹



å¤§å°
æœ‰ç¬¦å·
æ— ç¬¦å·




8 ä½
i8
u8


16 ä½
i16
u16


32 ä½
i32
u32


64 ä½
i64
u64


128 ä½
i128
u128


è§†æ¶æ„è€Œå®š
isize
usize



pub fn print_int_show() &#123;
    let integer: i32 = 2147483647; // æœ€å¤§å€¼
    let integer: i32 = -2147483648; // æœ€å°å€¼
    let integer: i32 = 0x1F; // åå…­è¿›åˆ¶
    let integer: i32 = 0o17; // å…«è¿›åˆ¶
    let integer: i32 = 0b1111_0000; // äºŒè¿›åˆ¶
    let integer: i32 = 1_000_000; // ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”æ•°å­—
    let integer: u8 = b'A'; // å­—ç¬¦è½¬æ¢ä¸ºæ•´æ•°
&#125;
æµ®ç‚¹å‹
æµ®ç‚¹ç±»å‹æ•°æ•°å­—ï¼Œå¸¦æœ‰å°æ•°ç‚¹ï¼ŒåŸºæœ¬ä¸¤ç§ç±»å‹æ˜¯ï¼šf32å’Œf64
é»˜è®¤ä¸ºf64ï¼Œç²¾åº¦æ›´é«˜ï¼Œé€Ÿåº¦åŸºæœ¬å’Œf32ç›¸åŒ
ä½†æ˜¯ä¸€èˆ¬åœ¨åŒºå—é“¾åº”ç”¨ä¸­ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨i128ï¼Œ å› ä¸ºç²¾åº¦çš„é—®é¢˜
ç²¾åº¦é—®é¢˜
ç²¾åº¦é—®é¢˜ï¼ŒRust ä½œä¸ºä¸€é—¨æ³¨é‡å†…å­˜å®‰å…¨å’Œæ€§èƒ½çš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨å¤„ç†æ•°å€¼ç²¾åº¦æ—¶éµå¾ªæ˜ç¡®çš„è§„åˆ™ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›éœ€è¦å¼€å‘è€…æ³¨æ„çš„æ½œåœ¨é™·é˜±ã€‚
assert_eq!(0.1 + 0.2, 0.3); // æµ®ç‚¹æ•°ç›¸åŠ  è¿™é‡Œä¼šfailed
println!("0.1 + 0.2 = &#123;:x&#125;", (abc.0 + abc.1).to_bits());
println!("0.3 = &#123;:x&#125;", abc.2.to_bits());
println!("0.1 + 0.2 = &#123;:x&#125;", (xyz.0 + xyz.1).to_bits());
println!("0.3 = &#123;:x&#125;", xyz.2.to_bits());
ç»“æœï¼Œå‘ç°é«˜ç²¾åº¦çš„0.1 + 0.2 çš„ç»“æœå’Œ0.3çš„ç»“æœæ˜¯ä¸åŒçš„ã€‚
0.1 + 0.2 = 3e99999a
0.3 = 3e99999a
0.1 + 0.2 = 3fd3333333333334
0.3 = 3fd3333333333333
è¿™å°±æ˜¯ç²¾åº¦é—®é¢˜ã€‚

Rust å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°çš„ç±»å‹åç¼€è¯­æ³•æœ‰ç»†å¾®å·®åˆ«ï¼š

æ•´æ•°ï¼šç±»å‹åç¼€ç›´æ¥ç´§è·Ÿæ•°å€¼ï¼Œæ— ä¸‹åˆ’çº¿ã€‚
ä¾‹å¦‚ï¼š1u32ã€42i64ã€0xFFu8ã€‚
æµ®ç‚¹æ•°ï¼šç±»å‹åç¼€ä¸æ•°å€¼ä¹‹é—´å¿…é¡»æœ‰ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ã€‚
ä¾‹å¦‚ï¼š0.5_f32ã€3.14159_f64ã€‚


NAN
NAN(Not a Number) ï¼Œ ç”¨æ¥å®šä¹‰å¦‚ä»¥ä¸‹è¿™ä¸ªå¹³æ–¹æ ¹ï¼Œè¿™ç§æ•°å­¦ä¸Šæœªå®šä¹‰çš„ç»“æœã€‚
pub fn nan_example() &#123;
    let nan_value: f64 = (-1.1_f64).sqrt(); // è®¡ç®—è´Ÿæ•°çš„å¹³æ–¹æ ¹
    assert!(nan_value.is_nan()); // æ£€æŸ¥æ˜¯å¦ä¸ºNaN
    println!("NaN: &#123;&#125;", nan_value);
&#125;
å¸ƒå°”ç±»å‹
å ä¸€ä¸ªå­—èŠ‚
pub fn boolean_example() &#123;
    let t = true;
    let f: bool = false;
    println!("true: &#123;&#125;, false: &#123;&#125;", t, f);
&#125;
å­—ç¬¦
å•å¼•å·å»å£°æ˜çš„ï¼Œunicodeå­—ç¬¦ä¹Ÿå¯ä»¥ä½œä¸ºRustçš„å­—ç¬¦ ï¼Œå ç”¨å››ä¸ªå­—èŠ‚
pub fn char_example() &#123;
    let c: char = 'A';
    let emoji: char = 'ğŸ˜Š';// unicodeå­—ç¬¦ä¹Ÿå¯ä»¥ä½œä¸ºRustçš„å­—ç¬¦
    println!("char: &#123;&#125;, emoji: &#123;&#125;", c, emoji);
&#125;

åºåˆ—
åŒ…å«éœ€è¦åŠ ä¸Š=
pub fn _sequence_example() &#123;
    let seq = 1..=5; // åŒ…å«5çš„èŒƒå›´
    for i in seq &#123;
        println!("Sequence: &#123;&#125;", i);
    &#125;
&#125;
ç±»å‹å¼ºè½¬
aså…³é”®å­—ç”¨äºåœ¨åŸå§‹ç±»å‹ä¹‹é—´è¿›è¡Œç±»å‹è½¬æ¢ï¼Œä¸é€‚ç”¨äºå¤åˆç±»å‹ï¼Œæ¯”å¦‚Stringæˆ–å…¶ä»–è‡ªå®šä¹‰ç±»å‹
pub fn convert() &#123;
    let a: i32 = 10;
    let b: f64 = a as f64; // å°†i32è½¬æ¢ä¸ºf64
    println!("Converted value: &#123;&#125;", b);

    let c: f64 = 3.14;
    let d: i32 = c as i32; // å°†f64è½¬æ¢ä¸ºi32
    println!("Converted value: &#123;&#125;", d);
&#125;
ç»ƒä¹ 
https://practice-zh.course.rs/basic-types/numbers.html
é”™é¢˜è®°å½•ï¼š
// å¡«ç©º
use std::ops::&#123;Range, RangeInclusive&#125;;
fn main() &#123;
    assert_eq!((1..5), Range&#123; start: 1, end: 5 &#125;);
    assert_eq!((1..=5), RangeInclusive::new(1, 5));
&#125;
// å¡«ç©ºï¼Œå¹¶è§£å†³é”™è¯¯
fn main() &#123;
    // æ•´æ•°åŠ æ³•
    assert!(1u32 + 2 == 3);

    // æ•´æ•°å‡æ³•
    assert!(1i32 - 2 == -1);
    assert!(1i8 - 2 == -1);
    
    assert!(3 * 50 == 150);

    assert!(9.6 / 3.2 - 3.0 &lt; 1e-9); 

    assert!(24 % 5 == 4);
    
    // é€»è¾‘ä¸æˆ–éæ“ä½œ
    assert!(true &amp;&amp; false == false);
    assert!(true || false == true);
    assert!(!true == false);

    // ä½æ“ä½œ
    println!("0011 AND 0101 is &#123;:04b&#125;", 0b0011u32 &amp; 0b0101);
    println!("0011 OR 0101 is &#123;:04b&#125;", 0b0011u32 | 0b0101);
    println!("0011 XOR 0101 is &#123;:04b&#125;", 0b0011u32 ^ 0b0101);
    println!("1 &lt;&lt; 5 is &#123;&#125;", 1u32 &lt;&lt; 5);
    println!("0x80 >> 2 is 0x&#123;:x&#125;", 0x80u32 >> 2);
&#125;
æ‰€æœ‰æƒ

é›¶å¼€é”€å†…å­˜å›æ”¶çš„ä¸€ç§é«˜æ•ˆå®ç°æ–¹å¼

Rustæ˜¯ä¸€ç§ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ç¡®ä¿å†…å­˜å®‰å…¨å¹¶é˜²æ­¢æ•°æ®ç«äº‰ï¼Œè€Œä¸ä¾èµ–åƒåœ¾å›æ”¶å™¨ã€‚è¿™ç§å†…å­˜å®‰å…¨æ€§ä¸»è¦é€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿæ¥è¿›è¡Œå®ç°ã€‚
ä¸ºä»€ä¹ˆéœ€è¦æ‰€æœ‰æƒï¼Ÿ
åœ¨ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå†…å­˜ç®¡ç†ä¸€ç›´æ˜¯æ ¸å¿ƒæŒ‘æˆ˜ï¼š

æ‰‹åŠ¨ç®¡ç†ï¼ˆå¦‚ C/C++ï¼‰ï¼šå¼€å‘è€…éœ€æ‰‹åŠ¨åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œæ˜“å‡ºç°æ‚¬ç©ºæŒ‡é’ˆã€å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚
åƒåœ¾å›æ”¶ï¼ˆå¦‚ Java/Goï¼‰ï¼šè‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œä½†å¸¦æ¥è¿è¡Œæ—¶å¼€é”€å’Œä¸å¯é¢„æµ‹çš„åœé¡¿ã€‚

Rust é€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿåœ¨ç¼–è¯‘æœŸè§£å†³å†…å­˜å®‰å…¨é—®é¢˜ï¼Œæ— éœ€åƒåœ¾å›æ”¶ï¼ŒåŒæ—¶ä¿æŒé«˜æ€§èƒ½ã€‚
åŸºæœ¬è§„åˆ™

æ¯ä¸€ä¸ªå€¼éƒ½æœ‰æ‰€æœ‰è€…(owner);
åœ¨ä»»ä¸€æ—¶åˆ»ï¼Œå€¼éƒ½åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…;
å½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸ(scope),å€¼ä¼šè¢«ä¸¢å¼ƒ(drop);

moveè¯­ä¹‰
pub fn _ownership_example() &#123;
    let s1: String = String::from("Hello");
    let s2: String = s1; // è½¬ç§»æ‰€æœ‰æƒ
    // println!("&#123;&#125;", s1); // æ­¤å¤„ä¼šæŠ¥é”™ï¼Œå› ä¸ºs1çš„æ‰€æœ‰æƒå·²è½¬ç§»
    drop(s2); // rustä¸­å¯ä»¥æ‰‹åŠ¨é‡Šæ”¾èµ„æº,ä½†é€šå¸¸ä¸éœ€è¦è¿™æ ·åš,å› ä¸ºRustä¼šåœ¨å˜é‡è¶…å‡ºä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾èµ„æº; æ³¨æ„s1è¿™ä¸ªæ—¶å€™å·²ç»æ˜¯ç±»ä¼¼ç©ºæŒ‡é’ˆçš„çŠ¶æ€ï¼Œä¹Ÿä¸éœ€è¦å»é‡Šæ”¾
    println!("&#123;&#125;", s2);
&#125;

copyè¯­ä¹‰
åŸºæœ¬æ•°æ®ç±»å‹
fn main() &#123;
    let x = 5;
    let y = x;  // x çš„å€¼è¢«å¤åˆ¶åˆ° y
    
    println!("x = &#123;&#125;, y = &#123;&#125;", x, y); // ä¸¤ä¸ªå˜é‡éƒ½æœ‰æ•ˆ
&#125;
ç»ƒä¹ 
// ç”¨ä¸¤ç§æ–¹æ³•æ‰“å°æˆåŠŸs1 å’Œs2çš„å€¼
    let s1 = String::from("Hello, Rust!");
    let s2 = ownership::take_ownership(s1); 

    //ä»¥ä¸‹ä»£ç ä¸èƒ½ä¿®æ”¹
    println!("&#123;&#125;", s1);
    println!("&#123;&#125;", s2);
ç¬¬ä¸€ç§æ–¹æ³•
fn main() &#123;
   
    // ç¬¬ä¸€ç§æ–¹æ³•
    let s1 = String::from("Hello, Rust!");
    let s2 = take_ownership(s1.clone()); // ä½¿ç”¨cloneæ–¹æ³•å¤åˆ¶s1

    //ä»¥ä¸‹ä»£ç ä¸èƒ½ä¿®æ”¹
    println!("&#123;&#125;", s1);
    println!("&#123;&#125;", s2);
&#125;
pub fn take_ownership(s: String) -> String &#123;
    s // è¿”å›çš„æ˜¯ sçš„å…‹éš†
&#125;
ç¬¬äºŒç§æ–¹æ³•
fn main() &#123;
   
    // ç¬¬äºŒç§æ–¹æ³•
    let s1 = String::from("Hello, Rust!");
    let s2 = take_ownership(&amp;s1); // ä¼ é€’s1çš„å¼•ç”¨

    //ä»¥ä¸‹ä»£ç ä¸èƒ½ä¿®æ”¹
    println!("&#123;&#125;", s1);
    println!("&#123;&#125;", s2);
&#125;

// ä¼ å…¥ç±»å‹æ”¹ä¸ºå¼•ç”¨ç±»å‹
pub fn take_ownership(s: &amp;String) -> &amp;String &#123;
    println!("Taking ownership of: &#123;&#125;", s);
    &amp;s // è¿”å›sçš„å¼•ç”¨
&#125;
åé¢ä¼šè¯¦ç»†è®²åˆ°å¼•ç”¨çš„ç”¨æ³•
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part1]_æ™ºèƒ½æŒ‡é’ˆæ¦‚è¿°&amp;boxæŒ‡é’ˆ</title>
    <url>/2025/07/18/Rust%E8%BF%9B%E9%98%B6-part1-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E6%A6%82%E8%BF%B0-box%E6%8C%87%E9%92%88/</url>
    <content><![CDATA[Rustè¿›é˜¶[part1]_æ™ºèƒ½æŒ‡é’ˆæ¦‚è¿°&amp;boxæŒ‡é’ˆ
æ™ºèƒ½æŒ‡é’ˆæ¦‚è¿°
åœ¨Rustä¸­ï¼Œæ™ºèƒ½æŒ‡é’ˆæ˜¯ä¸€ç±»ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬ä¸ä»…åƒæ™®é€šæŒ‡é’ˆä¸€æ ·å¯ä»¥å¼•ç”¨æ•°æ®ï¼Œè¿˜å¸¦æœ‰é¢å¤–çš„å…ƒæ•°æ®å’ŒåŠŸèƒ½ã€‚ä¸æ™®é€šæŒ‡é’ˆä¸åŒï¼Œæ™ºèƒ½æŒ‡é’ˆé€šå¸¸ä½¿ç”¨ç»“æ„ä½“å®ç°ï¼Œå¹¶ä¸”ä¼šå®ç° Deref å’Œ Drop ç­‰ç‰¹å®šçš„traitï¼Œä»¥æä¾›æ›´å¼ºå¤§çš„åŠŸèƒ½å’Œæ›´å®‰å…¨çš„å†…å­˜ç®¡ç†ã€‚
æ™ºèƒ½æŒ‡é’ˆåœ¨Rustç¼–ç¨‹ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œå®ƒä»¬èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…å¤„ç†å¤æ‚çš„å†…å­˜ç®¡ç†åœºæ™¯ï¼Œç¡®ä¿ç¨‹åºçš„å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†åŠ¨æ€å¤§å°çš„æ•°æ®ã€é€’å½’æ•°æ®ç»“æ„æˆ–è€…éœ€è¦è‡ªå®šä¹‰èµ„æºé‡Šæ”¾é€»è¾‘æ—¶ï¼Œæ™ºèƒ½æŒ‡é’ˆå°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚
BoxæŒ‡é’ˆ
å†…å­˜åˆ†é…åˆ°å †ä¸Š
åœ¨Rustä¸­ï¼Œæ ˆå†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾æ˜¯è‡ªåŠ¨ä¸”é«˜æ•ˆçš„ï¼Œä½†æ ˆç©ºé—´æ˜¯æœ‰é™çš„ã€‚å¯¹äºä¸€äº›å¤§å‹çš„æ•°æ®ç»“æ„æˆ–è€…éœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€ç¡®å®šå¤§å°çš„æ•°æ®ï¼Œå°†å…¶å­˜å‚¨åœ¨æ ˆä¸Šå¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡ºã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Box æŒ‡é’ˆå°†æ•°æ®åˆ†é…åˆ°å †ä¸Šã€‚
Box æ˜¯Rustæ ‡å‡†åº“ä¸­æœ€åŸºæœ¬çš„æ™ºèƒ½æŒ‡é’ˆä¹‹ä¸€ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åœ¨å…¶ä¸­ã€‚é€šè¿‡ Box æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ˆä¸Šå­˜å‚¨ä¸€ä¸ªæŒ‡å‘å †ä¸Šæ•°æ®çš„å¼•ç”¨ï¼Œä»è€Œå®ç°å¯¹å †ä¸Šæ•°æ®çš„è®¿é—®ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Box å°†ä¸€ä¸ªæ•´æ•°åˆ†é…åˆ°å †ä¸Šï¼š
fn main() &#123;
    let boxed_int = Box::new(42);
    println!("The value inside the box is: &#123;&#125;", *boxed_int);
&#125;
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒBox::new(42) åˆ›å»ºäº†ä¸€ä¸ª Box æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å †ä¸Šå­˜å‚¨çš„æ•´æ•° 42ã€‚
é€šè¿‡è§£å¼•ç”¨è¿ç®—ç¬¦ *ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®å †ä¸Šçš„æ•°æ®ã€‚
å…è®¸å¤„ç†åŠ¨æ€å¤§å°ç±»å‹ï¼ˆDSTï¼‰
Rustä¸­çš„åŠ¨æ€å¤§å°ç±»å‹ï¼ˆDSTï¼‰æ˜¯æŒ‡åœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šå¤§å°çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚åˆ‡ç‰‡ï¼ˆ[T]ï¼‰å’Œç‰¹å¾å¯¹è±¡ï¼ˆdyn Traitï¼‰ã€‚
ç”±äºæ ˆä¸Šçš„å†…å­˜åˆ†é…éœ€è¦åœ¨ç¼–è¯‘æ—¶ç¡®å®šå¤§å°ï¼Œå› æ­¤æ— æ³•ç›´æ¥å°†DSTå­˜å‚¨åœ¨æ ˆä¸Šã€‚è€Œ Box æŒ‡é’ˆå¯ä»¥ç”¨äºå­˜å‚¨DSTï¼Œå› ä¸ºå®ƒä¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œä»è€Œé¿å…äº†æ ˆä¸Šå†…å­˜åˆ†é…çš„é™åˆ¶ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Box å­˜å‚¨åˆ‡ç‰‡çš„ç¤ºä¾‹ï¼š
fn main() &#123;
    let slice: &amp;[i32] = &amp;[1, 2, 3];
    let boxed_slice: Box&lt;[i32]> = Box::from(slice);
    println!("The boxed slice contains: &#123;:?&#125;", boxed_slice);
&#125;
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªåˆ‡ç‰‡ sliceï¼Œç„¶åä½¿ç”¨ Box::from æ–¹æ³•å°†å…¶è½¬æ¢ä¸º Box&lt;[i32]&gt; ç±»å‹ï¼Œä»è€Œå°†åˆ‡ç‰‡å­˜å‚¨åœ¨å †ä¸Šã€‚

// å…è®¸å¤„ç†åŠ¨æ€å¤§å°ç±»å‹ï¼Œæ¯”å¦‚ç»“æ„ä½“å’Œå…ƒç»„
let boxed_tuple = Box::new((String::from("hello"), 5));
println!("Boxed tuple: &#123;:?&#125;", boxed_tuple);

é€’å½’æ•°æ®ç»“æ„
é€’å½’æ•°æ®ç»“æ„æ˜¯æŒ‡åŒ…å«è‡ªèº«ç±»å‹çš„æˆå‘˜çš„ç»“æ„ä½“æˆ–æšä¸¾ã€‚ç”±äºé€’å½’æ•°æ®ç»“æ„çš„å¤§å°åœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šï¼Œå› æ­¤æ— æ³•ç›´æ¥å°†å…¶å­˜å‚¨åœ¨æ ˆä¸Šã€‚Box æŒ‡é’ˆå¯ä»¥ç”¨äºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡åœ¨é€’å½’æ•°æ®ç»“æ„ä¸­ä½¿ç”¨ Box æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†é€’å½’æˆå‘˜å­˜å‚¨åœ¨å †ä¸Šï¼Œä»è€Œé¿å…æ ˆæº¢å‡ºçš„é—®é¢˜ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Box å®ç°é“¾è¡¨èŠ‚ç‚¹çš„ç¤ºä¾‹ï¼š
#[derive(Debug)]
enum List &#123;
    Cons(i32, Box&lt;List>),
    Nil,
&#125;

fn main() &#123;
    let list = List::Cons(1, Box::new(List::Cons(2, Box::new(List::Nil))));
    println!("The list is: &#123;:?&#125;", list);
&#125;
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒList æšä¸¾è¡¨ç¤ºä¸€ä¸ªé“¾è¡¨ï¼Œå…¶ä¸­ Cons å˜ä½“åŒ…å«ä¸€ä¸ªæ•´æ•°å’Œä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ª List èŠ‚ç‚¹çš„ Box æŒ‡é’ˆã€‚é€šè¿‡ä½¿ç”¨ Box æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé€’å½’çš„é“¾è¡¨ç»“æ„ã€‚
ç±»å‹æ“¦é™¤
ç±»å‹æ“¦é™¤æ˜¯æŒ‡åœ¨ç¼–è¯‘æ—¶éšè—å…·ä½“çš„ç±»å‹ä¿¡æ¯ï¼Œåªä¿ç•™ç±»å‹çš„å…±æ€§ã€‚åœ¨Rustä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Box&lt;dyn Trait&gt; æ¥å®ç°ç±»å‹æ“¦é™¤ã€‚Box&lt;dyn Trait&gt; æ˜¯ä¸€ä¸ªç‰¹å¾å¯¹è±¡ï¼Œå®ƒå¯ä»¥å­˜å‚¨ä»»ä½•å®ç°äº†æŒ‡å®šç‰¹å¾çš„ç±»å‹çš„å€¼ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Box&lt;dyn Trait&gt; å®ç°ç±»å‹æ“¦é™¤çš„ç¤ºä¾‹ï¼š
trait Draw &#123;
    fn draw(&amp;self);
&#125;

struct Circle;
impl Draw for Circle &#123;
    fn draw(&amp;self) &#123;
        println!("Drawing a circle");
    &#125;
&#125;

struct Square;
impl Draw for Square &#123;
    fn draw(&amp;self) &#123;
        println!("Drawing a square");
    &#125;
&#125;

fn main() &#123;
    let shapes: Vec&lt;Box&lt;dyn Draw>> = vec![
        Box::new(Circle),
        Box::new(Square),
    ];

    for shape in shapes &#123;
        shape.draw();
    &#125;
&#125;
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª Draw ç‰¹å¾ï¼Œå¹¶ä¸º Circle å’Œ Square ç»“æ„ä½“å®ç°äº†è¯¥ç‰¹å¾ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Vec&lt;Box&lt;dyn Draw&gt;&gt; ç±»å‹çš„å‘é‡ï¼Œå…¶ä¸­å­˜å‚¨äº† Circle å’Œ Square çš„å®ä¾‹ã€‚é€šè¿‡ä½¿ç”¨ Box&lt;dyn Draw&gt;ï¼Œæˆ‘ä»¬å®ç°äº†ç±»å‹æ“¦é™¤ï¼Œä½¿å¾—å‘é‡å¯ä»¥å­˜å‚¨ä¸åŒç±»å‹çš„å½¢çŠ¶ã€‚
å†…å­˜ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ–
Box æŒ‡é’ˆåœ¨å†…å­˜ç®¡ç†æ–¹é¢å…·æœ‰é‡è¦çš„ä½œç”¨ã€‚å½“ Box æŒ‡é’ˆç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼ŒRustä¼šè‡ªåŠ¨è°ƒç”¨å…¶ Drop å®ç°ï¼Œä»è€Œé‡Šæ”¾å †ä¸Šåˆ†é…çš„å†…å­˜ã€‚è¿™ç§è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ç¡®ä¿äº†å†…å­˜çš„å®‰å…¨æ€§ï¼Œé¿å…äº†å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚
åœ¨æ€§èƒ½æ–¹é¢ï¼Œç”±äº Box æŒ‡é’ˆæ¶‰åŠåˆ°å †ä¸Šçš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œå› æ­¤ä¼šæ¯”æ ˆä¸Šçš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ç¨å¾®æ…¢ä¸€äº›ã€‚ä½†æ˜¯ï¼Œå¯¹äºéœ€è¦åŠ¨æ€åˆ†é…å†…å­˜æˆ–è€…å¤„ç†åŠ¨æ€å¤§å°ç±»å‹çš„åœºæ™¯ï¼Œä½¿ç”¨ Box æŒ‡é’ˆæ˜¯å¿…è¦çš„ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚æ¥é€‰æ‹©åˆé€‚çš„å†…å­˜åˆ†é…æ–¹å¼ã€‚
boxçš„ä¼˜ç¼ºç‚¹
ä¼˜ç‚¹

åŠ¨æ€å†…å­˜åˆ†é…ï¼šå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼Œå¤„ç†å¤§å‹æ•°æ®ç»“æ„å’ŒåŠ¨æ€å¤§å°ç±»å‹ã€‚
é€’å½’æ•°æ®ç»“æ„æ”¯æŒï¼šå¯ä»¥ç”¨äºå®ç°é€’å½’æ•°æ®ç»“æ„ï¼Œé¿å…æ ˆæº¢å‡ºçš„é—®é¢˜ã€‚
ç±»å‹æ“¦é™¤ï¼šæ”¯æŒç±»å‹æ“¦é™¤ï¼Œä½¿å¾—ä»£ç æ›´åŠ çµæ´»å’Œå¯å¤ç”¨ã€‚
è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼šRustçš„æ‰€æœ‰æƒç³»ç»Ÿç¡®ä¿äº† Box æŒ‡é’ˆç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå †ä¸Šçš„å†…å­˜ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…äº†å†…å­˜æ³„æ¼ã€‚

ç¼ºç‚¹

æ€§èƒ½å¼€é”€ï¼šå †ä¸Šçš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ¯”æ ˆä¸Šçš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ç¨å¾®æ…¢ä¸€äº›ï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚
é¢å¤–çš„é—´æ¥è®¿é—®ï¼šä½¿ç”¨ Box æŒ‡é’ˆéœ€è¦é€šè¿‡æŒ‡é’ˆè¿›è¡Œé—´æ¥è®¿é—®ï¼Œå¯èƒ½ä¼šå¢åŠ ä¸€å®šçš„å¼€é”€ã€‚

Drop Trait
Drop trait ç”¨äºè‡ªå®šä¹‰å½“å€¼ç¦»å¼€ä½œç”¨åŸŸæ—¶æ‰§è¡Œçš„ä»£ç ï¼Œé€šå¸¸ç”¨äºé‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚å†…å­˜ã€æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ã€‚å½“ä¸€ä¸ªå®ç°äº† Drop trait çš„å€¼ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼ŒRustä¼šè‡ªåŠ¨è°ƒç”¨å…¶ drop æ–¹æ³•ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç° Drop traitï¼š
struct CustomSmartPointer &#123;
    data: String,
&#125;

impl Drop for CustomSmartPointer &#123;
    fn drop(&amp;mut self) &#123;
        println!("Dropping CustomSmartPointer with data `&#123;&#125;`!", self.data);
    &#125;
&#125;

fn main() &#123;
    let c = CustomSmartPointer &#123; data: String::from("my stuff") &#125;;
    let d = CustomSmartPointer &#123; data: String::from("other stuff") &#125;;
    println!("CustomSmartPointers created.");
&#125;
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª CustomSmartPointer ç»“æ„ä½“ï¼Œå¹¶ä¸ºå…¶å®ç°äº† Drop traitã€‚å½“ c å’Œ d ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼ŒRustä¼šè‡ªåŠ¨è°ƒç”¨å®ƒä»¬çš„ drop æ–¹æ³•ï¼Œæ‰“å°å‡ºç›¸åº”çš„ä¿¡æ¯ã€‚
Deref Trait
Deref trait ç”¨äºé‡è½½è§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆ*ï¼‰ï¼Œå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰æŒ‡é’ˆç±»å‹çš„è§£å¼•ç”¨è¡Œä¸ºã€‚é€šè¿‡å®ç° Deref traitï¼Œæˆ‘ä»¬å¯ä»¥è®©è‡ªå®šä¹‰çš„æ™ºèƒ½æŒ‡é’ˆåƒæ™®é€šæŒ‡é’ˆä¸€æ ·ä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ã€‚
Deref trait å®šä¹‰äº†ä¸€ä¸ª deref æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæŒ‡å‘å†…éƒ¨æ•°æ®çš„å¼•ç”¨ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç° Deref traitï¼š
use std::ops::Deref;

struct MyBox&lt;T>(T);

impl&lt;T> MyBox&lt;T> &#123;
    fn new(x: T) -> MyBox&lt;T> &#123;
        MyBox(x)
    &#125;
&#125;

impl&lt;T> Deref for MyBox&lt;T> &#123;
    type Target = T;

    fn deref(&amp;self) -> &amp;Self::Target &#123;
        &amp;self.0
    &#125;
&#125;

fn main() &#123;
    let x = 5;
    let y = MyBox::new(x);

    assert_eq!(5, x);
    assert_eq!(5, *y);
&#125;
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª MyBox ç»“æ„ä½“ï¼Œå¹¶ä¸ºå…¶å®ç°äº† Deref traitã€‚é€šè¿‡å®ç° deref æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ * æ¥è®¿é—® MyBox å†…éƒ¨çš„æ•°æ®ã€‚
ç»ƒä¹ 
1. åˆ›å»ºä¸€ä¸ªå¤§å‹æ•°ç»„å¹¶å°†å…¶åˆ†é…åœ¨å †ä¸Šï¼Œç„¶åæµ‹é‡å’Œæ¯”è¾ƒåˆ†é…åœ¨å †å’Œæ ˆä¸Šçš„æ€§èƒ½å·®å¼‚ã€‚
ä½¿ç”¨instant::now() ; ä»¥åŠelapsed()
use std::time::Instant;

const ARRAY_SIZE: usize = 1000000;

fn main() &#123;
    // æµ‹é‡æ ˆä¸Šåˆ†é…çš„æ—¶é—´
    let start_stack = Instant::now();
    let _stack_array: [i32; ARRAY_SIZE] = [0; ARRAY_SIZE];
    let stack_duration = start_stack.elapsed();

    // æµ‹é‡å †ä¸Šåˆ†é…çš„æ—¶é—´
    let start_heap = Instant::now();
    let _heap_array: Box&lt;[i32]> = vec![0; ARRAY_SIZE].into_boxed_slice();
    let heap_duration = start_heap.elapsed();

    println!("Stack allocation time: &#123;:?&#125;", stack_duration);
    println!("Heap allocation time: &#123;:?&#125;", heap_duration);
&#125;
2. åˆ›å»ºä¸€ä¸ªåŒ…å«1_000_000ä¸ªå…ƒç´ çš„æ•°æ®ï¼Œåˆ†åˆ«å°†å…¶åˆ†é…åœ¨å †å’Œæ ˆä¸Šã€‚ä½¿ç”¨std::time::Instantæ¥æµ‹é‡åˆ†é…å’Œè®¿é—®æ—¶é—´ã€‚
use std::time::Instant;

const ELEMENT_COUNT: usize = 1_000_000;

fn main() &#123;
    // æ ˆä¸Šåˆ†é…
    let start_stack_alloc = Instant::now();
    let stack_data: [i32; ELEMENT_COUNT] = [0; ELEMENT_COUNT];
    let stack_alloc_time = start_stack_alloc.elapsed();

    let start_stack_access = Instant::now();
    for i in 0..ELEMENT_COUNT &#123;
        let _ = stack_data[i];
    &#125;
    let stack_access_time = start_stack_access.elapsed();

    // å †ä¸Šåˆ†é…
    let start_heap_alloc = Instant::now();
    let heap_data: Box&lt;[i32]> = vec![0; ELEMENT_COUNT].into_boxed_slice();
    let heap_alloc_time = start_heap_alloc.elapsed();

    let start_heap_access = Instant::now();
    for i in 0..ELEMENT_COUNT &#123;
        let _ = heap_data[i];
    &#125;
    let heap_access_time = start_heap_access.elapsed();

    println!("Stack allocation time: &#123;:?&#125;", stack_alloc_time);
    println!("Stack access time: &#123;:?&#125;", stack_access_time);
    println!("Heap allocation time: &#123;:?&#125;", heap_alloc_time);
    println!("Heap access time: &#123;:?&#125;", heap_access_time);
&#125;
é€šè¿‡ä»¥ä¸Šç»ƒä¹ ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ·±å…¥åœ°äº†è§£ Box æŒ‡é’ˆåœ¨å †ä¸Šåˆ†é…å†…å­˜çš„æ€§èƒ½ç‰¹ç‚¹ï¼Œä»¥åŠä¸æ ˆä¸Šåˆ†é…çš„å·®å¼‚ã€‚
3. å®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿ
ç›®æ ‡
å®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿï¼Œå…¶ä¸­åŒ…å«æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ¦‚å¿µã€‚æ–‡ä»¶å¤¹å¯ä»¥åŒ…å«æ–‡ä»¶å’Œå…¶ä»–æ–‡ä»¶å¤¹ã€‚ä½¿ç”¨ Box æ¥ç®¡ç†å†…å­˜ï¼Œå¹¶å®ç°å¯¹æ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ“ä½œï¼ˆå¦‚åˆ›å»ºæ–‡ä»¶ã€åˆ›å»ºæ–‡ä»¶å¤¹ã€åˆ—å‡ºæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰ã€‚
ä½œä¸šè¦æ±‚


å®šä¹‰ FileSystem trait å’Œ Node æšä¸¾

FileSystem trait åŒ…å« create_fileã€create_folder å’Œ list_contents æ–¹æ³•ã€‚
Node æšä¸¾åŒ…å« File å’Œ Folder å˜ä½“ã€‚



å®ç° FolderNode ç»“æ„ä½“

FolderNode å®ç° FileSystem traitï¼ŒåŒ…å« name å’Œ contents å­—æ®µã€‚
ä½¿ç”¨ Box ç®¡ç† contents ä¸­çš„å­èŠ‚ç‚¹ã€‚



å®ç°æ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ“ä½œ

create_file æ–¹æ³•åœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ–‡ä»¶ã€‚
create_folder æ–¹æ³•åœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºå­æ–‡ä»¶å¤¹ã€‚
list_contents æ–¹æ³•åˆ—å‡ºæ–‡ä»¶å¤¹çš„æ‰€æœ‰å†…å®¹ã€‚



æµ‹è¯•æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œ

åˆ›å»ºæ ¹æ–‡ä»¶å¤¹å¹¶æ·»åŠ æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚
åˆ›å»ºå­æ–‡ä»¶å¤¹å¹¶æ·»åŠ æ–‡ä»¶ã€‚
åˆ—å‡ºæ–‡ä»¶å¤¹çš„å†…å®¹å¹¶è¾“å‡ºæ–‡ä»¶ç³»ç»Ÿç»“æ„ã€‚



æç¤º

ä½¿ç”¨ Box æ¥ç®¡ç† Folder ä¸­çš„å­èŠ‚ç‚¹ã€‚
ä½¿ç”¨é€’å½’æ–¹æ³•æ¥éå†å’Œåˆ—å‡ºæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„å†…å®¹ã€‚
è€ƒè™‘ä½¿ç”¨ Vec æ¥å­˜å‚¨æ–‡ä»¶å¤¹çš„å­èŠ‚ç‚¹ã€‚

/**
 * ---------------æ–‡ä»¶ç³»ç»Ÿ----------------------------
 */
// èŠ‚ç‚¹æšä¸¾ ç”¨æ¥åŒºåˆ†æ–‡ä»¶å¤¹è¿˜æ˜¯æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹é€šè¿‡boxåŒ…è£…æ¥é¿å…é€’å½’ç±»å‹çš„å¤§å°æ­§ä¹‰
// å®šä¹‰ Node æšä¸¾ï¼šåŒ…å«æ–‡ä»¶ï¼ˆFileï¼‰å’Œæ–‡ä»¶å¤¹ï¼ˆFolderï¼‰ä¸¤ç§å˜ä½“
#[derive(Debug)]
enum Node &#123;
    File(String),            // æ–‡ä»¶ï¼šå­˜å‚¨æ–‡ä»¶å
    Folder(Box&lt;FolderNode>), // æ–‡ä»¶å¤¹ï¼šå­˜å‚¨ FolderNode çš„ Boxï¼ˆé¿å…é€’å½’ç»“æ„çš„å¤§å°é—®é¢˜ï¼‰
&#125;

// å®šä¹‰ FileSystem traitï¼šåŒ…å«æ–‡ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒæ“ä½œ
trait FileSystem &#123;
    fn create_file(&amp;mut self, name: String); // åœ¨å½“å‰æ–‡ä»¶å¤¹åˆ›å»ºæ–‡ä»¶
    fn create_folder(&amp;mut self, name: String) -> &amp;mut Self; // åœ¨å½“å‰æ–‡ä»¶å¤¹åˆ›å»ºå­æ–‡ä»¶å¤¹ï¼ˆè¿”å›å­æ–‡ä»¶å¤¹å¼•ç”¨ä»¥ä¾¿é“¾å¼æ“ä½œï¼‰
    fn list_contents(&amp;self, indent: &amp;str); // åˆ—å‡ºå½“å‰æ–‡ä»¶å¤¹å†…å®¹ï¼ˆå¸¦ç¼©è¿›ï¼Œæ–¹ä¾¿å±•ç¤ºç»“æ„ï¼‰
&#125;

// å®šä¹‰ FolderNode ç»“æ„ä½“ï¼šè¡¨ç¤ºæ–‡ä»¶å¤¹èŠ‚ç‚¹
#[derive(Debug)]
struct FolderNode &#123;
    name: String,        // æ–‡ä»¶å¤¹åç§°
    contents: Vec&lt;Node>, // å­˜å‚¨å­èŠ‚ç‚¹ï¼ˆæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼‰
&#125;

// ä¸º FolderNode å®ç° FileSystem trait
impl FileSystem for FolderNode &#123;
    // 1. åˆ›å»ºæ–‡ä»¶ï¼šå‘ contents æ·»åŠ  File èŠ‚ç‚¹
    fn create_file(&amp;mut self, name: String) &#123;
        self.contents.push(Node::File(name));
    &#125;

    // 2. åˆ›å»ºå­æ–‡ä»¶å¤¹ï¼šå‘ contents æ·»åŠ  Folder èŠ‚ç‚¹ï¼Œå¹¶è¿”å›å­æ–‡ä»¶å¤¹çš„å¯å˜å¼•ç”¨
    fn create_folder(&amp;mut self, name: String) -> &amp;mut Self &#123;
        // æ–°å»ºå­æ–‡ä»¶å¤¹èŠ‚ç‚¹
        let new_folder = FolderNode &#123;
            name: name.clone(),
            contents: Vec::new(),
        &#125;;
        // å°†å­æ–‡ä»¶å¤¹åŒ…è£…ä¸º Box å¹¶åŠ å…¥ contents
        self.contents.push(Node::Folder(Box::new(new_folder)));

        // æ‰¾åˆ°åˆšæ·»åŠ çš„å­æ–‡ä»¶å¤¹å¹¶è¿”å›å…¶å¯å˜å¼•ç”¨ï¼ˆé€šè¿‡ last_mut ç¡®ä¿æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼‰
        match self.contents.last_mut() &#123;
            Some(Node::Folder(folder_box)) => &amp;mut **folder_box,
            _ => panic!("åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥ï¼šé€»è¾‘é”™è¯¯"), // ç†è®ºä¸Šä¸ä¼šè§¦å‘
        &#125;
    &#125;

    // 3. åˆ—å‡ºå†…å®¹ï¼šé€’å½’éå†å­èŠ‚ç‚¹ï¼Œå¸¦ç¼©è¿›å±•ç¤ºç»“æ„
    fn list_contents(&amp;self, indent: &amp;str) &#123;
        // æ‰“å°å½“å‰æ–‡ä»¶å¤¹åç§°
        println!("&#123;&#125;&#123;&#125;", indent, self.name);
        // éå†å­èŠ‚ç‚¹
        for node in &amp;self.contents &#123;
            match node &#123;
                Node::File(file_name) => println!("&#123;&#125;&#123;&#125;", indent, file_name), // æ‰“å°æ–‡ä»¶
                Node::Folder(folder) => folder.list_contents(&amp;format!("&#123;&#125;  ", indent)), // é€’å½’æ‰“å°å­æ–‡ä»¶å¤¹ï¼ˆå¢åŠ ç¼©è¿›ï¼‰
            &#125;
        &#125;
    &#125;
&#125;

// æµ‹è¯•ä»£ç ï¼šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿå¹¶æ‰§è¡Œæ“ä½œ
#[test]
fn test_file_system() &#123;
    // 1. åˆ›å»ºæ ¹æ–‡ä»¶å¤¹
    let mut root = FolderNode &#123;
        name: "Root".to_string(),
        contents: Vec::new(),
    &#125;;

    // 2. æ ¹æ–‡ä»¶å¤¹æ“ä½œï¼šåˆ›å»ºæ–‡ä»¶ + å­æ–‡ä»¶å¤¹
    root.create_file("file1.txt".to_string()); // æ ¹ç›®å½•åˆ›å»ºæ–‡ä»¶
    let mut sub1 = root.create_folder("sub1".to_string()); // æ ¹ç›®å½•åˆ›å»ºå­æ–‡ä»¶å¤¹ sub1
    sub1.create_file("subfile1.txt".to_string()); // åœ¨ sub1 ä¸­åˆ›å»ºæ–‡ä»¶

    // 3. å­æ–‡ä»¶å¤¹åµŒå¥—æ“ä½œ
    let mut sub2 = root.create_folder("sub2".to_string()); // æ ¹ç›®å½•åˆ›å»ºå­æ–‡ä»¶å¤¹ sub2
    let mut subsub2 = sub2.create_folder("subsub2".to_string()); // åœ¨ sub2 ä¸­åˆ›å»ºå­æ–‡ä»¶å¤¹ subsub2
    subsub2.create_file("deepfile.txt".to_string()); // åœ¨ subsub2 ä¸­åˆ›å»ºæ–‡ä»¶

    // 4. åˆ—å‡ºæ ¹æ–‡ä»¶å¤¹å†…å®¹ï¼ˆä»ç©ºç¼©è¿›å¼€å§‹ï¼‰
    println!("æ–‡ä»¶ç³»ç»Ÿç»“æ„ï¼š");
    root.list_contents("");
&#125;

]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>RuståŸºç¡€[part9]_è¿”å›å€¼å’Œé”™è¯¯å¤„ç†ã€æ¨¡å—åŒ–</title>
    <url>/2025/07/16/Rust%E5%9F%BA%E7%A1%80%5Bpart9%5D_%E8%BF%94%E5%9B%9E%E5%80%BC%E5%92%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96/</url>
    <content><![CDATA[RuståŸºç¡€[part9]_è¿”å›å€¼å’Œé”™è¯¯å¤„ç†ã€æ¨¡å—åŒ–
è¿”å›å€¼
Option&lt;T&gt;
åŸºæœ¬ä½¿ç”¨
fn option_example() &#123;
    // åˆ›å»ºOption
    let some_number = Some(5);
    let some_string = Some("a string");
    let absent_number: Option&lt;i32> = None;

    //ä½¿ç”¨
    let x = plus_one(some_number);
    let y = plus_one(absent_number);
    println!("x: &#123;:?&#125;, y: &#123;:?&#125;", x, y);
&#125;

fn plus_one(x: Option&lt;i32>) -> Option&lt;i32> &#123;
    match x &#123;
        None => None,
        Some(i) => Some(i + 1),
    &#125;
&#125;

è¾…åŠ©å‡½æ•°

unwrap() : æå–optionä¸­çš„å€¼ï¼Œä½†æ˜¯æ²¡æœ‰å€¼çš„æ—¶å€™ä¼španic

fn unwrap_example() &#123;
    let some_number = Some(5);
    let some_string = Some("a string");
    let absent_number: Option&lt;i32> = None;

    println!("some_number: &#123;:?&#125;", some_number.unwrap());
    println!("some_string: &#123;:?&#125;", some_string.unwrap());
    // println!("absent_number: &#123;:?&#125;", absent_number.unwrap());
&#125;


is_some() å’Œis_none()

fn is_some_example() &#123;
    let some_number = Some(5);
    let some_string = Some("a string");
    let absent_number: Option&lt;i32> = None;

    println!("some_number: &#123;:?&#125;", some_number.is_some());
    println!("some_string: &#123;:?&#125;", some_string.is_some());
    println!("absent_number: &#123;:?&#125;", absent_number.is_some());
&#125;

fn is_none_example() &#123;
    let some_number = Some(5);
    let some_string = Some("a string");
    let absent_number: Option&lt;i32> = None;

    println!("some_number: &#123;:?&#125;", some_number.is_none());
    println!("some_string: &#123;:?&#125;", some_string.is_none());
    println!("absent_number: &#123;:?&#125;", absent_number.is_none());
&#125;

é”™è¯¯å¤„ç†
Rustä¸­çš„é”™è¯¯ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š

å¯æ¢å¤é”™è¯¯ï¼šé€šå¸¸ç”¨äºç³»ç»Ÿå…¨å±€è§’åº¦æ¥çœ‹å¯ä»¥æ¥å—çš„é”™è¯¯ï¼Œä¾‹å¦‚å¤„ç†ç”¨æˆ·çš„è®¿é—®ã€æ“ä½œç­‰é”™è¯¯ï¼Œè¿™äº›é”™è¯¯åªä¼šå½±å“æŸä¸ªç”¨æˆ·è‡ªèº«çš„æ“ä½œè¿›ç¨‹ï¼Œè€Œä¸ä¼šå¯¹ç³»ç»Ÿçš„å…¨å±€ç¨³å®šæ€§äº§ç”Ÿå½±å“  Result&lt;T,E&gt;
ä¸å¯æ¢å¤é”™è¯¯ï¼šå…¨å±€æ€§æˆ–ç³»ç»Ÿæ€§çš„é”™è¯¯ï¼Œä¼šæ¯”è¾ƒè‡´å‘½  Panic

Panic

panic! æ˜¯ Rust æ ‡å‡†åº“æä¾›çš„å®ï¼Œç”¨äºä¸»åŠ¨å¼•å‘è¿è¡Œæ—¶é”™è¯¯ã€‚
å½“ panic! è¢«è°ƒç”¨æ—¶ï¼š

ç¨‹åºæ‰“å°é”™è¯¯ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ–‡ä»¶åã€è¡Œå·ç­‰ï¼‰ã€‚
å±•å¼€ï¼ˆunwindï¼‰è°ƒç”¨æ ˆå¹¶æ¸…ç†èµ„æºï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ã€‚
æœ€ç»ˆç»ˆæ­¢å½“å‰çº¿ç¨‹æˆ–æ•´ä¸ªç¨‹åºï¼ˆå–å†³äºç¼–è¯‘é…ç½®ï¼‰ã€‚



å¸¸è§åœºæ™¯



åœºæ™¯
æè¿°




panic! æ˜¾å¼è°ƒç”¨
ä¸»åŠ¨è§¦å‘ panic


æ•°ç»„è¶Šç•Œè®¿é—®
å¦‚ vec[100] è®¿é—®é•¿åº¦ä¸è¶³çš„å‘é‡


unwrap() æˆ– expect() é”™è¯¯
å½“ Option æˆ– Result ä¸º None æˆ– Err æ—¶


æ–­è¨€å¤±è´¥
ä½¿ç”¨ assert!, assert_eq! ç­‰å®æ£€æŸ¥å¤±è´¥æ—¶



è¡Œä¸ºæ§åˆ¶
1. æ ˆå±•å¼€ï¼ˆUnwindingï¼‰
é»˜è®¤æƒ…å†µä¸‹ï¼Œpanic ä¼šï¼š

å±•å¼€è°ƒç”¨æ ˆï¼ˆstack unwindingï¼‰
æ‰§è¡Œææ„å‡½æ•°ï¼ˆdropï¼‰
æ¸…ç†èµ„æº

è¿™æ˜¯æœ€å®‰å…¨çš„æ–¹å¼ï¼Œä½†å¯èƒ½å¸¦æ¥ä¸€å®šæ€§èƒ½å¼€é”€ã€‚
2. ä¸­æ­¢ï¼ˆAbortingï¼‰
åœ¨ [Cargo.toml](file:///Users/tinachan/rust/hello_cargo/Cargo.toml) ä¸­å¯ä»¥é…ç½®ï¼š
[profile.release]
panic = "abort"

&quot;abort&quot;ï¼šç›´æ¥ç»ˆæ­¢ç¨‹åºï¼Œä¸è¿›è¡Œæ ˆå±•å¼€ï¼ˆé€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿæˆ–æ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼‰
&quot;unwind&quot;ï¼šé»˜è®¤å€¼ï¼Œä¿ç•™æ ˆå±•å¼€è¡Œä¸º

ç¤ºä¾‹ä»£ç 
ç¤ºä¾‹ 1ï¼šæ˜¾å¼ panic
fn main() &#123;
    panic!("è¿™æ˜¯ä¸€ä¸ªä¸»åŠ¨ panic");
&#125;
ç¤ºä¾‹ 2ï¼šæ•°ç»„è¶Šç•Œè®¿é—®
let v = vec![1, 2, 3];
println!("&#123;&#125;", v[99]); // è¶Šç•Œè®¿é—®è§¦å‘ panic
ç¤ºä¾‹ 3ï¼šä½¿ç”¨ unwrap() è§¦å‘ panic
let s: Option&lt;String> = None;
let _ = s.unwrap(); // è§¦å‘ panic
è·å– Backtraceï¼ˆè°ƒè¯•ä¿¡æ¯ï¼‰
è®¾ç½®ç¯å¢ƒå˜é‡ä»¥è·å–è¯¦ç»†çš„è°ƒç”¨æ ˆä¿¡æ¯ï¼š
RUST_BACKTRACE=1 cargo run
è¾“å‡ºå°†åŒ…å«å®Œæ•´çš„è°ƒç”¨æ ˆï¼Œå¸®åŠ©å®šä½ panic å‘ç”Ÿçš„ä½ç½®ã€‚
panic å¤„ç†ç­–ç•¥ï¼ˆé«˜çº§ï¼‰
ä½ å¯ä»¥é€šè¿‡ std::panic::set_hook è‡ªå®šä¹‰ panic å¤„ç†é€»è¾‘ï¼š
use std::panic;

panic::set_hook(Box::new(|info| &#123;
    println!("è‡ªå®šä¹‰ panic å¤„ç†ï¼š&#123;&#125;", info);
&#125;));

panic!("æµ‹è¯•è‡ªå®šä¹‰ panic hook");

æ³¨æ„ï¼šæ­¤æ–¹æ³•åªèƒ½è®¾ç½®ä¸€æ¬¡ï¼Œé€šå¸¸ç”¨äºæ—¥å¿—è®°å½•æˆ–å´©æºƒåˆ†æå·¥å…·é›†æˆã€‚

Result
åœ¨ Rust ä¸­ï¼ŒResult æ˜¯ä¸€ä¸ªæ ‡å‡†åº“æä¾›çš„æšä¸¾ç±»å‹ï¼Œç”¨äºå¤„ç†å¯æ¢å¤é”™è¯¯ï¼ˆrecoverable errorsï¼‰ã€‚ä¸ panic! ä¸åŒï¼ŒResult å…è®¸å¼€å‘è€…é€šè¿‡è¿”å›å€¼æ˜ç¡®åœ°å¤„ç†æˆåŠŸæˆ–å¤±è´¥çš„æƒ…å†µï¼Œæ˜¯ç¼–å†™å¥å£®ç¨‹åºçš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ã€‚
å®šä¹‰
enum Result&lt;T, E> &#123;
    Ok(T),
    Err(E),
&#125;

Tï¼šè¡¨ç¤ºæ“ä½œæˆåŠŸæ—¶è¿”å›çš„å€¼ç±»å‹ã€‚
Eï¼šè¡¨ç¤ºæ“ä½œå¤±è´¥æ—¶è¿”å›çš„é”™è¯¯ç±»å‹ã€‚

äºŒã€å¸¸ç”¨æ“ä½œ
1. match åŒ¹é…
æœ€åŸºç¡€ä¹Ÿæœ€çµæ´»çš„æ–¹å¼ï¼š
#[test]
fn result_example() &#123;
    match divide(19, 0) &#123;
        Ok(result) => println!("result=&#123;&#125;", result),
        Err(err) => println!("&#123;&#125;", err),
    &#125;;
&#125;

fn divide(a: i32, b: i32) -> Result&lt;i32, String> &#123;
    if b == 0 &#123;
        Err("é™¤æ•°ä¸èƒ½ä¸º0".to_string())
    &#125; else &#123;
        Ok(a / b)
    &#125;
&#125;
2. æå–å†…éƒ¨å€¼ï¼š unwrap() å’Œ expect(msg)

unwrap()ï¼šå¦‚æœ Ok è¿”å›å†…éƒ¨å€¼ï¼›å¦‚æœæ˜¯ Err åˆ™è§¦å‘ panicã€‚
expect(&amp;str)ï¼šç±»ä¼¼ unwrap()ï¼Œä½†å¯ä»¥è‡ªå®šä¹‰ panic æ¶ˆæ¯ã€‚

let result = divide(4, 0).unwrap(); // å¦‚æœå‡ºé”™ä¼š panic
let result = divide(4, 0).expect("é™¤æ³•è®¡ç®—é”™è¯¯"); // è‡ªå®šä¹‰ panic æ¶ˆæ¯

âš ï¸ æ³¨æ„ï¼šä»…åœ¨æµ‹è¯•æˆ–ç¡®å®šä¸ä¼šå‡ºé”™çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚

3. ä¼ æ’­é”™è¯¯:? è¿ç®—ç¬¦
ç”¨äºåœ¨å‡½æ•°ä¸­å¿«é€Ÿä¼ æ’­é”™è¯¯ã€‚åªèƒ½ç”¨äºè¿”å›ç±»å‹ä¸º Result çš„å‡½æ•°ä¸­ã€‚
fn read_file() -> Result&lt;String, std::io::Error> &#123;
    let content = std::fs::read_to_string("file.txt")?;
    Ok(content)
&#125;
4. å¯¹å†…éƒ¨å€¼è¿›è¡Œä¿®æ”¹ï¼šmap ã€map_errå’Œ and_then

map(f)ï¼šå¯¹ Ok å€¼è¿›è¡Œæ˜ å°„ï¼Œä¸å½±å“ Errã€‚
map_err(f): å¯ä»¥ä¿®æ”¹Errç±»å‹
and_then(f)ï¼š é“¾å¼è°ƒç”¨ï¼Œåªæœ‰å½“å‰ä¸º Ok æ—¶æ‰ç»§ç»­æ‰§è¡Œã€‚

let result = divide(10, 2)
    .map(|x| x * 2)
    .and_then(|x| divide(x, 0));
5. or å’Œ or_else

or(res)ï¼šå¦‚æœå½“å‰æ˜¯ Errï¼Œåˆ™ä½¿ç”¨ç»™å®šçš„ Result æ›¿ä»£ã€‚
or_else(f)ï¼šå¦‚æœå½“å‰æ˜¯ Errï¼Œåˆ™è°ƒç”¨é—­åŒ…è·å–æ›¿ä»£å€¼ã€‚

let res = divide(4, 0).or(Ok(42)); // å¦‚æœå‡ºé”™å°±è¿”å›é»˜è®¤å€¼ 42
6. is_ok / is_err / ok() / err()
ç”¨äºåˆ¤æ–­çŠ¶æ€æˆ–è½¬æ¢ä¸º Optionã€‚
if result.is_ok() &#123;
    println!("æ“ä½œæˆåŠŸ");
&#125;

let opt = result.ok(); // è½¬æ¢ä¸º Option&lt;T>
7. å¯¹è¿”å›çš„é”™è¯¯è¿›è¡Œå¤„ç† err.kind
use std::fs::File;
use std::io::ErrorKind;
fn error_kind_example() &#123;
    let greeting = File::open("hello.txt");

    let greeting_result = match greeting &#123;
        Ok(result) => result,
        Err(err) => match err.kind() &#123;
            ErrorKind::NotFound => File::create("hello.txt").unwrap(),
            other_error => panic!("Error: &#123;&#125;", err),
        &#125;,
    &#125;;
&#125;
ä¸‰ã€æ³¨æ„äº‹é¡¹


é¿å…æ»¥ç”¨ unwrap() å’Œ expect()ï¼šé™¤éä½ éå¸¸ç¡®å®šæŸä¸ªæ“ä½œä¸ä¼šå¤±è´¥ï¼Œå¦åˆ™åº”ä¼˜å…ˆä½¿ç”¨ match æˆ– ? æ¥å¤„ç†é”™è¯¯ã€‚


é”™è¯¯ç±»å‹ä¿æŒä¸€è‡´ï¼šåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå»ºè®®ç»Ÿä¸€ä½¿ç”¨ç›¸åŒçš„é”™è¯¯ç±»å‹ï¼ˆå¦‚è‡ªå®šä¹‰æšä¸¾æˆ– anyhow::Errorï¼‰ï¼Œä»¥ä¾¿é›†ä¸­å¤„ç†ã€‚


ä½¿ç”¨ ? æ—¶æ³¨æ„å‡½æ•°ç­¾åï¼šåªèƒ½åœ¨è¿”å› Result æˆ– Option çš„å‡½æ•°ä¸­ä½¿ç”¨ ?ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚


é”™è¯¯ä¿¡æ¯åº”æ¸…æ™°å…·ä½“ï¼šä¸è¦ç®€å•è¿”å› &quot;error&quot;ï¼Œè€Œåº”è¯¥æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•å’Œæ—¥å¿—åˆ†æã€‚


é…åˆ From trait è‡ªåŠ¨è½¬æ¢é”™è¯¯ï¼šä½ å¯ä»¥ä¸ºè‡ªå®šä¹‰é”™è¯¯ç±»å‹å®ç° Fromï¼Œä»è€Œç®€åŒ–é”™è¯¯ä¼ æ’­ã€‚


impl From&lt;std::io::Error> for MyError &#123;
    fn from(e: std::io::Error) -> Self &#123;
        MyError::Io(e)
    &#125;
&#125;
è¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ ? å°† std::io::Result è½¬æ¢ä¸ºä½ çš„é”™è¯¯ç±»å‹ã€‚



æ“ä½œ
ç”¨é€”




match
æ‰‹åŠ¨åŒ¹é…æˆåŠŸæˆ–å¤±è´¥æƒ…å†µ


unwrap() / expect()
å¿«é€Ÿè·å–å€¼ï¼Œå‡ºé”™ panic


?
å‘ä¸Šå±‚ä¼ é€’é”™è¯¯


map() / and_then()
é“¾å¼å¤„ç†æˆåŠŸå€¼


or() / or_else()
æä¾›å¤‡é€‰é”™è¯¯å¤„ç†æ–¹æ¡ˆ



panic ä¸ Result çš„åŒºåˆ«



ç‰¹æ€§
panic!
Result




ç±»å‹
ä¸å¯æ¢å¤é”™è¯¯
å¯æ¢å¤é”™è¯¯


æ¨èä½¿ç”¨åœºæ™¯
é€»è¾‘é”™è¯¯ã€éæ³•çŠ¶æ€
æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ç­‰


æ˜¯å¦å¿…é¡»å¤„ç†
å¦
æ˜¯


å¯¹æ€§èƒ½å½±å“
è¾ƒå¤§ï¼ˆæ ˆå±•å¼€ï¼‰
å°






æœ€ä½³å®è·µ




ä¼˜å…ˆä½¿ç”¨ Result è€Œä¸æ˜¯ panic!


å‡å°‘ unwrap() çš„ä½¿ç”¨ï¼Œå°¤å…¶åœ¨ç”Ÿäº§ä»£ç ä¸­


ç»Ÿä¸€é”™è¯¯ç±»å‹ï¼Œæ–¹ä¾¿é›†ä¸­å¤„ç†


ä½¿ç”¨ ? ç®€åŒ–é”™è¯¯ä¼ æ’­é€»è¾‘



ç»ƒä¹ 
// ä¿®å¤callå‡½æ•°çš„é”™è¯¯
// å½“bä¸ºNoneæ—¶ï¼ŒæŒ‰é»˜è®¤å€¼1
fn call(a: i32, b: Option&lt;i32>) -> Result&lt;f64, String> &#123;
    let b = b.unwrap_or(1); // å¤„ç†bä¸ºNoneçš„æƒ…å†µï¼Œé»˜è®¤å€¼1
    let r = match divide(a, b) &#123;
        Some(r) => r,
        None => return Err(String::from("Division by zero")), // æ•è·é™¤é›¶é”™è¯¯
    &#125;;
    let s = match sqrt(r) &#123;
        Ok(s) => s,
        Err(MathError::NegativeSquareRoot) => &#123;
            return Err(String::from("Cannot compute square root of a negative number")) // æ•è·è´Ÿæ•°å¹³æ–¹æ ¹é”™è¯¯
        &#125;
    &#125;;
    Ok(s) // æ­£å¸¸è¿”å›ç»“æœ
&#125;

fn divide(a: i32, b: i32) -> Option&lt;f64> &#123;
    if b != 0 &#123;
        Some(a as f64 / b as f64)
    &#125; else &#123;
        None
    &#125;
&#125;

pub enum MathError &#123;
    DivisionByZero,
    NegativeSquareRoot,
&#125;

fn sqrt(x: f64) -> Result&lt;f64, MathError> &#123;
    if x &lt; 0.0 &#123;
        Err(MathError::NegativeSquareRoot)
    &#125; else &#123;
        Ok(x.sqrt())
    &#125;
&#125;
æ¨¡å—åŒ– Modules
Rust çš„æ¨¡å—ç³»ç»Ÿç”¨äºç»„ç»‡ä»£ç ç»“æ„ã€æ§åˆ¶ä½œç”¨åŸŸå’Œå¯è§æ€§ã€‚å®ƒæ”¯æŒå°†ç¨‹åºåˆ’åˆ†ä¸ºå¤šä¸ªé€»è¾‘å•å…ƒï¼ˆæ¨¡å—ï¼‰ï¼Œä¾¿äºä»£ç ç®¡ç†ã€å¤ç”¨å’Œå°è£…ã€‚
package
ä¸€èˆ¬é€šè¿‡cargo newåˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ªpackageï¼ŒåŒ…å«library crateså’Œ binary cratesï¼Œä¹Ÿå°±æ˜¯.rs
 Cargo.lock
Cargo.toml
src
â”œâ”€â”€ bin
â”‚   â”œâ”€â”€ a.rs
â”‚   â””â”€â”€ b.rs
â”œâ”€â”€ lib.rs
â””â”€â”€ main.rs
crate

crate æ˜¯ Rust ä¸­æœ€å°çš„ç¼–è¯‘å•å…ƒï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªåº“ï¼ˆlibraryï¼‰æˆ–å¯æ‰§è¡Œç¨‹åºï¼ˆbinaryï¼‰ã€‚
æ¯ä¸ª crate éƒ½æœ‰ä¸€ä¸ªéšå¼çš„æ ¹æ¨¡å—ï¼ˆroot moduleï¼‰ï¼š[main.rs](file:///Users/tinachan/rust/hello_cargo/src/main.rs) æˆ– lib.rsã€‚
æ‰€æœ‰æ¨¡å—éƒ½æ˜¯ä»æ ¹æ¨¡å—å¼€å§‹ç»„ç»‡çš„ã€‚

ä¾‹å¦‚ï¼š
src&#x2F;
â”œâ”€â”€ main.rs       &#x2F;&#x2F; æ ¹æ¨¡å—
â”œâ”€â”€ utils.rs      &#x2F;&#x2F; æ¨¡å—æ–‡ä»¶
â””â”€â”€ utils&#x2F;
    â””â”€â”€ logging.rs &#x2F;&#x2F; å­æ¨¡å—æ–‡ä»¶
Moudles
ä½¿ç”¨ mod å…³é”®å­—å®šä¹‰ä¸€ä¸ªæ¨¡å—ï¼š
mod a &#123;
    const num: usize = 1;
    fn log1() &#123;
        println!("&#123;&#125;", num);
    &#125;
&#125;

æ¨¡å—å¯ä»¥åµŒå¥—å®šä¹‰ï¼š
mod a &#123;
    const num: usize = 1;
    fn log1() &#123;
        println!("&#123;&#125;", num);
    &#125;
    mod b &#123;
        // æ— è®ºæ˜¯funcè¿˜æ˜¯mod åœ¨å¤–éƒ¨éœ€è¦è°ƒç”¨çš„è¯éƒ½éœ€è¦åŠ ä¸Špub
        const num2: usize = 2;
        fn log2() &#123;
            println!("&#123;&#125;", num2);
        &#125;
    &#125;
&#125;
å¯¼å…¥æ¨¡å— use
ä½¿ç”¨ use å°†æ¨¡å—æˆ–å‡½æ•°å¼•å…¥å½“å‰ä½œç”¨åŸŸï¼Œç®€åŒ–è°ƒç”¨ï¼š
use a::b::log2;
use a::log1;

fn main() &#123;
    log1();
    log2(); // å†…éƒ¨çš„modéœ€è¦å¤šå±‚è°ƒç”¨
&#125;
é‡å‘½å as[é‡åçš„æƒ…å†µ]ï¼š
 use a::&#123;b::log as log1, log as log2&#125;;// useåˆå¹¶

fn main() &#123;
    log1();
    log2(); 
&#125;


mod a &#123;
    const num: usize = 1;
    pub fn log() &#123;
        println!("&#123;&#125;", num);
    &#125;
    pub mod b &#123;
        // æ— è®ºæ˜¯funcè¿˜æ˜¯mod åœ¨å¤–éƒ¨éœ€è¦è°ƒç”¨çš„è¯éƒ½éœ€è¦åŠ ä¸Špub
        const num2: usize = 2;
        pub fn log() &#123;
            println!("&#123;&#125;", num2);
        &#125;
    &#125;
&#125;
å¯è§æ€§ï¼ˆVisibilityï¼‰
é»˜è®¤æ¨¡å—ä¸­çš„é¡¹æ˜¯ç§æœ‰çš„ ; pub å…³é”®å­—å®ç°å…¬æœ‰
fn main() &#123;
    a::log1();
    a::b::log2(); // aå†…éƒ¨çš„modéœ€è¦å¤šå±‚è°ƒç”¨
&#125;

mod a &#123;
    const num: usize = 1;
    pub fn log1() &#123;
        println!("&#123;&#125;", num);
    &#125;
    pub mod b &#123;
        // æ— è®ºæ˜¯funcè¿˜æ˜¯mod åœ¨å¤–éƒ¨éœ€è¦è°ƒç”¨çš„è¯éƒ½éœ€è¦åŠ ä¸Špub
        const num2: usize = 2;
        pub fn log2() &#123;
            println!("&#123;&#125;", num2);
        &#125;
    &#125;
&#125;
pub(crate)
é™å®šåœ¨mod aä¸­è°ƒç”¨
pub(in crate::a) fn log() &#123;
        println!("&#123;&#125;", num);
&#125;
pub(in path)
pub use
Path
é€šè¿‡è·¯å¾„è®¿é—®

ç»å¯¹è·¯å¾„

crate::b::log();// ç»å¯¹è·¯å¾„è®¿é—®

ç›¸å¯¹è·¯å¾„

a::log();// ç›¸å¯¹è·¯å¾„è®¿é—®
workspace
Rust ä¸­ç”¨äºç®¡ç† å¤šä¸ªç›¸å…³åŒ…ï¼ˆcrateï¼‰çš„åŠŸèƒ½ã€‚å·¥ä½œåŒºå…è®¸å°†å¤šä¸ª crate ç»„ç»‡åœ¨åŒä¸€ä»“åº“ä¸‹ï¼Œå…±äº«ä¾èµ–ã€ç»Ÿä¸€æ„å»º / æµ‹è¯•æµç¨‹ã€‚
å¯ä»¥é€šè¿‡åœ¨cargo.tomlä¸­æ·»åŠ 
[workspace] 
members = ["course","lib_add","lib_divide"]

]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part10]_å¹¶å‘-æ¦‚å¿µã€çº¿ç¨‹ã€é€šä¿¡ã€å…±äº«å†…å­˜</title>
    <url>/2025/08/01/Rust%E8%BF%9B%E9%98%B6-part10-%E5%B9%B6%E5%8F%91-%E6%A6%82%E5%BF%B5%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E9%80%9A%E4%BF%A1/</url>
    <content><![CDATA[Rustè¿›é˜¶[part10]_å¹¶å‘
åŸºæœ¬æ¦‚è¿°
åœ¨Rustä¸­ï¼Œé€šè¿‡std::thread::spawnå‡½æ•°å¯ä»¥åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ï¼Œé—­åŒ…ä¸­åŒ…å«çº¿ç¨‹è¦æ‰§è¡Œçš„ä»£ç ã€‚
åŸºç¡€çº¿ç¨‹åˆ›å»º
å­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¾èµ–äºä¸»çº¿ç¨‹ï¼šå½“ä¸»çº¿ç¨‹ç»“æŸæ—¶ï¼Œæ— è®ºå­çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œéƒ½ä¼šè¢«å¼ºåˆ¶ç»ˆæ­¢ã€‚
use std::thread;
use std::time::Duration;

fn main() &#123;
    // åˆ›å»ºå­çº¿ç¨‹
    thread::spawn(|| &#123;
        for i in 1..10 &#123;
            println!("spawn thread: &#123;&#125;", i);
            thread::sleep(Duration::from_millis(1)); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        &#125;
    &#125;);

    // ä¸»çº¿ç¨‹é€»è¾‘
    for i in 1..5 &#123;
        println!("main thread: &#123;&#125;", i);
        thread::sleep(Duration::from_millis(1));
    &#125;
&#125;
è¾“å‡ºç»“æœï¼ˆå¯èƒ½å› è°ƒåº¦é¡ºåºç•¥æœ‰ä¸åŒï¼‰ï¼š
main thread: 1
spawn thread: 1
main thread: 2
spawn thread: 2
main thread: 3
spawn thread: 3
main thread: 4
spawn thread: 4
spawn thread: 5  &#x2F;&#x2F; ä¸»çº¿ç¨‹å·²ç»“æŸï¼Œå­çº¿ç¨‹å¯èƒ½è¢«ä¸­æ–­
ç­‰å¾…çº¿ç¨‹å®Œæˆï¼šJoinHandle
é€šè¿‡thread::spawnè¿”å›çš„JoinHandleç±»å‹ï¼Œå¯ä»¥è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚è°ƒç”¨joinæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å­çº¿ç¨‹å®Œæˆã€‚
use std::thread;
use std::time::Duration;

fn main() &#123;
    // è·å–å­çº¿ç¨‹çš„JoinHandle
    let handle = thread::spawn(|| &#123;
        for i in 1..10 &#123;
            println!("spawn thread: &#123;&#125;", i);
            thread::sleep(Duration::from_millis(1));
        &#125;
    &#125;);

    // ä¸»çº¿ç¨‹é€»è¾‘
    for i in 1..5 &#123;
        println!("main thread: &#123;&#125;", i);
        thread::sleep(Duration::from_millis(1));
    &#125;

    // ç­‰å¾…å­çº¿ç¨‹å®Œæˆï¼ˆé˜»å¡ä¸»çº¿ç¨‹ï¼‰
    handle.join().unwrap(); // joinè¿”å›Resultï¼Œunwrapå¤„ç†æˆåŠŸæƒ…å†µ
&#125;
è¾“å‡ºç»“æœï¼šä¸»çº¿ç¨‹ä¼šç­‰å¾…å­çº¿ç¨‹æ‰“å°åˆ°9åå†ç»“æŸã€‚
ä½¿ç”¨moveé—­åŒ…
moveé—­åŒ…ç”¨äºå°†å¤–éƒ¨å˜é‡çš„æ‰€æœ‰æƒè½¬ç§»åˆ°å­çº¿ç¨‹ä¸­ï¼Œè§£å†³å¤šçº¿ç¨‹ä¸­å˜é‡ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼ˆé¿å…å­çº¿ç¨‹è®¿é—®å·²è¢«é‡Šæ”¾çš„å˜é‡ï¼‰ã€‚
ç¤ºä¾‹ï¼šä¸ä½¿ç”¨moveå¯¼è‡´çš„é”™è¯¯
use std::thread;

fn main() &#123;
    let s = String::from("hello");
    // é”™è¯¯ï¼šå­çº¿ç¨‹å¯èƒ½æ¯”ä¸»çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œså¯èƒ½è¢«æå‰é‡Šæ”¾
    thread::spawn(|| &#123;
        println!("&#123;&#125;", s); // ç¼–è¯‘é”™è¯¯ï¼š`s` does not live long enough
    &#125;);
&#125;
ä½¿ç”¨moveé—­åŒ…è§£å†³
use std::thread;

fn main() &#123;
    let s = String::from("hello");
    // moveé—­åŒ…å°†sçš„æ‰€æœ‰æƒè½¬ç§»åˆ°å­çº¿ç¨‹
    thread::spawn(move || &#123;
        println!("&#123;&#125;", s); // æ­£ç¡®ï¼šå­çº¿ç¨‹æ‹¥æœ‰sçš„æ‰€æœ‰æƒ
    &#125;).join().unwrap();
&#125;
å¤šçº¿ç¨‹é€šä¿¡
Rustæ¨èé€šè¿‡æ¶ˆæ¯ä¼ é€’å®ç°å®‰å…¨å¹¶å‘ï¼Œæ ‡å‡†åº“æä¾›çš„channelï¼ˆé€šé“ï¼‰æ˜¯å®ç°è¿™ä¸€æœºåˆ¶çš„æ ¸å¿ƒå·¥å…·ã€‚
Channelï¼ˆé€šé“ï¼‰åŸºç¡€
é€šé“ç”±å‘é€ç«¯ï¼ˆSenderï¼‰ å’Œæ¥æ”¶ç«¯ï¼ˆReceiverï¼‰ ç»„æˆï¼Œæ•°æ®ä»å‘é€ç«¯å‘é€ï¼Œæ¥æ”¶ç«¯æ¥æ”¶ï¼Œå®ç°çº¿ç¨‹é—´é€šä¿¡ã€‚

å¯¼å…¥ï¼šuse std::sync::mpsc;ï¼ˆmpscï¼šå¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…ï¼Œæ”¯æŒå¤šä¸ªå‘é€ç«¯å‘ä¸€ä¸ªæ¥æ”¶ç«¯å‘é€æ•°æ®ï¼‰
åˆ›å»ºï¼šlet (tx, rx) = mpsc::channel();ï¼ˆè¿”å›åŒ…å«å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„å…ƒç»„ï¼‰

åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
use std::sync::mpsc;
use std::thread;
use std::time::Duration;

fn main() &#123;
    let (tx, rx) = mpsc::channel();

    // å­çº¿ç¨‹å‘é€æ•°æ®
    thread::spawn(move || &#123;
        let vals = vec![
            String::from("hi"),
            String::from("from"),
            String::from("the"),
            String::from("thread"),
        ];
        for val in vals &#123;
            tx.send(val).unwrap(); // å‘é€æ•°æ®ï¼Œå¤±è´¥æ—¶unwrap panic
            thread::sleep(Duration::from_millis(500)); // æ¨¡æ‹Ÿé—´éš”å‘é€
        &#125;
    &#125;);

    // ä¸»çº¿ç¨‹æ¥æ”¶æ•°æ®
    for received in rx &#123; // è¿­ä»£æ¥æ”¶ï¼Œç›´åˆ°å‘é€ç«¯å…¨éƒ¨å…³é—­
        println!("Got: &#123;&#125;", received);
    &#125;
&#125;
è¾“å‡ºç»“æœï¼š
Got: hi
Got: from
Got: the
Got: thread
å‘é€ç«¯ä¸æ¥æ”¶ç«¯æ–¹æ³•


å‘é€ç«¯ï¼ˆSenderï¼‰ï¼š

send(T) -&gt; Result&lt;(), SendError&lt;T&gt;&gt;ï¼šå‘é€æ•°æ®ï¼ŒæˆåŠŸè¿”å›Ok(())ï¼Œå¤±è´¥ï¼ˆå¦‚æ¥æ”¶ç«¯å·²å…³é—­ï¼‰è¿”å›Errã€‚



æ¥æ”¶ç«¯ï¼ˆReceiverï¼‰ï¼š

recv() -&gt; Result&lt;T, RecvError&gt;ï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ”¶åˆ°æ•°æ®æˆ–å‘é€ç«¯å…³é—­ï¼ˆè¿”å›Errï¼‰ã€‚
try_recv() -&gt; Result&lt;T, TryRecvError&gt;ï¼šéé˜»å¡ï¼Œç«‹å³è¿”å›ï¼š

æœ‰æ•°æ®ï¼šOk(T)
æ— æ•°æ®ï¼šErr(TryRecvError::Empty)
å‘é€ç«¯å…³é—­ï¼šErr(TryRecvError::Disconnected)





å¤šç”Ÿäº§è€…ç¤ºä¾‹
é€šè¿‡Sender::cloneå¯ä»¥åˆ›å»ºå¤šä¸ªå‘é€ç«¯ï¼Œå®ç°å¤šçº¿ç¨‹å‘åŒä¸€æ¥æ”¶ç«¯å‘é€æ•°æ®ã€‚
use std::sync::mpsc;
use std::thread;
use std::time::Duration;

fn main() &#123;
    let (tx, rx) = mpsc::channel();
    let tx2 = tx.clone(); // å…‹éš†å‘é€ç«¯

    // çº¿ç¨‹1å‘é€æ•°æ®
    thread::spawn(move || &#123;
        let vals = vec![
            String::from("thread1: hi"),
            String::from("thread1: hello"),
        ];
        for val in vals &#123;
            tx.send(val).unwrap();
            thread::sleep(Duration::from_millis(500));
        &#125;
    &#125;);

    // çº¿ç¨‹2å‘é€æ•°æ®
    thread::spawn(move || &#123;
        let vals = vec![
            String::from("thread2: bye"),
            String::from("thread2: goodbye"),
        ];
        for val in vals &#123;
            tx2.send(val).unwrap();
            thread::sleep(Duration::from_millis(500));
        &#125;
    &#125;);

    // æ¥æ”¶æ•°æ®
    for received in rx &#123;
        println!("Got: &#123;&#125;", received);
    &#125;
&#125;
ç»ƒä¹ 
ç»ƒä¹ 1â€”â€”å®ç°å¤šçº¿ç¨‹æ–‡ä»¶å¤„ç†å™¨
ä»»åŠ¡æè¿°
ä½ éœ€è¦ç¼–å†™ä¸€ä¸ªå¤šçº¿ç¨‹æ–‡ä»¶å¤„ç†å™¨ï¼Œå®ƒä»ä¸€ä¸ªé€šé“ï¼ˆchannelï¼‰ä¸­æ¥æ”¶æ–‡ä»¶è·¯å¾„ï¼Œå¹¶åœ¨çº¿ç¨‹æ± ä¸­å¤„ç†è¿™äº›æ–‡ä»¶ã€‚æ–‡ä»¶å¤„ç†çš„å…·ä½“ä»»åŠ¡å¯ä»¥æ˜¯è¯»å–æ–‡ä»¶å†…å®¹å¹¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚ä½ éœ€è¦ä½¿ç”¨ Rust çš„å¸¦ç¼“å†²åŒºçš„ channel æ¥æ§åˆ¶å¹¶å‘çº¿ç¨‹çš„æ•°é‡ï¼Œä»è€Œé™åˆ¶åŒæ—¶å¤„ç†çš„æ–‡ä»¶æ•°é‡ã€‚
å…·ä½“è¦æ±‚
1.æ–‡ä»¶å¤„ç†ä»»åŠ¡ï¼šå®šä¹‰ä¸€ä¸ªå‡½æ•°process_fileï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ã€‚
2.å¤šçº¿ç¨‹æ§åˆ¶ï¼š

åˆ›å»ºä¸€ä¸ªå¸¦ç¼“å†²åŒºçš„channelï¼Œç”¨äºåœ¨ä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ä¹‹é—´ä¼ é€’æ–‡ä»¶è·¯å¾„ã€‚
ä½¿ç”¨å¤šçº¿ç¨‹æ¥å®ç°æ–‡ä»¶å¤„ç†çš„å¹¶å‘æ€§ï¼Œé™åˆ¶çº¿ç¨‹çš„å¹¶å‘æ•°é‡ï¼ˆä¾‹å¦‚ï¼Œæœ€å¤šåŒæ—¶å¤„ç† 4 ä¸ªæ–‡ä»¶ï¼‰ã€‚

3.ä¸»çº¿ç¨‹ä½œä¸ºç”Ÿäº§è€…ï¼šä¸»çº¿ç¨‹è´Ÿè´£å‘é€šé“å‘é€æ–‡ä»¶è·¯å¾„ã€‚å‡è®¾æˆ‘ä»¬æœ‰ 10 ä¸ªæ–‡ä»¶è·¯å¾„è¦å¤„ç†ã€‚
4.å·¥ä½œçº¿ç¨‹ä½œä¸ºæ¶ˆè´¹è€…ï¼šåˆ›å»ºå¤šä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä»é€šé“ä¸­æ¥æ”¶æ–‡ä»¶è·¯å¾„ï¼Œå¹¶è°ƒç”¨process_fileå‡½æ•°æ¥å¤„ç†æ–‡ä»¶ã€‚
use crossbeam_channel::bounded;
use std::fs;
use std::path::Path;

// å®ç°å¤šçº¿ç¨‹æ–‡ä»¶å¤„ç†å™¨,åŒæ—¶å¯ä»¥å¤„ç†4ä¸ªæ–‡ä»¶è¯»å–ï¼Œè¯´æ˜æœ‰å››ä¸ªæ¥å—ç«¯ ï¼Œä¸€ä¸ªå‘é€ç«¯
/* */
fn process_file(filename: &amp;str) &#123;
    match fs::read_to_string(filename) &#123;
        Ok(content) => &#123;
            println!("Processing file: &#123;&#125;", filename);
            println!("Content: &#123;&#125;", content);
        &#125;
        Err(error) => &#123;
            eprintln!("Error reading file &#123;&#125;: &#123;&#125;", filename, error);
        &#125;
    &#125;
&#125;

#[test]
fn test_thread_file_processor() &#123;
    let (tx, rx) = bounded(4);
    let num_threads = 4;
    let file_paths = vec![
        "file1.txt",
        "file2.txt",
        "file3.txt",
        "file4.txt",
        "file5.txt",
        "file6.txt",
        "file7.txt",
        "file8.txt",
        "file9.txt",
        "file10.txt",
    ];

    let mut handles = vec![];
    // å¯åŠ¨ 4 ä¸ªå·¥ä½œçº¿ç¨‹
    for i in 0..num_threads &#123;
        let rx: crossbeam_channel::Receiver&lt;String> = rx.clone();
        let handle: thread::JoinHandle&lt;()> = thread::spawn(move || &#123;
            for path in rx &#123;
                let content = fs::read_to_string(path).unwrap_or_else(|e| format!("Error: &#123;&#125;", e));
                println!("Worker &#123;&#125;: &#123;&#125;", i, content);
            &#125;
        &#125;);
        handles.push(handle);
    &#125;

    // å‘é€æ–‡ä»¶è·¯å¾„
    for path in file_paths &#123;
        tx.send(path.to_string()).unwrap();
    &#125;
  
    
    drop(tx);

    for h in handles &#123;
        h.join().unwrap()
    &#125;
&#125;


å‘âš ï¸ï¼š
éœ€è¦ä½¿ç”¨use crossbeam_channel::bounded; æ‰èƒ½æ»¡è¶³æ¥æ”¶è€…å¯ä»¥å…‹éš†ï¼Œmpsc::channel()ä¸èƒ½å…‹éš†æ¥æ”¶è€…ï¼Œåªèƒ½å…‹éš†å‘é€è€…
let (tx, rx) = bounded(4);
éœ€è¦ drop(tx);æ¥æ˜¾å¼å…³é—­å‘é€ç«¯ï¼Œä½¿æ¥æ”¶ç«¯é€€å‡º for path in rx å¾ªç¯
for path in rxè¿™æ˜¯ä¸€ä¸ªé˜»å¡å¾ªç¯ï¼Œåªæœ‰åœ¨å‘é€ç«¯å…³é—­æ—¶æ‰ä¼šé€€å‡º

ç»ƒä¹ 2â€”â€”ä½¿ç”¨ Channel å®ç°ç¨‹åºçš„ä¼˜é›…åœæ­¢
ä»»åŠ¡æè¿°

ä»»åŠ¡æè¿°
â—‹ åœ¨è¿™é“ç»ƒä¹ ä¸­ï¼Œä½ éœ€è¦ç¼–å†™ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºï¼Œè¯¥ç¨‹åºä¼šåˆ›å»ºå¤šä¸ªå·¥ä½œçº¿ç¨‹ï¼ŒæŒç»­å¤„ç†ä»»åŠ¡ã€‚åœ¨æ¥æ”¶åˆ°åœæ­¢ä¿¡å·æ—¶ï¼Œæ‰€æœ‰å·¥ä½œçº¿ç¨‹åº”è¯¥ä¼˜é›…åœ°åœæ­¢å·¥ä½œï¼Œå¹¶ç¡®ä¿æ‰€æœ‰æœªå®Œæˆçš„ä»»åŠ¡éƒ½è¢«å¤„ç†å®Œæ¯•ã€‚
â—‹ ä½ å°†ä½¿ç”¨ Rust çš„ channel æ¥å®ç°ä»»åŠ¡çš„è°ƒåº¦å’Œä¼˜é›…åœæ­¢æœºåˆ¶ã€‚

å…·ä½“è¦æ±‚

å·¥ä½œçº¿ç¨‹ï¼š
â—‹ åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ± ï¼Œå·¥ä½œçº¿ç¨‹ä»é€šé“æ¥æ”¶ä»»åŠ¡å¹¶å¤„ç†ã€‚
â—‹ å·¥ä½œçº¿ç¨‹åº”èƒ½å¤Ÿå“åº”åœæ­¢ä¿¡å·ï¼Œå¹¶åœ¨å®Œæˆå½“å‰ä»»åŠ¡åä¼˜é›…åœ°é€€å‡ºã€‚
ä»»åŠ¡ç»“æ„ï¼š
â—‹ ä»»åŠ¡å¯ä»¥æ˜¯ç®€å•çš„æ‰“å°æ“ä½œï¼Œæ¨¡æ‹Ÿä¸€äº›è€—æ—¶å·¥ä½œï¼Œä¾‹å¦‚æ‰“å°ä»»åŠ¡ ID å¹¶æš‚åœä¸€æ®µæ—¶é—´ã€‚
ä¼˜é›…åœæ­¢ï¼š
â—‹ é€šè¿‡å‘é€ä¸€ä¸ªç‰¹æ®Šçš„åœæ­¢ä¿¡å·ï¼Œé€šçŸ¥æ‰€æœ‰å·¥ä½œçº¿ç¨‹åœæ­¢æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œå¹¶åœ¨å®Œæˆå½“å‰ä»»åŠ¡åé€€å‡ºã€‚
â—‹ ç¡®ä¿æ‰€æœ‰å·²æ¥æ”¶çš„ä»»åŠ¡éƒ½è¢«å¤„ç†å®Œæ¯•ã€‚
ä¸»çº¿ç¨‹æ§åˆ¶ï¼š
â—‹ ä¸»çº¿ç¨‹åº”å½“èƒ½å¤Ÿå‘é€ä»»åŠ¡ï¼Œä¹Ÿèƒ½å¤Ÿåœ¨é€‚å½“çš„æ—¶å€™å‘é€åœæ­¢ä¿¡å·ï¼Œè§¦å‘å·¥ä½œçº¿ç¨‹çš„ä¼˜é›…åœæ­¢ã€‚

ç­”æ¡ˆï¼š

ä¼˜é›…åœæ­¢ï¼šå·¥ä½œçº¿ç¨‹å¤„ç†å®Œå½“å‰ä»»åŠ¡åé€€å‡ºï¼Œä¸ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ã€‚
å®ç°ï¼šé€šè¿‡ç‰¹æ®Šä¿¡å·ï¼ˆå¦‚Option::Noneï¼‰é€šçŸ¥çº¿ç¨‹åœæ­¢ï¼Œæˆ–å…³é—­å‘é€ç«¯è§¦å‘æ¥æ”¶ç«¯é€€å‡ºã€‚

å®ç°ä»£ç 
use std::sync::mpsc;
use std::thread;
use std::time::Duration;

// ä»»åŠ¡ç±»å‹ï¼šåŒ…å«ä»»åŠ¡IDå’Œæ¨¡æ‹Ÿè€—æ—¶
type Task = Option&lt;u32>; // Noneä½œä¸ºåœæ­¢ä¿¡å·

// å¤„ç†ä»»åŠ¡
fn process_task(task_id: u32) &#123;
    println!("å¤„ç†ä»»åŠ¡&#123;&#125;...", task_id);
    thread::sleep(Duration::from_secs(1)); // æ¨¡æ‹Ÿè€—æ—¶1ç§’
    println!("ä»»åŠ¡&#123;&#125;å¤„ç†å®Œæˆ", task_id);
&#125;

fn main() &#123;
    let (tx, rx) = bounded(4);
    let num_workers = 3;
    let mut handles = vec![];

    // åˆ›å»ºå·¥ä½œçº¿ç¨‹
    for i in 0..num_workers &#123;
        let rx = rx.clone();
        let handle = thread::spawn(move || &#123;
            println!("å·¥ä½œçº¿ç¨‹&#123;&#125;å¯åŠ¨", i);
            // å¾ªç¯æ¥æ”¶ä»»åŠ¡ï¼Œç›´åˆ°æ”¶åˆ°Noneï¼ˆåœæ­¢ä¿¡å·ï¼‰
            while let Ok(task) = rx.recv() &#123;
                match task &#123;
                    Some(task_id) => process_task(task_id),
                    None => &#123;
                        println!("å·¥ä½œçº¿ç¨‹&#123;&#125;æ”¶åˆ°åœæ­¢ä¿¡å·ï¼Œé€€å‡º", i);
                        break; // é€€å‡ºå¾ªç¯ï¼Œçº¿ç¨‹ç»“æŸ
                    &#125;
                &#125;
            &#125;
        &#125;);
        handles.push(handle);
    &#125;

    // ä¸»çº¿ç¨‹å‘é€ä»»åŠ¡
    for task_id in 1..=5 &#123;
        tx.send(Some(task_id)).unwrap();
    &#125;

    // å‘é€åœæ­¢ä¿¡å·ï¼ˆæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼‰
    for _ in 0..num_workers &#123;
        tx.send(None).unwrap();
    &#125;

    // ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹é€€å‡º
    for handle in handles &#123;
        handle.join().unwrap();
    &#125;
    println!("æ‰€æœ‰çº¿ç¨‹å·²ä¼˜é›…é€€å‡º");
&#125;
âœ… æ€»ç»“



æ–¹æ¡ˆ
æ”¯æŒå…‹éš† Receiver
æ˜¯å¦æ¨è
è¯´æ˜




mpsc::sync_channel
âŒ
âŒ
ä¸æ”¯æŒå…‹éš† Receiver


mpsc::channel
âŒ
âœ…
å¯å…‹éš† Senderï¼Œé€‚åˆå¤šå‘é€è€…å•æ¥æ”¶è€…


crossbeam-channel
âœ…
âœ…âœ…
æ”¯æŒå…‹éš† Receiverï¼Œé€‚åˆå¤šæ¶ˆè´¹è€…


Arc&lt;Mutex&lt;Receiver&gt;&gt;
âŒ
âŒ
ä¸æ¨èï¼Œæ€§èƒ½å·®ï¼Œæ˜“å‡ºé”™


select! + bounded
âœ…
âœ…
é€‚åˆå¤šçº¿ç¨‹ç›‘å¬åŒä¸€é€šé“




ğŸ“Œ æ¨èæ–¹æ¡ˆ
ä¼˜å…ˆä½¿ç”¨ crossbeam-channel çš„ bounded æˆ– unbounded é€šé“ï¼Œå®ƒä¸ä»…æ”¯æŒå…‹éš† Receiverï¼Œè¿˜æä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¦‚ select!ã€try_recvã€recv_timeout ç­‰
å…±äº«å†…å­˜å®ç°å¹¶å‘
é™¤äº†æ¶ˆæ¯ä¼ é€’ï¼Œè¿˜å¯ä»¥é€šè¿‡å…±äº«å†…å­˜å®ç°å¹¶å‘ã€‚Rusté€šè¿‡Mutexï¼ˆäº’æ–¥é”ï¼‰å’ŒArcï¼ˆåŸå­å¼•ç”¨è®¡æ•°ï¼‰ä¿è¯å…±äº«å†…å­˜çš„çº¿ç¨‹å®‰å…¨ã€‚
Mutex&lt;T&gt;ï¼ˆäº’æ–¥é”ï¼‰
Mutexç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å…±äº«æ•°æ®ï¼Œé€šè¿‡â€œé”â€æœºåˆ¶å®ç°ï¼š

è®¿é—®æ•°æ®å‰éœ€è°ƒç”¨lock()è·å–é”ï¼ˆè¿”å›MutexGuardï¼Œæ™ºèƒ½æŒ‡é’ˆï¼‰ã€‚
MutexGuardç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾é”ï¼Œé¿å…æ­»é”ã€‚

åŸºæœ¬ä½¿ç”¨
use std::sync::Mutex;

fn main() &#123;
    let m = Mutex::new(5); // åˆ›å»ºåŒ…å«i32çš„Mutex

    &#123;
        let mut num = m.lock().unwrap(); // è·å–é”ï¼Œè¿”å›MutexGuard
        *num = 6; // é€šè¿‡è§£å¼•ç”¨ä¿®æ”¹æ•°æ®
    &#125; // MutexGuardç¦»å¼€ä½œç”¨åŸŸï¼Œè‡ªåŠ¨é‡Šæ”¾é”

    println!("m = &#123;:?&#125;", m.lock().unwrap()); // è¾“å‡ºï¼šm = 6
&#125;
Arc&lt;T&gt;ï¼ˆåŸå­å¼•ç”¨è®¡æ•°ï¼‰
Rc&lt;T&gt;ä¸é€‚åˆå¤šçº¿ç¨‹ï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰ï¼ŒArc&lt;T&gt;æ˜¯çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬çš„å¼•ç”¨è®¡æ•°æŒ‡é’ˆï¼Œé€šè¿‡åŸå­æ“ä½œä¿è¯è®¡æ•°çš„çº¿ç¨‹å®‰å…¨ã€‚å¸¸ä¸Mutexé…åˆï¼Œå®ç°å¤šçº¿ç¨‹å…±äº«æ•°æ®ã€‚
å¤šçº¿ç¨‹å…±äº«è®¡æ•°å™¨ç¤ºä¾‹
use std::sync::&#123;Arc, Mutex&#125;;
use std::thread;

fn main() &#123;
    let counter = Arc::new(Mutex::new(0)); // ArcåŒ…è£¹Mutexï¼Œå®ç°å¤šçº¿ç¨‹å…±äº«
    let mut handles = vec![];

    for _ in 0..10 &#123;
        let counter = Arc::clone(&amp;counter); // å…‹éš†Arcï¼Œå¢åŠ å¼•ç”¨è®¡æ•°
        let handle = thread::spawn(move || &#123;
            let mut num = counter.lock().unwrap(); // è·å–é”
            *num += 1; // ä¿®æ”¹è®¡æ•°å™¨
        &#125;);
        handles.push(handle);
    &#125;

    // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
    for handle in handles &#123;
        handle.join().unwrap();
    &#125;

    println!("Result: &#123;&#125;", *counter.lock().unwrap()); // è¾“å‡ºï¼šResult: 10
&#125;
Send å’Œ Sync  trait
Rusté€šè¿‡è¿™ä¸¤ä¸ªæ ‡è®° trait ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š

Sendï¼šæ ‡è®°ç±»å‹å¯ä»¥å®‰å…¨åœ°è½¬ç§»åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæ‰€æœ‰æƒè½¬ç§»ï¼‰ã€‚
Syncï¼šæ ‡è®°ç±»å‹å¯ä»¥å®‰å…¨åœ°è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼ˆå³&amp;Tæ˜¯Sendçš„ï¼‰ã€‚

é»˜è®¤å®ç°ï¼š

åŸºæœ¬ç±»å‹ï¼ˆi32ã€boolç­‰ï¼‰å’Œå¤§å¤šæ•°æ ‡å‡†åº“ç±»å‹ï¼ˆStringã€Vecç­‰ï¼‰éƒ½å®ç°äº†Sendå’ŒSyncã€‚
Rc&lt;T&gt;ä¸å®ç°Sendå’ŒSyncï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰ã€‚
Arc&lt;T&gt;å®ç°Sendå’ŒSyncï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ã€‚
Mutex&lt;T&gt;å½“Tæ˜¯Sendæ—¶ï¼ŒMutex&lt;T&gt;å®ç°Syncã€‚

ç»ƒä¹ 3â€”â€”å®ç°å¤šçº¿ç¨‹ä»»åŠ¡è°ƒåº¦å™¨
ä»»åŠ¡æè¿°
ä½ éœ€è¦ç¼–å†™ä¸€ä¸ªç®€å•çš„å¤šçº¿ç¨‹ä»»åŠ¡è°ƒåº¦å™¨ï¼Œå®ƒèƒ½å¤Ÿæ¥æ”¶å¤šä¸ªä»»åŠ¡ï¼Œå¹¶å°†è¿™äº›ä»»åŠ¡åˆ†å‘åˆ°å¤šä¸ªå·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œã€‚è°ƒåº¦å™¨ä½¿ç”¨ Channel è¿›è¡Œä»»åŠ¡çš„åˆ†å‘å’Œç»“æœçš„æ”¶é›†ã€‚ä½ éœ€è¦ä½¿ç”¨ Rust çš„Sendå’ŒSyncç‰¹æ€§æ¥ç¡®ä¿ä»»åŠ¡è°ƒåº¦å™¨åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å®‰å…¨æ€§ã€‚
å…·ä½“è¦æ±‚
å®šä¹‰ä¸€ä¸ªTaskç»“æ„ä½“ï¼Œè¡¨ç¤ºéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚ä»»åŠ¡åŒ…å«ä¸€ä¸ªå”¯ä¸€çš„idå’Œä¸€ä¸ªç”¨äºæ‰§è¡Œçš„é—­åŒ…ã€‚
è°ƒåº¦å™¨ç»“æ„ï¼š
åˆ›å»ºä¸€ä¸ªSchedulerç»“æ„ä½“ï¼ŒåŒ…å«ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—å’Œä¸€ä¸ªçº¿ç¨‹æ± ã€‚è°ƒåº¦å™¨åº”å½“ä½¿ç”¨channelæ¥åˆ†å‘ä»»åŠ¡åˆ°ä¸åŒçš„å·¥ä½œçº¿ç¨‹ã€‚
åŠŸèƒ½å®ç°ï¼š
è°ƒåº¦å™¨åº”å½“å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š

æ·»åŠ ä»»åŠ¡ï¼šå‘è°ƒåº¦å™¨æ·»åŠ ä¸€ä¸ªä»»åŠ¡ã€‚
å¯åŠ¨è°ƒåº¦å™¨ï¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œå¼€å§‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚
è·å–ç»“æœï¼šåœ¨æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œæ”¶é›†å¹¶æ‰“å°æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚

å¤šçº¿ç¨‹å®‰å…¨ï¼š

é€šè¿‡ä½¿ç”¨Arcå’ŒMutexç¡®ä¿ä»»åŠ¡é˜Ÿåˆ—åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å®‰å…¨è®¿é—®ã€‚
ç¡®ä¿ä»»åŠ¡çš„ç»“æœèƒ½å¤Ÿæ­£ç¡®åœ°åœ¨çº¿ç¨‹ä¹‹é—´ä¼ é€’å’Œæ”¶é›†ã€‚

ä»»åŠ¡åˆ†æ

æ ¸å¿ƒï¼šç”¨channelåˆ†å‘ä»»åŠ¡ï¼Œç”¨Arc+Mutexç®¡ç†ä»»åŠ¡é˜Ÿåˆ—å’Œç»“æœæ”¶é›†ã€‚
ç»“æ„ï¼šScheduleråŒ…å«ä»»åŠ¡å‘é€ç«¯ã€ç»“æœæ¥æ”¶ç«¯å’Œå·¥ä½œçº¿ç¨‹å¥æŸ„ã€‚

å®ç°ä»£ç 
use crossbeam_channel as channel;
use std::sync::Mutex;
use std::thread;
use std::time::Duration;

// ------------------å®ç°å¤šçº¿ç¨‹ä»»åŠ¡è°ƒåº¦å™¨------------------------
/**
 * å¤šçº¿ç¨‹ä»»åŠ¡è°ƒåº¦å™¨ï¼Œèƒ½å¤Ÿæ¥æ”¶å¤šä¸ªä»»åŠ¡ï¼Œå¹¶å°†å¤šä¸ªä»»åŠ¡åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹æ‰§è¡Œã€‚éœ€è¦ä½¿ç”¨sendå’Œsync trait
 * æ¥ç¡®ä¿ä»»åŠ¡è°ƒåº¦å™¨å¯ä»¥å®‰å…¨åœ°è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ã€‚
 */
use std::sync::Arc;
// ä»»åŠ¡ç»“æ„ä½“ï¼šåŒ…å«IDå’Œæ‰§è¡Œé—­åŒ…ï¼ˆè¿”å›ç»“æœï¼‰
struct Task &#123;
    id: u32,
    func: Box&lt;dyn FnOnce() -> String + Send + 'static>, // é—­åŒ…éœ€å®ç°Send
&#125;

// è°ƒåº¦å™¨ç»“æ„ä½“
struct Scheduler &#123;
    task_tx: Option&lt;channel::Sender&lt;Task>>, // ä»»åŠ¡å‘é€ç«¯ (ä½¿ç”¨Optionä¾¿äºtake)
    result_rx: Arc&lt;Mutex&lt;channel::Receiver&lt;String>>>, // ç»“æœæ¥æ”¶ç«¯ï¼ˆå…±äº«ï¼‰
    workers: Option&lt;Vec&lt;thread::JoinHandle&lt;()>>>, // å·¥ä½œçº¿ç¨‹å¥æŸ„é˜Ÿåˆ— (ä½¿ç”¨Optionä¾¿äºtake)
&#125;

impl Scheduler &#123;
    // åˆ›å»ºæ–°è°ƒåº¦å™¨
    fn new(num_workers: usize) -> Self &#123;
        let (task_tx, task_rx) = channel::unbounded();
        let (result_tx, result_rx) = channel::unbounded();
        let result_rx = Arc::new(Mutex::new(result_rx));
        let mut workers = vec![];

        // åˆ›å»ºå·¥ä½œçº¿ç¨‹
        for _ in 0..num_workers &#123;
            // æ³¨æ„ï¼šcrossbeam-channelçš„Receiveræ”¯æŒclone
            let task_rx_clone: channel::Receiver&lt;Task> = task_rx.clone();
            let result_tx: channel::Sender&lt;String> = result_tx.clone();

            let handle = thread::spawn(move || &#123;
                // å¾ªç¯æ¥æ”¶ä»»åŠ¡å¹¶æ‰§è¡Œ
                while let Ok(task) = task_rx_clone.recv() &#123;
                    println!("æ‰§è¡Œä»»åŠ¡&#123;&#125;", task.id);
                    let result = (task.func)(); // æ‰§è¡Œä»»åŠ¡
                    result_tx.send(result).unwrap(); // å‘é€ç»“æœ
                &#125;
            &#125;);
            workers.push(handle);
        &#125;

        Scheduler &#123;
            task_tx: Some(task_tx),
            result_rx,
            workers: Some(workers),
        &#125;
    &#125;

    // æ·»åŠ ä»»åŠ¡
    fn add_task(&amp;self, id: u32, func: Box&lt;dyn FnOnce() -> String + Send + 'static>) &#123;
        if let Some(ref tx) = self.task_tx &#123;
            tx.send(Task &#123; id, func &#125;).unwrap();
        &#125;
    &#125;

    // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆå¹¶æ”¶é›†ç»“æœ
    fn wait_and_collect_results(&amp;mut self) -> Vec&lt;String> &#123;
        // å…³é—­ä»»åŠ¡å‘é€ç«¯ï¼Œè®©å·¥ä½œçº¿ç¨‹æ¥æ”¶å®Œæ¯•åé€€å‡º
        self.task_tx.take(); // ä½¿ç”¨takeè·å–æ‰€æœ‰æƒå¹¶ä½¿åŸä½ç½®ä¸ºNone

        // ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆ
        if let Some(workers) = self.workers.take() &#123;
            // ä½¿ç”¨takeè·å–æ‰€æœ‰æƒ
            for handle in workers &#123;
                handle.join().unwrap();
            &#125;
        &#125;

        // æ”¶é›†ç»“æœ
        let mut results = vec![];
        let result_rx = self.result_rx.lock().unwrap();
        // ä½¿ç”¨try_iter()æ¥è·å–å·²æœ‰çš„ç»“æœï¼Œé¿å…é˜»å¡
        for result in result_rx.try_iter() &#123;
            results.push(result);
        &#125;
        results
    &#125;
&#125;

fn main() &#123;
    let mut scheduler = Scheduler::new(2); // åˆ›å»º2ä¸ªå·¥ä½œçº¿ç¨‹

    // æ·»åŠ ä»»åŠ¡
    for i in 1..=5 &#123;
        scheduler.add_task(
            i,
            Box::new(move || &#123;
                thread::sleep(Duration::from_secs(1)); // æ¨¡æ‹Ÿè€—æ—¶
                format!("ä»»åŠ¡&#123;&#125;æ‰§è¡Œå®Œæˆ", i)
            &#125;),
        );
    &#125;

    // æ”¶é›†ç»“æœ
    let results = scheduler.wait_and_collect_results();
    println!("æ‰€æœ‰ä»»åŠ¡ç»“æœï¼š");
    for res in results &#123;
        println!("&#123;&#125;", res);
    &#125;
&#125;

æ€»ç»“
Rusté€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿã€Send/Sync traitã€channelå’ŒMutex/Arcç­‰å·¥å…·ï¼Œåœ¨ç¼–è¯‘æœŸä¿è¯å¹¶å‘å®‰å…¨ï¼Œé¿å…æ•°æ®ç«äº‰ã€‚å¼€å‘ä¸­åº”æ ¹æ®åœºæ™¯é€‰æ‹©æ¶ˆæ¯ä¼ é€’ï¼ˆchannelï¼‰æˆ–å…±äº«å†…å­˜ï¼ˆMutex+Arcï¼‰æ¨¡å¼ï¼Œä¼˜å…ˆä½¿ç”¨æ¶ˆæ¯ä¼ é€’ï¼ˆæ›´æ˜“ä¿è¯å®‰å…¨ï¼‰ã€‚
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part2]_æ³›å‹</title>
    <url>/2025/07/29/Rust%E8%BF%9B%E9%98%B6-part2-%E6%B3%9B%E5%9E%8B/</url>
    <content><![CDATA[Rustè¿›é˜¶[part2]_æ³›å‹
æ³›å‹æ¦‚è¿°
åœ¨å®šä¹‰å‡½æ•°æ—¶è¿ç”¨æ³›å‹ï¼Œå¯å°†åŸæœ¬å‡½æ•°ç­¾åé‡Œæ˜ç¡®æŒ‡å®šå‚æ•°å’Œè¿”å›å€¼ç±»å‹çš„éƒ¨åˆ†ï¼Œç”¨æ³›å‹æ¥æ›¿ä»£ã€‚è¿™ç§æ–¹å¼èƒ½å¢å¼ºä»£ç çš„é€‚åº”æ€§ï¼Œä¸ºå‡½æ•°è°ƒç”¨è€…èµ‹äºˆæ›´å¤šåŠŸèƒ½ï¼Œè¿˜èƒ½é¿å…ä»£ç é‡å¤ã€‚
fn add&lt;T>(a:T, b:T) -> T&#123;
  a + b
&#125;
ä¸è¿‡ï¼Œå¹¶éæ‰€æœ‰çš„Tç±»å‹éƒ½èƒ½è¿›è¡Œç›¸åŠ æ“ä½œï¼Œæ­¤æ—¶ä¼šæç¤ºé”™è¯¯ï¼š
genertic_type.rs(5, 9): consider restricting type parameter 'T' with trait 'Add': ': std::ops::Add&lt;Output = T&gt;'
ä¿®æ­£åçš„ä»£ç å¦‚ä¸‹ï¼š
fn add&lt;T: std::ops::Add&lt;Output = T>>(a: T, b: T) -> T &#123;
    a + b
&#125;
ä½¿ç”¨åœºæ™¯
åœ¨å‡½æ•°å®šä¹‰ä¸­ä½¿ç”¨æ³›å‹
fn largest&lt;T: std::cmp::PartialOrd>(list: &amp;[T]) -> &amp;T &#123;
    let mut largest = &amp;list[0];
    for item in list &#123;
        if item > largest &#123;
            largest = item;
        &#125;
    &#125;
    largest
&#125;
åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨æ³›å‹
struct Point&lt;T> &#123;
    x: T,
    y: T,
&#125;

// å®ä¾‹åŒ–æ³›å‹ç»“æ„ä½“
let integer = Point &#123; x: 5, y: 10 &#125;;
let float = Point &#123; x: 1.0, y: 4.0 &#125;;
åœ¨æšä¸¾é‡Œé¢ä½¿ç”¨æ³›å‹
enum Result&lt;T, E> &#123;
    Ok(T),
    Err(E),
&#125;

// å®ä¾‹åŒ–æ³›å‹æšä¸¾
fn divide(numerator: f64, denominator: f64) -> Result&lt;f64, String> &#123;
    if denominator == 0.0 &#123;
        Err("Division by zero".to_string())
    &#125; else &#123;
        Ok(numerator / denominator)
    &#125;
&#125;
implä¹‹åå£°æ˜æ³›å‹T
æ³›å‹å‚æ•°å¯ä»¥å’Œç»“æ„ä½“å®šä¹‰ä¸­å£°æ˜çš„æ³›å‹å‚æ•°ä¸ä¸€æ ·ã€‚
struct Point&lt;T, U> &#123;
    x: T,
    y: U,
&#125;

impl&lt;T, U> Point&lt;T, U> &#123;
    fn mixup&lt;V, W>(self, other: Point&lt;V, W>) -> Point&lt;T, W> &#123;
        Point &#123;
            x: self.x,
            y: other.y,
        &#125;
    &#125;
&#125;

// ç¤ºä¾‹ç”¨æ³•
let p1 = Point &#123; x: 5, y: 10.4 &#125;;
let p2 = Point &#123; x: "Hello", y: 'c' &#125;;
let p3 = p1.mixup(p2);
constæ³›å‹
// å®šä¹‰ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ç±»å‹
struct ArrayBuffer&lt;T, const N: usize> &#123;
    data: [T; N],
    len: usize,
&#125;

impl&lt;T, const N: usize> ArrayBuffer&lt;T, N>
where
    T: Default + Copy,
&#123;
    fn new() -> Self &#123;
        ArrayBuffer &#123;
            data: [Default::default(); N],
            len: 0,
        &#125;
    &#125;
&#125;


// åˆ›å»ºä¸€ä¸ªå¯ä»¥å­˜å‚¨10ä¸ªi32çš„ç¼“å†²åŒº
let buffer: ArrayBuffer&lt;i32, 10> = ArrayBuffer::new();
whereå­å¥å¯ä»¥ç›´æ¥å†™åœ¨æ³›å‹å‚æ•°åé¢ï¼Œä¾‹å¦‚ï¼š
// å†™æ³•1ï¼šä½¿ç”¨whereå­å¥
fn new_array_buffer&lt;T, const N: usize>() -> ArrayBuffer&lt;T, N>
where
    T: Default + Copy,
&#123; ... &#125;

// å†™æ³•2ï¼šç›´æ¥åœ¨æ³›å‹å‚æ•°åæŒ‡å®šçº¦æŸ
fn new_array_buffer&lt;T: Default + Copy, const N: usize>() -> ArrayBuffer&lt;T, N> &#123; ... &#125;
æ³›å‹ä»£ç çš„æ€§èƒ½
Rusté€šè¿‡åœ¨ç¼–è¯‘æ—¶å¯¹æ³›å‹ä»£ç è¿›è¡Œå•æ€åŒ–æ¥ä¿è¯æ•ˆç‡ã€‚
å½“ä»£ç è¿è¡Œæ—¶ï¼Œå…¶æ‰§è¡Œæ•ˆç‡å’Œæ‰‹å†™æ¯ä¸ªå…·ä½“å®šä¹‰çš„é‡å¤ä»£ç ä¸€æ ·ã€‚æ­£æ˜¯è¿™ä¸ªå•æ€åŒ–è¿‡ç¨‹ï¼Œä½¿å¾—Rustæ³›å‹åœ¨è¿è¡Œæ—¶æä¸ºé«˜æ•ˆã€‚
// æ³›å‹ä»£ç 
fn add&lt;T: std::ops::Add&lt;Output = T>>(a: T, b: T) -> T &#123;
    a + b
&#125;

// å•æ€åŒ–åçš„ä»£ç ç¤ºä¾‹
fn add_i32(a: i32, b: i32) -> i32 &#123;
    a + b
&#125;

fn add_f64(a: f64, b: f64) -> f64 &#123;
    a + b
&#125;
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part3]_ç”Ÿå‘½å‘¨æœŸ</title>
    <url>/2025/07/29/Rust%E8%BF%9B%E9%98%B6-part3-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
    <content><![CDATA[Rustè¿›é˜¶[part3]_ç”Ÿå‘½å‘¨æœŸ
ç”Ÿå‘½å‘¨æœŸæ¦‚è¿°
åœ¨Rustä¸­ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€ç§ç¡®ä¿å¼•ç”¨æœ‰æ•ˆæ€§çš„æœºåˆ¶ã€‚Rustç¼–è¯‘å™¨é€šè¿‡ç”Ÿå‘½å‘¨æœŸæ³¨è§£æ¥è·Ÿè¸ªå¼•ç”¨çš„ä½œç”¨åŸŸï¼Œé˜²æ­¢å‡ºç°æ‚¬ç©ºå¼•ç”¨ï¼ˆdangling referencesï¼‰ã€‚
ç®€å•ä½¿ç”¨
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£ç¤ºä¾‹ï¼š
fn longest&lt;'a>(x: &amp;'a str, y: &amp;'a str) -> &amp;'a str &#123;
    if x.len() > y.len() &#123;
        x
    &#125; else &#123;
        y
    &#125;
&#125;

fn main() &#123;
    let string1 = String::from("abcd");
    let string2 = "xyz";

    let result = longest(&amp;string1, string2);
    println!("The longest string is &#123;&#125;", result);
&#125;
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ'a æ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œå®ƒè¡¨ç¤º x å’Œ y å¼•ç”¨çš„å­—ç¬¦ä¸²åˆ‡ç‰‡å¿…é¡»è‡³å°‘å’Œ 'a ä¸€æ ·é•¿ã€‚å‡½æ•°è¿”å›çš„å¼•ç”¨ä¹Ÿå¿…é¡»å’Œ 'a ä¸€æ ·é•¿ã€‚
ç±»åˆ«
fn
å‡½æ•°å¯ä»¥æœ‰ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œç”¨äºæŒ‡å®šå‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸå…³ç³»ã€‚å¦‚ä¸Šé¢çš„ longest å‡½æ•°ç¤ºä¾‹ã€‚
struct
ç»“æ„ä½“ä¹Ÿå¯ä»¥åŒ…å«å¼•ç”¨ç±»å‹çš„å­—æ®µï¼Œè¿™æ—¶éœ€è¦ä¸ºè¿™äº›å¼•ç”¨æ·»åŠ ç”Ÿå‘½å‘¨æœŸæ³¨è§£ã€‚
struct ImportantExcerpt&lt;'a> &#123;
    part: &amp;'a str,
&#125;

fn main() &#123;
    let novel = String::from("Call me Ishmael. Some years ago...");
    let first_sentence = novel.split('.').next().expect("Could not find a '.'");
    let i = ImportantExcerpt &#123;
        part: first_sentence,
    &#125;;
&#125;
è¿™é‡Œçš„ 'a è¡¨ç¤º part å­—æ®µå¼•ç”¨çš„å­—ç¬¦ä¸²åˆ‡ç‰‡å¿…é¡»è‡³å°‘å’Œ ImportantExcerpt å®ä¾‹ä¸€æ ·é•¿ã€‚
enum
æšä¸¾åŒæ ·å¯ä»¥åŒ…å«å¼•ç”¨ç±»å‹çš„å­—æ®µï¼Œéœ€è¦æ·»åŠ ç”Ÿå‘½å‘¨æœŸæ³¨è§£ã€‚
enum MaybeString&lt;'a> &#123;
    Some(&amp;'a str),
    None,
&#125;

fn main() &#123;
    let s = String::from("hello");
    let maybe_str = MaybeString::Some(&amp;s);
&#125;
ç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤

rustç¼–è¯‘å™¨è‡ªåŠ¨æ¨ç†ï¼Œæ— éœ€æ‰‹åŠ¨é‡å¤æ·»åŠ 


æ¯ä¸ªå¼•ç”¨å‚æ•°éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ
å¦‚æœåªæœ‰ä¸€ä¸ªè¾“å…¥å¼•ç”¨å‚æ•°ï¼Œé‚£ä¹ˆå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹äºˆæ‰€æœ‰è¾“å‡ºå¼•ç”¨
å¦‚æœæœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä½†æ˜¯å…¶ä¸­ä¸€ä¸ªæ˜¯ &amp;self æˆ–è€… &amp;mut self ï¼Œé‚£å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¹Ÿä¼šè¢«èµ‹äºˆæ‰€æœ‰è¾“å‡ºå¼•ç”¨ ï¼Œæ¯”å¦‚ç»“æ„ä½“å’Œæšä¸¾è‡ªå·±å®ç°çš„æ–¹æ³•ä¸­

ç¤ºä¾‹
fn first_word(s: &amp;str) -> &amp;str &#123;
    let bytes = s.as_bytes();

    for (i, &amp;item) in bytes.iter().enumerate() &#123;
        if item == b' ' &#123;
            return &amp;s[0..i];
        &#125;
    &#125;

    &amp;s[..]
&#125;
åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œè™½ç„¶æ²¡æœ‰æ˜¾å¼åœ°æ·»åŠ ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Œä½†ç¼–è¯‘å™¨æ ¹æ®ç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤è§„åˆ™ï¼Œè‡ªåŠ¨ä¸º s å’Œè¿”å›å€¼æ·»åŠ äº†ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸã€‚
ç‰¹æ®Šç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨
å…¨å±€å˜é‡æˆ–è€…å­—ç¬¦ä¸²å­—é¢é‡çš„ç”Ÿå‘½å‘¨æœŸåœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½æœ‰æ•ˆï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨ 'static æ¥æ ‡æ³¨çš„ç”Ÿå‘½å‘¨æœŸã€‚
ç¤ºä¾‹
let s: &amp;'static str = "I have a static lifetime.";
è¿™é‡Œçš„ s æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ 'staticï¼Œæ„å‘³ç€å®ƒåœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½æœ‰æ•ˆã€‚
ç”Ÿå‘½å‘¨æœŸçº¦æŸ
ç”Ÿå‘½å‘¨æœŸæ³¨è§£å¯ä»¥ç”¨æ¥çº¦æŸå¤šä¸ªå¼•ç”¨ä¹‹é—´çš„å…³ç³»ã€‚
ç¤ºä¾‹
fn longest_with_an_announcement&lt;'a, T>(x: &amp;'a str, y: &amp;'a str, ann: T) -> &amp;'a str
where
    T: std::fmt::Display,
&#123;
    println!("Announcement! &#123;&#125;", ann);
    if x.len() > y.len() &#123;
        x
    &#125; else &#123;
        y
    &#125;
&#125;

fn main() &#123;
    let string1 = String::from("abcd");
    let string2 = "xyz";
    let ann = "Let's find the longest string!";

    let result = longest_with_an_announcement(&amp;string1, string2, ann);
    println!("The longest string is &#123;&#125;", result);
&#125;
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ'a çº¦æŸäº† x å’Œ y å¼•ç”¨çš„å­—ç¬¦ä¸²åˆ‡ç‰‡çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿçº¦æŸäº†è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸã€‚
ç”Ÿå‘½å‘¨æœŸå­ç±»å‹å’Œåå˜
ç”Ÿå‘½å‘¨æœŸå¯ä»¥æœ‰å­ç±»å‹å…³ç³»ï¼Œè¾ƒçŸ­çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥è¢«è§†ä¸ºè¾ƒé•¿ç”Ÿå‘½å‘¨æœŸçš„å­ç±»å‹ã€‚è¿™åœ¨åå˜ï¼ˆcovarianceï¼‰ä¸­å°¤ä¸ºé‡è¦ã€‚
ç¤ºä¾‹
fn main() &#123;
    let r;
    &#123;
        let x = 5;
        r = &amp;x;
    &#125; // x åœ¨è¿™é‡Œç¦»å¼€ä½œç”¨åŸŸï¼Œr å˜æˆæ‚¬ç©ºå¼•ç”¨

    println!("r: &#123;&#125;", r);
&#125;
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œx çš„ç”Ÿå‘½å‘¨æœŸæ¯” r çŸ­ï¼Œx çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ r ç”Ÿå‘½å‘¨æœŸçš„å­ç±»å‹ã€‚å½“ x ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œr å˜æˆæ‚¬ç©ºå¼•ç”¨ï¼Œè¿™æ®µä»£ç ä¼šç¼–è¯‘é”™è¯¯ã€‚
ç»ƒä¹ 
è¦æ±‚ï¼šä¿®å¤ä¸€ä¸‹åŸå§‹ä»£ç çš„bug
åŸå§‹ä»£ç 
fn test_lifetime_multiple() &#123;
    fn insert_value&lt;'a, 'b>(my_vec: &amp;'a mut Vec&lt;&amp;'a i32>, value: &amp;'b i32) &#123;
        my_vec.push(value)
    &#125;
    let mut my_vec: Vec&lt;&amp;i32> = vec![];
    let val1 = 1;
    let val2 = 2;

    let a = &amp;mut my_vec;
    insert_value(a, &amp;val1);
    println!("a is &#123;:?&#125; ", a);
    let b = &amp;mut my_vec;
    insert_value(b, &amp;val2);
    println!("b is &#123;:?&#125;", b);
    println!("&#123;my_vec:?&#125;");
&#125;
ä¿®æ”¹åçš„ä»£ç 
fn test_lifetime_multiple() &#123;
    fn insert_value&lt;'a, 'b>(my_vec: &amp;'a mut Vec&lt;&amp;'b i32>, value: &amp;'b i32) &#123;
        my_vec.push(value)
    &#125;
    let mut my_vec: Vec&lt;&amp;i32> = vec![];
    let val1 = 1;
    let val2 = 2;

    let a = &amp;mut my_vec;
    insert_value(a, &amp;val1);
    println!("a is &#123;:?&#125; ", a);
    let b = &amp;mut my_vec;
    insert_value(b, &amp;val2);
    println!("b is &#123;:?&#125;", b);
    println!("&#123;my_vec:?&#125;");
&#125;
è§£é‡Š
åˆ†ç¦»ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼š
fn insert_value&lt;'a, 'b>(my_vec: &amp;'a mut Vec&lt;&amp;'b i32>, value: &amp;'b i32)

'a æ˜¯ my_vec å¯å˜å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
'b æ˜¯å­˜å‚¨åœ¨ Vec ä¸­çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ

]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part4]_æ™ºèƒ½æŒ‡é’ˆ2</title>
    <url>/2025/07/30/Rust%E8%BF%9B%E9%98%B6-part4-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%882/</url>
    <content><![CDATA[Rustè¿›é˜¶[part4]_æ™ºèƒ½æŒ‡é’ˆ2
Rc&lt;T&gt;
Rc&lt;T&gt;ï¼ˆReference Countedï¼‰æ˜¯ Rust æ ‡å‡†åº“æä¾›çš„å•çº¿ç¨‹å…±äº«æ‰€æœ‰æƒæ™ºèƒ½æŒ‡é’ˆï¼Œé€šè¿‡å¼•ç”¨è®¡æ•°å®ç°å¤šæ‰€æœ‰æƒç®¡ç†ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯
æ ¸å¿ƒç‰¹æ€§


å¼•ç”¨è®¡æ•°ï¼š


æ¯ä¸ªå®ä¾‹åœ¨å †ä¸Šå­˜å‚¨ï¼š


å®é™…æ•°æ® T


å¼•ç”¨è®¡æ•°å™¨ï¼ˆè®°å½•æ´»è·ƒå¼•ç”¨æ•°é‡ï¼‰


å…‹éš†æ—¶åªå¢åŠ è®¡æ•°å™¨ï¼Œä¸ä¼šæ·±æ‹·è´æ•°æ®ï¼š
let a = Rc::new(vec![1,2,3]);
let b = a.clone(); // è®¡æ•°å™¨ä»1â†’2


æœ€åä¸€ä¸ªå¼•ç”¨ç¦»å¼€ä½œç”¨åŸŸæ—¶é‡Šæ”¾å†…å­˜




ä¸å¯å˜å…±äº«ï¼š


æ‰€æœ‰è€…åªèƒ½é€šè¿‡ .clone() å…±äº«ä¸å¯å˜å¼•ç”¨


éœ€é…åˆRefCell&lt;T&gt;å®ç°å†…éƒ¨å¯å˜æ€§ï¼š
let cell = Rc::new(RefCell::new(5));
*cell.borrow_mut() += 1;




ä½¿ç”¨åœºæ™¯
ä¸‹é¢è¿™ä¸ªä¾‹å­ä½¿ç”¨boxå¯ä»¥å®ç°é“¾è¡¨çš„ç»“æ„
enum list &#123;
    Cons(i32, Box&lt;list>),
    Nil,
&#125;
fn main() &#123;
    let list = list::Cons(1, Box::new(list::Cons(2, Box::new(list::Nil))));
    println!("&#123;:?&#125;", list);
&#125;
------
Cons(1, Cons(2, Nil))


Conså˜ä½“ï¼šè¡¨ç¤ºé“¾è¡¨èŠ‚ç‚¹
ç¬¬ä¸€ä¸ªå‚æ•°i32ï¼šå­˜å‚¨å½“å‰èŠ‚ç‚¹çš„æ•°å€¼
ç¬¬äºŒä¸ªå‚æ•°Boxï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å †å†…å­˜æŒ‡é’ˆ


Nilå˜ä½“ï¼šè¡¨ç¤ºé“¾è¡¨ç»ˆæ­¢èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ï¼‰


å¦‚æœéœ€è¦å…±äº«å¼•ç”¨ï¼Œå¯ä»¥è½¬æ¢ä¸ºRc, éœ€è¦ä½¿ç”¨use std::rc::Rc;
use std::rc::Rc;

#[derive(Debug)]
enum list &#123;
    Cons(i32, Rc&lt;list>),
    Nil,
&#125;

fn main() &#123;
    let a = Rc::new(list::Cons(5, Rc::new(list::Nil)));
    let b = list::Cons(10, Rc::clone(&amp;a));
    let c = list::Cons(15, Rc::clone(&amp;a));

    // æ‰“å°éªŒè¯
    match b &#123;
        list::Cons(val, ref next) => &#123;
            println!("å½“å‰å€¼: &#123;&#125;", val);
            println!("ä¸‹ä¸€ä¸ªèŠ‚ç‚¹: &#123;:?&#125;", next);
        &#125;
        list::Nil => println!("ç©ºèŠ‚ç‚¹"),
    &#125;
&#125;
âœ… æ¨èä½¿ç”¨åœºæ™¯ï¼š

å…±äº«å­ç»“æ„ï¼šå¦‚é“¾è¡¨å°¾éƒ¨å…±äº«ã€æ ‘ç»“æ„çš„å­èŠ‚ç‚¹
ç¼“å­˜å®ç°ï¼šå¤šä¸ªåœ°æ–¹éœ€è¦è®¿é—®ç›¸åŒç¼“å­˜æ•°æ®
äº‹ä»¶ç³»ç»Ÿï¼šå¤šä¸ªç›‘å¬è€…è®¢é˜…åŒä¸€äº‹ä»¶æº
é…ç½®å…±äº«ï¼šå…¨å±€åªè¯»é…ç½®çš„åˆ†å‘

RefCell&lt;T&gt; å®ç°å†…éƒ¨å¯å˜
RefCell&lt;T&gt; æ˜¯ å®ç°&quot;å†…éƒ¨å¯å˜æ€§&quot;çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒæœ¬èº«ä¸æ˜¯å¯å˜å¼•ç”¨ï¼Œä½†å¯ä»¥é€šè¿‡å…¶æ–¹æ³•è·å–å¯¹å†…éƒ¨æ•°æ®çš„å¯å˜è®¿é—®æƒé™ã€‚ä¸ Rc&lt;T&gt; ç»“åˆä½¿ç”¨æ—¶ï¼Œå¯ä»¥å®ç° å¤šæ‰€æœ‰æƒä¸‹çš„å…±äº«å¯å˜çŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š

å†…éƒ¨å¯å˜æ€§æ¨¡å¼ï¼š

å…è®¸åœ¨ä¸å¯å˜å¼•ç”¨ï¼ˆ&amp;selfï¼‰ä¸‹ä¿®æ”¹å†…éƒ¨æ•°æ®
é€šè¿‡è¿è¡Œæ—¶å€Ÿç”¨æ£€æŸ¥æ›¿ä»£ç¼–è¯‘æ—¶æ£€æŸ¥
è¿åå€Ÿç”¨è§„åˆ™ä¼šè§¦å‘ panicï¼ˆè€Œéç¼–è¯‘é”™è¯¯ï¼‰


å…³é”®æ–¹æ³•ï¼š

borrow()ï¼šè·å–ä¸å¯å˜å€Ÿç”¨ï¼ˆRef&lt;T&gt;ï¼‰
borrow_mut()ï¼šè·å–å¯å˜å€Ÿç”¨ï¼ˆRefMut&lt;T&gt;ï¼‰
into_inner()ï¼šæå–å†…éƒ¨æ•°æ®


ä¸ Cell&lt;T&gt; çš„åŒºåˆ«ï¼š

Cell&lt;T&gt;ï¼šé€‚ç”¨äºå¤åˆ¶ç±»å‹ï¼ˆå¦‚ i32ã€boolï¼‰ï¼Œé€šè¿‡ get() å’Œ set() ç›´æ¥æ“ä½œå€¼
RefCell&lt;T&gt;ï¼šé€‚ç”¨äºå¼•ç”¨ç±»å‹ï¼ˆå¦‚ Vec&lt;T&gt;ã€è‡ªå®šä¹‰ç»“æ„ä½“ï¼‰ï¼Œé€šè¿‡å€Ÿç”¨è·å–å¼•ç”¨



å’ŒRc&lt;T&gt;ç»„åˆä½¿ç”¨
use std::rc::Rc;
use std::cell::RefCell;

let shared_data = Rc::new(RefCell::new(vec![1, 2, 3]));

// å…‹éš† Rc è·å–å…±äº«æ‰€æœ‰æƒ
let data1 = Rc::clone(&amp;shared_data);
let data2 = Rc::clone(&amp;shared_data);

// é€šè¿‡ borrow_mut() ä¿®æ”¹æ•°æ®
data1.borrow_mut().push(4);
data2.borrow_mut().push(5);

// æœ€ç»ˆç»“æœï¼š[1, 2, 3, 4, 5]
println!("&#123;:?&#125;", shared_data.borrow());
Weak&lt;T&gt;
Weak&lt;T&gt; æ˜¯ Rust ä¸­ç”¨äºæ‰“ç ´ å¾ªç¯å¼•ç”¨ çš„å¼±å¼•ç”¨æ™ºèƒ½æŒ‡é’ˆã€‚å®ƒä¸ Rc&lt;T&gt; é…åˆä½¿ç”¨ï¼Œæ—¢èƒ½å…±äº«æ•°æ®è®¿é—®æƒï¼Œåˆä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼ã€‚
æ ¸å¿ƒä½œç”¨

æ‰“ç ´å¾ªç¯å¼•ç”¨

å½“ä¸¤ä¸ª `Rc&lt;T&gt;` ç›¸äº’å¼•ç”¨æ—¶ï¼Œä¼šå½¢æˆå¾ªç¯å¼•ç”¨ï¼Œå¯¼è‡´å¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º 0ï¼Œå†…å­˜æ— æ³•é‡Šæ”¾ã€‚`Weak&lt;T&gt;` é€šè¿‡ä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œæ‰“ç ´å¾ªç¯é“¾ã€‚


å»¶è¿Ÿè®¿é—®å…±äº«æ•°æ®

Weak&lt;T&gt; å¯ä»¥é€šè¿‡ .upgrade() æ–¹æ³•å°è¯•è·å– Option&lt;Rc&lt;T&gt;&gt;
å¦‚æœæ•°æ®å·²è¢«é‡Šæ”¾ï¼Œè¿”å› Noneï¼Œé¿å…æ‚¬ç©ºæŒ‡é’ˆ

å®ç°ç¼“å­˜å’Œè§‚å¯Ÿè€…æ¨¡å¼

ç¼“å­˜ç³»ç»Ÿï¼šé¿å…ç¼“å­˜é¡¹å› å¼ºå¼•ç”¨æ— æ³•å›æ”¶
ä½¿ç”¨åœºæ™¯
åŒå‘é“¾è¡¨å¾ªç¯å¼•ç”¨å¯¼è‡´æ— æ³•é‡Šæ”¾å†…å­˜
/**
 * åŒå‘é“¾è¡¨
 */
#[derive(Debug)]
struct Node &#123;
    value: i32,
    prev: Option&lt;Rc&lt;RefCell&lt;Node>>>,
    next: Option&lt;Rc&lt;RefCell&lt;Node>>>,
&#125;

#[test]
fn weak_reference() &#123;
    let a: Rc&lt;RefCell&lt;Node>> = Rc::new(RefCell::new(Node &#123;
        value: 1,
        prev: None,
        next: None,
    &#125;));
    let b: Rc&lt;RefCell&lt;Node>> = Rc::new(RefCell::new(Node &#123;
        value: 2,
        prev: Some(a.clone()),
        next: None,
    &#125;));
    a.borrow_mut().next = Some(b.clone());

    // å¾ªç¯å¼•ç”¨ï¼ša.next -> bï¼Œb.prev -> a
    // æ— æ³•é‡Šæ”¾å†…å­˜ï¼
&#125;

é€šè¿‡weak&lt;T&gt;è§£å†³
use std::rc::&#123;Rc, Weak&#125;;
use std::cell::RefCell;

#[derive(Debug)]
struct Node &#123;
    value: i32,
    prev: Option&lt;Weak&lt;RefCell&lt;Node>>>,
    next: Option&lt;Rc&lt;RefCell&lt;Node>>>,
&#125;

fn main() &#123;
    // åˆ›å»ºèŠ‚ç‚¹ A
    let a = Rc::new(RefCell::new(Node &#123;
        value: 1,
        prev: None,
        next: None,
    &#125;));

    // åˆ›å»ºèŠ‚ç‚¹ B
    let b = Rc::new(RefCell::new(Node &#123;
        value: 2,
        prev: Some(Rc::downgrade(&amp;a)), // ä½¿ç”¨ Weak&lt;T>
        next: None,
    &#125;));

    // è®¾ç½® A çš„ next
    a.borrow_mut().next = Some(b.clone());

    // éªŒè¯å¼•ç”¨å…³ç³»
    if let Some(next_node) = &amp;a.borrow().next &#123;
        println!("A.next.value = &#123;&#125;", next_node.borrow().value); // è¾“å‡º 2
    &#125;

    if let Some(prev_weak) = &amp;b.borrow().prev &#123;
        if let Some(prev_strong) = prev_weak.upgrade() &#123;
            println!("B.prev.value = &#123;&#125;", prev_strong.borrow().value); // è¾“å‡º 1
        &#125; else &#123;
            println!("B.prev å·²é‡Šæ”¾");
        &#125;
    &#125;
&#125;
âœ… æ¨èä½¿ç”¨åœºæ™¯

åŒå‘é“¾è¡¨ï¼šå°† prev è®¾ä¸º Weak&lt;T&gt;
æ ‘ç»“æ„ï¼šå­èŠ‚ç‚¹åˆ°çˆ¶èŠ‚ç‚¹çš„å¼•ç”¨è®¾ä¸º Weak&lt;T&gt;
ç¼“å­˜ç³»ç»Ÿï¼šç¼“å­˜é¡¹ä½¿ç”¨ Weak&lt;T&gt;ï¼Œé¿å…é˜»æ­¢æ•°æ®é‡Šæ”¾
è§‚å¯Ÿè€…æ¨¡å¼ï¼šè®¢é˜…è€…ä½¿ç”¨ Weak&lt;T&gt; é¿å…é˜»æ­¢å‘å¸ƒè€…é‡Šæ”¾

ç»ƒä¹ 
å®ç°ä¸€ä¸ªç®€å•çš„ç¤¾äº¤ç½‘ç»œç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·å’Œæœ‹å‹çš„å…³ç³»ã€‚
è¦æ±‚ï¼š
ç”¨æˆ·ç»“æ„ï¼šæ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ä¸€ä¸ªåå­—å’Œæœ‹å‹åˆ—è¡¨ã€‚
æ·»åŠ æœ‹å‹ï¼šæ”¯æŒåœ¨ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´å»ºç«‹æœ‹å‹å…³ç³»ã€‚
å±•ç¤ºæœ‹å‹å…³ç³»ï¼šèƒ½å¤Ÿå±•ç¤ºæ¯ä¸ªç”¨æˆ·çš„æœ‹å‹åˆ—è¡¨ã€‚
å¾ªç¯å¼•ç”¨ï¼šå¤„ç†ç”¨æˆ·ä¹‹é—´çš„åŒå‘å¼•ç”¨ï¼Œç¡®ä¿ä¸äº§ç”Ÿå¾ªç¯å¼•ç”¨ã€‚
/**
 * å®ç°ä¸€ä¸ªç®€å•çš„ç¤¾äº¤ç½‘ç»œ
 */
struct User &#123;
    username: String,
    friends: RefCell&lt;Vec&lt;Weak&lt;User>>>,
&#125;

impl User &#123;
    fn new(name: String) -> Rc&lt;User> &#123;
        Rc::new(User &#123;
            username: name,
            friends: RefCell::new(vec![]),
        &#125;)
    &#125;

    fn print_friends(&amp;self) &#123;
        for friend in self.friends.borrow().iter() &#123;
            println!(
                "&#123;&#125;'s friends list: &#123;&#125;",
                self.username,
                friend.upgrade().unwrap().username
            );
        &#125;
    &#125;
&#125;
fn add_friend(this: Rc&lt;User>, other: Rc&lt;User>) &#123;
    this.friends.borrow_mut().push(Rc::downgrade(&amp;other));
    other.friends.borrow_mut().push(Rc::downgrade(&amp;this));
&#125;
#[test]
fn test_social_network() &#123;
    let alice = User::new("Alice".to_string());
    let bob = User::new("Bob".to_string());
    add_friend(alice.clone(), bob.clone());
    alice.print_friends();
    bob.print_friends();
&#125;

æœ€ä½³å®è·µ


ä¼˜å…ˆé€‰æ‹©

ä¼˜å…ˆç”¨ Box&lt;T&gt; ä¿æŒæ‰€æœ‰æƒæ¸…æ™°
ç¡®éœ€å…±äº«æ—¶æ‰ä½¿ç”¨ Rc&lt;T&gt;



ç»„åˆä½¿ç”¨

é…åˆ RefCell&lt;T&gt; å®ç°&quot;å†…éƒ¨å¯å˜æ€§&quot;
é…åˆ Weak&lt;T&gt; é¿å…å¾ªç¯å¼•ç”¨



æ€§èƒ½ä¼˜åŒ–


é¿å…é¢‘ç¹ .clone() ä¼ é€’æ‰€æœ‰æƒ


ç”¨ Rc::make_mutè·å–å”¯ä¸€å¯å˜å¼•ç”¨ï¼š
let mut strong = Rc::new(10);
let weak = Rc::downgrade(&amp;strong);
let unique = Rc::make_mut(&amp;mut strong); // è‹¥æœ‰å…¶ä»–å¼•ç”¨ä¼šè§¦å‘æ·±æ‹·è´
*unique += 1;




é€šè¿‡åˆç†ä½¿ç”¨ Rc&lt;T&gt;ï¼Œå¯ä»¥åœ¨å•çº¿ç¨‹åœºæ™¯ä¸‹å®‰å…¨é«˜æ•ˆåœ°å®ç°æ•°æ®å…±äº«ï¼Œä½†éœ€è¦ç‰¹åˆ«æ³¨æ„å…¶å±€é™æ€§å’Œæ½œåœ¨é£é™©ã€‚
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part5]_trait</title>
    <url>/2025/07/30/Rust%E8%BF%9B%E9%98%B6-part5-trait/</url>
    <content><![CDATA[Rustè¿›é˜¶[part5]_trait
traitæ¦‚è¿°
åœ¨ Rust ä¸­ï¼Œtrait æ˜¯ä¸€ç§å®šä¹‰å…±äº«è¡Œä¸ºçš„æ–¹å¼ã€‚å®ƒç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„æ¥å£ï¼Œå…è®¸æˆ‘ä»¬å®šä¹‰ä¸€ç»„æ–¹æ³•ç­¾åï¼Œç„¶åè®©ä¸åŒçš„ç±»å‹å»å®ç°è¿™äº›æ–¹æ³•ã€‚é€šè¿‡ traitï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¤šæ€æ€§ï¼Œå³ä¸åŒç±»å‹å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼å¤„ç†ã€‚
æ™®é€šå®ç°

ä½¿ç”¨ trait å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªç‰¹å¾
summary æ˜¯ç‰¹å¾å
åœ¨å¤§æ‹¬å·ä¸­å®šä¹‰äº†è¯¥ç‰¹å¾çš„æ‰€æœ‰æ–¹æ³•

// å®šä¹‰ä¸€ä¸ª trait
trait Summary &#123;
    fn summarize(&amp;self) -> String;
&#125;

// å®šä¹‰ä¸€ä¸ªç»“æ„ä½“
struct NewsArticle &#123;
    headline: String,
    location: String,
    author: String,
    content: String,
&#125;

// ä¸º NewsArticle ç»“æ„ä½“å®ç° Summary trait
impl Summary for NewsArticle &#123;
    fn summarize(&amp;self) -> String &#123;
        format!("&#123;&#125;, by &#123;&#125; (&#123;&#125;)", self.headline, self.author, self.location)
    &#125;
&#125;

// å®šä¹‰å¦ä¸€ä¸ªç»“æ„ä½“
struct Tweet &#123;
    username: String,
    content: String,
    reply: bool,
    retweet: bool,
&#125;

// ä¸º Tweet ç»“æ„ä½“å®ç° Summary trait
impl Summary for Tweet &#123;
    fn summarize(&amp;self) -> String &#123;
        format!("&#123;&#125;: &#123;&#125;", self.username, self.content)
    &#125;
&#125;

fn main() &#123;
    let article = NewsArticle &#123;
        headline: String::from("Penguins win the Stanley Cup Championship!"),
        location: String::from("Pittsburgh, PA, USA"),
        author: String::from("Iceburgh"),
        content: String::from("The Pittsburgh Penguins once again are the best \
                              hockey team in the NHL."),
    &#125;;

    let tweet = Tweet &#123;
        username: String::from("horse_ebooks"),
        content: String::from("of course, as you probably already know, people"),
        reply: false,
        retweet: false,
    &#125;;

    println!("Article summary: &#123;&#125;", article.summarize());
    println!("Tweet summary: &#123;&#125;", tweet.summarize());
&#125;
ç‰¹å¾å®šä¹‰ä¸å®ç°çš„ä½ç½®
å­¤å„¿è§„åˆ™
å­¤å„¿è§„åˆ™æ˜¯ Rust ä¸­çš„ä¸€ä¸ªé‡è¦è§„åˆ™ï¼Œå®ƒè§„å®šäº†ç‰¹å¾çš„å®ç°å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼šè¦ä¹ˆç‰¹å¾åœ¨å½“å‰çš„ crate ä¸­å®šä¹‰ï¼Œè¦ä¹ˆç±»å‹åœ¨å½“å‰çš„ crate ä¸­å®šä¹‰ã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿äº†ç‰¹å¾çš„å®ç°æ˜¯å¯é¢„æµ‹çš„ï¼Œé¿å…äº†ä¸åŒ crate ä¸­å¯¹åŒä¸€ç±»å‹å®ç°åŒä¸€ç‰¹å¾æ—¶å¯èƒ½å‡ºç°çš„å†²çªã€‚
ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨è‡ªå·±çš„ crate ä¸­ä¸º Vec&lt;T&gt; å®ç°æ ‡å‡†åº“ä¸­çš„ Display ç‰¹å¾ï¼Œå› ä¸º Vec&lt;T&gt; å’Œ Display éƒ½å®šä¹‰åœ¨æ ‡å‡†åº“ä¸­ã€‚
å¸¦æ³›å‹çš„ trait
å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ³›å‹æ¥å®ç°
é»˜è®¤æ³›å‹ç±»å‹å‚æ•°

å®ç° trait æ—¶ä¸æŒ‡å®š Rhs çš„å…·ä½“ç±»å‹ï¼ŒRhs çš„ç±»å‹å°†æ˜¯é»˜è®¤çš„ Self ç±»å‹ï¼Œä¹Ÿå°±æ˜¯åœ¨å…¶ä¸Šå®ç° Add çš„ç±»å‹

trait Add&lt;Rhs=Self> &#123;
    type Output;
    fn add(self, rhs: Rhs) -> Self::Output;
&#125;

// ä¸º i32 å®ç° Add trait
impl Add for i32 &#123;
    type Output = i32;
    fn add(self, rhs: i32) -> i32 &#123;
        self + rhs
    &#125;
&#125;

fn main() &#123;
    let num1 = 5;
    let num2 = 3;
    let result = num1.add(num2);
    println!("The result of addition is: &#123;&#125;", result);
&#125;
å…³è”ç±»å‹
å…³è”ç±»å‹æ˜¯ trait å®šä¹‰ä¸­çš„ç±»å‹å ä½ç¬¦ï¼Œå¹¶ä¸å®šä¹‰å®ƒçš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆï¼Œåœ¨å®ç°è¿™ä¸ª trait çš„æ—¶å€™æ‰ä¸ºè¿™ä¸ªå…³è”ç±»å‹èµ‹äºˆç¡®å®šçš„ç±»å‹ã€‚
trait Container &#123;
    type Item;

    fn contains(&amp;self, item: &amp;Self::Item) -> bool;
&#125;

struct IntContainer &#123;
    numbers: Vec&lt;i32>,
&#125;

impl Container for IntContainer &#123;
    type Item = i32;

    fn contains(&amp;self, item: &amp;i32) -> bool &#123;
        self.numbers.contains(item)
    &#125;
&#125;

fn main() &#123;
    let container = IntContainer &#123; numbers: vec![1, 2, 3] &#125;;
    println!("Container contains 2: &#123;&#125;", container.contains(&amp;2));
&#125;
ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°
&amp;impl
ä½¿ç”¨ &amp;impl Trait è¯­æ³•å¯ä»¥å°†å®ç°äº†ç‰¹å®š trait çš„ç±»å‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚
trait Summary &#123;
    fn summarize(&amp;self) -> String;
&#125;

struct NewsArticle &#123;
    headline: String,
&#125;

impl Summary for NewsArticle &#123;
    fn summarize(&amp;self) -> String &#123;
        format!("Headline: &#123;&#125;", self.headline)
    &#125;
&#125;

fn notify(item: &amp;impl Summary) &#123;
    println!("Breaking news! &#123;&#125;", item.summarize());
&#125;

fn main() &#123;
    let article = NewsArticle &#123;
        headline: String::from("New Rust feature released!"),
    &#125;;
    notify(&amp;article);
&#125;
trait boundè¯­æ³•
trait bound è¯­æ³•å…è®¸æˆ‘ä»¬åœ¨æ³›å‹å‡½æ•°ä¸­æŒ‡å®šæ³›å‹ç±»å‹å¿…é¡»å®ç°çš„ traitã€‚

fn notify&lt;T: Summary>(item: &amp;T) &#123;
    println!("Breaking news! &#123;&#125;", item.summarize());
&#125;
where è¯­æ³•ç®€åŒ– trait bound
å½“æ³›å‹å‚æ•°è¾ƒå¤šï¼Œå¹¶ä¸”æ¯ä¸ªå‚æ•°éƒ½æœ‰å¤šä¸ª trait çº¦æŸæ—¶ï¼Œä½¿ç”¨ where è¯­æ³•å¯ä»¥ä½¿ä»£ç æ›´æ˜“è¯»ã€‚


fn notify&lt;T>(item: &amp;T)
where
    T: Summary + Display,
&#123;
    println!("Breaking news! &#123;&#125;", item.summarize());
    item.display();
&#125;

traitä½œä¸ºæ³›å‹çš„ç±»å‹
å¯ä»¥å°† trait ä½œä¸ºæ³›å‹ç±»å‹å‚æ•°ï¼Œè¿™æ ·å‡½æ•°å°±å¯ä»¥æ¥å—å®ç°äº†è¯¥ trait çš„ä»»ä½•ç±»å‹ã€‚
trait Summary &#123;
    fn summarize(&amp;self) -> String;
&#125;

struct NewsArticle &#123;
    headline: String,
&#125;

impl Summary for NewsArticle &#123;
    fn summarize(&amp;self) -> String &#123;
        format!("Headline: &#123;&#125;", self.headline)
    &#125;
&#125;

fn print_summary&lt;T: Summary>(item: T) &#123;
    println!("Summary: &#123;&#125;", item.summarize());
&#125;

fn main() &#123;
    let article = NewsArticle &#123;
        headline: String::from("New Rust feature released!"),
    &#125;;
    print_summary(article);
&#125;
impl trait è¯­æ³• ï¼ˆè¿”å›å€¼ä¸­è¿”å›traitï¼‰
å¦‚æœéœ€è¦åŠ¨æ€è¿”å›ä¸åŒçš„ trait ç±»å‹çš„è¯ï¼Œéœ€è¦ä½¿ç”¨ Box&lt;dyn xxx&gt; è¯­æ³•æ¥ä¿è¯è¿”å›çš„å†…å­˜å¤§å°ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥æ ‡æ³¨è¿”å›çš„å“ªç§ traitã€‚
trait Summary &#123;
    fn summarize(&amp;self) -> String;
&#125;

struct NewsArticle &#123;
    headline: String,
&#125;

impl Summary for NewsArticle &#123;
    fn summarize(&amp;self) -> String &#123;
        format!("Headline: &#123;&#125;", self.headline)
    &#125;
&#125;

fn returns_summarizable() -> Box&lt;dyn Summary> &#123;
    Box::new(NewsArticle &#123;
        headline: String::from("New Rust feature released!"),
    &#125;)
&#125;

fn main() &#123;
    let item = returns_summarizable();
    println!("Summary: &#123;&#125;", item.summarize());
&#125;
é€šè¿‡ derive æ´¾ç”Ÿç±»å‹
ä¾‹å¦‚ #[derive(Debug)] æ˜¯ä¸€ç§ç‰¹å¾æ´¾ç”Ÿè¯­æ³•ï¼Œè¿™ç§è¢«æ ‡è®°çš„å¯¹è±¡ä¼šè‡ªåŠ¨å®ç°å¯¹åº”çš„é»˜è®¤ç‰¹å¾ä»£ç ï¼Œç»§æ‰¿ç›¸åº”çš„åŠŸèƒ½ã€‚
#[derive(Debug)]
struct Rectangle &#123;
    width: u32,
    height: u32,
&#125;

fn main() &#123;
    let rect = Rectangle &#123; width: 30, height: 50 &#125;;
    println!("Rectangle: &#123;:?&#125;", rect);
&#125;
ç»ƒä¹ 
ç»ƒä¹  1
å®šä¹‰ä¸€ä¸ª Area traitï¼ŒåŒ…å«ä¸€ä¸ª area æ–¹æ³•ï¼Œç”¨äºè®¡ç®—é¢ç§¯ã€‚ç„¶åä¸º Rectangle ç»“æ„ä½“å®ç°è¯¥ traitã€‚
ç»ƒä¹  2
åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå®ç°äº† Area trait çš„ç±»å‹ä½œä¸ºå‚æ•°ï¼Œå¹¶æ‰“å°å…¶é¢ç§¯ã€‚
ç»ƒä¹  3
ä½¿ç”¨ derive æ´¾ç”Ÿ Clone å’Œ Copy trait åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ä¸Šï¼Œå¹¶éªŒè¯å…¶åŠŸèƒ½ã€‚
ä»¥ä¸‹æ˜¯ç»ƒä¹ çš„å‚è€ƒç­”æ¡ˆï¼š
// ç»ƒä¹  1
trait Area &#123;
    fn area(&amp;self) -> f64;
&#125;

struct Rectangle &#123;
    width: f64,
    height: f64,
&#125;

impl Area for Rectangle &#123;
    fn area(&amp;self) -> f64 &#123;
        self.width * self.height
    &#125;
&#125;

// ç»ƒä¹  2
fn print_area&lt;T: Area>(shape: T) &#123;
    println!("The area is: &#123;&#125;", shape.area());
&#125;

// ç»ƒä¹  3
#[derive(Clone, Copy, Debug)]
struct Point &#123;
    x: i32,
    y: i32,
&#125;

fn main() &#123;
    let rect = Rectangle &#123; width: 5.0, height: 3.0 &#125;;
    print_area(rect);

    let p1 = Point &#123; x: 1, y: 2 &#125;;
    let p2 = p1; // å¤åˆ¶æ“ä½œ
    println!("p1: &#123;:?&#125;, p2: &#123;:?&#125;", p1, p2);
&#125;
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part6]_å®</title>
    <url>/2025/07/31/Rust%E8%BF%9B%E9%98%B6-part6-%E5%AE%8F/</url>
    <content><![CDATA[Rustè¿›é˜¶[part6]_å®
macro æ¦‚è¿°
å®æ˜¯ Rust ä¸­å¼ºå¤§çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œä¸å‡½æ•°ä¸åŒï¼Œå®ƒåœ¨ç¼–è¯‘æœŸå±•å¼€å¹¶ç”Ÿæˆå…·ä½“ä»£ç ï¼Œèƒ½å¤„ç†å¯å˜å‚æ•°ã€å®ç°åŠ¨æ€é€»è¾‘ï¼Œè¯­æ³•ä¸Šä»¥ ! ç»“å°¾ï¼ˆå¦‚ println! vec! panic!ï¼‰ã€‚
å¸¸ç”¨å®ç®€åŒ–äº†é‡å¤æ“ä½œï¼šprintln! å¤„ç†æ ¼å¼åŒ–è¾“å‡ºï¼Œvec! å¿«é€Ÿåˆ›å»ºå‘é‡ï¼Œcfg! åšæ¡ä»¶ç¼–è¯‘åˆ¤æ–­ã€‚å®æ”¯æŒæ¨¡å¼åŒ¹é…å’Œä»£ç ç”Ÿæˆï¼Œæ¯”å‡½æ•°æ›´çµæ´»ï¼Œä½†ä¹Ÿå› ç¼–è¯‘æœŸå¤„ç†ï¼Œè°ƒè¯•å’Œå­¦ä¹ é—¨æ§›ç¨é«˜ã€‚æŒ‰åŠŸèƒ½å¯åˆ†ä¸ºå£°æ˜å®ï¼ˆåŸºäºæ¨¡å¼åŒ¹é…ï¼‰å’Œè¿‡ç¨‹å®ï¼ˆæ›´å¤æ‚çš„ä»£ç ç”Ÿæˆï¼‰ï¼Œæ˜¯ Rust å…ƒç¼–ç¨‹çš„æ ¸å¿ƒèƒ½åŠ›ã€‚
ä¸€äº›ä¹‹å‰å¸¸ç”¨çš„å®ï¼Œä¾‹å¦‚ println!ã€vec! ç­‰ï¼Œå®ƒä»¬ç®€åŒ–äº†ä»£ç ç¼–å†™ã€‚
å£°æ˜å®
å£°æ˜å®å…è®¸ä½ é€šè¿‡æ¨¡å¼åŒ¹é…æ¥ç”Ÿæˆä»£ç ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„åŠ æ³•å£°æ˜å®ï¼š
macro_rules! add &#123;
    ($a:expr, $b:expr) => &#123;
        $a + $b
    &#125;;
&#125;

fn main() &#123;
    let result = add!(1, 2);
    println!("Result: &#123;&#125;", result);
&#125;
æ ¼å¼
macro_rules! å®åç§° &#123;
    (æ¨¡å¼1) => &#123; ä»£ç 1 &#125;;
    (æ¨¡å¼2) => &#123; ä»£ç 2 &#125;;
    // ...
&#125;

æ¨¡å¼ï¼šåŒ¹é…è°ƒç”¨å®æ—¶çš„è¾“å…¥å‚æ•°ã€‚
å…ƒå˜é‡ï¼šç”¨ $ å¼€å¤´ï¼Œæ•è·è¾“å…¥çš„ç‰‡æ®µï¼ˆå¦‚è¡¨è¾¾å¼ã€æ ‡è¯†ç¬¦ç­‰ï¼‰ã€‚
é‡å¤ç¬¦å·ï¼š*ï¼ˆé›¶æˆ–å¤šæ¬¡ï¼‰ã€+ï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰ï¼Œç±»ä¼¼æ­£åˆ™è¡¨è¾¾å¼ã€‚

è¿‡ç¨‹å®
æ´¾ç”Ÿå®
æ´¾ç”Ÿå®å¯ä»¥ä¸ºç»“æ„ä½“ã€æšä¸¾ç­‰ç±»å‹è‡ªåŠ¨ç”Ÿæˆä»£ç ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ #[derive(Debug)] å¯ä»¥è‡ªåŠ¨ä¸ºç»“æ„ä½“æ·»åŠ è°ƒè¯•è¾“å‡ºçš„èƒ½åŠ›ï¼š
#[derive(Debug)]
struct Person &#123;
    name: String,
    age: u8,
&#125;

fn main() &#123;
    let person = Person &#123;
        name: String::from("Alice"),
        age: 30,
    &#125;;
    println!("&#123;:?&#125;", person);
&#125;
å±æ€§å®
å±æ€§å®å¯ä»¥ä¸ºå‡½æ•°ã€ç»“æ„ä½“ç­‰æ·»åŠ è‡ªå®šä¹‰å±æ€§ã€‚ä¾‹å¦‚ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªæ—¥å¿—å±æ€§å®ï¼š
#[proc_macro_attribute]
pub fn log(_attr: TokenStream, item: TokenStream) -> TokenStream &#123;
    // è¿™é‡Œå¯ä»¥å®ç°æ—¥å¿—è®°å½•é€»è¾‘
    item
&#125;

#[log]
fn my_function() &#123;
    println!("Function called");
&#125;

fn main() &#123;
    my_function();
&#125;
å‡½æ•°å®
å‡½æ•°å®ç±»ä¼¼äºæ™®é€šå‡½æ•°ï¼Œä½†åœ¨ç¼–è¯‘æ—¶å±•å¼€ã€‚ä¾‹å¦‚ï¼š
#[proc_macro]
pub fn greet(_item: TokenStream) -> TokenStream &#123;
    let code = "println!(\"Hello, world!\");";
    code.parse().unwrap()
&#125;

fn main() &#123;
    greet!();
&#125;
æ€»ç»“
å®æ˜¯ Rust ä¸­å¼ºå¤§çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå£°æ˜å®é€šè¿‡æ¨¡å¼åŒ¹é…ç”Ÿæˆä»£ç ï¼Œè¿‡ç¨‹å®åˆ™æä¾›äº†æ›´çµæ´»çš„ä»£ç ç”Ÿæˆæ–¹å¼ï¼ŒåŒ…æ‹¬æ´¾ç”Ÿå®ã€å±æ€§å®å’Œå‡½æ•°å®ã€‚
åº”ç”¨åœºæ™¯

å‡å°‘é‡å¤ä»£ç ï¼š é€šè¿‡å®ç”Ÿæˆé‡å¤çš„ä»£ç ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚
ç¼–è¯‘æœŸè®¡ç®—ï¼šåœ¨ç¼–è¯‘å™¨è¿›è¡Œè®¡ç®—å¹¶ç”Ÿæˆä»£ç ï¼Œæé«˜è¿è¡Œæ—¶æ€§èƒ½ã€‚
DSLï¼ˆé¢†åŸŸç‰¹å®šè¯­è¨€ï¼‰ï¼šä½¿ç”¨å®å®šä¹‰é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œæé«˜ä»£ç çš„è¡¨è¾¾åŠ›å’Œå¯è¯»æ€§ã€‚

è¯¾åä¹ é¢˜
å®ç°ä¸€ä¸‹å®
assert_eq!(repeat!("x", 3), "xxx");
    assert_eq!(sum!(1, 2, 3, 4, 5), 15);
    assert_eq!(max_value!(1, 8, 9), 9);
ä»£ç ï¼š
#[macro_export]
macro_rules! say_hello &#123;
    () => &#123;
        println!("hello!");
    &#125;;
    ($name:expr) => &#123;
        println!("hello &#123;&#125;!", $name);
    &#125;;
&#125;

#[macro_export]
macro_rules! repeat &#123;
    () => &#123;
        println!("repeat!");
    &#125;;
    ($s:expr, $n:expr) => &#123;
        std::string::String::from($s).repeat($n)
    &#125;;
&#125;

#[macro_export]
macro_rules! sum &#123;
    () => &#123;
        println!("sum!");
    &#125;;
    ($($x:expr),*) => &#123;
        &#123;
            let mut total = 0;
            $(total += $x;)*
            total
        &#125;
    &#125;;
&#125;

#[macro_export]
macro_rules! max_value &#123;
    () => &#123;
        println!("max_value!");
    &#125;;
    ($x:expr, $y:expr, $z:expr) => &#123;
        if $x > $y &#123;
            if $x > $z &#123; $x &#125; else &#123; $z &#125;
        &#125; else &#123;
            if $y > $z &#123; $y &#125; else &#123; $z &#125;
        &#125;
    &#125;;
&#125;

ä¸€äº›ç¬¦å·æ‹†è§£ï¼š

$()ï¼šåˆ†ç»„æ•è·å…ƒå˜é‡ã€‚
\*/+ï¼šé‡å¤åŒ¹é…è¾“å…¥ç‰‡æ®µã€‚
$(...)\*ï¼šåœ¨å±•å¼€æ—¶ä»£å…¥é‡å¤çš„ä»£ç é€»è¾‘ã€‚

// sum! å®å±•å¼€é€»è¾‘
$(total += $x;)*  // å¯¹æ¯ä¸ªæ•è·çš„è¡¨è¾¾å¼ï¼Œç”Ÿæˆä¸€æ¬¡ç´¯åŠ è¯­å¥
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part8]_è¿­ä»£å™¨</title>
    <url>/2025/07/31/Rust%E8%BF%9B%E9%98%B6-part8-%E8%BF%AD%E4%BB%A3%E5%99%A8/</url>
    <content><![CDATA[Rustè¿›é˜¶[part8]_è¿­ä»£å™¨&amp;å…³è”ç±»å‹
æ¦‚è¿°
è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ˜¯ Rust ä¸­å¤„ç†åºåˆ—å…ƒç´ çš„å¼ºå¤§å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥éå†é›†åˆï¼ˆå¦‚å‘é‡ã€æ•°ç»„ã€å“ˆå¸Œè¡¨ç­‰ï¼‰ä¸­çš„å…ƒç´ ã€‚è¿­ä»£å™¨çš„æ ¸å¿ƒç‰¹æ€§æ˜¯æƒ°æ€§æ‰§è¡Œï¼šé™¤éä¸»åŠ¨è°ƒç”¨æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•ï¼Œå¦åˆ™è¿­ä»£å™¨ä¸ä¼šå®é™…æ‰§è¡Œä»»ä½•æ“ä½œã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—è¿­ä»£å™¨å¯ä»¥é«˜æ•ˆåœ°ç»„åˆä½¿ç”¨ï¼Œè€Œä¸ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚
åœ¨ Rust ä¸­ï¼Œè¿­ä»£å™¨ç”± Iterator trait å®šä¹‰ï¼Œæ‰€æœ‰å®ç°äº†è¯¥ trait çš„ç±»å‹éƒ½å¯ä»¥è¢«ç§°ä¸ºè¿­ä»£å™¨ã€‚è¿­ä»£å™¨ä¸ä»…å¯ä»¥ç”¨äºéå†ç°æœ‰é›†åˆï¼Œè¿˜å¯ä»¥ç”¨äºç”Ÿæˆåºåˆ—ï¼ˆå¦‚æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼‰ã€å¤„ç†æ•°æ®æµç­‰åœºæ™¯ã€‚
è¿­ä»£å™¨çš„å®ç°
è¿­ä»£å™¨æœ¬è´¨æ˜¯å®ç°äº† Iterator trait çš„ç±»å‹ã€‚è¯¥ trait çš„æ ¸å¿ƒå®šä¹‰å¦‚ä¸‹ï¼š
trait Iterator &#123;
    type Item;  // å…³è”ç±»å‹ï¼šè¿­ä»£å™¨äº§ç”Ÿçš„å…ƒç´ ç±»å‹
    fn next(&amp;mut self) -> Option&lt;Self::Item>;  // æ ¸å¿ƒæ–¹æ³•ï¼šè¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆNoneè¡¨ç¤ºç»“æŸï¼‰
&#125;
next æ–¹æ³•æ˜¯è¿­ä»£å™¨çš„æ ¸å¿ƒï¼š

æ¯æ¬¡è°ƒç”¨è¿”å› Option&lt;Self::Item&gt;ï¼Œå…¶ä¸­ Some(value) è¡¨ç¤ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼ŒNone è¡¨ç¤ºè¿­ä»£ç»“æŸ
è°ƒç”¨ next ä¼šä¿®æ”¹è¿­ä»£å™¨çš„å†…éƒ¨çŠ¶æ€ï¼ˆæ¨è¿›åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå› æ­¤éœ€è¦ &amp;mut self

å…³è”ç±»å‹
ä¸Šé¢ trait ä¸­ç”¨åˆ°çš„ type Item; æ˜¯å…³è”ç±»å‹ï¼ˆAssociated Typeï¼‰ï¼Œå®ƒæ˜¯åœ¨ trait å†…éƒ¨å®šä¹‰çš„ç±»å‹å ä½ç¬¦ï¼Œç”¨äºè¡¨ç¤º trait ä¸­æ¶‰åŠçš„æŸä¸ªç±»å‹ã€‚å®ç°è¯¥ trait æ—¶ï¼Œéœ€è¦æŒ‡å®š Item çš„å…·ä½“ç±»å‹ã€‚
å’Œæ³›å‹çš„åŒºåˆ«
å…³è”ç±»å‹ä¸æ³›å‹éƒ½å¯ä»¥å®ç°&quot;ç±»å‹æŠ½è±¡&quot;ï¼Œä½†é€‚ç”¨åœºæ™¯ä¸åŒï¼š


å…³è”ç±»å‹ï¼šåœ¨ trait ä¸­åªå£°æ˜ä¸€ä¸ªç±»å‹å ä½ç¬¦ï¼Œå®ç° trait æ—¶å¿…é¡»ä¸ºè¯¥ç±»å‹æŒ‡å®šå”¯ä¸€å…·ä½“ç±»å‹ï¼ˆä¸€ä¸ªå®ç°å¯¹åº”ä¸€ä¸ªå…·ä½“ç±»å‹ï¼‰ã€‚é€‚åˆ trait ä¸­æŸä¸ªç±»å‹é€»è¾‘ä¸Š&quot;å›ºå®š&quot;çš„åœºæ™¯ï¼ˆå¦‚è¿­ä»£å™¨çš„å…ƒç´ ç±»å‹ï¼‰ã€‚
// è¿­ä»£å™¨åªèƒ½äº§ç”Ÿä¸€ç§ç±»å‹çš„å…ƒç´ ï¼Œç”¨å…³è”ç±»å‹æ›´åˆé€‚
trait Iterator &#123;
    type Item;
    fn next(&amp;mut self) -> Option&lt;Self::Item>;
&#125;


æ³›å‹ï¼šåœ¨ trait å®šä¹‰æ—¶å£°æ˜ç±»å‹å‚æ•°ï¼Œå®ç° trait æ—¶å¯ä»¥ä¸ºä¸åŒç±»å‹å‚æ•°æä¾›å¤šä¸ªå®ç°ã€‚é€‚åˆéœ€è¦ä¸ºå¤šç§ç±»å‹æä¾›é€šç”¨é€»è¾‘çš„åœºæ™¯ã€‚
// æ³›å‹å¯ä»¥ä¸ºä¸åŒTå®ç°ä¸åŒé€»è¾‘
trait Container&lt;T> &#123;
    fn get(&amp;self, index: usize) -> Option&lt;&amp;T>;
&#125;


ç®€å•è¿­ä»£å™¨
è¿­ä»£å™¨çš„åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹ï¼š
fn iter_study() &#123;
    let v1 = vec![1, 2, 3];
    // 1. forå¾ªç¯éå†ï¼ˆæœ€å¸¸ç”¨ï¼‰
    let v1_iter = v1.iter();  // è·å–è¿­ä»£å™¨ï¼ˆä¸å¯å˜å¼•ç”¨ï¼‰
    for var in v1_iter &#123;
        println!("&#123;&#125;", var);  // è¾“å‡ºï¼š1 2 3
    &#125;

    // 2. æ‰‹åŠ¨è°ƒç”¨nextæ–¹æ³•
    let mut v1_iter2 = v1.iter();  // éœ€è¦mutï¼Œå› ä¸ºnextä¼šä¿®æ”¹è¿­ä»£å™¨çŠ¶æ€
    while let Some(var) = v1_iter2.next() &#123;
        println!("&#123;&#125;", var);  // è¾“å‡ºï¼š1 2 3
    &#125;
&#125;
for å¾ªç¯ä¸éœ€è¦ mut è€Œ while å¾ªç¯éœ€è¦çš„åŸå› ï¼š
for å¾ªç¯åœ¨å†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç†è¿­ä»£å™¨çš„å¯å˜æ€§â€”â€”å®ƒä¼šå°†è¿­ä»£å™¨æ ‡è®°ä¸º mutableï¼Œå¹¶åœ¨å¾ªç¯è¿‡ç¨‹ä¸­éšå¼è°ƒç”¨ next æ–¹æ³•ã€‚è€Œæ‰‹åŠ¨è°ƒç”¨ next æ—¶ï¼Œéœ€è¦æ˜¾å¼å£°æ˜ mutï¼Œå› ä¸º next æ–¹æ³•æ¥æ”¶ &amp;mut selfï¼Œè¦æ±‚è¿­ä»£å™¨æ˜¯å¯å˜çš„ã€‚
å‡ ä¸ªè¿­ä»£çš„æ–¹æ³•
é›†åˆç±»å‹ï¼ˆå¦‚ Vecï¼‰é€šå¸¸æä¾›ä»¥ä¸‹æ–¹æ³•æ¥è·å–ä¸åŒç±»å‹çš„è¿­ä»£å™¨ï¼š
iter æ–¹æ³•
è¿”å›ä¸å¯å˜å¼•ç”¨è¿­ä»£å™¨ï¼ˆIterator&lt;Item = &amp;T&gt;ï¼‰ï¼Œè¿­ä»£è¿‡ç¨‹ä¸­å€Ÿç”¨é›†åˆå…ƒç´ ï¼ˆä¸è·å–æ‰€æœ‰æƒï¼‰ï¼Œé›†åˆæœ¬èº«å¯ä»¥åœ¨è¿­ä»£åç»§ç»­ä½¿ç”¨ã€‚
let v = vec![1, 2, 3];
let iter = v.iter();  // è¿­ä»£å…ƒç´ ç±»å‹ï¼š&amp;i32
into_iter æ–¹æ³•
è¿”å›æ‰€æœ‰æƒè¿­ä»£å™¨ï¼ˆIterator&lt;Item = T&gt;ï¼‰ï¼Œè¿­ä»£è¿‡ç¨‹ä¸­ä¼šè·å–é›†åˆå…ƒç´ çš„æ‰€æœ‰æƒï¼Œè¿­ä»£ç»“æŸåé›†åˆæœ¬èº«æ— æ³•å†ä½¿ç”¨ï¼ˆå·²è¢«æ¶ˆè€—ï¼‰ã€‚
let v = vec![1, 2, 3];
let iter = v.into_iter();  // è¿­ä»£å…ƒç´ ç±»å‹ï¼ši32ï¼ˆvæ­¤åä¸å¯ç”¨ï¼‰
iter_mut æ–¹æ³•
è¿”å›å¯å˜å¼•ç”¨è¿­ä»£å™¨ï¼ˆIterator&lt;Item = &amp;mut T&gt;ï¼‰ï¼Œè¿­ä»£è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹é›†åˆå…ƒç´ çš„å€¼ã€‚
let mut v = vec![1, 2, 3];
let iter = v.iter_mut();  // è¿­ä»£å…ƒç´ ç±»å‹ï¼š&amp;mut i32
for num in iter &#123;
    *num *= 2;  // ä¿®æ”¹å…ƒç´ å€¼
&#125;
println!("&#123;:?&#125;", v);  // è¾“å‡ºï¼š[2, 4, 6]
æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•
æ¶ˆè€—å‹æ–¹æ³•ï¼ˆConsuming Adaptorsï¼‰ä¼šéå†è¿­ä»£å™¨å¹¶æ¶ˆè€—å®ƒï¼ˆè°ƒç”¨åè¿­ä»£å™¨æ— æ³•å†ä½¿ç”¨ï¼‰ï¼Œé€šå¸¸ä¼šäº§ç”Ÿä¸€ä¸ªæœ€ç»ˆç»“æœã€‚
next
æœ€åŸºç¡€çš„æ¶ˆè€—å‹æ–¹æ³•ï¼Œæ¯æ¬¡è°ƒç”¨è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°è¿”å› Noneã€‚
sum
è®¡ç®—è¿­ä»£å™¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ€»å’Œï¼Œæ”¯æŒæ‰€æœ‰å®ç°äº† Sum trait çš„ç±»å‹ï¼ˆå¦‚æ•°å€¼ç±»å‹ï¼‰ã€‚
let v = vec![1, 2, 3, 4];
let total: i32 = v.iter().sum();  // sumä¼šæ¶ˆè€—è¿­ä»£å™¨
println!("&#123;&#125;", total);  // è¾“å‡ºï¼š10
collect
å°†è¿­ä»£å™¨äº§ç”Ÿçš„å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼ˆå¦‚ Vecã€HashMap ç­‰ï¼‰ï¼Œéœ€è¦æ˜¾å¼æŒ‡å®šç›®æ ‡é›†åˆç±»å‹ã€‚
let v = vec![1, 2, 3];
let doubled: Vec&lt;i32> = v.iter().map(|x| x * 2).collect();  // æ”¶é›†åˆ°Vec
println!("&#123;:?&#125;", doubled);  // è¾“å‡ºï¼š[2, 4, 6]
äº§ç”Ÿå…¶ä»–è¿­ä»£å™¨çš„æ–¹æ³•
è¿­ä»£å™¨é€‚é…å™¨ï¼ˆIterator Adaptorsï¼‰ä¼šå¯¹è¿­ä»£å™¨è¿›è¡Œè½¬æ¢ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ï¼ˆä¸ç«‹å³æ‰§è¡Œï¼Œä»ä¿æŒæƒ°æ€§ï¼‰ã€‚
map
æ¥æ”¶ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ï¼Œå°†è¿­ä»£å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ã€‚
let v = vec![1, 2, 3];
let mapped = v.iter().map(|x| x * 10);  // ç±»å‹ï¼šMap&lt;Iter&lt;i32>, ...>ï¼ˆæœªæ‰§è¡Œï¼‰
// ç”¨collectè§¦å‘æ‰§è¡Œ
let result: Vec&lt;i32> = mapped.collect();
println!("&#123;:?&#125;", result);  // è¾“å‡ºï¼š[10, 20, 30]
filter
æ¥æ”¶ä¸€ä¸ªé—­åŒ…ä½œä¸º predicateï¼ˆæ–­è¨€ï¼‰ï¼Œè¯¥é—­åŒ…è¿”å› boolï¼Œæ–°è¿­ä»£å™¨åªåŒ…å«æ»¡è¶³æ–­è¨€çš„å…ƒç´ ã€‚
let v = vec![1, 2, 3, 4, 5];
let even_numbers: Vec&lt;&amp;i32> = v.iter().filter(|x| **x % 2 == 0).collect();
println!("&#123;:?&#125;", even_numbers);  // è¾“å‡ºï¼š[2, 4]
ç»ƒä¹ ï¼šå®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—è¿­ä»£å™¨
é¢˜ç›®æè¿°
å®ç°ä¸€ä¸ªè‡ªå®šä¹‰è¿­ä»£å™¨ï¼Œç”¨äºç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚è¯¥è¿­ä»£å™¨åº”æ”¯æŒæ— é™ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°ï¼Œç›´åˆ°ç”¨æˆ·åœæ­¢è¿­ä»£ã€‚
ä»»åŠ¡è¦æ±‚

å®ç°ç»“æ„ä½“ Fibonacciï¼Œå¹¶ä¸ºå®ƒå®ç° Iterator traitã€‚
åœ¨ next æ–¹æ³•ä¸­ç”Ÿæˆä¸‹ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°ã€‚
ç¼–å†™æµ‹è¯•å‡½æ•°ï¼Œè¾“å‡ºå‰10ä¸ªæ–æ³¢é‚£å¥‘æ•°ã€‚

å®ç°ä»£ç 

use std::iter::Iterator;

// å®šä¹‰æ–æ³¢é‚£å¥‘è¿­ä»£å™¨ç»“æ„ä½“ï¼Œå­˜å‚¨å½“å‰å’Œä¸‹ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°
struct Fibonacci &#123;
    current: u64,
    next: u64,
&#125;

// ä¸ºFibonacciå®ç°Iterator trait
impl Iterator for Fibonacci &#123;
    type Item = u64;  // è¿­ä»£å™¨äº§ç”Ÿu64ç±»å‹çš„æ–æ³¢é‚£å¥‘æ•°

    fn next(&amp;mut self) -> Option&lt;Self::Item> &#123;
        let current_val = self.current;  // ä¿å­˜å½“å‰å€¼ä½œä¸ºè¿”å›ç»“æœ
        // æ›´æ–°ä¸‹ä¸€ç»„å€¼ï¼ˆæ–æ³¢é‚£å¥‘è§„åˆ™ï¼šä¸‹ä¸€ä¸ªæ•° = å½“å‰æ•° + å‰ä¸€ä¸ªæ•°ï¼‰
        let new_next = self.current + self.next;
        self.current = self.next;
        self.next = new_next;
        Some(current_val)  // å§‹ç»ˆè¿”å›Someï¼ˆæ— é™è¿­ä»£ï¼‰
    &#125;
&#125;

// æä¾›ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ–æ³¢é‚£å¥‘è¿­ä»£å™¨ï¼ˆä»0, 1å¼€å§‹ï¼‰
impl Fibonacci &#123;
    fn new() -> Self &#123;
        Fibonacci &#123; current: 0, next: 1 &#125;
    &#125;
&#125;

// æµ‹è¯•å‡½æ•°ï¼šè¾“å‡ºå‰10ä¸ªæ–æ³¢é‚£å¥‘æ•°
fn test_fibonacci() &#123;
    let fib_iter = Fibonacci::new();
    // take(10)é™åˆ¶åªå–å‰10ä¸ªå…ƒç´ ï¼ˆè¿­ä»£å™¨é€‚é…å™¨ï¼‰
    for (i, num) in fib_iter.t  ake(10).enumerate() &#123;
        println!("ç¬¬&#123;&#125;ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š&#123;&#125;", i + 1, num);
    &#125;
&#125;

// è¿è¡Œæµ‹è¯•
fn main() &#123;
    test_fibonacci();
&#125;
è¾“å‡ºç»“æœ
ç¬¬1ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š0
ç¬¬2ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š1
ç¬¬3ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š1
ç¬¬4ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š2
ç¬¬5ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š3
ç¬¬6ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š5
ç¬¬7ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š8
ç¬¬8ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š13
ç¬¬9ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š21
ç¬¬10ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š34
è¯´æ˜

ç»“æ„ä½“ Fibonacci ç”¨ current å’Œ next å­˜å‚¨å½“å‰å’Œä¸‹ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼Œåˆå§‹åŒ–ä¸º 0 å’Œ 1ï¼ˆç¬¦åˆæ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ•°å­¦å®šä¹‰ï¼‰ã€‚
next æ–¹æ³•é€šè¿‡æ›´æ–° current å’Œ next çš„å€¼ç”Ÿæˆä¸‹ä¸€ä¸ªæ•°ï¼Œå§‹ç»ˆè¿”å› Someï¼ˆå®ç°æ— é™è¿­ä»£ï¼‰ã€‚
ä½¿ç”¨ take(10) é€‚é…å™¨é™åˆ¶åªè·å–å‰10ä¸ªå…ƒç´ ï¼Œé¿å…æ— é™å¾ªç¯ã€‚

]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part7]_é—­åŒ…</title>
    <url>/2025/07/31/Rust%E8%BF%9B%E9%98%B6-part7-%E9%97%AD%E5%8C%85/</url>
    <content><![CDATA[Rustè¿›é˜¶[part7]_é—­åŒ…
é—­åŒ…æ¦‚è¿°

é—­åŒ…æ˜¯ä¸€ä¸ªå¯ä»¥æ•è·æ‰€åœ¨ç¯å¢ƒä¸­çš„å˜é‡çš„åŒ¿åå‡½æ•°
åœ¨Rustä¸­ï¼Œé—­åŒ…é€šè¿‡||ç¬¦å·å®šä¹‰ï¼Œå¯ä»¥åƒæ™®é€šå‡½æ•°ä¸€æ ·è°ƒç”¨ï¼Œä½†å’Œå‡½æ•°ä¸åŒï¼Œé—­åŒ…å¯ä»¥è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡

ç‰¹ç‚¹

åŒ¿åæ€§ï¼šæ²¡æœ‰å‡½æ•°åï¼Œé€šå¸¸ä½œä¸ºè¡¨è¾¾å¼ä½¿ç”¨
æ•è·ç¯å¢ƒï¼šèƒ½è‡ªåŠ¨æ•è·å®šä¹‰æ‰€åœ¨ä½œç”¨åŸŸä¸­çš„å˜é‡ï¼ˆæ— éœ€æ˜¾å¼å£°æ˜ï¼‰
ç±»å‹æ¨æ–­ï¼šå‚æ•°å’Œè¿”å›å€¼ç±»å‹å¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ï¼Œæ— éœ€æ˜¾å¼æ ‡æ³¨
çµæ´»è¯­æ³•ï¼šè¯­æ³•ç®€æ´ï¼Œå¯æ ¹æ®å¤æ‚åº¦è°ƒæ•´å†™æ³•ï¼ˆå•è¡Œå¯çœç•¥&#123;&#125;å’Œreturnï¼‰
å®ç°traitï¼šç¼–è¯‘å™¨ä¼šä¸ºé—­åŒ…è‡ªåŠ¨å®ç°Fnã€FnMutæˆ–FnOnce traitï¼Œä½¿å…¶èƒ½ä½œä¸ºå‚æ•°ä¼ é€’

è¯­æ³•
åŸºæœ¬è¯­æ³•ï¼š|å‚æ•°åˆ—è¡¨| ä»£ç å—ï¼ˆè¿”å›å€¼ç”±æœ€åä¸€è¡Œè¡¨è¾¾å¼å†³å®šï¼‰
// æ— å‚æ•°é—­åŒ…
let hello = || println!("Hello, closure!");
hello(); // è°ƒç”¨é—­åŒ…

// å•å‚æ•°é—­åŒ…ï¼ˆçœç•¥ç±»å‹æ ‡æ³¨ï¼‰
let square = |x| x * x;
println!("&#123;&#125;", square(5)); // è¾“å‡ºï¼š25

// å¤šå‚æ•°é—­åŒ…ï¼ˆæ˜¾å¼æ ‡æ³¨ç±»å‹ï¼Œå¯é€‰ï¼‰
let add = |a: i32, b: i32| -> i32 &#123; a + b &#125;;
println!("&#123;&#125;", add(2, 3)); // è¾“å‡ºï¼š5

// å¤šè¡Œé—­åŒ…ï¼ˆéœ€ç”¨&#123;&#125;åŒ…è£¹ï¼‰
let complex_calc = |x: i32| &#123;
    let y = x * 2;
    y + 3 // éšå¼è¿”å›
&#125;;
println!("&#123;&#125;", complex_calc(4)); // è¾“å‡ºï¼š11
ä½¿ç”¨åœºæ™¯
å‡½æ•°çš„å‚æ•°
é—­åŒ…å¸¸ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼ˆå¦‚è¿­ä»£å™¨æ–¹æ³•ã€å¼‚æ­¥ä»»åŠ¡ç­‰ï¼‰ï¼Œå®ç°çµæ´»çš„é€»è¾‘æ³¨å…¥
// 1. ç»“åˆè¿­ä»£å™¨ä½¿ç”¨
let numbers = vec![1, 2, 3, 4, 5];
let doubled: Vec&lt;i32> = numbers.iter().map(|x| x * 2).collect();
println!("&#123;:?&#125;", doubled); // è¾“å‡ºï¼š[2, 4, 6, 8, 10]

// 2. è‡ªå®šä¹‰æ¥å—é—­åŒ…çš„å‡½æ•°
fn apply&lt;F>(f: F, value: i32) -> i32 
where 
    F: Fn(i32) -> i32  // çº¦æŸé—­åŒ…ç±»å‹
&#123;
    f(value)
&#125;

let result = apply(|x| x * 3 + 2, 5);
println!("&#123;&#125;", result); // è¾“å‡ºï¼š17
æ•è·ç¯å¢ƒå˜é‡
å¯ä»¥æ•è·å¹¶ä½¿ç”¨å…¶å®šä¹‰æ‰€åœ¨ç¯å¢ƒä¸­çš„å˜é‡ï¼Œæ•è·æ–¹å¼ç”±ç¼–è¯‘å™¨æ ¹æ®ä½¿ç”¨åœºæ™¯è‡ªåŠ¨æ¨æ–­
// 1. æŒ‰å¼•ç”¨æ•è·ï¼ˆ&amp;Tï¼‰ï¼šé€‚ç”¨äºåªè¯»è®¿é—®
let message = String::from("Hello");
let print_msg = || println!("&#123;&#125;", message); // æ•è·messageçš„å¼•ç”¨
print_msg(); // è¾“å‡ºï¼šHello
println!("&#123;&#125;", message); // ä»å¯ä½¿ç”¨messageï¼ˆæœªè½¬ç§»æ‰€æœ‰æƒï¼‰

// 2. æŒ‰å¯å˜å¼•ç”¨æ•è·ï¼ˆ&amp;mut Tï¼‰ï¼šé€‚ç”¨äºä¿®æ”¹å˜é‡
let mut count = 0;
let mut increment = || &#123;
    count += 1; // ä¿®æ”¹æ•è·çš„å˜é‡
    println!("Count: &#123;&#125;", count);
&#125;;
increment(); // è¾“å‡ºï¼šCount: 1
increment(); // è¾“å‡ºï¼šCount: 2

// 3. æŒ‰å€¼æ•è·ï¼ˆTï¼‰ï¼šé€‚ç”¨äºéœ€è¦è½¬ç§»æ‰€æœ‰æƒçš„åœºæ™¯
let name = String::from("Alice");
let take_name = || &#123;
    println!("Name: &#123;&#125;", name); // æ•è·nameçš„æ‰€æœ‰æƒ
&#125;;
take_name(); 
// println!("&#123;&#125;", name); // é”™è¯¯ï¼šnameçš„æ‰€æœ‰æƒå·²è¢«é—­åŒ…æ•è·
é—­åŒ…åŸç†


è‡ªåŠ¨å®ç°çš„å‡½æ•°ç±»å‹ï¼šç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªé—­åŒ…è‡ªåŠ¨å®ç°Fnã€FnMutæˆ–FnOnceä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªtraitï¼š

FnOnceï¼šé—­åŒ…æ¶ˆè€—æ•è·çš„å˜é‡ï¼ˆæ‰€æœ‰æƒè½¬ç§»ï¼‰ï¼Œå› æ­¤åªèƒ½è°ƒç”¨ä¸€æ¬¡
FnMutï¼šé—­åŒ…é€šè¿‡å¯å˜å¼•ç”¨ä¿®æ”¹æ•è·çš„å˜é‡ï¼Œå¯å¤šæ¬¡è°ƒç”¨
Fnï¼šé—­åŒ…é€šè¿‡ä¸å¯å˜å¼•ç”¨è®¿é—®æ•è·çš„å˜é‡ï¼Œå¯å¤šæ¬¡è°ƒç”¨ï¼ˆå®ç°Fnçš„é—­åŒ…è‡ªåŠ¨å®ç°FnMutå’ŒFnOnceï¼‰



é—­åŒ…çš„ç±»å‹æ¨æ–­ï¼š

é—­åŒ…çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ç”±ç¼–è¯‘å™¨æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨æ–­
åŒä¸€é—­åŒ…çš„ç±»å‹æ˜¯å”¯ä¸€çš„ï¼ˆå³ä½¿ç­¾åç›¸åŒï¼Œä¸åŒé—­åŒ…ç±»å‹ä¹Ÿä¸åŒï¼‰
è‹¥éœ€å­˜å‚¨é—­åŒ…æˆ–ä½œä¸ºè¿”å›å€¼ï¼Œéœ€é€šè¿‡traitå¯¹è±¡ï¼ˆå¦‚Box&lt;dyn Fn(...) -&gt; ...&gt;ï¼‰å®ç°



ç”Ÿå‘½å‘¨æœŸä¸é—­åŒ…ï¼š

æ•è·å¼•ç”¨çš„é—­åŒ…ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå—é™äºæ‰€æ•è·å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ
è‹¥é—­åŒ…ä½œä¸ºè¿”å›å€¼ï¼Œéœ€ç¡®ä¿è¿”å›çš„é—­åŒ…ä¸æ•è·å·²é”€æ¯çš„å˜é‡å¼•ç”¨



moveå…³é”®å­—
åœ¨å‚æ•°åˆ—è¡¨å‰ä½¿ç”¨moveå…³é”®å­—ï¼Œå¯å¼ºåˆ¶é—­åŒ…å–å¾—å®ƒæ‰€ä½¿ç”¨çš„ç¯å¢ƒå€¼çš„æ‰€æœ‰æƒï¼ˆå¿½ç•¥é»˜è®¤çš„å¼•ç”¨æ•è·ï¼‰
// åŸºç¡€ç¤ºä¾‹ï¼šè½¬ç§»æ‰€æœ‰æƒ
let x = vec![1, 2, 3];
let equal_to_x = move |y| y == x; // xçš„æ‰€æœ‰æƒè¢«é—­åŒ…æ•è·
// println!("&#123;:?&#125;", x); // é”™è¯¯ï¼šxçš„æ‰€æœ‰æƒå·²è½¬ç§»
let y = vec![1, 2, 3];
assert!(equal_to_x(y));

// å¤šçº¿ç¨‹åœºæ™¯ï¼šç¡®ä¿é—­åŒ…æ‹¥æœ‰å˜é‡æ‰€æœ‰æƒï¼ˆé¿å…ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼‰
use std::thread;

let s = String::from("thread message");
thread::spawn(move || &#123; // å¿…é¡»ç”¨moveè½¬ç§»sçš„æ‰€æœ‰æƒåˆ°å­çº¿ç¨‹
    println!("&#123;&#125;", s);
&#125;).join().unwrap();
ç»ƒä¹ 

å®ç°ä¸€ä¸ªé—­åŒ…ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„ä¹˜ç§¯å¹¶åŠ ä¸Šä¸€ä¸ªå¤–éƒ¨å®šä¹‰çš„åç§»é‡ï¼ˆå¦‚offset = 10ï¼‰
ä½¿ç”¨é—­åŒ…ä½œä¸ºfilteræ–¹æ³•çš„å‚æ•°ï¼Œä»æ•´æ•°åˆ—è¡¨ä¸­ç­›é€‰å‡ºå¶æ•°
ç”¨moveå…³é”®å­—åˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­æ‰“å°æ•è·çš„å­—ç¬¦ä¸²
ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸¤ä¸ªé—­åŒ…å‚æ•°ï¼ˆä¸€ä¸ªè®¡ç®—å¹³æ–¹ï¼Œä¸€ä¸ªè®¡ç®—ç«‹æ–¹ï¼‰ï¼Œå¹¶è¿”å›ä¸¤ä¸ªé—­åŒ…ç»“æœçš„å’Œ

ç¤ºä¾‹ç­”æ¡ˆå‚è€ƒï¼š
// ç»ƒä¹ 1
let offset = 10;
let calc = |a: i32, b: i32| a * b + offset;
println!("&#123;&#125;", calc(3, 4)); // è¾“å‡ºï¼š22ï¼ˆ3*4+10ï¼‰

// ç»ƒä¹ 2
let numbers = vec![1, 2, 3, 4, 5, 6];
let evens: Vec&lt;_> = numbers.into_iter().filter(|x| x % 2 == 0).collect();
println!("&#123;:?&#125;", evens); // è¾“å‡ºï¼š[2, 4, 6]

// ç»ƒä¹ 3
use std::thread;
let msg = String::from("hello from thread");
thread::spawn(move || &#123;
    println!("&#123;&#125;", msg);
&#125;).join().unwrap();

// ç»ƒä¹ 4
fn combine&lt;F1, F2>(f1: F1, f2: F2, x: i32) -> i32
where
    F1: Fn(i32) -> i32,
    F2: Fn(i32) -> i32,
&#123;
    f1(x) + f2(x)
&#125;
let square = |n| n * n;
let cube = |n| n * n * n;
println!("&#123;&#125;", combine(square, cube, 2)); // è¾“å‡ºï¼š4 + 8 = 12]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustè¿›é˜¶[part9]_testæµ‹è¯•</title>
    <url>/2025/07/31/Rust%E8%BF%9B%E9%98%B6-part9-test%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[Rustè¿›é˜¶[part9]_testæµ‹è¯•
Unit Testï¼ˆå•å…ƒæµ‹è¯•ï¼‰
å•å…ƒæµ‹è¯•ç”¨äºæµ‹è¯•ä»£ç ä¸­çš„æœ€å°åŠŸèƒ½å•å…ƒï¼ˆå¦‚å‡½æ•°ã€æ–¹æ³•ï¼‰ï¼Œé€šå¸¸ä¸è¢«æµ‹è¯•ä»£ç æ”¾åœ¨åŒä¸€æ¨¡å—ä¸­ï¼Œæ–¹ä¾¿æµ‹è¯•ç§æœ‰æ¥å£ã€‚
åŸºæœ¬ç¤ºä¾‹
åˆ›å»ºsrc/lib.rsï¼Œç¼–å†™å…¬å…±å‡½æ•°åŠå¯¹åº”çš„å•å…ƒæµ‹è¯•ï¼š
pub fn add(left: usize, right: usize) -> usize &#123;
    left + right
&#125;

pub fn multiply(a: i32, b: i32) -> i32 &#123;
    a * b
&#125;

// æµ‹è¯•æ¨¡å—ï¼ˆé€šå¸¸å‘½åä¸ºtestï¼Œä½¿ç”¨#[cfg(test)]æ ‡è®°ä»…åœ¨æµ‹è¯•æ¨¡å¼ä¸‹ç¼–è¯‘ï¼‰
#[cfg(test)]
mod tests &#123;
    // å¼•å…¥çˆ¶æ¨¡å—çš„å‡½æ•°ï¼ˆå› æµ‹è¯•æ¨¡å—æ˜¯å­æ¨¡å—ï¼Œéœ€æ˜¾å¼å¼•å…¥ï¼‰
    use super::*;

    // æµ‹è¯•addå‡½æ•°ï¼šæ­£å¸¸æƒ…å†µ
    #[test]
    fn test_add() &#123;
        assert_eq!(add(2, 3), 5); // æ–­è¨€ç›¸ç­‰
        assert_ne!(add(10, 20), 25); // æ–­è¨€ä¸ç›¸ç­‰
    &#125;

    // æµ‹è¯•multiplyå‡½æ•°ï¼šè¾¹ç•Œæƒ…å†µ
    #[test]
    fn test_multiply() &#123;
        assert_eq!(multiply(0, 5), 0); // ä¹˜ä»¥0
        assert_eq!(multiply(-3, 4), -12); // è´Ÿæ•°ç›¸ä¹˜
    &#125;

    // æ ‡è®°åº”è¯¥å¤±è´¥çš„æµ‹è¯•ï¼ˆç”¨äºéªŒè¯é”™è¯¯å¤„ç†ï¼‰
    #[test]
    #[should_panic(expected = "division by zero")] // é¢„æœŸpanicä¿¡æ¯
    fn test_divide_by_zero() &#123;
        let _ = 1 / 0;
    &#125;

    // å¿½ç•¥æµ‹è¯•ï¼ˆæš‚æ—¶ä¸æ‰§è¡Œï¼‰
    #[test]
    #[ignore = "å°šæœªå®ç°å®Œæ•´é€»è¾‘"]
    fn test_complex_calculation() &#123;
        // å¾…å®ç°çš„æµ‹è¯•é€»è¾‘
    &#125;
&#125;
ä»£ç è§£é‡Šï¼š

#[cfg(test)]ï¼šæ ‡è®°æµ‹è¯•æ¨¡å—ï¼Œä»…åœ¨è¿è¡Œcargo testæ—¶æ‰ç¼–è¯‘ï¼Œé¿å…å½±å“ç”Ÿäº§ä»£ç 
#[test]ï¼šæ ‡è®°æµ‹è¯•å‡½æ•°ï¼Œcargoä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æ‰§è¡Œ
æ–­è¨€å®ï¼šassert_eq!(a, b)ï¼ˆæ£€æŸ¥aç­‰äºbï¼‰ã€assert_ne!(a, b)ï¼ˆæ£€æŸ¥aä¸ç­‰äºbï¼‰ã€assert!(condition)ï¼ˆæ£€æŸ¥æ¡ä»¶ä¸ºçœŸï¼‰
#[should_panic]ï¼šæ ‡è®°æµ‹è¯•é¢„æœŸä¼španicï¼Œè‹¥æœªpanicåˆ™æµ‹è¯•å¤±è´¥ï¼›å¯é€šè¿‡expectedæŒ‡å®šé¢„æœŸçš„panicä¿¡æ¯
#[ignore]ï¼šæ ‡è®°æµ‹è¯•æš‚æ—¶å¿½ç•¥ï¼Œæ‰§è¡Œcargo test -- --ignoredå¯å•ç‹¬è¿è¡Œå¿½ç•¥çš„æµ‹è¯•

Integration Testï¼ˆé›†æˆæµ‹è¯•ï¼‰
é›†æˆæµ‹è¯•ç”¨äºæµ‹è¯•å¤šä¸ªæ¨¡å—æˆ–ç»„ä»¶ååŒå·¥ä½œçš„æƒ…å†µï¼Œé€šå¸¸æ”¾åœ¨ç‹¬ç«‹çš„testsç›®å½•ä¸­ï¼Œåªèƒ½è®¿é—®è¢«æµ‹è¯•ä»£ç çš„å…¬å…±æ¥å£ã€‚
ç›®å½•ç»“æ„
åœ¨srcåŒçº§åˆ›å»ºtestsæ–‡ä»¶å¤¹ï¼ˆcargoä¼šè‡ªåŠ¨è¯†åˆ«ä¸ºé›†æˆæµ‹è¯•ç›®å½•ï¼‰ï¼š
project&#x2F;
â”œâ”€â”€ src&#x2F;
â”‚   â””â”€â”€ lib.rs
â”œâ”€â”€ tests&#x2F;
â”‚   â”œâ”€â”€ basic_test.rs  &#x2F;&#x2F; é›†æˆæµ‹è¯•æ–‡ä»¶1
â”‚   â””â”€â”€ advanced_test.rs  &#x2F;&#x2F; é›†æˆæµ‹è¯•æ–‡ä»¶2
â””â”€â”€ Cargo.toml
ç¤ºä¾‹ä»£ç 
tests/basic_test.rsï¼š
// å¼•å…¥è¢«æµ‹è¯•çš„åº“ï¼ˆéœ€åœ¨Cargo.tomlä¸­é…ç½®åº“åç§°ï¼‰
use my_library::&#123;add, multiply&#125;;

#[test]
fn test_integration_add() &#123;
    assert_eq!(add(10, 20), 30);
&#125;

#[test]
fn test_integration_multiply() &#123;
    assert_eq!(multiply(3, 7), 21);
&#125;
é…ç½®è¯´æ˜
éœ€åœ¨Cargo.tomlä¸­é…ç½®åº“ä¿¡æ¯ï¼Œä½¿é›†æˆæµ‹è¯•èƒ½æ­£ç¡®å¼•å…¥ï¼š
[lib]
name = "my_library"  # åº“åç§°ï¼ˆé›†æˆæµ‹è¯•ä¸­useçš„åç§°ï¼‰
path = "src/lib.rs"  # åº“æ–‡ä»¶è·¯å¾„
æµ‹è¯•å‘½ä»¤è¡Œ



å‘½ä»¤
ä½œç”¨




cargo test
è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆå•å…ƒæµ‹è¯•+é›†æˆæµ‹è¯•+æ–‡æ¡£æµ‹è¯•ï¼‰


cargo test test_add
è¿è¡Œåç§°åŒ…å«test_addçš„æµ‹è¯•ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰


cargo test tests::test_multiply
è¿è¡ŒæŒ‡å®šæ¨¡å—ä¸‹çš„æµ‹è¯•


cargo test --test basic_test
ä»…è¿è¡Œtests/basic_test.rsä¸­çš„é›†æˆæµ‹è¯•


cargo test -- --nocapture
è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºæµ‹è¯•ä¸­çš„æ‰“å°è¾“å‡ºï¼ˆé»˜è®¤æ•è·è¾“å‡ºï¼‰


cargo test -- --ignored
ä»…è¿è¡Œè¢«#[ignore]æ ‡è®°çš„æµ‹è¯•


cargo test --release
åœ¨releaseæ¨¡å¼ä¸‹è¿è¡Œæµ‹è¯•ï¼ˆæ€§èƒ½æ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒï¼‰



Doc Testsï¼ˆæ–‡æ¡£æµ‹è¯•ï¼‰
æ–‡æ¡£æµ‹è¯•æ˜¯åµŒå…¥åœ¨ä»£ç æ–‡æ¡£ä¸­çš„æµ‹è¯•ï¼Œæ—¢èƒ½ä½œä¸ºç¤ºä¾‹æ–‡æ¡£ï¼Œåˆèƒ½è¢«cargoæ‰§è¡Œï¼Œç¡®ä¿æ–‡æ¡£ä¸ä»£ç è¡Œä¸ºä¸€è‡´ã€‚
åŸºæœ¬ç”¨æ³•
åœ¨å‡½æ•°çš„æ–‡æ¡£æ³¨é‡Šï¼ˆ///ï¼‰ä¸­é€šè¿‡ä»£ç å—ç¼–å†™æµ‹è¯•ï¼š
/// ä¸¤æ•°ç›¸åŠ 
/// 
/// # Examples
/// 
/// ```
/// use my_library::add;
/// 
/// assert_eq!(add(2, 3), 5);
/// assert_eq!(add(100, 200), 300);
/// ```
pub fn add(left: usize, right: usize) -> usize &#123;
    left + right
&#125;
æ‰§è¡Œæ–‡æ¡£æµ‹è¯•
cargo test --doc  # ä»…è¿è¡Œæ–‡æ¡£æµ‹è¯•
æ³¨æ„äº‹é¡¹

æ–‡æ¡£æµ‹è¯•ä»£ç å—å¿…é¡»æ˜¯å®Œæ•´å¯æ‰§è¡Œçš„ï¼ˆéœ€åŒ…å«useå¼•å…¥ï¼‰
å¯ä½¿ç”¨/// # fn main() &#123; ... &#125;åŒ…è£¹å¤æ‚ç¤ºä¾‹ï¼ˆé€‚ç”¨äºéœ€è¦ä¸»å‡½æ•°çš„åœºæ™¯ï¼‰
è‹¥ç¤ºä¾‹ä»£ç é¢„æœŸä¼š panicï¼Œå¯åœ¨ä»£ç å—å‰åŠ should_panicæ ‡è®°ï¼š/// # Examples
/// 
/// ```should_panic
/// use my_library::divide;
/// divide(1, 0);  // é¢„æœŸpanic
/// ```
pub fn divide(a: i32, b: i32) -> i32 &#123;
    if b == 0 &#123;
        panic!("division by zero");
    &#125;
    a / b
&#125;


Examplesï¼ˆç¤ºä¾‹ä»£ç ï¼‰
examplesç›®å½•ç”¨äºå­˜æ”¾å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç ï¼Œè¿™äº›ç¤ºä¾‹ä¸ä»…æ˜¯æ–‡æ¡£ï¼Œè¿˜èƒ½é€šè¿‡cargo testéªŒè¯å…¶å¯æ‰§è¡Œæ€§ã€‚
ç›®å½•ç»“æ„
project&#x2F;
â”œâ”€â”€ src&#x2F;
â”‚   â””â”€â”€ lib.rs
â””â”€â”€ examples&#x2F;
    â”œâ”€â”€ simple_usage.rs  # ç®€å•ç¤ºä¾‹
    â””â”€â”€ advanced&#x2F;  # å¤šæ–‡ä»¶ç¤ºä¾‹
        â”œâ”€â”€ main.rs
        â””â”€â”€ helper.rs
ç¤ºä¾‹ä»£ç 
examples/simple_usage.rsï¼š
use my_library::add;

fn main() &#123;
    let result = add(5, 7);
    println!("5 + 7 = &#123;&#125;", result);
&#125;
è¿è¡Œç¤ºä¾‹æµ‹è¯•
cargo test --examples  # è¿è¡Œæ‰€æœ‰ç¤ºä¾‹ï¼ˆéªŒè¯èƒ½å¦ç¼–è¯‘æ‰§è¡Œï¼‰
cargo run --example simple_usage  # ç›´æ¥è¿è¡ŒæŒ‡å®šç¤ºä¾‹
æ ‡å‡†å·¥ç¨‹ç›®å½•è§„èŒƒè¯¦è§£
â”œâ”€â”€ Cargo.lock  # ä¾èµ–ç‰ˆæœ¬é”å®šæ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œä¸è¦æ‰‹åŠ¨ä¿®æ”¹ï¼‰  
â”œâ”€â”€ Cargo.toml  # é¡¹ç›®é…ç½®æ–‡ä»¶ï¼ˆä¾èµ–ã€åº“ä¿¡æ¯ç­‰ï¼‰  
â”œâ”€â”€ src&#x2F;  
â”‚   â”œâ”€â”€ lib.rs  # åº“ä»£ç å…¥å£ï¼ˆè¢«å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•å¼•ç”¨ï¼‰  
â”‚   â”œâ”€â”€ main.rs  # ä¸»ç¨‹åºå…¥å£ï¼ˆè‹¥é¡¹ç›®æ˜¯å¯æ‰§è¡Œç¨‹åºï¼‰  
â”‚   â””â”€â”€ bin&#x2F;  # å¤šå¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ï¼ˆæ¯ä¸ª.rsæ–‡ä»¶å¯¹åº”ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼‰  
â”‚       â”œâ”€â”€ tool1.rs  
â”‚       â””â”€â”€ tool2.rs  
â”œâ”€â”€ benches&#x2F;  # åŸºå‡†æµ‹è¯•ç›®å½•ï¼ˆæ€§èƒ½æµ‹è¯•ï¼‰  
â”‚   â”œâ”€â”€ performance.rs  
â”‚   â””â”€â”€ heavy_operation.rs  
â”‚       # åŸºå‡†æµ‹è¯•ç¤ºä¾‹ï¼š  
â”‚       # #[bench]  
â”‚       # fn bench_add(b: &amp;mut Bencher) &#123;  
â”‚       #     b.iter(|| add(1, 2));  
â”‚       # &#125;  
â”œâ”€â”€ examples&#x2F;  # ç¤ºä¾‹ä»£ç ç›®å½•ï¼ˆè§ä¸Šæ–‡Exampleséƒ¨åˆ†ï¼‰  
â””â”€â”€ tests&#x2F;  # é›†æˆæµ‹è¯•ç›®å½•ï¼ˆè§ä¸Šæ–‡Integration Testéƒ¨åˆ†ï¼‰  

src/binï¼šå½“é¡¹ç›®éœ€è¦å¤šä¸ªå¯æ‰§è¡Œç¨‹åºæ—¶ä½¿ç”¨ï¼Œè¿è¡Œcargo run --bin tool1å¯æ‰§è¡Œå¯¹åº”ç¨‹åº
benchesï¼šåŸºå‡†æµ‹è¯•ä½¿ç”¨#[bench]æ ‡è®°ï¼Œé€šè¿‡cargo benchè¿è¡Œï¼Œç”¨äºè¯„ä¼°ä»£ç æ€§èƒ½
æ‰€æœ‰æµ‹è¯•ç›¸å…³ç›®å½•ï¼ˆtestsã€benchesã€examplesï¼‰çš„ä»£ç éƒ½éµå¾ª&quot;ä»…åœ¨æµ‹è¯•/è¿è¡Œæ—¶ç¼–è¯‘&quot;çš„åŸåˆ™ï¼Œä¸å½±å“ç”Ÿäº§ç¯å¢ƒä»£ç ä½“ç§¯

ç»ƒä¹ 
åˆ›å»ºå¹¶å‘å¸ƒä¸€ä¸ª Rust crate åˆ° crates.ioï¼Œæ¶µç›–å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ–‡æ¡£æµ‹è¯•ã€examples ä»¥åŠé¡¹ç›®è§„èŒƒï¼Œç”šè‡³è¿›é˜¶çš„ GitHub Actions è‡ªåŠ¨å‘å¸ƒã€‚
é¦–å…ˆï¼Œå¾—ç†æ¸…æ¥šæ•´ä¸ªæµç¨‹çš„æ­¥éª¤ï¼Œä»åˆå§‹åŒ–é¡¹ç›®ã€ç¼–å†™ä»£ç ã€æ·»åŠ æµ‹è¯•ã€é…ç½®æ–‡æ¡£ï¼Œåˆ°å‘å¸ƒå’Œè‡ªåŠ¨åŒ–ã€‚
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana DeFi äº¤æ˜“çš„â€œå¤§è„‘â€ï¼šJupiter (JUP) å¦‚ä½•é€šè¿‡èšåˆå™¨é‡å¡‘ç”¨æˆ·ä½“éªŒï¼Ÿ</title>
    <url>/2025/10/06/Solana-DeFi-%E4%BA%A4%E6%98%93%E7%9A%84%E2%80%9C%E5%A4%A7%E8%84%91%E2%80%9D%EF%BC%9AJupiter-JUP-%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E8%81%9A%E5%90%88%E5%99%A8%E9%87%8D%E5%A1%91%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%EF%BC%9F/</url>
    <content><![CDATA[Solana DeFi äº¤æ˜“çš„â€œå¤§è„‘â€ï¼šJupiter (JUP) å¦‚ä½•é€šè¿‡èšåˆå™¨é‡å¡‘ç”¨æˆ·ä½“éªŒï¼Ÿ
åœ¨ Solana çš„ DeFi ä¸–ç•Œä¸­ï¼Œæœ‰ä¸€ä¸ªåº”ç”¨æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªäº¤æ˜“æ‰€ï¼Œä½†å¤„ç†ç€ Solana ä¸Šå¤§éƒ¨åˆ†çš„äº¤æ˜“é‡ã€‚å®ƒå°±æ˜¯ Jupiter (JUP)ã€‚https://jup.ag/
å¦‚æœä½ æƒ³åœ¨ Web3 é¢†åŸŸå»ºç«‹æ·±åº¦è®¤çŸ¥ï¼Œç†è§£ JUP çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’ŒæŠ€æœ¯ä¼˜åŠ¿æ˜¯å¿…ä¸å¯å°‘çš„ä¸€æ­¥ã€‚
ä»€ä¹ˆæ˜¯ Jupiter (JUP)ï¼Ÿ â€”â€” Solana ä¸Šçš„â€œæ‰“è½¦è½¯ä»¶â€
JUP æ˜¯ Solana ç”Ÿæ€ä¸­æœ€å¤§çš„â€œå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€èšåˆå™¨â€ï¼ˆDEX Aggregatorï¼‰ã€‚
ä½ å¯ä»¥æŠŠ JUP ç†è§£ä¸º DeFi é¢†åŸŸçš„ â€œæ‰“è½¦è½¯ä»¶â€ï¼ˆæ¯”å¦‚æ»´æ»´æˆ– Uberï¼‰ã€‚å®ƒçš„æ ¸å¿ƒä»»åŠ¡æ˜¯ï¼šå¸®ç”¨æˆ·ä»¥æœ€å¿«é€Ÿåº¦ã€æœ€ä½æˆæœ¬ï¼Œæ‰¾åˆ°æœ€ä½³çš„äº¤æ˜“è·¯å¾„ã€‚

ä¼ ç»Ÿ DEX çš„å›°å¢ƒï¼š Solana ä¸Šæœ‰è®¸å¤šç‹¬ç«‹çš„ DEXï¼Œå¦‚ Orcaã€Raydiumã€Meteoraã€‚å®ƒä»¬å°±åƒä¸€å®¶å®¶ç‹¬ç«‹çš„æµåŠ¨æ€§æä¾›å•†ã€‚ç”¨æˆ·æƒ³è¦å…‘æ¢ä»£å¸æ—¶ï¼Œå¿…é¡»ä¸€å®¶å®¶å»æ¯”è¾ƒä»·æ ¼ï¼Œè´¹æ—¶è´¹åŠ›ã€‚
JUP çš„æ ¸å¿ƒä»·å€¼ï¼š JUP ä¸è‡ªå·±æä¾›æµåŠ¨æ€§ï¼Œè€Œæ˜¯ä½œä¸ºâ€œæœ€ä¼˜è·¯å¾„è§„åˆ’å¸ˆâ€ã€‚å½“ä½ è¾“å…¥ä¸€ç¬”äº¤æ˜“æ—¶ï¼ŒJUP ä¼šå®æ—¶æ‰«ææ‰€æœ‰è¿™äº› DEX çš„æµåŠ¨æ€§æ± ï¼Œå¹¶è®¡ç®—å‡ºä¸€ä¸ªèƒ½åœ¨å…¨ç½‘è·å¾—æœ€ä½³ä»·æ ¼å’Œæœ€å°æ»‘ç‚¹çš„å¤æ‚äº¤æ˜“è·¯çº¿ã€‚
ç”¨æˆ·ä½“éªŒé‡å¡‘ï¼š æœ€ç»ˆï¼ŒJUP å°†å¤æ‚çš„åç«¯è¿ç®—å’Œå¤šæ­¥æ“ä½œç®€åŒ–ä¸ºç”¨æˆ·å‰ç«¯çš„â€œä¸€é”®äº¤æ˜“â€ï¼Œæå¤§åœ°é™ä½äº† DeFi çš„ä½¿ç”¨é—¨æ§›ã€‚

JUP è§£å†³çš„ DeFi ä¸¤å¤§â€œå¤´ç–¼é—®é¢˜â€
JUP ä¹‹æ‰€ä»¥æˆä¸º Solana çš„â€œå¤§è„‘â€ï¼Œæ˜¯å› ä¸ºå®ƒç›´æ¥è§£å†³äº† DeFi äº¤æ˜“ä¸­æœ€ä»¤ç”¨æˆ·å¤´ç–¼çš„ä¸¤ä¸ªç—›ç‚¹ï¼š
ç—›ç‚¹ä¸€ï¼šäº¤æ˜“æ»‘ç‚¹å¤±æ§ (Slippage)
æ»‘ç‚¹æŒ‡çš„æ˜¯ä½ å‘èµ·äº¤æ˜“æ—¶çš„é¢„æœŸä»·æ ¼ä¸æœ€ç»ˆé“¾ä¸Šå®é™…æˆäº¤ä»·æ ¼ä¹‹é—´çš„å·®å¼‚ã€‚

é—®é¢˜æ‰€åœ¨ï¼š åœ¨å•ä¸€ DEX ä¸Šè¿›è¡Œå¤§é¢äº¤æ˜“æˆ–äº¤æ˜“æµåŠ¨æ€§è¾ƒä½çš„ä»£å¸æ—¶ï¼Œä½ çš„äº¤æ˜“è¡Œä¸ºä¼šç«‹åˆ»æ”¹å˜æµåŠ¨æ€§æ± ä¸­èµ„äº§çš„æ¯”ä¾‹ï¼Œå¯¼è‡´ä»·æ ¼ç¬æ—¶å˜åŒ–ã€‚è´­ä¹°æ•°é‡è¶Šå¤§ï¼Œä»·æ ¼å†²å‡»è¶Šå¤§ï¼Œæ»‘ç‚¹æŸå¤±å°±è¶Šé«˜ã€‚
JUP çš„è§£å†³æ–¹æ¡ˆï¼š JUP ä¼šå°†ä½ çš„å¤§é¢äº¤æ˜“æ‹†åˆ†æˆè®¸å¤šå°ä»½ï¼Œå¹¶å·§å¦™åœ°è·¯ç”±åˆ°ä¸åŒçš„ DEX æ± ä¸­ã€‚è¿™æœ‰æ•ˆåˆ†æ•£äº†å¯¹å•ä¸ªæµåŠ¨æ€§æ± çš„å†²å‡»ï¼Œä»è€Œæ˜¾è‘—é™ä½äº†ä½ çš„æ€»ä½“æ»‘ç‚¹æŸå¤±ã€‚

ç—›ç‚¹äºŒï¼šå¯»æ‰¾æœ€ä½ä»·çš„â€œåœ°ç‹±çº§éš¾åº¦â€

é—®é¢˜æ‰€åœ¨ï¼š å¯»æ‰¾æœ€ä½³äº¤æ˜“ä»·æ ¼éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å»å¤šä¸ªå¹³å°è¿›è¡Œæ¯”è¾ƒã€‚åœ¨å¸‚åœºå¿«é€Ÿæ³¢åŠ¨æ—¶ï¼Œè¿™ç§æ‰‹åŠ¨æ“ä½œä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”ä¼šé”™å¤±è‰¯æœºã€‚
JUP çš„è§£å†³æ–¹æ¡ˆï¼š JUP ç®—æ³•å…¨è‡ªåŠ¨å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œåœ¨æ¯«ç§’çº§å†…é”å®šæœ€ä½ä»·ã€‚å®ƒç”šè‡³èƒ½è§„åˆ’å¤šæ­¥è·³è·ƒäº¤æ˜“ï¼ˆä¾‹å¦‚ï¼šç”¨ SOL æ¢ USDCï¼Œå†ç”¨ USDC æ¢ç›®æ ‡å¸ï¼‰ï¼Œä»¥é¿å¼€æŸäº›æµåŠ¨æ€§ä¸ä½³çš„äº¤æ˜“å¯¹ï¼Œä»è€Œæ‰¾åˆ°æœ€ä¼˜è§£ã€‚

JUP çš„é«˜æ€§èƒ½ç§˜å¯†æ­¦å™¨ï¼šRust ä¸ Solana çš„åŸå­æ€§
JUP èƒ½å¤Ÿåœ¨é«˜é¢‘äº¤æ˜“åœºæ™¯ä¸­ç¨³å®šè¿è¡Œï¼Œç¦»ä¸å¼€ Rust è¯­è¨€å’Œ Solana åº•å±‚æ¶æ„çš„æ”¯æ’‘ã€‚è¿™æ˜¯ JUP ç›¸è¾ƒäº EVM é“¾èšåˆå™¨çš„æ ¸å¿ƒæŠ€æœ¯ä¼˜åŠ¿ã€‚
1. ç®—æ³•æ ¸å¿ƒï¼šå¤šè·¯å¾„ã€å¹¿åº¦ä¼˜å…ˆçš„æœ€ä¼˜è·¯ç”±
JUP çš„ç®—æ³•ç±»ä¼¼äºä¸€ä¸ªå¤æ‚çš„ GPS å¯¼èˆªç³»ç»Ÿï¼Œè‡´åŠ›äºå¯»æ‰¾èƒ½æä¾›æœ€å¤§äº§å‡ºé‡çš„äº¤æ˜“è·¯å¾„ã€‚

å®æ—¶å›¾è°±ï¼š JUP å®æ—¶è¿½è¸ª Solana ä¸Šæ‰€æœ‰ DEX çš„æµåŠ¨æ€§çŠ¶æ€ï¼Œå°†å®ƒä»¬è§†ä¸ºä¸€ä¸ªå·¨å¤§çš„ç½‘ç»œå›¾ã€‚
äº¤æ˜“æ‹†åˆ†ä¸ç»„åˆï¼š ç®—æ³•ä¸ä¼šå°†ä½ çš„èµ„é‡‘è§†ä¸ºå•ä¸€æ•´ä½“ã€‚å®ƒä¼šå°è¯•å°†ä½ çš„äº¤æ˜“æ™ºèƒ½æ‹†åˆ†æˆå¤šä»½ï¼Œå¹¶è®¡ç®—å‡ºæ‰€æœ‰å¯èƒ½çš„å¤šæ­¥è·¯å¾„ç»„åˆï¼ˆä¾‹å¦‚ï¼šå°†ä¸€ç¬” SOL äº¤æ˜“ï¼Œæ‹†åˆ†æˆ A éƒ¨åˆ†èµ° Orca â†’ B è·¯å¾„ï¼ŒB éƒ¨åˆ†èµ° Raydium â†’ C è·¯å¾„ï¼‰ã€‚
å®æ—¶è®¡ç®—ä¸ä¼˜åŒ–ï¼š ç®—æ³•å¯¹æ¯æ¡è·¯å¾„è¿›è¡Œå®æ—¶æŠ¥ä»·ï¼Œå¹¶çº³å…¥æ»‘ç‚¹å½±å“ï¼Œæœ€ç»ˆç¡®å®šèƒ½è®©ä½ è·å¾—æœ€å¤šç›®æ ‡ä»£å¸çš„é‚£ä¸ªè·¯å¾„ç»„åˆã€‚

2. Rust å¸¦æ¥çš„è®¡ç®—æ•ˆç‡

é«˜æ€§èƒ½å¼•æ“ï¼š JUP çš„èšåˆç®—æ³•æ˜¯ç”¨ Rust ç¼–å†™çš„ã€‚Rust çš„å†…å­˜å®‰å…¨å’Œæé«˜çš„è¿è¡Œæ—¶æ•ˆç‡ï¼Œä½¿å¾— JUP èƒ½å¤Ÿæ‰¿å—å·¨å¤§çš„è®¡ç®—é‡ï¼Œåœ¨ Solana æä½çš„å»¶è¿Ÿä¸‹ï¼Œå¿«é€Ÿå®Œæˆå¤æ‚çš„è·¯å¾„æœç´¢å’Œè®¡ç®—ã€‚
ä¸šåŠ¡ä»·å€¼ï¼š é€Ÿåº¦æ˜¯ä¿éšœã€‚åªæœ‰å¿«é€Ÿè®¡ç®—æ‰èƒ½ç¡®ä¿æŠ¥ä»·çš„å‡†ç¡®æ€§ï¼Œé˜²æ­¢å¸‚åœºåœ¨è®¡ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿå˜åŒ–ã€‚

3. Solana çš„åŸå­æ€§äº‹åŠ¡ä¿è¯äº¤æ˜“å®‰å…¨

æ ¸å¿ƒå®ç°ï¼š JUP æœ€é‡è¦çš„æŠ€æœ¯å®ç°ï¼Œæ˜¯åˆ©ç”¨ Solana çš„äº‹åŠ¡ï¼ˆTransactionï¼‰æ¨¡å‹ï¼Œå°†å¤æ‚çš„å¤šæ­¥äº¤æ˜“è·¯å¾„ï¼ˆæ¶‰åŠå¤šä¸ª DEX çš„ä¹°å…¥å’Œå–å‡ºï¼‰æ‰“åŒ…æˆä¸€ä¸ªå•ä¸€çš„ Solana äº‹åŠ¡ã€‚
å®‰å…¨ä¿è¯ï¼š åŸå­æ€§ï¼ˆAtomicï¼‰ æ„å‘³ç€ï¼šè¦ä¹ˆäº¤æ˜“è·¯å¾„ä¸Šçš„æ¯ä¸€æ­¥æŒ‡ä»¤éƒ½æˆåŠŸæ‰§è¡Œï¼Œäº¤æ˜“æ‰ç®—å®Œæˆï¼›è¦ä¹ˆæ•´ä¸ªäº‹åŠ¡å¤±è´¥å¹¶å®‰å…¨åœ°å›æ»šæ‰€æœ‰èµ„é‡‘ã€‚è¿™æœ‰æ•ˆé¿å…äº†åœ¨å¤šæ­¥äº¤æ˜“ä¸­ï¼Œå› æŸä¸€ç¯èŠ‚å¤±è´¥è€Œå¯¼è‡´ç”¨æˆ·èµ„äº§è¢«å›°æˆ–æŸå¤±çš„é£é™©ã€‚

è¶…è¶Šèšåˆï¼šJUP çš„ç”Ÿæ€é‡å¿ƒ
ä½œä¸º Solana çš„åŸºç¡€è®¾æ–½ï¼ŒJUP å¹¶æ²¡æœ‰æ­¢æ­¥äºäº¤æ˜“èšåˆï¼Œå®ƒæ­£åœ¨å‘ â€œDeFi è¶…çº§åº”ç”¨â€ å‘å±•ï¼š

å…ˆè¿›çš„äº¤æ˜“åŠŸèƒ½ï¼š æä¾›**é™ä»·å•ï¼ˆLimit Ordersï¼‰å’Œå®šæœŸå®šæŠ•ï¼ˆDCAï¼‰**ç­‰ï¼Œå°†ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„ä¸“ä¸šåŠŸèƒ½å¸¦åˆ°é“¾ä¸Šï¼Œè¿›ä¸€æ­¥æå‡äº†ç”¨æˆ·ä½“éªŒã€‚
LFG Launchpadï¼š ä½œä¸º Solana é¡¹ç›®çš„å¯åŠ¨å¹³å°ï¼ŒJUP æ­£åœ¨æˆä¸ºç”Ÿæ€ç³»ç»Ÿæ–°è¡€æ¶²æ¶Œå…¥çš„å…³é”®é—¨æˆ·ã€‚
JUP Token ä¸æ²»ç†ï¼š JUP ä»£å¸ä¸ä»…æ˜¯æ¿€åŠ±æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œæ›´æ˜¯å¹³å°çš„æ²»ç†æƒåŠ›ã€‚å®ƒç¡®ä¿äº† JUP çš„å‘å±•å’Œå‡çº§ç”±ç¤¾åŒºé©±åŠ¨ã€‚

æ‰€ä»¥ä½ è®¤ä¸º JUP çš„ä¸‹ä¸€ä¸ªåˆ›æ–°ç‚¹ä¼šæ˜¯ä»€ä¹ˆï¼Ÿå®ƒå¯¹ Solana ç”Ÿæ€çš„å“ªä¸ªèµ›é“ï¼ˆGameFi, DePIN, etc.ï¼‰å½±å“æœ€å¤§å‘¢ï¼Ÿ
]]></content>
      <categories>
        <category>Eco Insights</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>DeFi</tag>
        <tag>JUP</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part1]_SOLåŸºç¡€</title>
    <url>/2025/08/04/Solana-part1-SOL%E4%B8%AD%E7%9A%84Rust%E6%BA%90%E7%A0%81%E6%A6%82%E8%A7%88%EF%BC%8C%E4%BB%A5%E5%8F%8ARust%E5%9C%A8%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[Solana[part1]_SOLåŸºç¡€
ä¸€ã€Solanaæ¦‚è¿°
Solanaæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å…¬é“¾ç³»ç»Ÿï¼Œæ ¸å¿ƒç‰¹ç‚¹ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

å…±è¯†åè®®ï¼šé‡‡ç”¨ç‹¬ç‰¹çš„å†å²è¯æ˜ï¼ˆPOHï¼‰ä¸æƒç›Šè¯æ˜ï¼ˆPoSï¼‰ç»“åˆçš„å…±è¯†æœºåˆ¶ï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸é«˜æ•ˆæ€§ã€‚
é«˜æ€§èƒ½æ¶æ„ï¼šé€šè¿‡ä¼˜åŒ–æ•°æ®ä¼ è¾“ã€å¹¶è¡Œå¤„ç†ç­‰æŠ€æœ¯ï¼Œæ”¯æŒæ¯ç§’æ•°ä¸‡ç¬”äº¤æ˜“ï¼ˆTPSï¼‰ï¼Œè¿œè¶…ä¼ ç»Ÿå…¬é“¾ã€‚
é«˜å¹¶å‘å¤„ç†ï¼šé‡‡ç”¨è´¦æˆ·æ¨¡å‹ä¸äº‹åŠ¡éš”ç¦»è®¾è®¡ï¼Œå®ç°å¤šç¬”äº¤æ˜“çš„å¹¶è¡ŒéªŒè¯ä¸æ‰§è¡Œã€‚
ä½å»¶è¿Ÿï¼šå¾—ç›ŠäºPOHçš„æ—¶é—´æˆ³æœºåˆ¶ï¼Œäº¤æ˜“ç¡®è®¤å»¶è¿Ÿå¯ä½è‡³ç§’çº§ã€‚

1.1 æ ¸å¿ƒæ¨¡å—

Runtimeæ¨¡å—ï¼šä½œä¸ºSolanaçš„è¿è¡Œæ—¶æ ¸å¿ƒï¼Œè´Ÿè´£ç®¡ç†æ‰€æœ‰è´¦æˆ·çš„çŠ¶æ€ï¼ˆåŒ…æ‹¬ä½™é¢ã€æ•°æ®å­˜å‚¨ç­‰ï¼‰ï¼Œå¹¶è°ƒåº¦æ™ºèƒ½åˆçº¦çš„æ‰§è¡Œæµç¨‹ï¼Œç¡®ä¿äº¤æ˜“æŒ‰è§„åˆ™æœ‰åºå¤„ç†ã€‚
Programsæ¨¡å—ï¼šå³Solanaçš„æ™ºèƒ½åˆçº¦å±‚ï¼ŒåŒ…å«å¤šä¸ªæ ¸å¿ƒç¨‹åºï¼š

Token Programï¼šSolanaç”Ÿæ€ä¸­ä»£å¸å‘è¡Œã€è½¬è´¦ã€æˆæƒçš„åŸºç¡€ç¨‹åºï¼Œå…¼å®¹SPLæ ‡å‡†ä»£å¸ï¼ˆç±»ä¼¼ä»¥å¤ªåŠçš„ERC-20ï¼‰ã€‚
Stake Programï¼šç”¨äºéªŒè¯èŠ‚ç‚¹çš„è´¨æŠ¼ç®¡ç†ï¼Œæ”¯æŒSOLä»£å¸è´¨æŠ¼ã€è§£é™¤è´¨æŠ¼åŠæ”¶ç›Šåˆ†é…ç­‰æ“ä½œã€‚



1.2 Ruståœ¨Solanaä¸­çš„åº”ç”¨
Rustæ˜¯Solanaæ™ºèƒ½åˆçº¦å¼€å‘çš„é¦–é€‰è¯­è¨€ï¼Œæ ¸å¿ƒåŸå› åŒ…æ‹¬ï¼š

å†…å­˜å®‰å…¨æ€§ï¼šRustçš„æ‰€æœ‰æƒæœºåˆ¶å’Œå€Ÿç”¨æ£€æŸ¥å™¨å¯é¿å…ç©ºæŒ‡é’ˆã€ç¼“å†²åŒºæº¢å‡ºç­‰å†…å­˜é”™è¯¯ï¼Œç¡®ä¿æ™ºèƒ½åˆçº¦åœ¨å»ä¸­å¿ƒåŒ–ç¯å¢ƒä¸­ç¨³å®šè¿è¡Œã€‚
é«˜æ€§èƒ½ï¼šç¼–è¯‘å‹è¯­è¨€ç‰¹æ€§ä½¿Rustä»£ç æ‰§è¡Œæ•ˆç‡æ¥è¿‘C/C++ï¼Œé€‚é…Solanaé«˜TPSçš„æ€§èƒ½éœ€æ±‚ã€‚
ç±»å‹å®‰å…¨ï¼šå¼ºç±»å‹ç³»ç»Ÿå‡å°‘è¿è¡Œæ—¶é”™è¯¯ï¼Œé™ä½æ™ºèƒ½åˆçº¦æ¼æ´é£é™©ï¼ˆå¦‚é€»è¾‘æ¼æ´ã€é‡å…¥æ”»å‡»ç­‰ï¼‰ã€‚
ç”Ÿæ€é€‚é…ï¼šSolanaæä¾›äº†å®Œæ•´çš„Rustå¼€å‘å·¥å…·é“¾ï¼ˆå¦‚Anchoræ¡†æ¶ï¼‰ï¼Œç®€åŒ–åˆçº¦ç¼–å†™ã€æµ‹è¯•ä¸éƒ¨ç½²æµç¨‹ã€‚

äºŒã€SOLåœ¨åŒºå—é“¾ç”Ÿæ€ç³»ç»Ÿä¸­çš„åœ°ä½

é«˜æ€§èƒ½æ ‡æ†ï¼šSolanaä»¥é«˜TPSå’Œä½å»¶è¿Ÿæˆä¸ºå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆdAPPï¼‰çš„é‡è¦è½½ä½“ï¼Œå°¤å…¶é€‚åˆé«˜é¢‘äº¤æ˜“ã€æ¸¸æˆã€DeFiç­‰å¯¹æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ã€‚
ç”Ÿæ€æ‰©å±•æ€§ï¼šæ”¯æŒNFTã€DeFiã€Web3åº”ç”¨ç­‰å¤šå…ƒåœºæ™¯ï¼Œæ‹¥æœ‰å¤§é‡å¼€å‘è€…å·¥å…·ï¼ˆå¦‚Phantomé’±åŒ…ã€SolscanåŒºå—æµè§ˆå™¨ï¼‰å’ŒåŸºç¡€è®¾æ–½ã€‚
å¸‚åœºè®¤å¯åº¦ï¼šSOLä½œä¸ºå…¶åŸç”Ÿä»£å¸ï¼Œæ˜¯å¸‚å€¼æ’åå‰åˆ—çš„åŠ å¯†èµ„äº§ï¼Œå¹¿æ³›ç”¨äºæ”¯ä»˜æ‰‹ç»­è´¹ã€è´¨æŠ¼éªŒè¯èŠ‚ç‚¹åŠç”Ÿæ€å†…ä»·å€¼æµè½¬ã€‚

ä¸‰ã€SOLçš„å†å²ã€æœªæ¥åŠå‘å±•

å†å²é‡Œç¨‹ç¢‘ï¼š

2017å¹´ç”±Anatoly Yakovenkoåˆ›ç«‹ï¼Œæ ¸å¿ƒå›¢é˜Ÿå¤šæ¥è‡ªé«˜é€šã€è‹±ç‰¹å°”ç­‰ç§‘æŠ€å…¬å¸ã€‚
2020å¹´ä¸»ç½‘ä¸Šçº¿ï¼Œå‡­å€ŸPOHæŠ€æœ¯è¿…é€Ÿè·å¾—å…³æ³¨ã€‚
2021-2022å¹´ç”Ÿæ€çˆ†å‘ï¼ŒNFTå’ŒDeFié¡¹ç›®å¿«é€Ÿå¢é•¿ï¼Œæˆä¸ºä¸»æµå…¬é“¾ä¹‹ä¸€ã€‚


æœªæ¥æ–¹å‘ï¼š

è¿›ä¸€æ­¥ä¼˜åŒ–å…±è¯†æœºåˆ¶ï¼Œæå‡å»ä¸­å¿ƒåŒ–ç¨‹åº¦ï¼ˆå¦‚å‡å°‘éªŒè¯èŠ‚ç‚¹é—¨æ§›ï¼‰ã€‚
æ‰©å±•è·¨é“¾äº’æ“ä½œæ€§ï¼Œæ”¯æŒä¸ä»¥å¤ªåŠã€Avalancheç­‰å…¬é“¾çš„èµ„äº§ä¸æ•°æ®äº¤äº’ã€‚
é™ä½å¼€å‘é—¨æ§›ï¼Œå¸å¼•æ›´å¤šå¼€å‘è€…å‚ä¸ç”Ÿæ€å»ºè®¾ã€‚



å››ã€SOLçš„æ¶æ„å’Œå¸¸è§åè¯æ¦‚å¿µ
4.1 å¸¸è§æ¦‚å¿µ

accountsï¼ˆè´¦æˆ·ï¼‰ï¼šSolanaä¸­æ•°æ®å­˜å‚¨çš„åŸºæœ¬å•å…ƒï¼Œä¸ä»…åŒ…å«é’±åŒ…åœ°å€ï¼ˆå¦‚solfareã€Backpackç­‰é’±åŒ…ç®¡ç†çš„è´¦æˆ·ï¼‰ï¼Œè¿˜å­˜å‚¨æ™ºèƒ½åˆçº¦æ•°æ®ã€ä»£å¸ä½™é¢ç­‰ä¿¡æ¯ã€‚æ¯ä¸ªè´¦æˆ·æœ‰å”¯ä¸€çš„å…¬é’¥ï¼ˆaddressï¼‰ï¼Œéœ€æ”¯ä»˜ç§Ÿçº¦è´¹ç”¨ä»¥ç»´æŒå­˜å‚¨ã€‚
åˆçº¦ï¼ˆProgramsï¼‰ï¼šå³æ™ºèƒ½åˆçº¦ï¼Œç”±Rustç¼–å†™å¹¶ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œéƒ¨ç½²åé€šè¿‡äº¤æ˜“è§¦å‘æ‰§è¡Œï¼Œä¿®æ”¹è´¦æˆ·çŠ¶æ€ã€‚
éªŒè¯å™¨ï¼ˆValidatorï¼‰ï¼šç»´æŠ¤Solanaç½‘ç»œçš„èŠ‚ç‚¹ï¼Œè´Ÿè´£éªŒè¯äº¤æ˜“ã€ç”ŸæˆåŒºå—å¹¶å‚ä¸å…±è¯†ï¼Œé€šè¿‡è´¨æŠ¼SOLè·å¾—å‡ºå—æƒé™å’Œå¥–åŠ±ã€‚
åŒºå—æµè§ˆå™¨ï¼šç”¨äºæŸ¥è¯¢äº¤æ˜“ã€è´¦æˆ·ã€åŒºå—ç­‰ä¿¡æ¯çš„å·¥å…·ï¼ˆå¦‚Solscanã€Solana Explorerï¼‰ï¼Œæ”¯æŒä¸»ç½‘ã€æµ‹è¯•ç½‘ï¼ˆdevnet/testnetï¼‰æŸ¥è¯¢ã€‚
addressï¼ˆåœ°å€ï¼‰ï¼šè´¦æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”±å…¬é’¥ç”Ÿæˆï¼ˆé€šå¸¸ä¸ºBase58ç¼–ç çš„å­—ç¬¦ä¸²ï¼‰ï¼Œç”¨äºæ¥æ”¶è½¬è´¦æˆ–æ ‡è¯†åˆçº¦ã€‚
transferï¼ˆè½¬è´¦ï¼‰ï¼šé€šè¿‡äº¤æ˜“å°†SOLæˆ–SPLä»£å¸ä»ä¸€ä¸ªè´¦æˆ·è½¬ç§»åˆ°å¦ä¸€ä¸ªè´¦æˆ·ï¼Œéœ€æ”¯ä»˜æ‰‹ç»­è´¹ï¼ˆfeeï¼‰ã€‚
dAPPï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼‰ï¼šåŸºäºSolanaå…¬é“¾å¼€å‘çš„åº”ç”¨ï¼Œå¦‚å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰ã€NFTå¸‚åœºç­‰ï¼Œä¾èµ–æ™ºèƒ½åˆçº¦å®ç°é€»è¾‘ã€‚
feeï¼ˆæ‰‹ç»­è´¹ï¼‰ï¼šç”¨æˆ·å‘èµ·äº¤æ˜“æ—¶æ”¯ä»˜ç»™éªŒè¯èŠ‚ç‚¹çš„è´¹ç”¨ï¼Œå–å†³äºäº¤æ˜“å¤æ‚åº¦å’Œç½‘ç»œæ‹¥å µç¨‹åº¦ã€‚
blockï¼ˆåŒºå—ï¼‰ï¼šéªŒè¯èŠ‚ç‚¹æ‰“åŒ…äº¤æ˜“çš„é›†åˆï¼ŒåŒ…å«å¤šä¸ªäº¤æ˜“åŠPOHæ—¶é—´æˆ³ï¼Œç¡®ä¿äº¤æ˜“é¡ºåºå¯è¿½æº¯ã€‚
ç§Ÿçº¦ï¼ˆrentï¼‰ï¼šSolanaé€šè¿‡ç§Ÿçº¦æœºåˆ¶ç»´æŒè´¦æˆ·å­˜å‚¨ï¼Œè´¦æˆ·ä½™é¢é«˜äºé˜ˆå€¼æ—¶å¯å…ç§Ÿï¼Œå¦åˆ™ä¼šè¢«å›æ”¶ã€‚
ç­¾åï¼ˆsignatureï¼‰ï¼šäº¤æ˜“å‘èµ·è€…ç”¨ç§é’¥å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œè¯æ˜äº¤æ˜“åˆæ³•æ€§ï¼ŒéªŒè¯èŠ‚ç‚¹é€šè¿‡å…¬é’¥éªŒè¯ç­¾åã€‚
é’±åŒ…ï¼ˆwalletï¼‰ï¼šç®¡ç†è´¦æˆ·ç§é’¥çš„å·¥å…·ï¼Œæ”¯æŒç”Ÿæˆåœ°å€ã€ç­¾åäº¤æ˜“ã€æŸ¥è¯¢ä½™é¢ç­‰åŠŸèƒ½ï¼ˆå¦‚Phantomã€Solflareï¼‰ã€‚

4.2 8å¤§æ ¸å¿ƒæŠ€æœ¯

POHï¼ˆå†å²è¯æ˜ï¼‰ï¼šSolanaçš„åˆ›æ–°æ—¶é—´æˆ³æœºåˆ¶ï¼Œé€šè¿‡å“ˆå¸Œé“¾è®°å½•äº‹ä»¶é¡ºåºï¼Œæ— éœ€å…¨èŠ‚ç‚¹åŒæ­¥å³å¯ç¡®å®šäº¤æ˜“å…ˆåï¼Œå¤§å¹…æå‡å…±è¯†æ•ˆç‡ã€‚
Turbineï¼ˆæ¶¡è½®æœºï¼‰ï¼šæ•°æ®ä¼ è¾“åè®®ï¼Œå°†åŒºå—æ•°æ®åˆ†ç‰‡å¹¶é€šè¿‡èŠ‚ç‚¹ç½‘ç»œå¹¶è¡Œä¼ è¾“ï¼Œè§£å†³å¤§åŒºå—åŒæ­¥ç“¶é¢ˆã€‚
Gulf Streamï¼ˆæ¹¾æµï¼‰ï¼šäº¤æ˜“é¢„æ‰§è¡Œæœºåˆ¶ï¼ŒéªŒè¯èŠ‚ç‚¹åœ¨æ”¶åˆ°äº¤æ˜“å‰æå‰ç¼“å­˜å¹¶é¢„æ‰§è¡Œï¼Œå‡å°‘ç¡®è®¤å»¶è¿Ÿã€‚
Sealevelï¼šå¹¶è¡Œäº¤æ˜“å¤„ç†å¼•æ“ï¼Œæ”¯æŒå¤šç¬”ä¸å†²çªçš„äº¤æ˜“åŒæ—¶æ‰§è¡Œï¼ˆåŸºäºè´¦æˆ·éš”ç¦»ï¼‰ï¼Œæå‡TPSã€‚
Pipeliningï¼ˆæµæ°´çº¿ï¼‰ï¼šå°†äº¤æ˜“å¤„ç†æ‹†åˆ†ä¸ºâ€œéªŒè¯-æ‰§è¡Œ-æ‰“åŒ…â€ç­‰é˜¶æ®µï¼Œé€šè¿‡æµæ°´çº¿å¹¶è¡Œå¤„ç†ï¼Œä¼˜åŒ–èŠ‚ç‚¹èµ„æºåˆ©ç”¨ç‡ã€‚
Cloudbreakï¼šå­˜å‚¨ä¼˜åŒ–æŠ€æœ¯ï¼Œå°†å†å²æ•°æ®å‹ç¼©å¹¶åˆ†å¸ƒå¼å­˜å‚¨ï¼Œé™ä½å…¨èŠ‚ç‚¹å­˜å‚¨æˆæœ¬ã€‚
Reed-Solomonï¼šæ•°æ®å†—ä½™ç¼–ç ç®—æ³•ï¼Œé€šè¿‡çº é”™ç ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“æˆ–å­˜å‚¨ä¸­å‘ç”Ÿé”™è¯¯æ—¶å¯æ¢å¤ï¼Œæå‡ç½‘ç»œå¥å£®æ€§ã€‚
Archiversï¼ˆå½’æ¡£èŠ‚ç‚¹ï¼‰ï¼šä¸“é—¨å­˜å‚¨å†å²åŒºå—æ•°æ®çš„èŠ‚ç‚¹ï¼Œå‡è½»éªŒè¯èŠ‚ç‚¹çš„å­˜å‚¨å‹åŠ›ï¼Œç¡®ä¿é“¾ä¸Šæ•°æ®å¯è¿½æº¯ã€‚

äº”ã€æœ¬åœ°ç¯å¢ƒæ­å»º
5.1 ç¯å¢ƒå‡†å¤‡


å®‰è£…ä¾èµ–å·¥å…·ï¼š

macOSï¼šå®‰è£…Xcodeå‘½ä»¤è¡Œå·¥å…·

  xcode-select --install  # å®‰è£…å·¥å…·é“¾
xcode-select -p  # éªŒè¯å®‰è£…ï¼ˆè¾“å‡ºè·¯å¾„å³æˆåŠŸï¼‰

Windowsï¼šé€šè¿‡WSLï¼ˆWindows Subsystem for Linuxï¼‰æ¨¡æ‹ŸLinuxç¯å¢ƒï¼Œå†æ‰§è¡Œåç»­æ­¥éª¤ã€‚



å®‰è£…Rustï¼š
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh  # ä¸‹è½½å®‰è£…è„šæœ¬
source $HOME/.cargo/env  # é…ç½®ç¯å¢ƒå˜é‡
rustc --version  # éªŒè¯å®‰è£…


å®‰è£…Solana CLIï¼š
å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://solana.com/zh/docs/intro/installation#å®‰è£…-solana-cli
sh -c "$(curl -sSfL https://release.solana.com/v1.18.4/install)"  # å®‰è£…æŒ‡å®šç‰ˆæœ¬
solana --version  # éªŒè¯å®‰è£…


å®‰è£…Anchoræ¡†æ¶ï¼ˆæ™ºèƒ½åˆçº¦å¼€å‘å·¥å…·ï¼‰ï¼š
å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://solana.com/zh/docs/intro/installation#å®‰è£…-anchor-cli
cargo install --git https://github.com/coral-xyz/anchor avm --locked --force  # å®‰è£…AVMï¼ˆAnchorç‰ˆæœ¬ç®¡ç†å™¨ï¼‰
avm install latest  # å®‰è£…æœ€æ–°ç‰ˆAnchor
avm use latest  # å¯ç”¨æœ€æ–°ç‰ˆ
é…ç½®ç¯å¢ƒå˜é‡ï¼ˆä»¥zshä¸ºä¾‹ï¼‰ï¼š
echo 'export PATH="$HOME/.avm/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc  # ç”Ÿæ•ˆé…ç½®
anchor --version  # éªŒè¯å®‰è£…


5.2 åˆ›å»ºé’±åŒ…
solana-keygen new  # åˆ›å»ºé»˜è®¤é’±åŒ…ï¼ˆè·¯å¾„ï¼š~/.config/solana/id.jsonï¼‰
æ‰§è¡Œåè¾“å…¥å¯†ç ï¼ˆBIP39 Passphraseï¼‰ï¼Œå®Œæˆåç”Ÿæˆç§é’¥æ–‡ä»¶ï¼ˆç”¨äºç­¾åäº¤æ˜“ï¼‰å’Œå…¬é’¥ï¼ˆé’±åŒ…åœ°å€ï¼‰ã€‚
5.3 åˆ‡æ¢è‡³Devnetï¼ˆæµ‹è¯•ç½‘ï¼‰
Solanaæœ‰ä¸»ç½‘ï¼ˆMainnetï¼‰ã€æµ‹è¯•ç½‘ï¼ˆDevnetï¼‰ã€å¼€å‘ç½‘ï¼ˆTestnetï¼‰ï¼Œå¼€å‘é˜¶æ®µå»ºè®®ä½¿ç”¨Devnetï¼š
solana config set -ud  # åˆ‡æ¢è‡³Devnet
solana config get  # éªŒè¯é…ç½®ï¼ˆRPC URLæ˜¾ç¤ºhttps://api.devnet.solana.comå³ä¸ºæˆåŠŸï¼‰
5.4 è·å–æµ‹è¯•SOLï¼ˆç©ºæŠ•ï¼‰
Devnetçš„SOLå¯é€šè¿‡ç©ºæŠ•è·å–ï¼Œç”¨äºæµ‹è¯•äº¤æ˜“ï¼š
solana airdrop 5  # å‘é»˜è®¤é’±åŒ…ç©ºæŠ•5ä¸ªSOL
è‹¥æç¤ºâ€œrate limit reachedâ€ï¼Œå¯ç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•ï¼Œæˆ–æŒ‡å®šå…¶ä»–é’±åŒ…åœ°å€ï¼š
solana airdrop 5 &lt;é’±åŒ…å…¬é’¥>  # å‘æŒ‡å®šé’±åŒ…ç©ºæŠ•
å…­ã€Solana CLIå¸¸è§ç”¨æ³•
6.1 åˆ›å»ºå¤šä¸ªé’±åŒ…
# åˆ›å»ºé’±åŒ…1ï¼ˆè·¯å¾„ï¼š~/wallets/wallet1.jsonï¼‰
solana-keygen new -o ~/wallets/wallet1.json

# åˆ›å»ºé’±åŒ…2
solana-keygen new -o ~/wallets/wallet2.json

# åˆ›å»ºå¸¦å¯†ç çš„é’±åŒ…3ï¼ˆ--forceå¼ºåˆ¶è¦†ç›–åŒåæ–‡ä»¶ï¼Œè°¨æ…ä½¿ç”¨ï¼‰
solana-keygen new -o ~/wallets/wallet3.json --force
6.2 é¢†å–ç©ºæŠ•è‡³æŒ‡å®šé’±åŒ…
# å‘wallet2ç©ºæŠ•0.5ä¸ªSOLï¼ˆå…ˆé€šè¿‡pubkeyå‘½ä»¤è·å–é’±åŒ…å…¬é’¥ï¼‰
solana airdrop 0.5 $(solana-keygen pubkey ~/wallets/wallet2.json)
6.3 é’±åŒ…é—´è½¬è´¦
# ä»é»˜è®¤é’±åŒ…å‘ç›®æ ‡åœ°å€è½¬è´¦ï¼ˆç¤ºä¾‹ï¼‰
solana transfer --from ~/.config/solana/id.json &lt;ç›®æ ‡é’±åŒ…å…¬é’¥> 0.3  # è½¬è´¦0.3 SOL
å‚æ•°è¯´æ˜ï¼š--fromæŒ‡å®šè½¬å‡ºé’±åŒ…è·¯å¾„ï¼Œæœ€åä¸€ä¸ªæ•°å­—ä¸ºè½¬è´¦é‡‘é¢ï¼ˆSOLï¼‰ã€‚
6.4 æŸ¥çœ‹è´¦æˆ·ä½™é¢
# æŸ¥çœ‹æŒ‡å®šé’±åŒ…ä½™é¢
solana balance &lt;é’±åŒ…å…¬é’¥>
# ç¤ºä¾‹è¾“å‡ºï¼š0.9 SOL
6.5 æŸ¥è¯¢äº¤æ˜“è®°å½•
é€šè¿‡åŒºå—æµè§ˆå™¨æŸ¥è¯¢äº¤æ˜“è¯¦æƒ…ï¼Œä¾‹å¦‚Devnetçš„äº¤æ˜“å¯è®¿é—®ï¼š  https://solscan.io/tx/&lt;äº¤æ˜“ID&gt;?cluster=devnet
ï¼ˆå°†&lt;äº¤æ˜“ID&gt;æ›¿æ¢ä¸ºå®é™…äº¤æ˜“å“ˆå¸Œï¼Œå¯é€šè¿‡solana transferå‘½ä»¤çš„è¾“å‡ºè·å–ï¼‰
https://solscan.io/tx/3pnyEXnDJcyCZo2VBzunRRveu1siXmAJmjpGrC4TdrkbAfvLGaioC7Amnum6YoorioBUVMxgQe3VcW3UGpoJskh6?cluster=devnet

]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part10]_Anchorå®æˆ˜ï¼šåˆ›å»ºç”¨æˆ·profile</title>
    <url>/2025/08/14/Solana-part10-anchor%E5%AE%9E%E6%88%981/</url>
    <content><![CDATA[Solana[part10]_Anchorå®æˆ˜ï¼šåˆ›å»ºç”¨æˆ·profile
ä¸€ã€é¡¹ç›®æ¶æ„æ¦‚è§ˆ
1.1 æ•´ä½“æ¶æ„
anchor_social&#x2F;
â”œâ”€â”€ programs&#x2F;               # Solana æ™ºèƒ½åˆçº¦æºä»£ç 
â”‚   â””â”€â”€ anchor_social&#x2F;      # æ ¸å¿ƒåˆçº¦æ¨¡å—
â”‚       â”œâ”€â”€ src&#x2F;              # Rust æºä»£ç 
â”‚       â”‚   â”œâ”€â”€ lib.rs        # ç¨‹åºå…¥å£å’ŒæŒ‡ä»¤è·¯ç”±
â”‚       â”‚   â”œâ”€â”€ instructions&#x2F; # æŒ‡ä»¤å¤„ç†é€»è¾‘
â”‚       â”‚   â””â”€â”€ state&#x2F;        # é“¾ä¸ŠçŠ¶æ€å®šä¹‰
â”‚       â””â”€â”€ Cargo.toml        # Rust é¡¹ç›®é…ç½®
â”œâ”€â”€ app&#x2F;                    # å‰ç«¯äº¤äº’ä»£ç 
â”‚   â”œâ”€â”€ api&#x2F;                  # API æ¥å£æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ wallet.ts         # é’±åŒ…ç®¡ç†
â”‚   â”‚   â””â”€â”€ profile.ts        # ç”¨æˆ·èµ„æ–™æ¥å£
â”‚   â””â”€â”€ index.ts            # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ tests&#x2F;                  # æµ‹è¯•æ¨¡å—
â”œâ”€â”€ migrations&#x2F;             # åˆçº¦éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ Anchor.toml             # Anchor é¡¹ç›®é…ç½®
â”œâ”€â”€ package.json            # å‰ç«¯ä¾èµ–é…ç½®
â””â”€â”€ tsconfig.json           # TypeScript é…ç½®
1.2 æŠ€æœ¯æ ˆ

åŒºå—é“¾å¹³å°: Solana
å¼€å‘æ¡†æ¶: Anchor v0.31.1
æ™ºèƒ½åˆçº¦è¯­è¨€: Rust
å‰ç«¯äº¤äº’: TypeScript
ä¾èµ–ç®¡ç†:

å‰ç«¯: yarn
åˆçº¦: Cargo



äºŒã€æ ¸å¿ƒæ¨¡å—è¯¦è§£
2.1 æ™ºèƒ½åˆçº¦æ¨¡å— (programs/anchor_social)
2.1.1 ç¨‹åºå…¥å£ (lib.rs)
declare_id!("35vQtxXXv5rb99eiVrVVrwYMRYc7vscZvXas8zjEnnK5");

pub mod instructions;
pub mod state;
use instructions::*;

#[program]
pub mod anchor_social &#123;
    use super::*;

    pub fn create_profile(ctx: Context&lt;CreateProfile>, display_name: String) -> Result&lt;()> &#123;
        instructions::profile::create_profile(ctx, display_name)
    &#125;
&#125;

declare_id!: å®šä¹‰ç¨‹åºåœ°å€
#[program]: Anchor å®æ ‡è®°ç¨‹åºå…¥å£
æŒ‡ä»¤è·¯ç”±: å°† create_profile æŒ‡ä»¤è·¯ç”±åˆ° instructions æ¨¡å—

2.1.2 æŒ‡ä»¤å¤„ç† (instructions/profile.rs)
pub fn create_profile(ctx: Context&lt;CreateProfile>, display_name: String) -> Result&lt;()> &#123;
    ctx.accounts.profile.display_name = display_name;
    Ok(())
&#125;

#[derive(Accounts)]
pub struct CreateProfile&lt;'info> &#123;
    #[account(init, payer = user, space = 8 + Profile::INIT_SPACE, seeds = [Profile::SEED_PREFIX.as_bytes(), user.key().as_ref()], bump)]
    pub profile: Account&lt;'info, Profile>,
    #[account(mut)]
    pub user: Signer&lt;'info>,
    pub system_program: Program&lt;'info, System>,
&#125;

ä¸šåŠ¡é€»è¾‘: ç®€å•è®¾ç½®æ˜¾ç¤ºåç§°
è´¦æˆ·çº¦æŸ:

init: åˆ›å»ºæ–°è´¦æˆ·
payer = user: æŒ‡å®šæ”¯ä»˜è´¦æˆ·
seeds: PDA è®¡ç®—ç§å­
mut: è¡¨ç¤ºå¯å˜è´¦æˆ·



2.1.3 çŠ¶æ€å®šä¹‰ (state/profile.rs)
#[account]
#[derive(InitSpace)]
pub struct Profile &#123;
    #[max_len(20)]
    pub display_name: String,
&#125;
impl Profile &#123;
    pub const SEED_PREFIX: &amp;'static str = "profile";
&#125;

#[account]: æ ‡è®°ä¸ºé“¾ä¸Šè´¦æˆ·ç»“æ„
#[derive(InitSpace)]: è‡ªåŠ¨ç”Ÿæˆç©ºé—´è®¡ç®—ä»£ç 
#[max_len(20)]: å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶

2.2 å‰ç«¯äº¤äº’æ¨¡å— (app/)
2.2.1 é’±åŒ…ç®¡ç† (api/wallet.ts)
// é»˜è®¤é’±åŒ…
export function useDefaultWallet() &#123;
    return anchor.Wallet.local();
&#125;

// è®¿å®¢é’±åŒ…
export function useVisitorWallet() &#123;
    const keypair = anchor.web3.Keypair.fromSecretKey(new Uint8Array([...]));
    return new anchor.Wallet(keypair);
&#125;

é’±åŒ…ç±»å‹:

local(): ä½¿ç”¨æœ¬åœ°ç¯å¢ƒå˜é‡é’±åŒ…
Keypair: é€šè¿‡ç§é’¥åˆ›å»ºå¯†é’¥å¯¹
Wallet: åŒ…è£…ç­¾ååŠŸèƒ½


é‡è¦çº¦æŸ:

éœ€è¦ payer å±æ€§è¿›è¡Œäº¤æ˜“ç­¾å
å¿…é¡»å¤„ç†å¼‚æ­¥ç­¾åæ“ä½œ



2.2.2 ç”¨æˆ·èµ„æ–™æ¥å£ (api/profile.ts)
export async function createProfile(wallet: anchor.Wallet, displayName: string) &#123;
    return await program.methods.createProfile(displayName).accounts(&#123;
        user: wallet.publicKey,
    &#125;)
    .signers([wallet.payer])  // å¿…é¡»æ˜¾å¼ä¼ é€’ç­¾åè€…
    .rpc();
&#125;

export async function getProfile(wallet: anchor.Wallet) &#123;
    const [profilePda,] = anchor.web3.PublicKey.findProgramAddressSync(
        [Buffer.from("profile"), wallet.publicKey.toBuffer()],
        program.programId,
    );
    return await program.account.profile.fetch(profilePda);
&#125;

äº¤æ˜“æ„å»º:

accounts: ç»‘å®šè´¦æˆ·å‚æ•°
signers: æŒ‡å®šé¢å¤–ç­¾åè€…
rpc(): å‘é€äº¤æ˜“


PDA è®¡ç®—:

ä½¿ç”¨ç§å­ç”Ÿæˆç¡®å®šæ€§è´¦æˆ·åœ°å€
ä¿è¯è´¦æˆ·åœ°å€ä¸€è‡´æ€§



2.2.3 ä¸»ç¨‹åºå…¥å£ (index.ts)
const defaultWallet = useDefaultWallet();
const visitorWallet = useVisitorWallet();

// åˆ›å»ºç”¨æˆ·èµ„æ–™
async function createProfiles() &#123;
    try &#123;
        await createProfile(defaultWallet, "Bob");
        await createProfile(visitorWallet, "Alice");
    &#125; catch (error) &#123;
        console.error("åˆ›å»ºèµ„æ–™å¤±è´¥:", error.message);
    &#125;
&#125;

// è·å–ç”¨æˆ·èµ„æ–™
async function fetchProfiles() &#123;
    try &#123;
        console.log("é»˜è®¤é’±åŒ…èµ„æ–™:", await getProfile(defaultWallet));
        console.log("è®¿å®¢é’±åŒ…èµ„æ–™:", await getProfile(visitorWallet));
    &#125; catch (error) &#123;
        console.error("è·å–èµ„æ–™å¤±è´¥:", error.message);
    &#125;
&#125;

å¼‚æ­¥å¤„ç†: ä½¿ç”¨ try-catch æ•è·å¼‚å¸¸
æµç¨‹æ§åˆ¶: åˆ†ç¦»åˆ›å»ºå’ŒæŸ¥è¯¢æ“ä½œ
æ—¥å¿—è®°å½•: è¯¦ç»†è¾“å‡ºæ‰§è¡Œç»“æœ

ä¸‰ã€å…³é”®å®ç°ç»†èŠ‚
3.1 é’±åŒ…ç­¾åæœºåˆ¶
class NodeWallet &#123;
    constructor(payer) &#123;
        this.payer = payer;  // Keypair å®ä¾‹
    &#125;

    async signTransaction(tx) &#123;
        if (isVersionedTransaction(tx)) &#123;
            tx.sign([this.payer]);  // ç‰ˆæœ¬åŒ–äº¤æ˜“
        &#125; else &#123;
            tx.partialSign(this.payer);  // ä¼ ç»Ÿäº¤æ˜“
        &#125;
        return tx;
    &#125;
&#125;

ç­¾åæµç¨‹:

æ£€æµ‹äº¤æ˜“ç‰ˆæœ¬
æ ¹æ®ç‰ˆæœ¬é€‰æ‹©ç­¾åæ–¹å¼
è¿”å›ç­¾ååçš„äº¤æ˜“



3.2 PDA è´¦æˆ·ç”Ÿæˆ
const [profilePda, bump] = PublicKey.findProgramAddressSync(
    [Buffer.from("profile"), wallet.publicKey.toBuffer()],
    program.programId
);

ç”Ÿæˆè§„åˆ™:

ç§å­ç”±å¸¸é‡å’Œç”¨æˆ·åœ°å€ç»„æˆ
ä½¿ç”¨ç¨‹åºIDä½œä¸ºç¨‹åºæ ‡è¯†
ç¡®ä¿åœ°å€å”¯ä¸€æ€§å’Œå¯é¢„æµ‹æ€§



3.3 äº¤æ˜“é”™è¯¯å¤„ç†
try &#123;
    await createProfile(wallet, "Alice");
&#125; catch (error) &#123;
    console.log("é”™è¯¯è¯¦æƒ…:", &#123;
        message: error.message,
        logs: error.logs,  // åŒ…å«é“¾ä¸Šæ—¥å¿—
        errorCode: error.errorCode
    &#125;);
&#125;

é”™è¯¯åˆ†æè¦ç‚¹:

æŸ¥çœ‹å®Œæ•´æ—¥å¿—å †æ ˆ
æ£€æŸ¥é“¾ä¸Šè¿”å›ç 
éªŒè¯è´¦æˆ·çŠ¶æ€



å››ã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
4.1 ç±»å‹é”™è¯¯ (TS2345)
é”™è¯¯ä¿¡æ¯:
Argument of type &#39;Keypair&#39; is not assignable to parameter of type &#39;Wallet&#39;
è§£å†³æ–¹æ¡ˆ:
// é”™è¯¯æ–¹å¼
return Keypair.fromSecretKey(...)

// æ­£ç¡®æ–¹å¼
return new anchor.Wallet(Keypair.fromSecretKey(...))
4.2 è´¦æˆ·ä¸å­˜åœ¨é”™è¯¯
é”™è¯¯ä¿¡æ¯:
Account does not exist or has no data
è§£å†³æ–¹æ¡ˆ:

éªŒè¯é’±åŒ…åœ°å€:

solana address -k ~/.config/solana/t3.json

ç©ºæŠ• SOL:

solana airdrop 1 &lt;WALLET_ADDRESS>

ç¡®è®¤ PDA è®¡ç®—æ­£ç¡®æ€§:

console.log("é¢„æœŸPDA:", profilePda.toBase58())
4.3 äº¤æ˜“ç­¾åé”™è¯¯
é”™è¯¯ä¿¡æ¯:
Transfer: &#96;from&#96; must not carry data
è§£å†³æ–¹æ¡ˆ:
// ç¡®ä¿æ­£ç¡®ä¼ é€’ç­¾åè€…
.signers([wallet.payer])
äº”ã€å¼€å‘æœ€ä½³å®è·µ


æ¨¡å—åŒ–å¼€å‘:

å°†æŒ‡ä»¤å’ŒçŠ¶æ€åˆ†ç¦»åˆ°ä¸åŒæ–‡ä»¶
ä½¿ç”¨ pub(crate) æ§åˆ¶å¯è§æ€§



é”™è¯¯å¤„ç†:

ä½¿ç”¨ anyhow æˆ– thiserror ç®€åŒ–é”™è¯¯å¤„ç†
æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•



æµ‹è¯•ç­–ç•¥:

å•å…ƒæµ‹è¯•: ä½¿ç”¨ anchor çš„æµ‹è¯•æ¡†æ¶
é›†æˆæµ‹è¯•: ä½¿ç”¨æœ¬åœ°ç½‘ç»œæµ‹è¯•å®Œæ•´æµç¨‹
è¾¹ç•Œæµ‹è¯•: éªŒè¯è¾“å…¥é•¿åº¦é™åˆ¶



å®‰å…¨æ€§å»ºè®®:

é¿å…ç¡¬ç¼–ç å¯†é’¥
ä½¿ç”¨ Anchor çš„è´¦æˆ·çº¦æŸ
éªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•°



]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part11]_Anchorå®æˆ˜ï¼šç”¨æˆ·å‘å¸–&amp;ç‚¹èµ</title>
    <url>/2025/08/17/Solana-part11-Anchor%E5%AE%9E%E6%88%98%EF%BC%9A%E7%94%A8%E6%88%B7%E5%8F%91%E5%B8%96-%E7%82%B9%E8%B5%9E/</url>
    <content><![CDATA[Solana[part11]_Anchorå®æˆ˜ï¼šç”¨æˆ·å‘å¸–&amp;ç‚¹èµ
å‘å¸–åŠŸèƒ½ï¼ˆcreateTweetï¼‰
1. æ ¸å¿ƒæ•°æ®ç»“æ„
å‘å¸–åŠŸèƒ½çš„æ ¸å¿ƒæ•°æ®ç»“æ„ä¸ºTweetï¼Œå®šä¹‰åœ¨programs/anchor_social/src/state/tweet.rsä¸­ï¼Œç”¨äºå­˜å‚¨å¸–å­å†…å®¹åŠç‚¹èµæ•°ï¼š
// programs/anchor_social/src/state/tweet.rs
use anchor_lang::prelude::*;

#[account]
#[derive(InitSpace)]
pub struct Tweet &#123;
    #[max_len(50)]  // é™åˆ¶å¸–å­å†…å®¹æœ€å¤§é•¿åº¦ä¸º50å­—ç¬¦
    pub body: String,  // å¸–å­å†…å®¹
    pub like_count: u64,  // ç‚¹èµæ•°ï¼Œåˆå§‹ä¸º0
&#125;

impl Tweet &#123;
    pub const SEED_PREFIX: &amp;'static str = "tweet";  // PDAç§å­å‰ç¼€

    // åˆå§‹åŒ–æ–°å¸–å­
    pub fn new(body: String) -> Self &#123;
        Self &#123;
            body,
            like_count: 0,
        &#125;
    &#125;
&#125;
2. å‰ç«¯APIå®ç°ï¼ˆåˆ›å»ºå¸–å­ï¼‰
å‰ç«¯é€šè¿‡app/api/tweet.tsä¸­çš„createTweetå‡½æ•°å‘èµ·åˆ›å»ºå¸–å­çš„äº¤æ˜“ï¼Œæ ¸å¿ƒé€»è¾‘åŒ…æ‹¬ç”Ÿæˆå¸–å­PDAã€è°ƒç”¨é“¾ä¸Šç¨‹åºï¼š
// app/api/tweet.ts
import * as anchor from "@coral-xyz/anchor";
import &#123; program &#125; from "./wallet";

export async function createTweet(
    wallet: anchor.Wallet,
    body: string,
): Promise&lt;[anchor.web3.PublicKey, string]> &#123;
    // 1. ç”Ÿæˆç”¨æˆ·Profileçš„PDAï¼ˆç”¨äºå…³è”å¸–å­æ‰€å±ç”¨æˆ·ï¼‰
    const [profilePda,] = anchor.web3.PublicKey.findProgramAddressSync(
        [Buffer.from("profile"), wallet.publicKey.toBuffer()],  // ç§å­ï¼š"profile" + ç”¨æˆ·å…¬é’¥
        program.programId,
    );

    // 2. è·å–ç”¨æˆ·Profileæ•°æ®ï¼ˆéœ€å…ˆåˆ›å»ºProfileï¼‰
    const profile = await program.account.profile.fetch(profilePda);

    // 3. ç”Ÿæˆå¸–å­çš„PDAï¼ˆå”¯ä¸€æ ‡è¯†å¸–å­ï¼‰
    const [tweetPda] = anchor.web3.PublicKey.findProgramAddressSync(
        [
            Buffer.from("tweet"),  // ç§å­1ï¼šå›ºå®šå‰ç¼€"tweet"
            profilePda.toBuffer(),  // ç§å­2ï¼šç”¨æˆ·Profileçš„PDAï¼ˆå…³è”ç”¨æˆ·ï¼‰
            Buffer.from((profile.tweet_count + 1).toString())  // ç§å­3ï¼šç”¨æˆ·çš„ç¬¬N+1æ¡å¸–å­ï¼ˆç¡®ä¿å”¯ä¸€æ€§ï¼‰
        ],
        program.programId,
    );

    // 4. è°ƒç”¨é“¾ä¸Šç¨‹åºåˆ›å»ºå¸–å­ï¼Œè¿”å›å¸–å­PDAå’Œäº¤æ˜“ç­¾å
    return [
        tweetPda,
        await program.methods.createTweet(body)
            .accounts(&#123;
                authority: wallet.publicKey,  // äº¤æ˜“å‘èµ·è€…ï¼ˆå¸–å­ä½œè€…ï¼‰
                tweet: tweetPda,  // å¸–å­è´¦æˆ·ï¼ˆæ–°å»ºï¼‰
            &#125;)
            .rpc()  // å‘é€äº¤æ˜“
    ];
&#125;
3. åç«¯ç¨‹åºé€»è¾‘ï¼ˆåˆ›å»ºå¸–å­ï¼‰
é“¾ä¸Šç¨‹åºé€»è¾‘å®šä¹‰åœ¨programs/anchor_social/src/instructions/tweet.rsä¸­ï¼Œè´Ÿè´£åˆå§‹åŒ–å¸–å­è´¦æˆ·ã€æ›´æ–°ç”¨æˆ·å‘å¸–æ•°ï¼š
// programs/anchor_social/src/instructions/tweet.rs
use crate::state::profile::*;
use crate::state::tweet::*;
use anchor_lang::prelude::*;

// å¤„ç†åˆ›å»ºå¸–å­çš„æ ¸å¿ƒé€»è¾‘
pub fn create_tweet(ctx: Context&lt;CreateTweet>, body: String) -> Result&lt;()> &#123;
    // 1. æ›´æ–°ç”¨æˆ·Profileçš„å‘å¸–æ•°ï¼ˆ+1ï¼‰
    let profile = &amp;mut ctx.accounts.profile;
    profile.tweet_count += 1;

    // 2. åˆå§‹åŒ–å¸–å­æ•°æ®
    let tweet = Tweet::new(body);
    // å°†å¸–å­æ•°æ®å†™å…¥è´¦æˆ·ï¼ˆset_innerç”¨äºæ›´æ–°Anchorè´¦æˆ·çš„å†…éƒ¨æ•°æ®ï¼‰
    ctx.accounts.tweet.set_inner(tweet.clone());
    Ok(())
&#125;

// å®šä¹‰åˆ›å»ºå¸–å­æ‰€éœ€çš„è´¦æˆ·ç»“æ„
#[derive(Accounts)]
pub struct CreateTweet&lt;'info> &#123;
    // å¸–å­è´¦æˆ·ï¼ˆæ–°å»ºï¼‰
    #[account(
        init,  // åˆå§‹åŒ–æ–°è´¦æˆ·
        payer = authority,  // ç”±authorityæ”¯ä»˜è´¦æˆ·åˆ›å»ºè´¹ç”¨
        space = 8 + Tweet::INIT_SPACE,  // åˆ†é…å­˜å‚¨ç©ºé—´ï¼ˆ8å­—èŠ‚ä¸ºAnchorè´¦æˆ·å‰ç¼€ï¼‰
        seeds = [  // PDAç§å­ï¼ˆéœ€ä¸å‰ç«¯ç”Ÿæˆé€»è¾‘ä¸€è‡´ï¼‰
            Tweet::SEED_PREFIX.as_bytes(),  // "tweet"
            profile.key().as_ref(),  // ç”¨æˆ·Profileçš„PDA
            (profile.tweet_count + 1).to_string().as_ref()  // ç¬¬N+1æ¡å¸–å­
        ],
        bump  // è‡ªåŠ¨è®¡ç®—PDAçš„bumpå€¼
    )]
    pub tweet: Account&lt;'info, Tweet>,

    // ç”¨æˆ·Profileè´¦æˆ·ï¼ˆéœ€å·²å­˜åœ¨ï¼Œç”¨äºè®°å½•å‘å¸–æ•°ï¼‰
    #[account(mut, seeds = [Profile::SEED_PREFIX.as_bytes(), authority.key().as_ref()], bump)]
    pub profile: Account&lt;'info, Profile>,

    // äº¤æ˜“å‘èµ·è€…ï¼ˆå¸–å­ä½œè€…ï¼Œç­¾åè€…ï¼‰
    #[account(mut)]
    pub authority: Signer&lt;'info>,

    // Solanaç³»ç»Ÿç¨‹åºï¼ˆç”¨äºåˆ›å»ºæ–°è´¦æˆ·ï¼‰
    pub system_program: Program&lt;'info, System>,
&#125;
4. å…³é”®æŠ€æœ¯ç‚¹è§£æ

PDAï¼ˆProgram Derived Addressï¼‰è®¾è®¡ï¼šå¸–å­çš„PDAç”±&quot;tweet&quot; + ç”¨æˆ·Profileçš„PDA + å¸–å­åºå·ç»„æˆï¼Œç¡®ä¿æ¯ä¸ªç”¨æˆ·çš„æ¯æ¡å¸–å­æœ‰å”¯ä¸€æ ‡è¯†ï¼Œä¸”å¯é€šè¿‡ç§å­é€†å‘æ¨å¯¼ã€‚
çŠ¶æ€æ›´æ–°ä¾èµ–ï¼šåˆ›å»ºå¸–å­æ—¶å¿…é¡»å…ˆå­˜åœ¨ç”¨æˆ·Profileï¼ˆç”¨äºè®°å½• tweet_countï¼‰ï¼Œå¦åˆ™ä¼šå› æ— æ³•è·å–Profileæ•°æ®è€Œå¤±è´¥ã€‚
å­˜å‚¨ç©ºé—´åˆ†é…ï¼šspace = 8 + Tweet::INIT_SPACEä¸­ï¼Œ8å­—èŠ‚æ˜¯Anchorè´¦æˆ·çš„å›ºå®šå‰ç¼€ï¼ˆç”¨äºå­˜å‚¨è´¦æˆ· discriminatorï¼‰ï¼ŒTweet::INIT_SPACEç”±#[derive(InitSpace)]è‡ªåŠ¨è®¡ç®—ï¼ˆåŒ…å«bodyå’Œlike_countçš„ç©ºé—´ï¼‰ã€‚

ç‚¹èµåŠŸèƒ½ï¼ˆCreateLikeï¼‰
1. æ ¸å¿ƒæ•°æ®ç»“æ„
ç‚¹èµåŠŸèƒ½æ¶‰åŠä¸¤ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ï¼šLikeï¼ˆå­˜å‚¨ç‚¹èµå…³ç³»ï¼‰å’ŒTweetï¼ˆè®°å½•ç‚¹èµæ•°ï¼‰ã€‚Likeå®šä¹‰åœ¨programs/anchor_social/src/state/like.rsä¸­ï¼š
// programs/anchor_social/src/state/like.rs
use anchor_lang::prelude::*;

#[account]
#[derive(InitSpace)]
pub struct Like &#123;
    pub profile_pubkey: Pubkey,  // ç‚¹èµç”¨æˆ·çš„å…¬é’¥
    pub tweet_pubkey: Pubkey,  // è¢«ç‚¹èµå¸–å­çš„å…¬é’¥
&#125;

impl Like &#123;
    pub const SEED_PREFIX: &amp;'static str = "like";  // PDAç§å­å‰ç¼€

    // åˆå§‹åŒ–æ–°ç‚¹èµ
    pub fn new(profile_pubkey: Pubkey, tweet_pubkey: Pubkey) -> Self &#123;
        Self &#123;
            profile_pubkey,
            tweet_pubkey,
        &#125;
    &#125;
&#125;
2. å‰ç«¯APIå®ç°ï¼ˆåˆ›å»ºç‚¹èµï¼‰
å‰ç«¯é€šè¿‡app/api/tweet.tsä¸­çš„createLikeå‡½æ•°å‘èµ·ç‚¹èµäº¤æ˜“ï¼š
// app/api/tweet.ts
export async function createLike(
    wallet: anchor.Wallet,
    tweetPdas: anchor.web3.PublicKey  // è¢«ç‚¹èµå¸–å­çš„PDA
) &#123;
    // è°ƒç”¨é“¾ä¸Šç¨‹åºåˆ›å»ºç‚¹èµï¼Œè¿”å›äº¤æ˜“ç­¾å
    return await program.methods.createLike()
        .accounts(&#123;
            tweet: tweetPdas,  // è¢«ç‚¹èµçš„å¸–å­è´¦æˆ·
            authority: wallet.publicKey,  // ç‚¹èµç”¨æˆ·
        &#125;)
        .signers([wallet.payer])  // ç­¾åè€…ï¼ˆç‚¹èµç”¨æˆ·ï¼‰
        .rpc();
&#125;
3. åç«¯ç¨‹åºé€»è¾‘ï¼ˆåˆ›å»ºç‚¹èµï¼‰
é“¾ä¸Šç¨‹åºé€»è¾‘å®šä¹‰åœ¨programs/anchor_social/src/instructions/tweet.rsä¸­ï¼Œè´Ÿè´£åˆ›å»ºç‚¹èµè®°å½•ã€æ›´æ–°å¸–å­ç‚¹èµæ•°ï¼š
// programs/anchor_social/src/instructions/tweet.rs
use crate::state::like::*;
use crate::state::tweet::*;
use anchor_lang::prelude::*;

// å¤„ç†åˆ›å»ºç‚¹èµçš„æ ¸å¿ƒé€»è¾‘
pub fn create_like(ctx: Context&lt;CreateLike>) -> Result&lt;()> &#123;
    // 1. æ›´æ–°å¸–å­çš„ç‚¹èµæ•°ï¼ˆ+1ï¼‰
    let tweet = &amp;mut ctx.accounts.tweet;
    tweet.like_count += 1;

    // 2. åˆå§‹åŒ–ç‚¹èµè®°å½•ï¼ˆå…³è”ç‚¹èµç”¨æˆ·å’Œå¸–å­ï¼‰
    let like = Like::new(ctx.accounts.authority.key(), tweet.key());
    // å°†ç‚¹èµæ•°æ®å†™å…¥è´¦æˆ·
    ctx.accounts.like.set_inner(like);
    Ok(())
&#125;

// å®šä¹‰åˆ›å»ºç‚¹èµæ‰€éœ€çš„è´¦æˆ·ç»“æ„
#[derive(Accounts)]
pub struct CreateLike&lt;'info> &#123;
    // ç‚¹èµè®°å½•è´¦æˆ·ï¼ˆæ–°å»ºï¼‰
    #[account(
        init,  // åˆå§‹åŒ–æ–°è´¦æˆ·
        payer = authority,  // ç”±ç‚¹èµç”¨æˆ·æ”¯ä»˜è´¹ç”¨
        space = 8 + Like::INIT_SPACE,  // åˆ†é…å­˜å‚¨ç©ºé—´
        seeds = [  // PDAç§å­ï¼ˆç¡®ä¿å”¯ä¸€ï¼šåŒä¸€ç”¨æˆ·å¯¹åŒä¸€å¸–å­åªèƒ½ç‚¹èµä¸€æ¬¡ï¼‰
            Like::SEED_PREFIX.as_bytes(),  // "like"
            profile.key().as_ref(),  // ç‚¹èµç”¨æˆ·çš„Profile PDA
            tweet.key().as_ref()  // è¢«ç‚¹èµå¸–å­çš„PDA
        ],
        bump
    )]
    pub like: Account&lt;'info, Like>,

    // è¢«ç‚¹èµçš„å¸–å­è´¦æˆ·ï¼ˆéœ€å·²å­˜åœ¨ï¼Œæ›´æ–°ç‚¹èµæ•°ï¼‰
    #[account(mut)]
    pub tweet: Account&lt;'info, Tweet>,

    // ç‚¹èµç”¨æˆ·çš„Profileè´¦æˆ·ï¼ˆéªŒè¯ç”¨æˆ·èº«ä»½ï¼‰
    #[account(mut, seeds = [Profile::SEED_PREFIX.as_bytes(), authority.key().as_ref()], bump)]
    pub profile: Account&lt;'info, Profile>,

    // ç‚¹èµç”¨æˆ·ï¼ˆç­¾åè€…ï¼‰
    #[account(mut)]
    pub authority: Signer&lt;'info>,

    // ç³»ç»Ÿç¨‹åºï¼ˆç”¨äºåˆ›å»ºç‚¹èµè´¦æˆ·ï¼‰
    pub system_program: Program&lt;'info, System>,
&#125;
4. å…³é”®æŠ€æœ¯ç‚¹è§£æ

ç‚¹èµå”¯ä¸€æ€§ä¿éšœï¼šç‚¹èµè®°å½•çš„PDAç”±&quot;like&quot; + ç‚¹èµç”¨æˆ·Profile PDA + å¸–å­PDAç»„æˆï¼Œç¡®ä¿åŒä¸€ç”¨æˆ·å¯¹åŒä¸€å¸–å­åªèƒ½åˆ›å»ºä¸€æ¡ç‚¹èµè®°å½•ï¼ˆé‡å¤åˆ›å»ºä¼šå› PDAå·²å­˜åœ¨è€Œå¤±è´¥ï¼‰ã€‚
çŠ¶æ€è”åŠ¨æ›´æ–°ï¼šç‚¹èµæ—¶åŒæ—¶æ›´æ–°ä¸¤ä¸ªçŠ¶æ€ï¼štweet.like_countï¼ˆå¸–å­çš„ç‚¹èµæ•°+1ï¼‰å’ŒLikeè´¦æˆ·ï¼ˆå­˜å‚¨ç‚¹èµå…³ç³»ï¼‰ã€‚
ä¾èµ–éªŒè¯ï¼šç‚¹èµæ“ä½œä¾èµ–ä¸‰ä¸ªå‰æï¼šå¸–å­è´¦æˆ·å·²å­˜åœ¨ã€ç‚¹èµç”¨æˆ·çš„Profileè´¦æˆ·å·²å­˜åœ¨ï¼Œå¦åˆ™ä¼šå› è´¦æˆ·ä¸å­˜åœ¨è€Œå¤±è´¥ã€‚

ä½¿ç”¨ç¤ºä¾‹
ä»¥ä¸‹æ˜¯app/index.tsä¸­å‘å¸–å’Œç‚¹èµçš„è°ƒç”¨ç¤ºä¾‹ï¼Œå±•ç¤ºå®Œæ•´æµç¨‹ï¼š
// app/index.ts
import &#123; useDefaultWallet, useVisitorWallet &#125; from "./api/wallet";
import &#123; createTweet, getTweet, createLike &#125; from "./api/tweet";

(async () => &#123;
    const defaultWallet = useDefaultWallet();  // å‘å¸–ç”¨æˆ·é’±åŒ…
    const visitorWallet = useVisitorWallet();  // ç‚¹èµç”¨æˆ·é’±åŒ…

    // 1. åˆ›å»ºå¸–å­
    const [tweetPda, createTweetTx] = await createTweet(defaultWallet, "Hello, world!");
    console.log("å¸–å­åˆ›å»ºæˆåŠŸï¼ŒPDAï¼š", tweetPda.toBase58(), "äº¤æ˜“ç­¾åï¼š", createTweetTx);

    // 2. è·å–å¸–å­è¯¦æƒ…ï¼ˆéªŒè¯åˆ›å»ºç»“æœï¼‰
    const tweet = await getTweet(defaultWallet, tweetPda);
    console.log("å¸–å­åˆå§‹ä¿¡æ¯ï¼š", tweet);  // like_countåº”ä¸º0

    // 3. å¯¹å¸–å­ç‚¹èµ
    const createLikeTx = await createLike(visitorWallet, tweetPda);
    console.log("ç‚¹èµæˆåŠŸï¼Œäº¤æ˜“ç­¾åï¼š", createLikeTx);

    // 4. å†æ¬¡è·å–å¸–å­è¯¦æƒ…ï¼ˆéªŒè¯ç‚¹èµæ•°æ›´æ–°ï¼‰
    const updatedTweet = await getTweet(defaultWallet, tweetPda);
    console.log("ç‚¹èµåå¸–å­ä¿¡æ¯ï¼š", updatedTweet);  // like_countåº”ä¸º1
&#125;)();
æ€»ç»“
å‘å¸–å’Œç‚¹èµåŠŸèƒ½é€šè¿‡Anchoræ¡†æ¶å®ç°äº†SolanaåŒºå—é“¾ä¸Šçš„çŠ¶æ€ç®¡ç†ï¼š

å‘å¸–åŠŸèƒ½é€šè¿‡PDAå…³è”ç”¨æˆ·ä¸å¸–å­ï¼Œç¡®ä¿å”¯ä¸€æ€§å¹¶è®°å½•å‘å¸–æ•°ï¼›
ç‚¹èµåŠŸèƒ½é€šè¿‡PDAä¿éšœå”¯ä¸€ç‚¹èµï¼Œå¹¶è”åŠ¨æ›´æ–°å¸–å­çš„ç‚¹èµæ•°ï¼›
æ ¸å¿ƒä¾èµ–Profileè´¦æˆ·ä½œä¸ºç”¨æˆ·èº«ä»½æ ‡è¯†ï¼Œæ‰€æœ‰æ“ä½œå‡éœ€éªŒè¯è´¦æˆ·å­˜åœ¨æ€§ã€‚

ç†è§£ä¸Šè¿°é€»è¾‘æœ‰åŠ©äºæŒæ¡Solanaä¸Šçš„PDAè®¾è®¡ã€è´¦æˆ·äº¤äº’åŠçŠ¶æ€æ›´æ–°æ¨¡å¼ã€‚
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part12]_Anchorå®æˆ˜ï¼šspl token&amp;mintè´¦æˆ·çš„åˆ›å»º</title>
    <url>/2025/08/18/Solana-part12-Anchor%E5%AE%9E%E6%88%98%EF%BC%9A/</url>
    <content><![CDATA[Solana[part12]_Anchorå®æˆ˜ï¼šspl token&amp;mintè´¦æˆ·çš„åˆ›å»º
ä¸€ã€åŠŸèƒ½æ¦‚è¿°
createTokenMintAccount æ˜¯é¡¹ç›®ä¸­ç”¨äºåˆ›å»ºä»£å¸é“¸é€ ï¼ˆMintï¼‰è´¦æˆ·åŠå…³è”å…ƒæ•°æ®è´¦æˆ·çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŸºäº Solana åŒºå—é“¾å’Œ Anchor æ¡†æ¶å®ç°ã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š

é€šè¿‡ Anchor æŒ‡ä»¤åˆå§‹åŒ–ä¸€ä¸ªç”± PDAï¼ˆç¨‹åºæ´¾ç”Ÿåœ°å€ï¼‰æ§åˆ¶çš„ SPL Token Mint è´¦æˆ·ï¼›
é€šè¿‡ CPIï¼ˆè·¨ç¨‹åºè°ƒç”¨ï¼‰è°ƒç”¨ Metaplex å…ƒæ•°æ®ç¨‹åºçš„ create_metadata_accounts_v3 æ–¹æ³•ï¼Œä¸º Mint è´¦æˆ·åˆ›å»ºå…ƒæ•°æ®ï¼ˆåç§°ã€ç¬¦å·ã€URI ç­‰ï¼‰ã€‚

äºŒã€token.rs å®ç°ç»†èŠ‚è§£æ
1. æ ¸å¿ƒå‡½æ•°ï¼šcreate_token_mint_account
è¯¥å‡½æ•°æ˜¯æŒ‡ä»¤çš„å…¥å£ï¼Œè´Ÿè´£åˆå§‹åŒ– mint è´¦æˆ·å¹¶è§¦å‘å…ƒæ•°æ®è´¦æˆ·çš„ CPI è°ƒç”¨ï¼Œä»£ç é€»è¾‘å¦‚ä¸‹ï¼š
pub fn create_token_mint_account(ctx: Context&lt;CreateTokenMintAccount>) -> Result&lt;()> &#123;
    // å®šä¹‰ PDA ç­¾åç§å­ï¼ˆç”¨äº CPI è°ƒç”¨æ—¶çš„ç­¾åéªŒè¯ï¼‰
    let signer_seeds: &amp;[&amp;[&amp;[u8]]] = &amp;[&amp;[b"mint_v3", &amp;[ctx.bumps.mint_account]]];
    // CPI è°ƒç”¨ Metaplex çš„ create_metadata_accounts_v3 æ–¹æ³•
    create_metadata_accounts_v3(
        CpiContext::new_with_signer(
            ctx.accounts.token_metadata_program.to_account_info(), // å…ƒæ•°æ®ç¨‹åºè´¦æˆ·
            CreateMetadataAccountsV3 &#123;
                metadata: ctx.accounts.meta_account.to_account_info(), // å…ƒæ•°æ®è´¦æˆ·
                mint: ctx.accounts.mint_account.to_account_info(), // mint è´¦æˆ·
                mint_authority: ctx.accounts.mint_account.to_account_info(), // mint æˆæƒè€…ï¼ˆè‡ªèº« PDAï¼‰
                update_authority: ctx.accounts.mint_account.to_account_info(), // å…ƒæ•°æ®æ›´æ–°æˆæƒè€…ï¼ˆè‡ªèº« PDAï¼‰
                payer: ctx.accounts.authority.to_account_info(), // æ”¯ä»˜è€…ï¼ˆå¤–éƒ¨ç­¾åè€…ï¼‰
                system_program: ctx.accounts.system_program.to_account_info(), // ç³»ç»Ÿç¨‹åº
                rent: ctx.accounts.rent.to_account_info(), // ç§Ÿé‡‘ç³»ç»Ÿå˜é‡
            &#125;,
            signer_seeds, // ä¼ å…¥ PDA ç­¾åç§å­ï¼Œç¡®ä¿ CPI è°ƒç”¨æƒé™
        ),
        // å…ƒæ•°æ®å†…å®¹ï¼ˆDataV2 ç»“æ„ï¼‰
        DataV2 &#123;
            name: "tokenchs".to_string(), // ä»£å¸åç§°
            symbol: "TKS".to_string(), // ä»£å¸ç¬¦å·
            uri: "https://example.com/tokenchs".to_string(), // å…ƒæ•°æ® URIï¼ˆé€šå¸¸æŒ‡å‘JSONæ–‡ä»¶ï¼‰
            seller_fee_basis_points: 0, // å–å®¶æ‰‹ç»­è´¹ï¼ˆ0è¡¨ç¤ºæ— ï¼‰
            creators: None, // åˆ›ä½œè€…ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
            collection: None, // é›†åˆä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
            uses: None, // ç”¨é€”é™åˆ¶ï¼ˆå¯é€‰ï¼‰
        &#125;,
        false, // ä¸åˆ›å»ºä¸»å”®å¸‚åœº
        true, // å…è®¸ç¬¬ä¸‰æ–¹è½¬è®©
        None, // æ— é›†åˆæˆæƒ
    )?;
    Ok(())
&#125;
å…³é”®é€»è¾‘è¯´æ˜ï¼š

PDA ç­¾åç§å­ï¼šsigner_seeds ä½¿ç”¨ b&quot;mint_v3&quot; å’Œ mint_account çš„ bump å€¼ç”Ÿæˆï¼Œç”¨äºè¯æ˜å½“å‰ç¨‹åºå¯¹ mint_account çš„æ§åˆ¶æƒï¼Œç¡®ä¿ CPI è°ƒç”¨æœ‰æƒé™æ“ä½œå…ƒæ•°æ®ã€‚
CPI è°ƒç”¨å‚æ•°ï¼šé€šè¿‡ CreateMetadataAccountsV3 ç»“æ„ä½“æŒ‡å®šå…ƒæ•°æ®è´¦æˆ·ã€mint è´¦æˆ·ã€æˆæƒè€…ç­‰å…³é”®è´¦æˆ·ï¼Œå…¶ä¸­ mint_authority å’Œ update_authority å‡è®¾ä¸º mint_account è‡ªèº«ï¼ˆPDAï¼‰ï¼Œç¡®ä¿åªæœ‰ mint è´¦æˆ·çš„æ§åˆ¶ç¨‹åºï¼ˆå½“å‰ç¨‹åºï¼‰å¯ä¿®æ”¹æƒé™ã€‚
å…ƒæ•°æ®å†…å®¹ï¼šDataV2 ç»“æ„ä½“å›ºå®šäº†ä»£å¸ çš„åç§°ã€ç¬¦å·å’Œ URIï¼Œå®é™…åœºæ™¯ä¸­å¯æ”¹ä¸ºåŠ¨æ€å‚æ•°ä¼ å…¥ã€‚

2. è´¦æˆ·ç»“æ„ï¼šCreateTokenMintAccount
è¯¥ç»“æ„ä½“å®šä¹‰äº†æŒ‡ä»¤æ‰€éœ€çš„æ‰€æœ‰è´¦æˆ·åŠå…¶çº¦æŸæ¡ä»¶ï¼Œç¡®ä¿é“¾ä¸Šè´¦æˆ·çš„å®‰å…¨æ€§å’Œæ­£ç¡®æ€§ï¼š
#[derive(Accounts)]
pub struct CreateTokenMintAccount&lt;'info> &#123;
    /// å…ƒæ•°æ®è´¦æˆ·ï¼ˆå­˜å‚¨ä»£å¸ å…ƒæ•°æ®ï¼‰
    #[account(
        mut,
        seeds = [
            b"metadata", // å›ºå®šå‰ç¼€
            token_metadata_program.key().as_ref(), // å…ƒæ•°æ®ç¨‹åºåœ°å€
            mint_account.key().as_ref(), // mint è´¦æˆ·åœ°å€
        ],
        bump, // è‡ªåŠ¨è®¡ç®— bump å€¼
        seeds::program = token_metadata_program.key(), // ç§å­æ ¡éªŒç¨‹åº
    )]
    pub meta_account: UncheckedAccount&lt;'info>,

    /// Mint è´¦æˆ·ï¼ˆä»£å¸é“¸é€ è´¦æˆ·ï¼‰
    #[account(
        init_if_needed, // è‹¥ä¸å­˜åœ¨åˆ™åˆå§‹åŒ–
        payer = authority, // ç”± authority æ”¯ä»˜ç§Ÿé‡‘
        seeds = [b"mint_v3"], // å›ºå®šç§å­ï¼ˆç”¨äºç”Ÿæˆ PDAï¼‰
        bump, // è‡ªåŠ¨è®¡ç®— bump å€¼
        mint::decimals = 100, // ä»£å¸å°æ•°ä½ä¸º 100
        mint::authority = mint_account.key(), // æˆæƒè€…ä¸ºè‡ªèº« PDA
    )]
    pub mint_account: Account&lt;'info, Mint>,

    /// äº¤æ˜“æ”¯ä»˜è€…ï¼ˆå¤–éƒ¨ç­¾åè€…ï¼‰
    #[account(mut)]
    pub authority: Signer&lt;'info>,

    /// SPL Token ç¨‹åºï¼ˆç”¨äºå¤„ç†ä»£å¸é€»è¾‘ï¼‰
    pub token_program: Program&lt;'info, Token>,

    /// ç³»ç»Ÿç¨‹åºï¼ˆç”¨äºåˆ›å»ºè´¦æˆ·ï¼‰
    pub system_program: Program&lt;'info, System>,

    /// Metaplex å…ƒæ•°æ®ç¨‹åºï¼ˆç”¨äºåˆ›å»ºå…ƒæ•°æ®ï¼‰
    pub token_metadata_program: Program&lt;'info, Metadata>,

    /// ç§Ÿé‡‘ç³»ç»Ÿå˜é‡ï¼ˆç”¨äºè®¡ç®—è´¦æˆ·å­˜å‚¨è´¹ç”¨ï¼‰
    pub rent: Sysvar&lt;'info, Rent>,
&#125;
è´¦æˆ·çº¦æŸè¯´æ˜ï¼š

meta_accountï¼šé€šè¿‡ b&quot;metadata&quot; + å…ƒæ•°æ®ç¨‹åºåœ°å€ + mint åœ°å€ ç”Ÿæˆç§å­ï¼Œç¡®ä¿å…ƒæ•°æ®è´¦æˆ·ä¸ mint è´¦æˆ·ä¸€ä¸€å¯¹åº”ï¼Œç¬¦åˆ Metaplex å…ƒæ•°æ®è´¦æˆ·çš„æ ‡å‡†ç”Ÿæˆè§„åˆ™ã€‚
mint_accountï¼šä½¿ç”¨ b&quot;mint_v3&quot; ä½œä¸ºç§å­ç”Ÿæˆ PDAï¼Œinit_if_needed ç¡®ä¿é‡å¤è°ƒç”¨æ—¶ä¸ä¼šé‡å¤åˆ›å»ºï¼›mint::authority è®¾ä¸ºè‡ªèº«ï¼Œæ„å‘³ç€åªæœ‰é€šè¿‡è¯¥ PDA ç­¾åï¼ˆå³å½“å‰ç¨‹åºï¼‰æ‰èƒ½æ‰§è¡Œé“¸é€  ç­‰æ“ä½œï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚

ä¸‰ã€å‰ç«¯æµ‹è¯•è°ƒç”¨é€»è¾‘ï¼ˆapp/api/token.tsï¼‰
å‰ç«¯é€šè¿‡ createTokenMintAccount å‡½æ•°è§¦å‘é“¾ä¸ŠæŒ‡ä»¤ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯ç”Ÿæˆ mint è´¦æˆ·çš„ PDA å¹¶å‘é€äº¤æ˜“ï¼š
export async function createTokenMintAccount(wallet: anchor.Wallet) &#123;
    // ç”Ÿæˆ mint è´¦æˆ·çš„ PDAï¼ˆä¸é“¾ä¸Šç§å­ b"mint_v3" å¯¹åº”ï¼‰
    const [splTokenPda,] = anchor.web3.PublicKey.findProgramAddressSync(
        [Buffer.from("mint_v3"),],
        program.programId,
    );

    // å‘é€äº¤æ˜“è°ƒç”¨é“¾ä¸ŠæŒ‡ä»¤
    return [splTokenPda,
        await program.methods.createTokenMintAccount().accounts(&#123;
            // éœ€è¡¥å……è´¦æˆ·å‚æ•°ï¼ˆå½“å‰ä¸ºç©ºï¼Œå®é™…è°ƒç”¨éœ€ä¼ å…¥ä»¥ä¸‹è´¦æˆ·ï¼‰
            // authority: wallet.publicKey,
            // mintAccount: splTokenPda,
            // tokenMetadataProgram: METADATA_PROGRAM_ID,
            // ...å…¶ä»–å¿…è¦è´¦æˆ·
        &#125;).rpc()];
&#125;
æ³¨æ„äº‹é¡¹ï¼š

å‰ç«¯éœ€æ˜¾å¼ä¼ å…¥ accounts å‚æ•°ï¼ŒåŒ…æ‹¬ authorityã€mint_accountã€token_metadata_program ç­‰ï¼Œå¦åˆ™ä¼šå› è´¦æˆ·ç¼ºå¤±å¯¼è‡´äº¤æ˜“å¤±è´¥ã€‚
PDA ç”Ÿæˆéœ€ä¸é“¾ä¸Š mint_account çš„ç§å­ï¼ˆb&quot;mint_v3&quot;ï¼‰ä¿æŒä¸€è‡´ï¼Œç¡®ä¿åœ°å€åŒ¹é…ã€‚

å››ã€æµ‹è¯•æ³¨æ„äº‹é¡¹ä¸è¸©å‘ç‚¹
1. ç¯å¢ƒé…ç½®ï¼ˆå¿…åšï¼‰
ä½¿ç”¨ create_metadata_accounts_v3 CPI éœ€ç¡®ä¿æœ¬åœ°æµ‹è¯•ç¯å¢ƒåŠ è½½ Metaplex å…ƒæ•°æ®ç¨‹åºï¼š
# ä¸‹è½½å…ƒæ•°æ®ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶
solana program dump -u m metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s metadata.so
# å¯åŠ¨æœ¬åœ°æµ‹è¯•ç½‘å¹¶åŠ è½½ç¨‹åº
solana-test-validator -r --bpf-program metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s metadata.so

è‹¥æœªåŠ è½½ï¼Œä¼šå‡ºç° Program not found é”™è¯¯ï¼Œå¯¼è‡´ CPI è°ƒç”¨å¤±è´¥ã€‚

2. PDA ç­¾åä¸æƒé™é—®é¢˜

é—®é¢˜ï¼šCPI è°ƒç”¨æ—¶å‡ºç° Signature verification failedï¼Œé€šå¸¸å›  signer_seeds ä¸ mint_account ç§å­ä¸åŒ¹é…ã€‚
è§£å†³ï¼šç¡®ä¿é“¾ä¸Š mint_account çš„ç§å­ï¼ˆb&quot;mint_v3&quot;ï¼‰ä¸ signer_seeds å®Œå…¨ä¸€è‡´ï¼Œä¸” bump å€¼æ­£ç¡®ï¼ˆé€šè¿‡ ctx.bumps.mint_account è·å–ï¼‰ã€‚

3. è´¦æˆ·å‚æ•°ç¼ºå¤±

é—®é¢˜ï¼šå‰ç«¯è°ƒç”¨æ—¶æœªä¼ å…¥ token_metadata_programã€system_program ç­‰è´¦æˆ·ï¼Œå¯¼è‡´äº¤æ˜“å› è´¦æˆ·éªŒè¯å¤±è´¥è€Œå›æ»šã€‚
è§£å†³ï¼šè¡¥å……å®Œæ•´è´¦æˆ·å‚æ•°ï¼Œç¤ºä¾‹ï¼šawait program.methods.createTokenMintAccount().accounts(&#123;
    authority: wallet.publicKey,
    mintAccount: splTokenPda,
    metaAccount: metaPda, // éœ€æå‰è®¡ç®—å…ƒæ•°æ®è´¦æˆ· PDA
    tokenProgram: TOKEN_PROGRAM_ID,
    tokenMetadataProgram: METADATA_PROGRAM_ID,
    systemProgram: SystemProgram.programId,
    rent: anchor.web3.SYSVAR_RENT_PUBKEY,
&#125;).rpc()


4. å…ƒæ•°æ®è´¦æˆ·ç©ºé—´ä¸è¶³

é—®é¢˜ï¼šå…ƒæ•°æ®å­—æ®µï¼ˆå¦‚ nameã€uriï¼‰è¿‡é•¿å¯¼è‡´è´¦æˆ·ç©ºé—´ä¸è¶³ï¼Œäº¤æ˜“å¤±è´¥ã€‚
è§£å†³ï¼šé™åˆ¶ DataV2 å­—æ®µé•¿åº¦ï¼ˆå¦‚ name ä¸è¶…è¿‡ 32 å­—èŠ‚ï¼‰ï¼Œæˆ–åŠ¨æ€è®¡ç®—æ‰€éœ€ç©ºé—´ã€‚

äº”ã€æµ‹è¯•éªŒè¯

å¯¼å‡ºmetadataç¨‹åº

solana program dump -u m metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s metadata.so

å¯åŠ¨æµ‹è¯•éªŒè¯å™¨

solana-test-validator -r --bpf-program metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s metadata.so

éƒ¨ç½²ç¨‹åº

anchor build &amp;&amp; anchor deploy

æ‰§è¡Œæµ‹è¯•

 anchor run api 
 --------------
 âœ  anchor_social git:(main) âœ— anchor run api               
yarn run v1.22.18
warning ../package.json: No license field
$ /Users/tinachan/anchor_social/node_modules/.bin/ts-node app/index.ts
DuFS4L7YDYsEnXeyc13g5xTxKYdcpNRvXkbrsp7BmbAW tm2FqnqSAZ5KhT5499ozLUh38RZAZM1BPuSst7A97N4f1WSsE9hZFbvnzuEu569dwrnHiGarJRE5BiuRsQHn4jj

https://explorer.solana.com/ æŸ¥çœ‹è´¦æˆ·è¯¦æƒ…



å¯ä»¥çœ‹åˆ°è¿™é‡Œå°±åˆ›å»ºäº†ä¸€ä¸ªæœ‰metadataä½“çš„token
SPL-TOKEN å®šä¹‰

Solana SPL Token ä¸å…¶ä»–åŒºå—é“¾ Token çš„æ ¸å¿ƒåŒºåˆ«
1. æŠ€æœ¯æ¶æ„ï¼šè´¦æˆ·æ¨¡å‹ vs æ™ºèƒ½åˆçº¦



ç»´åº¦
Solana SPL Token
ETH ERC20 / BSC BEP20




å®ç°æ–¹å¼
å¤ç”¨ SPL Token Program ç»Ÿä¸€é€»è¾‘ï¼Œæ— éœ€éƒ¨ç½²åˆçº¦
æ¯ä¸ª Token æ˜¯ç‹¬ç«‹ æ™ºèƒ½åˆçº¦ï¼ˆå¦‚ ERC20 åˆçº¦ï¼‰


éƒ¨ç½²æˆæœ¬
ä»…éœ€åˆ›å»º Mint/Token è´¦æˆ·ï¼ˆé“¾ä¸Šæ•°æ®å­˜å‚¨ï¼‰
éœ€éƒ¨ç½²å®Œæ•´åˆçº¦ï¼ˆæ¶ˆè€— Gasï¼Œä»£ç å­˜å‚¨å ç©ºé—´ï¼‰


çµæ´»æ€§
ä¾èµ– SPL æ ‡å‡†æ‰©å±•ï¼ˆå¦‚ Token 2022ï¼‰ï¼Œä½†é€»è¾‘é›†ä¸­
å¯è‡ªå®šä¹‰åˆçº¦é€»è¾‘ï¼ˆå¦‚åˆ†çº¢ã€é”€æ¯è§„åˆ™ï¼‰ï¼Œæ›´çµæ´»



2. æ€§èƒ½ä¸æ‰§è¡Œæ•ˆç‡

Solana ä¼˜åŠ¿ï¼š
åŸºäº å¹¶è¡Œå¤„ç†ï¼ˆTower BFT + æµæ°´çº¿ï¼‰ï¼ŒSPL Token æ“ä½œå¯å¹¶è¡Œæ‰§è¡Œï¼Œæ”¯æŒ 10 ä¸‡ + TPSï¼ˆç†è®ºå€¼ï¼‰ã€‚
ä¾‹ï¼šè½¬è´¦ã€é“¸å¸ç­‰æ“ä½œé€šè¿‡ CPI è°ƒç”¨ Token Programï¼Œæ— éœ€é€ä¸ªéªŒè¯åˆçº¦é€»è¾‘ã€‚
ETH/BSC é™åˆ¶ï¼š
äº¤æ˜“ä¸²è¡Œå¤„ç†ï¼ˆåŸºäº Gas ç«ä»·ï¼‰ï¼ŒERC20 äº¤æ˜“ TPS ä»… 30-300ï¼Œä¸”å¤æ‚é€»è¾‘ï¼ˆå¦‚æ‰¹é‡è½¬è´¦ï¼‰ä¼šè¿›ä¸€æ­¥é™ä½æ•ˆç‡ã€‚

3. è´¦æˆ·æ¨¡å‹ç»†èŠ‚

SPL Token çš„ â€œè´¦æˆ·åˆ†ç¦»â€ï¼š
ç”¨æˆ·çš„ Token ä½™é¢å­˜å‚¨åœ¨ ç‹¬ç«‹çš„ Token Accountï¼ˆéœ€æå‰åˆ›å»ºï¼Œå…³è” Mintï¼‰ï¼Œè€Œéç”¨æˆ·é’±åŒ…æœ¬èº«ã€‚
ä¾‹ï¼šç”¨æˆ· A çš„ USDC ä½™é¢ â†’ ä¸€ä¸ª Token Accountï¼ˆåœ°å€ï¼š...ï¼Œmint: USDC Mintï¼Œowner: Aï¼‰ã€‚
ERC20 çš„ â€œåˆçº¦å†…æ˜ å°„â€ï¼š
ä½™é¢ç›´æ¥è®°å½•åœ¨ ERC20 åˆçº¦çš„ mapping(address =&gt; uint256) balances ä¸­ï¼Œç”¨æˆ·é’±åŒ…åœ°å€æœ¬èº«ä¸å­˜å‚¨ Token æ•°æ®ã€‚

4. ç”Ÿæ€ä¸æ ‡å‡†æ‰©å±•

SPL çš„ç»Ÿä¸€æ‰©å±•ï¼š

å…ƒæ•°æ®ï¼šé€šè¿‡ Token Metadata Program ç»Ÿä¸€ç®¡ç†ï¼ˆåç§°ã€URIã€ç¬¦å·ï¼‰ï¼Œä¸ NFT æ ‡å‡†ï¼ˆå¦‚ Metaplexï¼‰æ— ç¼å…¼å®¹ã€‚
è¿›é˜¶æ ‡å‡†ï¼šToken 2022ï¼ˆæ›´çµæ´»çš„æƒé™æ§åˆ¶ï¼‰ã€NFTï¼ˆåŸºäº SPL Token çš„å˜ç§ï¼‰ã€‚


ERC20 çš„åˆ†æ•£æ‰©å±•ï¼š

å…ƒæ•°æ®éœ€é¢å¤–åè®®ï¼ˆå¦‚ OpenSea çš„ Metadata æ ‡å‡†ï¼‰ï¼Œå„æ‰©å±•æ ‡å‡†ï¼ˆERC721ã€ERC1155ï¼‰éœ€ç‹¬ç«‹å¼€å‘ï¼Œå…¼å®¹æ€§ä¾èµ–å¼€å‘è€…å®ç°ã€‚



5. è·¨ç¨‹åºè°ƒç”¨ï¼ˆCPIï¼‰ vs åˆçº¦è°ƒç”¨

Solana CPIï¼š
ç±»ä¼¼ â€œå‡½æ•°è°ƒç”¨â€ï¼Œæ”¯æŒ åµŒå¥—è·¨ç¨‹åºè°ƒç”¨ï¼ˆå¦‚ Token Metadata Program è°ƒç”¨ Token Program è·å– Mint ä¿¡æ¯ï¼‰ï¼Œé€»è¾‘æ›´é«˜æ•ˆã€‚
ETH åˆçº¦è°ƒç”¨ï¼š
é€šè¿‡ call æŒ‡ä»¤è°ƒç”¨å…¶ä»–åˆçº¦ï¼ŒåµŒå¥—æ·±åº¦å—é™ï¼ˆé¿å…æ ˆæº¢å‡ºï¼‰ï¼Œå¤æ‚äº¤äº’æˆæœ¬é«˜ã€‚

æ€»ç»“
createTokenMintAccount åŠŸèƒ½é€šè¿‡ Anchor æ¡†æ¶æ•´åˆäº† SPL Token å’Œ Metaplex å…ƒæ•°æ®ç¨‹åºï¼Œæ ¸å¿ƒé€»è¾‘é›†ä¸­åœ¨ token.rs ä¸­ï¼š

å®šä¹‰ PDA æ§åˆ¶çš„ mint è´¦æˆ·ï¼Œç¡®ä¿æƒé™å®‰å…¨ï¼›
é€šè¿‡ CPI è°ƒç”¨ç”Ÿæˆå…³è”çš„å…ƒæ•°æ®è´¦æˆ·ï¼Œå›ºå®šä»£å¸å…ƒæ•°æ®å†…å®¹ï¼›
å‰ç«¯éœ€æ­£ç¡®ç”Ÿæˆ PDA å¹¶ä¼ å…¥å®Œæ•´è´¦æˆ·å‚æ•°æ‰èƒ½è§¦å‘äº¤æ˜“ã€‚

æµ‹è¯•æ—¶éœ€é‡ç‚¹å…³æ³¨ç¯å¢ƒé…ç½®ã€PDA ç§å­ä¸€è‡´æ€§å’Œè´¦æˆ·å‚æ•°å®Œæ•´æ€§ï¼Œé¿å…å› é“¾ä¸Šç¨‹åºä¾èµ–æˆ–æƒé™é—®é¢˜å¯¼è‡´å¤±è´¥ã€‚
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part13]_Anchorå®æˆ˜ï¼šä¸ºç”¨æˆ·Mint Spl TOKEN</title>
    <url>/2025/08/19/Solana-part13-Anchor%E5%AE%9E%E6%88%98%EF%BC%9A%E4%B8%BA%E7%94%A8%E6%88%B7Mint-Spl-TOKEN/</url>
    <content><![CDATA[Solana[part13]_Anchorå®æˆ˜ï¼šä¸ºç”¨æˆ·Mint Spl TOKEN
è¯¥éƒ¨åˆ†ä»£ç è§ï¼šhttps://github.com/SoniaChan33/anchor_social/commit/5abd954500f2926d999ac644c18a97c91cde9fb6
createLikeæŒ‡ä»¤æ·»åŠ éœ€è¦çš„account
/anchor_social/src/instructions/tweet.rs
#[derive(Accounts)]
pub struct CreateLike&lt;'info> &#123;
    #[account(
        mut,
        seeds = [b"mint_v3",],
        bump,
    )]
    pub mint_account: Account&lt;'info, Mint>,

    #[account(
        init_if_needed,
        payer = authority,
        associated_token::mint = mint_account,
        associated_token::authority = author_wallet,
    )]
    pub author_token_account: Account&lt;'info, TokenAccount>,

    /// CHECK : THIS IS AUTHOR WALLET
    pub author_wallet: AccountInfo&lt;'info>,

    #[account(
        init,
        payer = authority,
        space = 8 + Like::INIT_SPACE,
        seeds = [
            Like::SEED_PREFIX.as_bytes().as_ref(),
            profile.key().as_ref(),
            tweet.key().as_ref()
        ],
        bump
    )]
    pub like: Account&lt;'info, Like>,

    #[account(mut)]
    pub tweet: Account&lt;'info, Tweet>,


    #[account(mut, seeds = [Profile::SEED_PREFIX.as_bytes(), authority.key().as_ref()], bump)]
    pub profile: Account&lt;'info, Profile>,
    #[account(mut)]
    pub authority: Signer&lt;'info>,
    pub system_program: Program&lt;'info, System>,

    pub associated_token_program: Program&lt;'info, AssociatedToken>,

    pub token_program: Program&lt;'info, Token>, // æ–°å¢çš„Tokenç¨‹åºå­—æ®µ
&#125;

tweetç»“æ„ä½“ä¿®æ”¹
#[account]
#[derive(InitSpace)]
pub struct Tweet &#123;
    #[max_len(50)]
    pub body: String,

    pub like_count: u64,
    pub author: Pubkey,
&#125;
impl Tweet &#123;
    pub const SEED_PREFIX: &amp;'static str = "tweet";

    pub fn new(body: String, author: Pubkey) -> Self &#123;
        Self &#123;
            body,
            like_count: 0,
            author,
        &#125;
    &#125;
&#125;

æ·»åŠ authorå±æ€§è®°å½•è¦mint toçš„author token account åœ°å€
åŒæ—¶éœ€è¦ä¿®æ”¹create_tweetå‡½æ•°çš„ç»†èŠ‚ï¼š
pub fn create_tweet(ctx: Context&lt;CreateTweet>, body: String) -> Result&lt;()> &#123;
    let profile = &amp;mut ctx.accounts.profile;
    profile.tweet_count += 1;
    let tweet = Tweet::new(body, ctx.accounts.tweet.key()); // è¿™é‡Œæ·»åŠ tweetçš„åœ°å€
    ctx.accounts.tweet.set_inner(tweet.clone());
    Ok(())
&#125;

ä¿®æ”¹createLikeæ–¹æ³•
pub fn create_like(ctx: Context&lt;CreateLike>) -> Result&lt;()> &#123;
    let tweet = &amp;mut ctx.accounts.tweet;
    tweet.like_count += 1;

    let like = Like::new(ctx.accounts.profile.key(), tweet.key());
    ctx.accounts.like.set_inner(like);
    // æ‰“å°mint_accountçš„åœ°å€
    msg!("mint_account: &#123;&#125;", ctx.accounts.mint_account.key());
    msg!(
        "author_token_account: &#123;&#125;",
        ctx.accounts.author_token_account.key()
    );

    mint_to(
        CpiContext::new_with_signer(
            ctx.accounts.token_program.to_account_info(),
            MintTo &#123;
                mint: ctx.accounts.mint_account.to_account_info(),
                to: ctx.accounts.author_token_account.to_account_info(),
                authority: ctx.accounts.mint_account.to_account_info(),
            &#125;,
            &amp;[&amp;[b"mint_v3", &amp;[ctx.bumps.mint_account]]],
        ),
        100,
    )?;
    Ok(())
&#125;
å…³é”®å‚æ•°è§£æï¼š


CpiContext::new_with_signerï¼šåˆ›å»ºè·¨ç¨‹åºè°ƒç”¨ï¼ˆCPIï¼‰ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºé“¸é€ ä»£å¸éœ€è¦è°ƒç”¨ Solana çš„ Token ç¨‹åºï¼ˆtoken_programï¼‰ã€‚


MintTo
ç»“æ„ä½“ï¼šæŒ‡å®šé“¸é€ ç›¸å…³çš„è´¦æˆ·ï¼š

mintï¼šä»£å¸çš„é“¸é€ è´¦æˆ·ï¼ˆmint_accountï¼‰ï¼Œè´Ÿè´£ç”Ÿæˆæ–°ä»£å¸ã€‚
toï¼šæ¥æ”¶ä»£å¸çš„è´¦æˆ·ï¼ˆauthor_token_accountï¼Œæ¨æ–‡ä½œè€…çš„ä»£å¸è´¦æˆ·ï¼‰ã€‚
authorityï¼šé“¸é€ æƒé™çš„æ‹¥æœ‰è€…ï¼ˆè¿™é‡Œæ˜¯mint_accountè‡ªèº«ï¼Œå› ä¸ºè¯¥è´¦æˆ·çš„æƒé™é€šè¿‡ç§å­éªŒè¯ï¼‰ã€‚



ç­¾åç§å­&amp;[&amp;[b&quot;mint_v3&quot;, &amp;[ctx.bumps.mint_account]]]ï¼šç”¨äºéªŒè¯mint_accountçš„æƒé™ï¼ˆè¯¥è´¦æˆ·æ˜¯é€šè¿‡b&quot;mint_v3&quot;ç§å­å’Œ bump å€¼åˆ›å»ºçš„ï¼Œå› æ­¤éœ€è¦ç”¨ç›¸åŒç§å­è¯æ˜æœ‰æƒé™é“¸é€ ä»£å¸ï¼‰ã€‚


æœ€åä¸€ä¸ªå‚æ•°100ï¼šæŒ‡å®šé“¸é€ çš„ä»£å¸æ•°é‡ï¼ˆå‘ä½œè€…è´¦æˆ·é“¸é€  100 ä¸ªä»£å¸ï¼‰ã€‚


apié‡æ–°è°ƒç”¨è¿™éƒ¨åˆ†ä»£ç 
// åˆ›å»ºæ¨æ–‡
const [pda, r3] = await createTweet(defaultWallet, "Hello, world!");

const r4 = await getTweet(defaultWallet, pda);
console.log("defaultWallet public key:", defaultWallet.publicKey);

console.log(r4);

// åˆ›å»ºç‚¹èµ
const visitorPublicKey = visitorWallet.publicKey;
console.log("Visitor public key:", visitorPublicKey.toString());
const r5 = await createLike(visitorWallet, pda);
console.log("Like created:", r5);

const r6 = await getTweet(defaultWallet, pda);
console.log(r6);
ç»“æœæ ¡éªŒ
  anchor_social git:(main) anchor run api
yarn run v1.22.18
warning ../package.json: No license field
$ /Users/tinachan/anchor_social/node_modules/.bin/ts-node app/index.ts
defaultWallet public key: PublicKey [PublicKey(FcKkQZRxD5P6JwGv58vGRAcX3CkjbX8oqFiygz6ohceU)] &#123;
  _bn: &lt;BN: d91024e709f54d65b29c9328658d06a488414c4cabc36522130c330322428769>
&#125;
&#123;
  body: 'Hello, world!',
  likeCount: &lt;BN: 0>,
  author: PublicKey [PublicKey(BiQgNLwkejkdYyvbSSCjKhTsdK6tmn6YZiXhApX88L1q)] &#123;
    _bn: &lt;BN: 9f3074c28783b31efe51bdc42e5a0a6a8c2314d017da6a8ed713ccecd1aee164>
  &#125;
&#125;
Visitor public key: 7rQKPb1bPLS4xU93a43GYmBK7MfY3ChSTSVfA8fcxbRF
Like created: 59rjviQxEK68USP6VfPjqpciwKNcf98jTUpv7CBWEdFqNbAvh9FBTwH3RCcwviK8Wu92G3WACgwv6rafsWgitWDT
&#123;
  body: 'Hello, world!',
  likeCount: &lt;BN: 1>,
  author: PublicKey [PublicKey(BiQgNLwkejkdYyvbSSCjKhTsdK6tmn6YZiXhApX88L1q)] &#123;
    _bn: &lt;BN: 9f3074c28783b31efe51bdc42e5a0a6a8c2314d017da6a8ed713ccecd1aee164>
  &#125;
&#125;
âœ¨  Done in 2.45s.
æˆåŠŸåæŸ¥çœ‹author token accountçš„è´¦æˆ·

]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part14]_Solanaè´¨æŠ¼-native stake</title>
    <url>/2025/08/20/Solana-part14-Solana%E8%B4%A8%E6%8A%BC-native-stake/</url>
    <content><![CDATA[Solana[part14]_Solanaè´¨æŠ¼-native stake
ä»€ä¹ˆæ˜¯ Solana Native Stakingï¼Ÿ
Solana çš„åŸç”Ÿè´¨æŠ¼ï¼ˆNative Stakingï¼‰æ˜¯æŒ‡å°† SOL ä»£å¸è´¨æŠ¼ç»™éªŒè¯è€…ï¼Œä»¥æ”¯æŒ Solana ç½‘ç»œçš„å®‰å…¨è¿è¡Œå¹¶è·å¾—ç›¸åº”å¥–åŠ±çš„è¿‡ç¨‹ã€‚é€šè¿‡è´¨æŠ¼ï¼Œç”¨æˆ·å¯ä»¥å‚ä¸ç½‘ç»œå…±è¯†ï¼ŒåŒæ—¶è·å¾—å¹´åŒ–æ”¶ç›Šï¼ˆAPY é€šå¸¸åœ¨ 4-8% ä¹‹é—´æµ®åŠ¨ï¼‰ã€‚
ä¸€ã€é’±åŒ…æ“ä½œæ–¹å¼
1. å‡†å¤‡å·¥ä½œ

å®‰è£…æ”¯æŒ Solana è´¨æŠ¼çš„é’±åŒ…ï¼ˆæ¨èï¼šPhantomã€Solflareã€Ledger Liveï¼‰
ç¡®ä¿é’±åŒ…ä¸­æœ‰è¶³å¤Ÿçš„ SOLï¼ˆè‡³å°‘éœ€è¦è¦†ç›–è´¨æŠ¼é‡‘é¢ + äº¤æ˜“æ‰‹ç»­è´¹ï¼‰
äº†è§£ Solana éªŒè¯è€…çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå¯ä»¥åœ¨ Solana Validator Explorer æŸ¥çœ‹ï¼‰

2. ä½¿ç”¨ Phantom é’±åŒ…è¿›è¡Œè´¨æŠ¼
æ­¥éª¤ 1ï¼šæ‰“å¼€ Phantom é’±åŒ…å¹¶è¿æ¥åˆ° Solana ä¸»ç½‘
ç¡®ä¿é’±åŒ…ç½‘ç»œå·²åˆ‡æ¢è‡³ â€œSolana Mainnet Betaâ€
æ­¥éª¤ 2ï¼šå¯¼èˆªè‡³è´¨æŠ¼é¡µé¢

åœ¨é’±åŒ…ä¸»é¡µç‚¹å‡» â€œStakeâ€ æˆ– â€œè´¨æŠ¼â€ é€‰é¡¹
ç‚¹å‡» â€œAdd Stakeâ€ æˆ– â€œæ·»åŠ è´¨æŠ¼â€ æŒ‰é’®

æ­¥éª¤ 3ï¼šé€‰æ‹©éªŒè¯è€…

å¯ä»¥é€šè¿‡æœç´¢éªŒè¯è€…çš„åç§°æˆ–åœ°å€æŸ¥æ‰¾
æŸ¥çœ‹éªŒè¯è€…çš„ä½£é‡‘æ¯”ä¾‹ã€æ´»è·ƒåº¦å’Œå†å²è¡¨ç°
é€‰æ‹©åˆé€‚çš„éªŒè¯è€…åç‚¹å‡» â€œSelectâ€ æˆ– â€œé€‰æ‹©â€

æ­¥éª¤ 4ï¼šè¾“å…¥è´¨æŠ¼é‡‘é¢

è¾“å…¥è¦è´¨æŠ¼çš„ SOL æ•°é‡
ç¡®è®¤äº¤æ˜“æ‰‹ç»­è´¹ï¼ˆé€šå¸¸è‡ªåŠ¨è®¡ç®—ï¼‰
ç‚¹å‡» â€œStakeâ€ æˆ– â€œè´¨æŠ¼â€ æŒ‰é’®

æ­¥éª¤ 5ï¼šç¡®è®¤äº¤æ˜“

æ£€æŸ¥äº¤æ˜“è¯¦æƒ…æ— è¯¯åç¡®è®¤
ç­‰å¾…äº¤æ˜“è¢«ç½‘ç»œç¡®è®¤ï¼ˆé€šå¸¸éœ€è¦å‡ ç§’é’Ÿåˆ°ä¸€åˆ†é’Ÿï¼‰

æ­¥éª¤ 6ï¼šæŸ¥çœ‹è´¨æŠ¼çŠ¶æ€

åœ¨ â€œStakeâ€ é¡µé¢å¯ä»¥æŸ¥çœ‹æ‰€æœ‰è´¨æŠ¼å¤´å¯¸
åŒ…æ‹¬è´¨æŠ¼é‡‘é¢ã€éªŒè¯è€…ä¿¡æ¯ã€é¢„è®¡æ”¶ç›Šå’Œè§£é”æ—¶é—´

3. è§£é™¤è´¨æŠ¼ï¼ˆUnstakeï¼‰

åœ¨è´¨æŠ¼å¤´å¯¸æ—ç‚¹å‡» â€œUnstakeâ€ æˆ– â€œè§£é™¤è´¨æŠ¼â€
ç¡®è®¤äº¤æ˜“ï¼Œç­‰å¾…ç½‘ç»œç¡®è®¤
æ³¨æ„ï¼šè§£é™¤è´¨æŠ¼åï¼Œèµ„é‡‘æœ‰å¤§çº¦ 2-3 å¤©çš„è§£é”æœŸï¼ŒæœŸé—´æ— æ³•è½¬ç§»æˆ–å†æ¬¡è´¨æŠ¼

4. é¢†å–å¥–åŠ±

å¤§å¤šæ•°é’±åŒ…ä¼šè‡ªåŠ¨ç´¯ç§¯å¥–åŠ±
éƒ¨åˆ†é’±åŒ…éœ€è¦æ‰‹åŠ¨ç‚¹å‡» â€œClaim Rewardsâ€ æˆ– â€œé¢†å–å¥–åŠ±â€
å¥–åŠ±ä¼šç›´æ¥æ·»åŠ åˆ°ä½ çš„å¯ç”¨ä½™é¢ä¸­

äºŒã€CLI æ“ä½œæ–¹å¼
1. å‡†å¤‡å·¥ä½œ
# åˆ›å»ºæ–°é’±åŒ…
solana-keygen new --outfile ~/.config/solana/my-wallet.json

# å¯¼å…¥ç°æœ‰é’±åŒ…ï¼ˆå¦‚æœ‰ç§é’¥æ–‡ä»¶ï¼‰
# solana-keygen recover -o ~/.config/solana/my-wallet.json

# è®¾ç½®é»˜è®¤é’±åŒ…
solana config set --keypair ~/.config/solana/my-wallet.json

# æŸ¥çœ‹é’±åŒ…ä½™é¢
solana balance
2. è¿›è¡Œè´¨æŠ¼
æ­¥éª¤ 1ï¼šåˆ›å»ºè´¨æŠ¼è´¦æˆ·
# åˆ›å»ºä¸€ä¸ªè´¨æŠ¼è´¦æˆ·ï¼Œéœ€è¦æ”¯ä»˜å°‘é‡ç§Ÿé‡‘
solana create-stake-account ~/.config/solana/my-stake-account.json 10 SOL
# æ³¨æ„ï¼š10 SOL æ˜¯è´¨æŠ¼çš„æœ€å°é‡‘é¢ç¤ºä¾‹ï¼Œå®é™…å¯æ ¹æ®éœ€è¦è°ƒæ•´
æ­¥éª¤ 2ï¼šæŸ¥æ‰¾éªŒè¯è€…
# è·å–éªŒè¯è€…åˆ—è¡¨ï¼ˆå‰100åï¼‰
solana validators --output json-compact | jq '.validators[0:100] | map(&#123;votePubkey: .votePubkey, commission: .commission, activatedStake: .activatedStake&#125;)'

# é€‰æ‹©ä¸€ä¸ªéªŒè¯è€…çš„ vote account åœ°å€ï¼ˆç¤ºä¾‹ï¼‰
VALIDATOR_VOTE_ADDRESS="GdnSyH3YtwcxFvQrVVJMm1JhTS4QVX7MFsX56uJLUfiZ"
æ­¥éª¤ 3ï¼šè¿›è¡Œè´¨æŠ¼
# å°†è´¨æŠ¼è´¦æˆ·å§”æ‰˜ç»™éªŒè¯è€…
solana delegate-stake ~/.config/solana/my-stake-account.json $VALIDATOR_VOTE_ADDRESS
æ­¥éª¤ 4ï¼šæŸ¥çœ‹è´¨æŠ¼çŠ¶æ€
# æŸ¥çœ‹è´¨æŠ¼è´¦æˆ·ä¿¡æ¯
solana stake-account ~/.config/solana/my-stake-account.json

# æŸ¥çœ‹æ‰€æœ‰è´¨æŠ¼è´¦æˆ·
solana stakes
3. å¢åŠ è´¨æŠ¼é‡‘é¢
# å‘ç°æœ‰è´¨æŠ¼è´¦æˆ·æ·»åŠ æ›´å¤š SOL
solana delegate-stake --increase ~/.config/solana/my-stake-account.json $VALIDATOR_VOTE_ADDRESS 5 SOL
# è¿™é‡Œçš„ 5 SOL æ˜¯è¦å¢åŠ çš„è´¨æŠ¼é‡‘é¢
4. è§£é™¤è´¨æŠ¼
# è§£é™¤è´¨æŠ¼ï¼ˆå¼€å§‹è§£é”è¿‡ç¨‹ï¼‰
solana deactivate-stake ~/.config/solana/my-stake-account.json

# æ£€æŸ¥è§£é”çŠ¶æ€ï¼ˆéœ€è¦ç­‰å¾…è§£é”æœŸï¼‰
solana stake-account ~/.config/solana/my-stake-account.json
5. æå–è´¨æŠ¼èµ„é‡‘
åœ¨è§£é”æœŸç»“æŸåï¼Œå¯ä»¥æå–èµ„é‡‘ï¼š
# æå–è´¨æŠ¼çš„ SOL åˆ°é’±åŒ…
solana withdraw-stake ~/.config/solana/my-stake-account.json ~/.config/solana/my-wallet.json 100%
# 100% è¡¨ç¤ºæå–å…¨éƒ¨é‡‘é¢ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“æ•°é‡å¦‚ 5 SOL
6. é¢†å–å¥–åŠ±
# æŸ¥çœ‹å¯é¢†å–çš„å¥–åŠ±
solana get-rewards ~/.config/solana/my-stake-account.json --output json

# é¢†å–å¥–åŠ±åˆ°é’±åŒ…
solana withdraw-stake --withdraw-from-rewards ~/.config/solana/my-stake-account.json ~/.config/solana/my-wallet.json 100%
ä¸‰ã€æ³¨æ„äº‹é¡¹


éªŒè¯è€…é€‰æ‹©ï¼šé€‰æ‹©ä½£é‡‘åˆç†ã€å†å²è¡¨ç°è‰¯å¥½çš„éªŒè¯è€…ï¼Œé¿å…é€‰æ‹©è¿‡äºé›†ä¸­çš„éªŒè¯è€…ä»¥åˆ†æ•£é£é™©ã€‚


è´¨æŠ¼å‘¨æœŸï¼šè´¨æŠ¼æ²¡æœ‰å›ºå®šæœŸé™ï¼Œä½†è§£é™¤è´¨æŠ¼æœ‰ 2-3 å¤©çš„è§£é”æœŸã€‚


å¥–åŠ±è®¡ç®—ï¼šå¥–åŠ±æŒ‰ epochï¼ˆçº¦ 2 å¤©ï¼‰è®¡ç®—å’Œå‘æ”¾ï¼Œå…·ä½“æ”¶ç›Šå–å†³äºç½‘ç»œæ•´ä½“è´¨æŠ¼ç‡å’ŒéªŒè¯è€…è¡¨ç°ã€‚


å®‰å…¨è€ƒè™‘ï¼š

ä¸è¦å°†ç§é’¥åˆ†äº«ç»™ä»»ä½•äºº
å¤§é¢è´¨æŠ¼å»ºè®®ä½¿ç”¨ç¡¬ä»¶é’±åŒ…ï¼ˆå¦‚ Ledgerï¼‰
å®šæœŸæ£€æŸ¥éªŒè¯è€…çŠ¶æ€



è´¹ç”¨é—®é¢˜ï¼šæ‰€æœ‰æ“ä½œéƒ½éœ€è¦æ”¯ä»˜å°‘é‡äº¤æ˜“è´¹ï¼Œç¡®ä¿é’±åŒ…ä¸­æœ‰è¶³å¤Ÿçš„ SOL æ”¯ä»˜è´¹ç”¨ã€‚


]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part15]_Solanaè´¨æŠ¼-æµåŠ¨æ€§è´¨æŠ¼</title>
    <url>/2025/08/20/Solana-part15-Solana%E8%B4%A8%E6%8A%BC-%E6%B5%81%E5%8A%A8%E6%80%A7%E8%B4%A8%E6%8A%BC/</url>
    <content><![CDATA[Solana[part15]_Solanaè´¨æŠ¼-æµåŠ¨æ€§è´¨æŠ¼
ä¸€ã€æµåŠ¨æ€§è´¨æŠ¼æ ¸å¿ƒæ¦‚å¿µä¸è§’è‰²
1. åŸºæœ¬å®šä¹‰
æµåŠ¨æ€§è´¨æŠ¼ï¼ˆLiquid Stakingï¼‰æ˜¯ä¸€ç§å…è®¸ç”¨æˆ·è´¨æŠ¼åŠ å¯†èµ„äº§æ”¯æŒåŒºå—é“¾ç½‘ç»œå®‰å…¨ï¼ŒåŒæ—¶é€šè¿‡æ¥æ”¶æµåŠ¨æ€§ä»£å¸ï¼ˆLiquid Staking Token, LSTï¼‰ä¿æŒèµ„äº§æµåŠ¨æ€§çš„æœºåˆ¶ã€‚
åœ¨Solanaç”Ÿæ€ä¸­ï¼Œç”¨æˆ·è´¨æŠ¼SOLåä¼šæ”¶åˆ°å¯¹åº”æ¯”ä¾‹çš„LSTï¼ˆå¦‚mSOLã€stSOLç­‰ï¼‰ï¼Œè¿™äº›ä»£å¸å¯åœ¨DeFiåº”ç”¨ä¸­è‡ªç”±ä½¿ç”¨ï¼ˆäº¤æ˜“ã€å€Ÿè´·ç­‰ï¼‰ï¼ŒåŒæ—¶ä»èƒ½è·å¾—è´¨æŠ¼å¥–åŠ±ã€‚
2. å·¥ä½œåŸç†
graph TD
    A[ç”¨æˆ·è´¨æŠ¼SOL] --&gt; B[æµåŠ¨æ€§è´¨æŠ¼åè®®æ¥æ”¶SOL]
    B --&gt; C[åè®®åˆ†é…SOLç»™éªŒè¯è€…èŠ‚ç‚¹]
    B --&gt; D[ç”¨æˆ·è·å¾—ç­‰é¢LST]
    D --&gt; E[LSTåœ¨DeFiåœºæ™¯ä½¿ç”¨]
    C --&gt; F[äº§ç”Ÿè´¨æŠ¼å¥–åŠ±]
    F --&gt; G[LSTä»·å€¼éšå¥–åŠ±å¢å€¼]
    D --&gt; H[ç”¨æˆ·èµå›LSTä¸ºSOL]
    
3. ä¸åŸç”Ÿè´¨æŠ¼çš„æ ¸å¿ƒåŒºåˆ«



ç‰¹æ€§
åŸç”Ÿè´¨æŠ¼
æµåŠ¨æ€§è´¨æŠ¼




èµ„äº§æµåŠ¨æ€§
ä½ï¼ˆè§£é”éœ€2-3å¤©ï¼‰
é«˜ï¼ˆLSTå¯è‡ªç”±æµé€šï¼‰


èµ„é‡‘åˆ©ç”¨ç‡
ä½ï¼ˆèµ„é‡‘é”å®šï¼‰
é«˜ï¼ˆLSTå¯å¤ç”¨è‡³å…¶ä»–åœºæ™¯ï¼‰


æ”¶ç›Šæ¨¡å¼
å•ä¸€è´¨æŠ¼å¥–åŠ±
è´¨æŠ¼å¥–åŠ±+LSTåº”ç”¨æ”¶ç›Š


æ“ä½œå¤æ‚åº¦
è¾ƒä½
ä¸­ç­‰ï¼ˆéœ€äº†è§£LSTç”Ÿæ€ï¼‰



4. æ ¸å¿ƒè§’è‰²ä¸èŒè´£



è§’è‰²
æ ¸å¿ƒèŒè´£




Manager
è´¨æŠ¼æ± åˆ›å»ºè€…ï¼Œè´Ÿè´£é…ç½®è§„åˆ™ï¼ˆè´¹ç‡ã€æƒé™ï¼‰ã€ç®¡ç†éªŒè¯è€…èŠ‚ç‚¹ã€ç»´æŠ¤è´¨æŠ¼æ± å¹³è¡¡


User
è´¨æŠ¼SOL/è´¨æŠ¼è´¦æˆ·ã€è·å–LSTã€èµå›èµ„äº§ï¼Œäº«å—è´¨æŠ¼æ”¶ç›Š



äºŒã€ç¯å¢ƒå‡†å¤‡ï¼ˆæœ¬åœ°æµ‹è¯•ç½‘ï¼‰

å‰ç½®æ“ä½œï¼šä¸ºåç»­Managerå’ŒUserçš„å®æ“æ­å»ºæœ¬åœ°æµ‹è¯•ç¯å¢ƒ

1. å·¥å…·å®‰è£…
# å®‰è£…Solana CLIå’Œè´¨æŠ¼æ± å·¥å…·
sh -c "$(curl -sSfL https://release.solana.com/stable/install)"
cargo install spl-stake-pool-cli

# å…‹éš†è´¨æŠ¼æ± ä»£ç ï¼ˆéƒ¨ç½²ä¾èµ–ï¼‰
git clone https://github.com/solana-labs/spl-stake-pool.git
cd spl-stake-pool &amp;&amp; cargo build-bpf
2. å¯åŠ¨æœ¬åœ°æµ‹è¯•ç½‘ï¼ˆåŠ è½½è´¨æŠ¼æ± ç¨‹åºï¼‰
solana-test-validator \
  --ledger ./test-ledger \  # æ•°æ®å­˜å‚¨è·¯å¾„
  --bpf-program STAKE11111111111111111111111111111111111111 ./target/deploy/spl_stake_pool.so \  # åŠ è½½è´¨æŠ¼æ± ç¨‹åº
  --reset  # é‡ç½®æµ‹è¯•ç½‘çŠ¶æ€ï¼ˆé¦–æ¬¡å¯åŠ¨å»ºè®®æ·»åŠ ï¼‰
ä¸‰ã€Manageræ“ä½œï¼šè´¨æŠ¼æ± å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

æµç¨‹ï¼šåˆ›å»ºèº«ä»½ â†’ åˆå§‹åŒ–è´¨æŠ¼æ±  â†’ é…ç½®éªŒè¯è€… â†’ ç»´æŠ¤è´¨æŠ¼æ± 

1. ç”ŸæˆManagerèº«ä»½å¯†é’¥
solana-keygen new --outfile pool-manager.json --no-passphrase
2. åˆ›å»ºè´¨æŠ¼æ± ï¼ˆåˆå§‹åŒ–æ ¸å¿ƒå‚æ•°ï¼‰
# æ›¿æ¢$USER_ADDRä¸ºåç»­ç”¨æˆ·ä¸»è´¦æˆ·åœ°å€ï¼ˆè§ç¬¬å››ç« æ­¥éª¤1ï¼‰
spl-stake-pool create-pool \
  --manager pool-manager.json \          # Managerèº«ä»½ï¼ˆç­¾åæƒé™ï¼‰
  --fee-owner $USER_ADDR \              # ç®¡ç†è´¹æ¥æ”¶åœ°å€
  --withdrawal-fee 0.01 \               # æç°æ‰‹ç»­è´¹ï¼ˆ1%ï¼‰
  --management-fee 0.1 \                # è´¨æŠ¼å¥–åŠ±ç®¡ç†è´¹ï¼ˆ10%ï¼‰
  --stake-deposit-authority $USER_ADDR \# å…è®¸ç”¨æˆ·å­˜å…¥è´¨æŠ¼è´¦æˆ·çš„æƒé™
  --withdrawal-authority $USER_ADDR \   # å…è®¸ç”¨æˆ·æç°çš„æƒé™
  --no-lamports-check                   # æµ‹è¯•ç½‘è·³è¿‡ä½™é¢æ£€æŸ¥

è¾“å‡ºå…³é”®ä¿¡æ¯ï¼šè´¨æŠ¼æ± åœ°å€ï¼ˆPOOL_ADDRï¼‰ã€æµåŠ¨æ€§ä»£å¸Mintåœ°å€ï¼ˆTOKEN_MINTï¼‰

3. é…ç½®æµåŠ¨æ€§ä»£å¸å…ƒæ•°æ®ï¼ˆé’±åŒ…æ˜¾ç¤ºï¼‰
spl-stake-pool create-token-metadata \
  $POOL_ADDR \           # è´¨æŠ¼æ± åœ°å€
  "MyStakePoolToken" \   # ä»£å¸åç§°
  "MPT" \                # ä»£å¸ç¬¦å·ï¼ˆå¦‚mSOLï¼‰
  --manager pool-manager.json
4. éªŒè¯è€…èŠ‚ç‚¹ç®¡ç†
â‘  åˆ›å»ºæµ‹è¯•éªŒè¯è€…æŠ•ç¥¨è´¦æˆ·ï¼ˆæµ‹è¯•ç½‘ä¸“ç”¨ï¼‰
solana-keygen new --outfile validator.json --no-passphrase
solana create-vote-account validator-vote.json validator.json 100
VALIDATOR_VOTE_ADDR=$(solana address -k validator-vote.json)  # è·å–éªŒè¯è€…æŠ•ç¥¨åœ°å€
â‘¡ æ·»åŠ éªŒè¯è€…åˆ°è´¨æŠ¼æ± 
spl-stake-pool add-validator \
  $POOL_ADDR \
  $VALIDATOR_VOTE_ADDR \  # éªŒè¯è€…æŠ•ç¥¨è´¦æˆ·åœ°å€
  --manager pool-manager.json
â‘¢ è°ƒæ•´éªŒè¯è€…è´¨æŠ¼åˆ†é…


å¢åŠ è´¨æŠ¼é‡ï¼ˆ100 SOLï¼‰ï¼š
spl-stake-pool increase-validator-stake \
  $POOL_ADDR \
  $VALIDATOR_VOTE_ADDR \
  100 \
  --manager pool-manager.json


å‡å°‘è´¨æŠ¼é‡ï¼ˆ50 SOLï¼‰ï¼š
spl-stake-pool decrease-validator-stake \
  $POOL_ADDR \
  $VALIDATOR_VOTE_ADDR \
  50 \
  --manager pool-manager.json


5. è´¨æŠ¼æ± ç»´æŠ¤ï¼ˆæ”¶ç›Šå†å¹³è¡¡ï¼‰
å®šæ—¶è§¦å‘è´¨æŠ¼èµ„é‡‘åœ¨éªŒè¯è€…é—´çš„ä¼˜åŒ–åˆ†é…ï¼ˆå‘é«˜æ”¶ç›ŠèŠ‚ç‚¹å€¾æ–œï¼‰ï¼š
spl-stake-pool update \
  $POOL_ADDR \
  --manager pool-manager.json
å››ã€Useræ“ä½œï¼šè´¨æŠ¼ä¸èµå›å…¨æµç¨‹

æµç¨‹ï¼šåˆ›å»ºç”¨æˆ·èº«ä»½ â†’ è´¨æŠ¼SOL/è´¨æŠ¼è´¦æˆ· â†’ èµå›SOL/è´¨æŠ¼è´¦æˆ·

1. å‡†å¤‡Userä¸»è´¦æˆ·
solana-keygen new --outfile user.json --no-passphrase
solana config set --keypair user.json  # è®¾ä¸ºé»˜è®¤ç­¾åè´¦æˆ·
USER_ADDR=$(solana address)  # è·å–ç”¨æˆ·åœ°å€
solana airdrop 1000 $USER_ADDR  # æµ‹è¯•ç½‘ç©ºæŠ•SOLï¼ˆç”¨äºè´¨æŠ¼ï¼‰
2. è´¨æŠ¼æ“ä½œ
â‘  ç›´æ¥è´¨æŠ¼SOLï¼ˆè‡ªåŠ¨åˆ›å»ºè´¨æŠ¼è´¦æˆ·ï¼‰
é€‚åˆæ™®é€šç”¨æˆ·ï¼Œæ— éœ€æå‰å‡†å¤‡è´¨æŠ¼è´¦æˆ·ï¼š
spl-stake-pool deposit-sol \
  $POOL_ADDR \  # ç›®æ ‡è´¨æŠ¼æ± åœ°å€
  50 \          # è´¨æŠ¼50 SOL
  --source user.json  # ç”¨æˆ·ç­¾å
â‘¡ è´¨æŠ¼å·²æœ‰è´¨æŠ¼è´¦æˆ·ï¼ˆè‡ªå®šä¹‰è´¨æŠ¼ç­–ç•¥ï¼‰
é€‚åˆæœºæ„ç”¨æˆ·æˆ–éœ€çµæ´»é…ç½®è´¨æŠ¼çš„åœºæ™¯ï¼š

å…ˆåˆ›å»ºè´¨æŠ¼è´¦æˆ·ï¼šsolana create-stake-account stake-account.json 100  # è´¨æŠ¼è´¦æˆ·å­˜å…¥100 SOL

å­˜å…¥è´¨æŠ¼æ± ï¼šspl-stake-pool deposit-stake \
  $POOL_ADDR \
  stake-account.json \  # å·²åˆ›å»ºçš„è´¨æŠ¼è´¦æˆ·
  --source user.json    # ç”¨æˆ·ç­¾å


3. èµå›æ“ä½œ
â‘  ç›´æ¥èµå›SOLï¼ˆå¿«é€Ÿæç°ï¼Œä¾èµ–æ± å†…æµåŠ¨æ€§ï¼‰
é€‚åˆç´§æ€¥æˆ–å°é¢æç°ï¼š
spl-stake-pool withdraw-sol \
  $POOL_ADDR \
  20 \          # èµå›20 SOL
  --owner user.json  # ç”¨æˆ·ç­¾å
â‘¡ èµå›è‡³æ–°è´¨æŠ¼è´¦æˆ·ï¼ˆå¤§é¢èµå›ï¼Œéœ€è§£é”æœŸï¼‰


å‘èµ·æç°è¯·æ±‚ï¼ˆåˆ›å»ºæ–°è´¨æŠ¼è´¦æˆ·ï¼‰ï¼š
spl-stake-pool request-withdrawal \
  $POOL_ADDR \
  30 \  # èµå›30 SOLå¯¹åº”çš„LST
  --owner user.json \
  --new-stake-account new-stake.json  # æ–°è´¨æŠ¼è´¦æˆ·


æµ‹è¯•ç½‘è·³è¿‡è§£é”æœŸï¼ˆæ¨¡æ‹Ÿæ—¶é—´æµé€ï¼‰ï¼š
solana advance-clock +1000  # æ¨è¿›1000ä¸ªslotï¼ˆçº¦10åˆ†é’Ÿï¼‰


å®Œæˆæç°å¹¶æå–SOLåˆ°ä¸»è´¦æˆ·ï¼š
spl-stake-pool complete-withdrawal \
  $POOL_ADDR \
  new-stake.json \
  --owner user.json

solana withdraw-stake new-stake.json $USER_ADDR 100%  # ä»è´¨æŠ¼è´¦æˆ·æå–å…¨éƒ¨SOL


äº”ã€æœºåˆ¶è§£æä¸æ“ä½œå¯¹æ¯”
1. æµåŠ¨æ€§ä»£å¸ï¼ˆLSTï¼‰å¢å€¼é€»è¾‘

åˆå§‹æ¯”ä¾‹ä¸º1:1ï¼ˆ1 LST = 1 SOLï¼‰ï¼Œéšè´¨æŠ¼å¥–åŠ±ç´¯ç§¯ï¼Œ1 LSTå¯¹åº”çš„SOLæ•°é‡ä¼šå¢é•¿ï¼ˆå¦‚1:1.1ï¼‰ã€‚
Manageræ”¶å–çš„ç®¡ç†è´¹ï¼ˆå¦‚10%ï¼‰ä»ç”¨æˆ·å¥–åŠ±ä¸­æ‰£é™¤ï¼Œç›´æ¥å½±å“LSTå¢å€¼é€Ÿåº¦ã€‚

2. Useræ“ä½œå¯¹æ¯”è¡¨



æ“ä½œç±»å‹
ç‰¹ç‚¹
é€‚ç”¨åœºæ™¯




deposit-sol
è‡ªåŠ¨åˆ›å»ºè´¨æŠ¼è´¦æˆ·ï¼Œæ“ä½œç®€
æ™®é€šç”¨æˆ·å°é¢è´¨æŠ¼


deposit-stake
éœ€æå‰åˆ›å»ºè´¨æŠ¼è´¦æˆ·ï¼Œçµæ´»
æœºæ„ç”¨æˆ·/è‡ªå®šä¹‰ç­–ç•¥


withdraw-sol
å¿«é€Ÿèµå›ï¼Œä¾èµ–æ± å†…æµåŠ¨æ€§
ç´§æ€¥æç°/å°é¢èµå›


withdraw-stake
éœ€è§£é”æœŸï¼Œé‡‘é¢æ— ä¸Šé™
å¤§é¢èµå›/é•¿æœŸè´¨æŠ¼åæç°



3. Manageræ ¸å¿ƒé€»è¾‘

éªŒè¯è€…ä¼˜åŒ–ï¼šé€šè¿‡add-validatorå’Œè´¨æŠ¼é‡è°ƒæ•´ï¼Œå°†èµ„é‡‘åˆ†é…ç»™é«˜æ”¶ç›Šã€ä½é£é™©éªŒè¯è€…ã€‚
è‡ªåŠ¨å¹³è¡¡ï¼šupdateæ“ä½œè§¦å‘èµ„é‡‘é‡åˆ†é…ï¼Œç¡®ä¿æ”¶ç›Šæœ€å¤§åŒ–ã€‚
è§„åˆ™æ§åˆ¶ï¼šå¯é€šè¿‡set-withdrawal-fee/set-management-feeåŠ¨æ€è°ƒæ•´è´¹ç‡ã€‚

å…­ã€å¸¸è§é—®é¢˜ä¸è°ƒè¯•
1. Manageræ“ä½œæŠ¥é”™

Permission deniedï¼šæ£€æŸ¥--managerå‚æ•°æ˜¯å¦ä¸ºpool-manager.jsonï¼ˆéœ€Managerç­¾åï¼‰ã€‚
Validator not foundï¼šç¡®è®¤éªŒè¯è€…æŠ•ç¥¨è´¦æˆ·åœ°å€æ­£ç¡®ï¼Œä¸”å·²é€šè¿‡add-validatoråŠ å…¥æ± ã€‚

2. Useræ“ä½œé—®é¢˜

è´¨æŠ¼åæœªæ”¶åˆ°LSTï¼šé€šè¿‡solana transaction-status &lt;TX_HASH&gt;æŸ¥è¯¢äº¤æ˜“çŠ¶æ€ï¼Œç¡®è®¤è´¨æŠ¼æ± æ˜¯å¦æœ‰æƒé™å‘è¡Œä»£å¸ã€‚
èµå›å¤±è´¥ï¼šwithdraw-solå¤±è´¥å¯èƒ½å› æ± å†…æµåŠ¨æ€§ä¸è¶³ï¼Œå»ºè®®æ”¹ç”¨withdraw-stakeã€‚

3. è´¨æŠ¼æ± updateæ— æ•ˆæœ

ç¡®ä¿æ± å†…æœ‰å¯åˆ†é…çš„è´¨æŠ¼èµ„é‡‘ï¼Œæˆ–éªŒè¯è€…æŠ•ç¥¨è´¦æˆ·çŠ¶æ€æ­£å¸¸ï¼ˆå¯é€šè¿‡solana vote-account &lt;VOTE_ADDR&gt;æ£€æŸ¥ï¼‰ã€‚

é€šè¿‡Managerå¯¹è´¨æŠ¼æ± çš„ä¸“ä¸šç®¡ç†ä¸Userçš„çµæ´»æ“ä½œï¼ŒæµåŠ¨æ€§è´¨æŠ¼å®ç°äº†â€œæ”¶ç›Šæ€§â€ä¸â€œæµåŠ¨æ€§â€çš„å¹³è¡¡ã€‚æœ¬åœ°æµ‹è¯•ç½‘å¯åå¤æ¼”ç»ƒä¸Šè¿°æµç¨‹ï¼Œå¸®åŠ©ç†è§£å…¶åº•å±‚é€»è¾‘ï¼
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part16]_Solanaè´¨æŠ¼-ç¼–å†™åº”ç”¨çº§åˆ«çš„è´¨æŠ¼åˆçº¦-è´¨æŠ¼éƒ¨åˆ†</title>
    <url>/2025/08/22/Solana-part16-Solana%E8%B4%A8%E6%8A%BC-%E7%BC%96%E5%86%99%E5%BA%94%E7%94%A8%E7%BA%A7%E5%88%AB%E7%9A%84%E8%B4%A8%E6%8A%BC%E5%90%88%E7%BA%A6-%E8%B4%A8%E6%8A%BC%E9%83%A8%E5%88%86/</url>
    <content><![CDATA[Solanaè´¨æŠ¼-ç¼–å†™åº”ç”¨çº§åˆ«çš„è´¨æŠ¼åˆçº¦-è´¨æŠ¼éƒ¨åˆ†

æ ¸å¿ƒä»£ç è§ï¼š
https://github.com/SoniaChan33/anchor_social/commit/48b428c2a33213275cea8cc42be199f8bfc7a332 nft mint ç¼–å†™
https://github.com/SoniaChan33/anchor_social/commit/a27180fc342c3be81e670794f0e0ddf22817881c  stake nft

1. NFT é“¸é€ ï¼ˆMintï¼‰åŠŸèƒ½
1.1 åŠŸèƒ½è¯´æ˜
é€šè¿‡ nft_mint_v1 æ–¹æ³•å®ç° NFT é“¸é€ ï¼Œéµå¾ª MPL Token Metadata æ ‡å‡†ï¼Œåˆ›å»ºåŒ…å«å…ƒæ•°æ®çš„å”¯ä¸€ NFTï¼Œä¸»è¦æµç¨‹åŒ…æ‹¬ï¼š

åˆ›å»º NFT å…ƒæ•°æ®è´¦æˆ·
é“¸é€  1 ä¸ªä»£å¸åˆ°å…³è”è´¦æˆ·
åˆ›å»ºä¸»ç‰ˆæœ¬è´¦æˆ·ï¼ˆMaster Editionï¼‰ç¡®ä¿å”¯ä¸€æ€§

1.2 æ ¸å¿ƒå®ç°ï¼ˆnft_mint.rsï¼‰
1.2.1 é“¸é€ æ–¹æ³•
pub fn nft_mint_v1(ctx: Context&lt;NFTMint>, nft_id: String) -> Result&lt;()> &#123;
    // å®šä¹‰ç­¾åç§å­ï¼ˆPDAï¼‰
    let signer_seeds: &amp;[&amp;[&amp;[u8]]] = &amp;[&amp;[
        MyNFT::SEED_PREFIX.as_bytes(),
        nft_id.as_bytes(),
        &amp;[ctx.bumps.nft_mint_account],
    ]];

    // åˆ›å»ºå…ƒæ•°æ®è´¦æˆ·
    create_metadata_accounts_v3(
        CpiContext::new_with_signer(
            ctx.accounts.token_metadata_program.to_account_info(),
            CreateMetadataAccountsV3 &#123;
                metadata: ctx.accounts.meta_account.to_account_info(),
                mint: ctx.accounts.nft_mint_account.to_account_info(),
                mint_authority: ctx.accounts.nft_mint_account.to_account_info(),
                update_authority: ctx.accounts.nft_mint_account.to_account_info(),
                payer: ctx.accounts.authority.to_account_info(),
                system_program: ctx.accounts.system_program.to_account_info(),
                rent: ctx.accounts.rent.to_account_info(),
            &#125;,
            signer_seeds,
        ),
        DataV2 &#123;
            name: format!("&#123;&#125; #&#123;&#125;", MyNFT::TOKEN_NAME.to_string(), nft_id),
            symbol: MyNFT::TOKEN_SYMBOL.to_string(),
            uri: MyNFT::TOKEN_URL.to_string(),
            seller_fee_basis_points: 0,
            creators: None,
            collection: None,
            uses: None,
        &#125;,
        false,
        true,
        None,
    )?;

    // é“¸é€  1 ä¸ª NFT åˆ°å…³è”è´¦æˆ·
    mint_to(
        CpiContext::new_with_signer(
            ctx.accounts.token_program.to_account_info(),
            MintTo &#123;
                mint: ctx.accounts.nft_mint_account.to_account_info(),
                to: ctx.accounts.nft_associated_token_account.to_account_info(),
                authority: ctx.accounts.nft_mint_account.to_account_info(),
            &#125;,
            signer_seeds,
        ),
        1,
    )?;

    // åˆ›å»ºä¸»ç‰ˆæœ¬è´¦æˆ·ï¼ˆé™åˆ¶æœ€å¤§å‘è¡Œé‡ä¸º 1ï¼‰
    create_master_edition_v3(
        CpiContext::new_with_signer(
            ctx.accounts.token_metadata_program.to_account_info(),
            CreateMasterEditionV3 &#123;
                edition: ctx.accounts.master_edition_account.to_account_info(),
                payer: ctx.accounts.authority.to_account_info(),
                mint: ctx.accounts.nft_mint_account.to_account_info(),
                metadata: ctx.accounts.meta_account.to_account_info(),
                mint_authority: ctx.accounts.nft_mint_account.to_account_info(),
                update_authority: ctx.accounts.nft_mint_account.to_account_info(),
                system_program: ctx.accounts.system_program.to_account_info(),
                token_program: ctx.accounts.token_program.to_account_info(),
                rent: ctx.accounts.rent.to_account_info(),
            &#125;,
            signer_seeds,
        ),
        Some(1), // æœ€å¤§å‘è¡Œé‡ï¼Œç¡®ä¿ NFT å”¯ä¸€æ€§
    )?;

    Ok(())
&#125;
1.2.2 è´¦æˆ·ç»“æ„ï¼ˆNFTMintï¼‰
#[derive(Accounts)]
#[instruction(nft_id: String)]
pub struct NFTMint&lt;'info> &#123;
    /// ä¸»ç‰ˆæœ¬è´¦æˆ·ï¼ˆMPL æ ‡å‡†ï¼‰
    #[account(
        mut,
        seeds = [
            b"metadata",
            token_metadata_program.key().as_ref(),
            nft_mint_account.key().as_ref(),
            b"edition".as_ref(),
        ],
        bump,
        seeds::program = token_metadata_program.key(),
    )]
    pub master_edition_account: UncheckedAccount&lt;'info>,

    /// å…ƒæ•°æ®è´¦æˆ·ï¼ˆMPL æ ‡å‡†ï¼‰
    #[account(
        mut,
        seeds = [
            b"metadata",
            token_metadata_program.key().as_ref(),
            nft_mint_account.key().as_ref(),
        ],
        bump,
        seeds::program = token_metadata_program.key(),
    )]
    pub meta_account: UncheckedAccount&lt;'info>,

    /// NFT Mint è´¦æˆ·ï¼ˆPDA æ´¾ç”Ÿï¼‰
    #[account(
        init_if_needed,
        payer = authority,
        seeds = [MyNFT::SEED_PREFIX.as_bytes(), &amp;nft_id.to_string().as_bytes()],
        bump,
        mint::decimals = MyNFT::TOKEN_DECIMALS,
        mint::authority = nft_mint_account.key(),
        mint::freeze_authority = nft_mint_account.key(),
    )]
    pub nft_mint_account: Account&lt;'info, Mint>,

    /// ç”¨æˆ·å…³è”çš„ NFT ä»£å¸è´¦æˆ·
    #[account(
        init_if_needed,
        payer = authority,
        associated_token::mint = nft_mint_account,
        associated_token::authority = authority,
    )]
    pub nft_associated_token_account: Account&lt;'info, TokenAccount>,

    #[account(mut)]
    pub authority: Signer&lt;'info>, // å‘èµ·è€…ç­¾åè´¦æˆ·

    // ä¾èµ–ç¨‹åº
    pub token_program: Program&lt;'info, Token>,
    pub system_program: Program&lt;'info, System>,
    pub token_metadata_program: Program&lt;'info, Metadata>,
    pub associated_token_program: Program&lt;'info, AssociatedToken>,
    pub rent: Sysvar&lt;'info, Rent>,
&#125;
1.2.3 NFT é…ç½®å¸¸é‡ï¼ˆstate/nft.rsï¼‰
pub struct MyNFT;

impl MyNFT &#123;
    pub const SEED_PREFIX: &amp;'static str = "MyNFT_v1"; // PDA ç§å­å‰ç¼€
    pub const TOKEN_DECIMALS: u8 = 0; // NFT é€šå¸¸ä½¿ç”¨ 0 ä½å°æ•°
    pub const TOKEN_NAME: &amp;'static str = "My NFT"; // åç§°å‰ç¼€
    pub const TOKEN_SYMBOL: &amp;'static str = "MTK"; // ç¬¦å·
    pub const TOKEN_URL: &amp;'static str = "https://img.soniachen.com/IMG_0151.JPG"; // å…ƒæ•°æ® URI
&#125;
1.3 å®¢æˆ·ç«¯è°ƒç”¨ç¤ºä¾‹ï¼ˆapp/api/nft.tsï¼‰
import * as anchor from "@coral-xyz/anchor";
import &#123; program &#125; from "./wallet";

export async function nftMint(wallet: anchor.Wallet, nftId: string) &#123;
    const tx = await program.methods.nftMint(nftId).accounts(&#123;
        authority: wallet.publicKey,
    &#125;).rpc();
    return tx;
&#125;
2. NFT è´¨æŠ¼ï¼ˆStakeï¼‰åŠŸèƒ½
2.1 åŠŸèƒ½è¯´æ˜
é€šè¿‡ nft_stake æ–¹æ³•å®ç° NFT è´¨æŠ¼ï¼Œä¸»è¦æµç¨‹åŒ…æ‹¬ï¼š

åˆ›å»ºè´¨æŠ¼ä¿¡æ¯è®°å½•ï¼ˆStakeInfoï¼‰
å°† NFT ä»ç”¨æˆ·è´¦æˆ·è½¬ç§»åˆ°è´¨æŠ¼æ± ï¼ˆç¨‹åºæ‰˜ç®¡è´¦æˆ·ï¼‰
é“¸é€ æµåŠ¨æ€§ä»£å¸ä½œä¸ºè´¨æŠ¼å¥–åŠ±

2.2 æ ¸å¿ƒå®ç°ï¼ˆnft_stake.rsï¼‰
2.2.1 è´¨æŠ¼æ–¹æ³•
pub fn nft_stake(ctx: Context&lt;NFTStake>) -> Result&lt;()> &#123;
    // è®°å½•è´¨æŠ¼å…³ç³»
    let stake_info = StakeInfo::new(
        ctx.accounts.authority.key(),
        ctx.accounts.nft_mint_account.key(),
    );
    ctx.accounts.stake_info.set_inner(stake_info.clone());

    // å°† NFT ä»ç”¨æˆ·è´¦æˆ·è½¬ç§»åˆ°è´¨æŠ¼æ± 
    transfer(
        CpiContext::new(
            ctx.accounts.token_program.to_account_info(),
            Transfer &#123;
                from: ctx.accounts.nft_associated_token_account.to_account_info(),
                to: ctx.accounts.program_receipt_ata.to_account_info(),
                authority: ctx.accounts.authority.to_account_info(),
            &#125;,
        ),
        1, // NFT æ•°é‡ä¸º 1
    )?;

    // é“¸é€ æµåŠ¨æ€§ä»£å¸ä½œä¸ºå¥–åŠ±
    let signer_seeds: &amp;[&amp;[&amp;[u8]]] = &amp;[&amp;[
        MyToken::SEED_PREFIX.as_bytes(),
        &amp;[ctx.bumps.token_mint_account],
    ]];

    mint_to(
        CpiContext::new(
            ctx.accounts.token_program.to_account_info(),
            MintTo &#123;
                mint: ctx.accounts.token_mint_account.to_account_info(),
                to: ctx.accounts.associated_token_account.to_account_info(),
                authority: ctx.accounts.token_mint_account.to_account_info(),
            &#125;,
        )
        .with_signer(signer_seeds),
        10000, // å¥–åŠ±ä»£å¸æ•°é‡
    )?;

    Ok(())
&#125;
2.2.2 è´¦æˆ·ç»“æ„ï¼ˆNFTStakeï¼‰
#[derive(Accounts)]
pub struct NFTStake&lt;'info> &#123;
    /// è´¨æŠ¼ä¿¡æ¯è®°å½•è´¦æˆ·
    #[account(
        init_if_needed,
        payer = authority,
        space = 8 + StakeInfo::INIT_SPACE,
        seeds = [
            StakeInfo::SEED_PREFIX.as_bytes(),
            nft_mint_account.key().as_ref(),
        ],
        bump,
    )]
    pub stake_info: Box&lt;Account&lt;'info, StakeInfo>>,

    /// è´¨æŠ¼æ± æ¥æ”¶ NFT çš„è´¦æˆ·
    #[account(
        init_if_needed,
        payer = authority,
        associated_token::mint = nft_mint_account,
        associated_token::authority = stake_info,
    )]
    pub program_receipt_ata: Box&lt;Account&lt;'info, TokenAccount>>,

    /// æµåŠ¨æ€§ä»£å¸ Mint è´¦æˆ·
    #[account(
        mut,
        seeds = [MyToken::SEED_PREFIX.as_bytes(),],
        bump,
    )]
    pub token_mint_account: Box&lt;Account&lt;'info, Mint>>,

    /// ç”¨æˆ·çš„æµåŠ¨æ€§ä»£å¸å…³è”è´¦æˆ·
    #[account(
        init_if_needed,
        payer = authority,
        associated_token::mint = token_mint_account,
        associated_token::authority = authority,
    )]
    pub associated_token_account: Box&lt;Account&lt;'info, TokenAccount>>,

    /// è¢«è´¨æŠ¼çš„ NFT Mint è´¦æˆ·
    #[account(mut)]
    pub nft_mint_account: Box&lt;Account&lt;'info, Mint>>,

    /// ç”¨æˆ·çš„ NFT å…³è”è´¦æˆ·
    #[account(mut,
        associated_token::mint = nft_mint_account,
        associated_token::authority = authority,
    )]
    pub nft_associated_token_account: Box&lt;Account&lt;'info, TokenAccount>>,

    #[account(mut)]
    pub authority: Signer&lt;'info>, // å‘èµ·è€…ç­¾åè´¦æˆ·

    // ä¾èµ–ç¨‹åº
    pub token_program: Program&lt;'info, Token>,
    pub system_program: Program&lt;'info, System>,
    pub associated_token_program: Program&lt;'info, AssociatedToken>,
&#125;
2.2.3 è´¨æŠ¼ä¿¡æ¯ç»“æ„ï¼ˆstate/stake.rsï¼‰
#[account]
#[derive(InitSpace)]
pub struct StakeInfo &#123;
    pub staker: Pubkey,           // è´¨æŠ¼äººåœ°å€
    pub nft_mint_account: Pubkey, // è´¨æŠ¼çš„ NFT Mint åœ°å€
    pub staked_at: u64,           // è´¨æŠ¼æ—¶é—´ï¼ˆçºªå…ƒï¼‰
&#125;

impl StakeInfo &#123;
    pub const SEED_PREFIX: &amp;'static str = "stake_v1"; // PDA ç§å­å‰ç¼€

    pub fn new(staker: Pubkey, nft_mint_account: Pubkey) -> Self &#123;
        Self &#123;
            staker,
            nft_mint_account,
            staked_at: Clock::get().unwrap().epoch,
        &#125;
    &#125;
&#125;
2.3 å®¢æˆ·ç«¯è°ƒç”¨ç¤ºä¾‹ï¼ˆapp/api/stake.tsï¼‰
import * as anchor from "@coral-xyz/anchor";
import &#123; program &#125; from "./wallet";
import &#123; getNftMintAccount &#125; from "./account";

export async function stakeNFT(wallet: anchor.Wallet, nft_id: string) &#123;
    return await program.methods.nftStake().accounts(&#123;
        nftMintAccount: getNftMintAccount(nft_id),
    &#125;).signers([wallet.payer]).rpc();
&#125;
3. å…³é”®æŠ€æœ¯ç‚¹


PDA è´¦æˆ·ç®¡ç†ï¼šé€šè¿‡ç§å­ï¼ˆSeedï¼‰æ´¾ç”Ÿç¨‹åºæ´¾ç”Ÿåœ°å€ï¼ˆPDAï¼‰ç®¡ç† NFT Mint è´¦æˆ·ã€è´¨æŠ¼ä¿¡æ¯è´¦æˆ·ç­‰ï¼Œç¡®ä¿è´¦æˆ·å®‰å…¨æ€§å’Œå¯é¢„æµ‹æ€§ã€‚


MPL å…ƒæ•°æ®æ ‡å‡†ï¼šéµå¾ª Metaplex Token Metadata æ ‡å‡†åˆ›å»º NFT å…ƒæ•°æ®å’Œä¸»ç‰ˆæœ¬è´¦æˆ·ï¼Œç¡®ä¿ NFT å…¼å®¹æ€§å’Œå”¯ä¸€æ€§ã€‚


ä»£å¸è½¬ç§»ä¸é“¸é€ æƒé™ï¼šä½¿ç”¨ SPL Token ç¨‹åºè¿›è¡Œä»£å¸è½¬ç§»ï¼Œé€šè¿‡ PDA ç­¾åæˆäºˆé“¸é€ æƒé™ï¼Œé¿å…ç§é’¥ç›´æ¥æš´éœ²ã€‚


å…³è”ä»£å¸è´¦æˆ·ï¼ˆATAï¼‰ï¼šä½¿ç”¨å…³è”ä»£å¸è´¦æˆ·è§„èŒƒç®¡ç†ç”¨æˆ·ä¸ä»£å¸çš„å…³è”å…³ç³»ï¼Œç®€åŒ–è´¦æˆ·åˆ›å»ºå’Œç®¡ç†æµç¨‹ã€‚


è´¨æŠ¼å¥–åŠ±æœºåˆ¶ï¼šè´¨æŠ¼ NFT æ—¶é“¸é€ æµåŠ¨æ€§ä»£å¸ä½œä¸ºå¥–åŠ±ï¼Œå®ç°æ¿€åŠ±æœºåˆ¶é—­ç¯ã€‚


éªŒè¯
æŸ¥çœ‹è´¦å·ï¼Œå‘ç°æˆ‘çš„nftå·²ç»è½¬ç§»èµ°äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯tokenå‘æ”¾åˆ°æˆ‘çš„è´¦æˆ·ä¸­

]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part17]_Solanaè´¨æŠ¼-ç¼–å†™åº”ç”¨çº§åˆ«çš„è´¨æŠ¼åˆçº¦-è§£è´¨æŠ¼éƒ¨åˆ†</title>
    <url>/2025/08/22/Solana-part17-Solana%E8%B4%A8%E6%8A%BC-%E7%BC%96%E5%86%99%E5%BA%94%E7%94%A8%E7%BA%A7%E5%88%AB%E7%9A%84%E8%B4%A8%E6%8A%BC%E5%90%88%E7%BA%A6-%E8%A7%A3%E8%B4%A8%E6%8A%BC%E9%83%A8%E5%88%86/</url>
    <content><![CDATA[Solanaè´¨æŠ¼-ç¼–å†™åº”ç”¨çº§åˆ«çš„è´¨æŠ¼åˆçº¦-è§£è´¨æŠ¼éƒ¨åˆ†

æ ¸å¿ƒä»£ç åœ°å€æäº¤ï¼š
https://github.com/SoniaChan33/anchor_social/commit/b6ca707c33992ef5e72d1be5e4b6edc14e385b98

1. è§£è´¨æŠ¼åŠŸèƒ½æ ¸å¿ƒé€»è¾‘
è§£è´¨æŠ¼æ˜¯è´¨æŠ¼æµç¨‹çš„åå‘æ“ä½œï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯å°†è´¨æŠ¼çš„ NFT å½’è¿˜ç»™ç”¨æˆ·ï¼Œå¹¶é”€æ¯è´¨æŠ¼æ—¶è·å¾—çš„æµåŠ¨æ€§ä»£å¸ã€‚å…·ä½“æµç¨‹é€šè¿‡ nft_unstake å‡½æ•°å®ç°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š
1.1 æƒé™æ ¡éªŒ
å‡½æ•°é¦–å…ˆéªŒè¯è§£è´¨æŠ¼æ“ä½œçš„åˆæ³•æ€§ï¼Œç¡®ä¿ï¼š

è§£è´¨æŠ¼çš„ NFT ä¸è´¨æŠ¼è®°å½•ä¸­çš„ NFT åŒ¹é…ï¼ˆstake_info.nft_mint_account == nft_mint_account.key()ï¼‰ï¼›
å‘èµ·è§£è´¨æŠ¼çš„ç”¨æˆ·æ˜¯åŸè´¨æŠ¼äººï¼ˆstake_info.staker == authority.key()ï¼‰ã€‚
è‹¥ä¸æ»¡è¶³ï¼Œè¿”å› UnstakeError::NoAuthority é”™è¯¯ã€‚

// æƒé™æ ¡éªŒä»£ç ï¼ˆæºè‡ªnft_unstake.rsï¼‰
require!(
    &amp;ctx.accounts.stake_info.nft_mint_account == &amp;ctx.accounts.nft_mint_account.key(),
    UnstakeError::NoAuthority,
);
require!(
    &amp;ctx.accounts.stake_info.staker == &amp;ctx.accounts.authority.key(),
    UnstakeError::NoAuthority,
);
1.2 NFT è½¬å›ç”¨æˆ·è´¦æˆ·
é€šè¿‡ transfer æ“ä½œå°†æš‚å­˜äºåˆçº¦æ‰˜ç®¡è´¦æˆ·ï¼ˆprogram_receipt_ataï¼‰çš„ NFT è½¬å›ç”¨æˆ·çš„å…³è”è´¦æˆ·ï¼ˆnft_associated_token_accountï¼‰ã€‚

ç”±äºåˆçº¦æ‰˜ç®¡è´¦æˆ·çš„æƒé™å½’ stake_infoï¼ˆPDA è´¦æˆ·ï¼‰ï¼Œéœ€ä½¿ç”¨ stake_info çš„ç§å­ï¼ˆStakeInfo::SEED_PREFIX + nft_mint_account.key() + bumpï¼‰ç”Ÿæˆç­¾åï¼Œç¡®ä¿æ“ä½œåˆæ³•æ€§ã€‚

// NFT è½¬ç§»ä»£ç ï¼ˆæºè‡ªnft_unstake.rsï¼‰
let nft_mint_account = ctx.accounts.nft_mint_account.key();
let signer_seeds: &amp;[&amp;[&amp;[u8]]] = &amp;[&amp;[
    StakeInfo::SEED_PREFIX.as_bytes(),
    nft_mint_account.as_ref(),
    &amp;[ctx.bumps.stake_info],
]];
transfer(
    CpiContext::new(
        ctx.accounts.token_program.to_account_info(),
        Transfer &#123;
            from: ctx.accounts.program_receipt_ata.to_account_info(),
            to: ctx.accounts.nft_associated_token_account.to_account_info(),
            authority: ctx.accounts.stake_info.to_account_info(),
        &#125;,
    )
    .with_signer(signer_seeds),
    1, // NFT æ•°é‡å›ºå®šä¸º1
)?;
1.3 æµåŠ¨æ€§ä»£å¸é”€æ¯
ç”¨æˆ·è§£è´¨æŠ¼æ—¶ï¼Œéœ€é”€æ¯è´¨æŠ¼æ—¶è·å¾—çš„æµåŠ¨æ€§ä»£å¸ï¼ˆé€šè¿‡ burn æ“ä½œï¼‰ï¼Œæ•°é‡é€šè¿‡ stake_info.salvage_value(10000) è®¡ç®—ï¼ˆåŸºäºè´¨æŠ¼æ—¶é•¿ï¼‰ã€‚
// ä»£å¸é”€æ¯ä»£ç ï¼ˆæºè‡ªnft_unstake.rsï¼‰
let amount = ctx.accounts.stake_info.salvage_value(10000);
burn(
    CpiContext::new(
        ctx.accounts.token_program.to_account_info(),
        Burn &#123;
            mint: ctx.accounts.token_mint_account.to_account_info(),
            from: ctx.accounts.associated_token_account.to_account_info(),
            authority: ctx.accounts.authority.to_account_info(),
        &#125;,
    ),
    amount,
)?;
2. è´¦æˆ·ç»“æ„è¯´æ˜ï¼ˆNFTUnStakeï¼‰
NFTUnStake ç»“æ„ä½“å®šä¹‰äº†è§£è´¨æŠ¼æ‰€éœ€çš„æ‰€æœ‰è´¦æˆ·ï¼Œå„è´¦æˆ·ä½œç”¨å¦‚ä¸‹ï¼š



è´¦æˆ·å
ä½œç”¨æè¿°




stake_info
å­˜å‚¨è´¨æŠ¼è®°å½•ï¼ˆè´¨æŠ¼äººã€NFT åœ°å€ã€è´¨æŠ¼æ—¶é—´ï¼‰ï¼Œä»¥ StakeInfo::SEED_PREFIX + NFT Mint åœ°å€ ä¸ºç§å­çš„ PDA è´¦æˆ·ã€‚


program_receipt_ata
åˆçº¦æ‰˜ç®¡ NFT çš„å…³è”è´¦æˆ·ï¼Œæƒé™å½’ stake_infoï¼Œç”¨äºæš‚å­˜è´¨æŠ¼çš„ NFTã€‚


token_mint_account
æµåŠ¨æ€§ä»£å¸çš„ Mint è´¦æˆ·ï¼Œä»¥ MyToken::SEED_PREFIX ä¸ºç§å­çš„ PDA è´¦æˆ·ï¼Œç”¨äºé”€æ¯ä»£å¸ã€‚


associated_token_account
ç”¨æˆ·æŒæœ‰çš„æµåŠ¨æ€§ä»£å¸è´¦æˆ·ï¼Œç”¨äºé”€æ¯è´¨æŠ¼æ—¶è·å¾—çš„ä»£å¸ã€‚


nft_mint_account
è¢«è´¨æŠ¼ NFT çš„ Mint è´¦æˆ·ï¼Œæ ‡è¯†å”¯ä¸€ NFTã€‚


nft_associated_token_account
ç”¨æˆ·æ¥æ”¶ NFT çš„å…³è”è´¦æˆ·ï¼Œè§£è´¨æŠ¼å NFT è½¬å›æ­¤å¤„ã€‚


authority
è§£è´¨æŠ¼å‘èµ·è€…ï¼ˆåŸè´¨æŠ¼äººï¼‰ï¼Œéœ€ç­¾åæˆæƒæ“ä½œã€‚


ç³»ç»Ÿç¨‹åºï¼ˆtoken_program ç­‰ï¼‰
æä¾›ä»£å¸è½¬ç§»ã€é”€æ¯ç­‰åŸºç¡€åŠŸèƒ½çš„ç³»ç»Ÿç¨‹åºã€‚



3. åˆ©æ¯è®¡ç®—é€»è¾‘ï¼ˆsalvage_value æ–¹æ³•ï¼‰
è§£è´¨æŠ¼æ—¶é”€æ¯çš„ä»£å¸æ•°é‡é€šè¿‡ StakeInfo::salvage_value è®¡ç®—ï¼Œé€»è¾‘ä¸ºï¼šåŸºäºè´¨æŠ¼æ—¶é•¿ï¼ˆå½“å‰ Epoch ä¸è´¨æŠ¼æ—¶ Epoch çš„å·®å€¼ï¼‰ï¼ŒæŒ‰æ¯ Epoch 2% çš„æ¯”ä¾‹è®¡ç®—ï¼ˆåŸä»£ç å®ç°ï¼‰ã€‚
// åˆ©æ¯è®¡ç®—ä»£ç ï¼ˆæºè‡ªstake.rsï¼‰
pub fn salvage_value(&amp;self, amount: u64) -> u64 &#123;
    let now = Clock::get().unwrap().epoch;
    // æ¯ä¸€ä¸ªepochå‡2%ï¼ˆåŸä»£ç é€»è¾‘ï¼‰
    let p = max(0, (now - self.staked_at) * 2) as f64 / 100.0;
    (amount as f64 * p) as u64
&#125;
4. å…³é”®æ³¨æ„äº‹é¡¹
4.1 åˆ©æ¯è®¡ç®—çš„æ½œåœ¨é—®é¢˜

æµ®ç‚¹æ•°ç²¾åº¦é£é™©ï¼šåŸä»£ç ä½¿ç”¨ f64 è®¡ç®—æ¯”ä¾‹ï¼ˆå¦‚ (now - staked_at) * 2 as f64 / 100.0ï¼‰ï¼Œå¯èƒ½å¯¼è‡´ç²¾åº¦ä¸¢å¤±ï¼ˆä¾‹å¦‚ 10000 * 0.02 ç†è®ºä¸º 200ï¼Œä½†æµ®ç‚¹æ•°è¿ç®—å¯èƒ½äº§ç”Ÿåå·®ï¼‰ã€‚
Epoch å·®å€¼ä¸º 0 çš„é—®é¢˜ï¼šè‹¥æµ‹è¯•ç½‘ç»œä¸­ Epoch é•¿æœŸæœªæ›´æ–°ï¼ˆé»˜è®¤é…ç½® slots-per-epoch è¾ƒå¤§ï¼‰ï¼Œnow - self.staked_at ä¸º 0ï¼Œå¯¼è‡´ salvage_value è¿”å› 0ï¼Œç”¨æˆ·æ— å®é™…è·åˆ©ã€‚

4.2 æµ‹è¯•ç½‘ç»œé…ç½®å»ºè®®
ä¸ºè§£å†³ Epoch ä¸æ›´æ–°çš„é—®é¢˜ï¼Œå¯åŠ¨æœ¬åœ°æµ‹è¯•ç½‘æ—¶éœ€æ‰‹åŠ¨è®¾ç½®è¾ƒå°çš„ slots-per-epochï¼Œç¡®ä¿ Epoch èƒ½å¿«é€Ÿæ¨è¿›ï¼š
# æ¯32ä¸ªslotä¸º1ä¸ªEpochï¼ˆåŠ é€ŸEpochæ›´æ–°ï¼Œä¾¿äºæµ‹è¯•åˆ©æ¯è®¡ç®—ï¼‰
solana-test-validator --slots-per-epoch 32 -r \
  --bpf-program metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s metadata.so
å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ Epoch çŠ¶æ€ï¼š
solana epoch-info --url localhost # æŸ¥çœ‹å½“å‰Epochå’Œslotæ•°
4.3 æƒé™ä¸å®‰å…¨æ€§

è§£è´¨æŠ¼å¿…é¡»éªŒè¯ stake_info ä¸­çš„è´¨æŠ¼äººä¸å‘èµ·è€…ä¸€è‡´ï¼Œé˜²æ­¢éæ‰€æœ‰è€…æ“ä½œã€‚
NFT è½¬ç§»æ—¶éœ€ä½¿ç”¨ stake_info çš„ PDA ç­¾åï¼ˆsigner_seedsï¼‰ï¼Œç¡®ä¿åªæœ‰åˆçº¦æœ‰æƒé™æ“ä½œæ‰˜ç®¡çš„ NFTï¼Œé¿å…æƒé™æ³„éœ²ã€‚

æ€»ç»“
è§£è´¨æŠ¼åŠŸèƒ½é€šè¿‡æƒé™æ ¡éªŒã€NFT è½¬å›ã€æµåŠ¨æ€§ä»£å¸é”€æ¯å®Œæˆé—­ç¯ï¼Œæ ¸å¿ƒä¾èµ– stake_info è®°å½•çš„è´¨æŠ¼å…³ç³»å’Œ salvage_value è®¡ç®—çš„é”€æ¯æ•°é‡ã€‚éœ€ç‰¹åˆ«æ³¨æ„æµ®ç‚¹æ•°è®¡ç®—ç²¾åº¦å’Œæµ‹è¯•ç½‘ Epoch é…ç½®ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è·åˆ©é€»è¾‘å¯æ­£å¸¸éªŒè¯ã€‚
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part18]_Solana DAPP-å‰ç«¯å•å…ƒæµ‹è¯•ä¸åˆçº¦æ¥å…¥</title>
    <url>/2025/08/23/Solana-part18-Solana-DAPP-%E5%89%8D%E7%AB%AF%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E5%90%88%E7%BA%A6%E6%8E%A5%E5%85%A5/</url>
    <content><![CDATA[Solana DAPP-å‰ç«¯å•å…ƒæµ‹è¯•ä¸åˆçº¦æ¥å…¥
ä¸€ã€åˆå§‹åŒ– Solana DApp é¡¹ç›®
1. ç¯å¢ƒå‡†å¤‡
å…ˆç¡®ä¿å®‰è£…åŸºç¡€å·¥å…·ï¼š
# å®‰è£… Node.jsï¼ˆæ¨è v16+ï¼‰
# å®‰è£… Solana CLIï¼ˆç”¨äºæœ¬åœ°èŠ‚ç‚¹å’Œé’±åŒ…ç®¡ç†ï¼‰
sh -c "$(curl -sSfL https://release.solana.com/v1.18.4/install)"

# æ£€æŸ¥ç‰ˆæœ¬
solana --version
node --version
2. åˆå§‹åŒ–é¡¹ç›®
ä½¿ç”¨å®˜æ–¹æ¨¡æ¿åˆ›å»ºé¡¹ç›®ï¼š
npx create-solana-dapp@latest my-solana-dapp
cd my-solana-dapp
3. é¡¹ç›®ç»“æ„è§£æï¼ˆæ ¸å¿ƒæ–‡ä»¶ï¼‰
my-solana-dapp&#x2F;
â”œâ”€â”€ app&#x2F;                  # å‰ç«¯ä»£ç ï¼ˆReactï¼‰
â”œâ”€â”€ programs&#x2F;             # åç«¯ç¨‹åºï¼ˆRustï¼‰
â”‚   â””â”€â”€ my_solana_dapp&#x2F;   # æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ tests&#x2F;                # æµ‹è¯•æ–‡ä»¶ï¼ˆTypeScriptï¼‰
â”‚   â””â”€â”€ my-solana-dapp.ts # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ Anchor.toml           # é¡¹ç›®é…ç½®ï¼ˆé›†ç¾¤ã€ç¨‹åºIDç­‰ï¼‰
â””â”€â”€ package.json          # ä¾èµ–ç®¡ç†
äºŒã€æµ‹è¯•æ–‡ä»¶ç¼–å†™ï¼ˆTypeScriptï¼‰
æµ‹è¯•æ–‡ä»¶ä½äº tests/ ç›®å½•ï¼Œç”¨äºéªŒè¯ç¨‹åºé€»è¾‘ï¼Œåç«¯å­¦å‘˜éœ€é‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æµ‹è¯•åŸºæœ¬ç»“æ„
// tests/my-solana-dapp.ts
import * as anchor from "@coral-xyz/anchor";
import &#123; Program &#125; from "@coral-xyz/anchor";
import &#123; MySolanaDapp &#125; from "../target/types/my_solana_dapp"; // è‡ªåŠ¨ç”Ÿæˆçš„ç±»å‹

describe("my-solana-dapp", () => &#123;
  // 1. åˆå§‹åŒ–ç¯å¢ƒ
  const provider = anchor.AnchorProvider.env(); // ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®çš„é›†ç¾¤
  anchor.setProvider(provider);
  const program = anchor.workspace.MySolanaDapp as Program&lt;MySolanaDapp>; // åŠ è½½ç¨‹åº
  const wallet = provider.wallet as anchor.Wallet; // æµ‹è¯•é’±åŒ…

  it("åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨", async () => &#123;
    // 2. å‡†å¤‡è´¦æˆ·ï¼ˆæ¯”å¦‚åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨è´¦æˆ·ï¼‰
    const counterKeypair = anchor.web3.Keypair.generate(); // éšæœºç”Ÿæˆè´¦æˆ·

    // 3. è°ƒç”¨ç¨‹åºæŒ‡ä»¤ï¼ˆæ¯”å¦‚åˆå§‹åŒ–è®¡æ•°å™¨ï¼‰
    const tx = await program.methods
      .initializeCounter()
      .accounts(&#123;
        counter: counterKeypair.publicKey, // è®¡æ•°å™¨è´¦æˆ·åœ°å€
        user: wallet.publicKey, // è°ƒç”¨è€…åœ°å€
        systemProgram: anchor.web3.SystemProgram.programId, // ç³»ç»Ÿç¨‹åºï¼ˆåˆ›å»ºè´¦æˆ·ç”¨ï¼‰
      &#125;)
      .signers([counterKeypair]) // æ–°è´¦æˆ·éœ€è¦ç­¾åï¼ˆå› ä¸ºæ˜¯åˆšç”Ÿæˆçš„ï¼‰
      .rpc(); // å‘é€äº¤æ˜“

    console.log("äº¤æ˜“ç­¾å:", tx);

    // 4. éªŒè¯ç»“æœ
    const counterAccount = await program.account.counter.fetch(counterKeypair.publicKey);
    console.log("åˆå§‹è®¡æ•°:", counterAccount.count.toString());
    assert.equal(counterAccount.count.toString(), "0"); // æ–­è¨€åˆå§‹å€¼ä¸º0
  &#125;);
&#125;);
2. æµ‹è¯•æ³¨æ„äº‹é¡¹

é›†ç¾¤é€‰æ‹©ï¼šé»˜è®¤ä½¿ç”¨ localnetï¼ˆæœ¬åœ°èŠ‚ç‚¹ï¼‰ï¼Œæµ‹è¯•å‰éœ€å¯åŠ¨ solana-test-validator
è´¦æˆ·æƒé™ï¼š

æ–°ç”Ÿæˆçš„è´¦æˆ·ï¼ˆKeypair.generate()ï¼‰éœ€è¦æ”¾åœ¨ signers ä¸­ç­¾å
é’±åŒ…è´¦æˆ·ï¼ˆwallet.publicKeyï¼‰çš„ç­¾åç”± provider è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ 


æ•°æ®è¯»å–ï¼šç”¨ program.account.xxx.fetch(åœ°å€) è¯»å–è´¦æˆ·æ•°æ®
é”™è¯¯å¤„ç†ï¼šä½¿ç”¨ try/catch æ•è·äº¤æ˜“å¤±è´¥ï¼ˆå¦‚æƒé™ä¸è¶³ã€æ•°æ®é”™è¯¯ï¼‰

3. å¸¸ç”¨ TS è¯­æ³•ï¼ˆæµ‹è¯•ä¸­é«˜é¢‘ä½¿ç”¨ï¼‰

ç±»å‹æ³¨è§£ï¼šconst wallet: anchor.Wallet = provider.wallet;ï¼ˆæŒ‡å®šå˜é‡ç±»å‹ï¼‰
å¼‚æ­¥å‡½æ•°ï¼šasync/await å¤„ç†åŒºå—é“¾äº¤æ˜“ï¼ˆç½‘ç»œæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼‰
æ¥å£å®šä¹‰ï¼šæè¿°è´¦æˆ·æ•°æ®ç»“æ„interface Counter &#123;
  count: anchor.BN; // Solanaä¸­å¸¸ç”¨BNå¤„ç†å¤§æ•°å­—
  owner: anchor.web3.PublicKey;
&#125;

è§£æ„èµ‹å€¼ï¼šå¿«é€Ÿè·å–è´¦æˆ·å­—æ®µconst &#123; count, owner &#125; = await program.account.counter.fetch(addr);


ä¸‰ã€å‰ç«¯äº¤äº’ï¼ˆè°ƒç”¨ Anchor ç¨‹åºï¼‰
å‰ç«¯é€šè¿‡ Anchor å®¢æˆ·ç«¯åº“ä¸é“¾ä¸Šç¨‹åºäº¤äº’ï¼Œæ ¸å¿ƒæµç¨‹ï¼šè¿æ¥é’±åŒ… â†’ åˆå§‹åŒ–ç¨‹åº â†’ è°ƒç”¨æŒ‡ä»¤ã€‚
1. å‰ç«¯é¡¹ç›®ç»“æ„ï¼ˆapp/ ç›®å½•ï¼‰
app&#x2F;
â”œâ”€â”€ components&#x2F;  # UIç»„ä»¶
â”œâ”€â”€ lib&#x2F;         # å·¥å…·å‡½æ•°ï¼ˆè¿æ¥é’±åŒ…ã€ç¨‹åºåˆå§‹åŒ–ï¼‰
â”‚   â””â”€â”€ anchor.ts # æ ¸å¿ƒäº¤äº’é€»è¾‘
â””â”€â”€ pages&#x2F;       # é¡µé¢ï¼ˆå¦‚é¦–é¡µï¼‰
2. æ ¸å¿ƒäº¤äº’ä»£ç ï¼ˆlib/anchor.tsï¼‰
import * as anchor from "@coral-xyz/anchor";
import &#123; PublicKey &#125; from "@solana/web3.js";
import idl from "../target/idl/my_solana_dapp.json"; // ç¨‹åºIDLï¼ˆæ¥å£æè¿°ï¼‰

// 1. åˆå§‹åŒ–ç¨‹åº
export const initProgram = () => &#123;
  // è¿æ¥åˆ°æµè§ˆå™¨é’±åŒ…ï¼ˆå¦‚Phantomï¼‰
  const provider = new anchor.AnchorProvider(
    window.solana, // é’±åŒ…æ³¨å…¥çš„provider
    window.solana,
    &#123; preflightCommitment: "processed" &#125;
  );
  anchor.setProvider(provider);

  // åŠ è½½ç¨‹åºï¼ˆIDL + ç¨‹åºåœ°å€ï¼‰
  const programId = new PublicKey(idl.metadata.address);
  const program = new anchor.Program(idl as any, programId, provider);
  return &#123; program, provider &#125;;
&#125;;

// 2. è°ƒç”¨ç¨‹åºæŒ‡ä»¤ï¼ˆæ¯”å¦‚å¢åŠ è®¡æ•°å™¨ï¼‰
export const incrementCounter = async (counterAddr: string) => &#123;
  const &#123; program, provider &#125; = initProgram();
  const counterPubkey = new PublicKey(counterAddr);

  try &#123;
    // å‘é€äº¤æ˜“
    const tx = await program.methods
      .incrementCounter() // å¯¹åº”Rustä¸­çš„increment_counterå‡½æ•°
      .accounts(&#123;
        counter: counterPubkey,
        user: provider.wallet.publicKey,
      &#125;)
      .rpc(); // é’±åŒ…ä¼šè‡ªåŠ¨å¼¹å‡ºç­¾åè¯·æ±‚

    console.log("äº¤æ˜“æˆåŠŸ:", tx);
    return tx;
  &#125; catch (err) &#123;
    console.error("äº¤æ˜“å¤±è´¥:", err);
  &#125;
&#125;;
3. åœ¨é¡µé¢ä¸­ä½¿ç”¨ï¼ˆReact ç¤ºä¾‹ï¼‰
// pages/index.tsx
import &#123; useState &#125; from "react";
import &#123; incrementCounter &#125; from "../lib/anchor";

export default function Home() &#123;
  const [counterAddr, setCounterAddr] = useState("");

  const handleIncrement = async () => &#123;
    if (!counterAddr) return;
    await incrementCounter(counterAddr);
  &#125;;

  return (
    &lt;div>
      &lt;input
        placeholder="è®¡æ•°å™¨åœ°å€"
        value=&#123;counterAddr&#125;
        onChange=&#123;(e) => setCounterAddr(e.target.value)&#125;
      />
      &lt;button onClick=&#123;handleIncrement&#125;>å¢åŠ è®¡æ•°&lt;/button>
    &lt;/div>
  );
&#125;
4. å‰ç«¯äº¤äº’æ³¨æ„äº‹é¡¹

é’±åŒ…è¿æ¥ï¼šéœ€ç”¨æˆ·å®‰è£… Phantom ç­‰é’±åŒ…ï¼Œé€šè¿‡ window.solana æ³¨å…¥
æƒé™è¯·æ±‚ï¼šé¦–æ¬¡è°ƒç”¨ä¼šè¯·æ±‚é’±åŒ…æˆæƒï¼ˆè®¿é—®å…¬é’¥ï¼‰
äº¤æ˜“ç¡®è®¤ï¼šåŒºå—é“¾äº¤æ˜“éœ€è¦æ—¶é—´ç¡®è®¤ï¼Œå¯é€šè¿‡ @solana/web3.js çš„ Connection.confirmTransaction ç­‰å¾…ç¡®è®¤
é”™è¯¯æç¤ºï¼šå¸¸è§é”™è¯¯å¦‚â€œç”¨æˆ·æ‹’ç»ç­¾åâ€â€œä½™é¢ä¸è¶³â€ï¼ˆéœ€ç¡®ä¿é’±åŒ…æœ‰ SOL æ”¯ä»˜æ‰‹ç»­è´¹ï¼‰

å››ã€å¿«é€Ÿä¸Šæ‰‹å‘½ä»¤
# å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹
solana-test-validator

# éƒ¨ç½²ç¨‹åºåˆ°æœ¬åœ°èŠ‚ç‚¹
anchor deploy

# è¿è¡Œæµ‹è¯•
anchor test

# å¯åŠ¨å‰ç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
cd app &amp;&amp; npm run dev
æ€»ç»“
é‡ç‚¹ç†è§£ï¼š

æµ‹è¯•æ–‡ä»¶é€šè¿‡æ¨¡æ‹Ÿäº¤æ˜“éªŒè¯ç¨‹åºé€»è¾‘ï¼Œæ ¸å¿ƒæ˜¯ program.methods.xxx è°ƒç”¨æŒ‡ä»¤
å‰ç«¯äº¤äº’æœ¬è´¨æ˜¯é€šè¿‡ Anchor å®¢æˆ·ç«¯åº“å°†ç”¨æˆ·æ“ä½œè½¬åŒ–ä¸ºé“¾ä¸Šäº¤æ˜“ï¼Œä¾èµ–é’±åŒ…ç­¾å
TypeScript ç±»å‹ç³»ç»Ÿå¸®åŠ©åŒ¹é…ç¨‹åºæ¥å£ï¼ˆIDLï¼‰ï¼Œå‡å°‘è°ƒç”¨é”™è¯¯

é€šè¿‡ä»¥ä¸Šæµç¨‹ï¼Œå¯å®ç°ä»åç«¯ç¨‹åºåˆ°å‰ç«¯äº¤äº’çš„å®Œæ•´é—­ç¯ï¼Œåç»­å¯é€æ­¥æ·±å…¥å¤æ‚åŠŸèƒ½ï¼ˆå¦‚ NFT æ“ä½œã€çŠ¶æ€ç®¡ç†ç­‰ï¼‰ã€‚
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part19]_ETFçš„ä»‹ç»å’Œåˆ›å»ºæŒ‡ä»¤å®ç°</title>
    <url>/2025/08/24/Solana-part19-ETF%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[ETFçš„ä»‹ç»å’Œåˆ›å»ºæŒ‡ä»¤å®ç°


ä»£ç æäº¤åœ°å€ï¼šhttps://github.com/SoniaChan33/iswap/commit/25b017929923a3d1e46d853f3a12da05f0b77172

ä¸€ã€é¡¹ç›®æ¦‚è¿°
iSwapé¡¹ç›®ä¸­çš„ETFåˆ›å»ºåŠŸèƒ½ç”¨äºåœ¨SolanaåŒºå—é“¾ä¸Šç”Ÿæˆè‡ªå®šä¹‰ETFï¼ˆäº¤æ˜“æ‰€äº¤æ˜“åŸºé‡‘ï¼‰ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯å®ç°ETFç›¸å…³è´¦æˆ·çš„åˆ›å»ºä¸ç®¡ç†ï¼ŒåŒ…æ‹¬ETFä¿¡æ¯å­˜å‚¨è´¦æˆ·ã€èµ„äº§å…³è”è´¦æˆ·ï¼ˆATAï¼‰ã€ETFä»£å¸é“¸é€ è´¦æˆ·ï¼ˆMintï¼‰åŠå…ƒæ•°æ®ï¼ˆMetadataï¼‰è´¦æˆ·ï¼Œç¡®ä¿æ‰€æœ‰æ“ä½œçš„åŸå­æ€§ä¸é“¾ä¸Šæ•°æ®ä¸€è‡´æ€§ã€‚
äºŒã€æ ¸å¿ƒé“¾ä¸Šç»„ä»¶ï¼ˆRustç¨‹åºï¼‰
é“¾ä¸Šé€»è¾‘é€šè¿‡Solanaç¨‹åºï¼ˆæ™ºèƒ½åˆçº¦ï¼‰å®ç°ï¼Œè´Ÿè´£ETFç›¸å…³è´¦æˆ·çš„åˆå§‹åŒ–ã€æ•°æ®å­˜å‚¨åŠè·¨ç¨‹åºè°ƒç”¨ï¼ˆCPIï¼‰ã€‚
1. è´¦æˆ·ç»“æ„å®šä¹‰ï¼ˆetf_token.rsï¼‰
å®šä¹‰äº†é“¾ä¸Šå­˜å‚¨ETFæ•°æ®çš„æ ¸å¿ƒè´¦æˆ·ç»“æ„ï¼Œç”¨äºæŒä¹…åŒ–ETFçš„å…³é”®ä¿¡æ¯ã€‚
EtfToken è´¦æˆ·
å­˜å‚¨ETFçš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬é“¸é€ è´¦æˆ·åœ°å€ã€åˆ›å»ºè€…ã€åˆ›å»ºæ—¶é—´ã€æè¿°åŠèµ„äº§åˆ—è¡¨ï¼š
#[account]
#[derive(InitSpace)]
pub struct EtfToken &#123;
    pub mint_account: Pubkey,       // ETFä»£å¸çš„Mintè´¦æˆ·åœ°å€
    pub creator: Pubkey,            // ETFåˆ›å»ºè€…åœ°å€
    pub create_at: i64,             // åˆ›å»ºæ—¶é—´ï¼ˆUnixæ—¶é—´æˆ³ï¼‰
    #[max_len(50)]
    pub descriptor: String,         // ETFæè¿°ä¿¡æ¯ï¼ˆæœ€å¤§é•¿åº¦50ï¼‰
    #[max_len(10)]
    pub assets: Vec&lt;EtfAsset>,      // åŒ…å«çš„èµ„äº§åˆ—è¡¨ï¼ˆæœ€å¤š10ä¸ªèµ„äº§ï¼‰
&#125;

ç§å­å‰ç¼€ï¼šSEEDS_PREFIX = &quot;ETF_TOKEN&quot;ï¼ˆç”¨äºPDAæ´¾ç”Ÿï¼‰
åˆå§‹åŒ–æ–¹æ³•ï¼šnew æ–¹æ³•æ¥æ”¶å‚æ•°å¹¶è¿”å›å®ä¾‹ï¼Œè‡ªåŠ¨å¡«å……åˆ›å»ºæ—¶é—´ï¼ˆé€šè¿‡Clockè·å–ï¼‰ã€‚

EtfAsset è´¦æˆ·
å­˜å‚¨ETFä¸­å•ä¸ªèµ„äº§çš„ä¿¡æ¯ï¼ˆä»£å¸åœ°å€åŠæƒé‡ï¼‰ï¼š
#[account]
#[derive(InitSpace)]
pub struct EtfAsset &#123;
    pub token: Pubkey,  // èµ„äº§ä»£å¸çš„Mintåœ°å€
    pub weight: u16,    // èµ„äº§åœ¨ETFä¸­çš„æƒé‡ï¼ˆæ•°å€¼ç±»å‹ä¸ºæ— ç¬¦å·16ä½æ•´æ•°ï¼‰
&#125;

åˆå§‹åŒ–æ–¹æ³•ï¼šnew æ–¹æ³•æ¥æ”¶ä»£å¸åœ°å€å’Œæƒé‡ï¼Œè¿”å›å®ä¾‹ã€‚

2. ETFåˆ›å»ºæŒ‡ä»¤ï¼ˆetf_create.rsï¼‰
å®ç°ETFåˆ›å»ºçš„æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬è´¦æˆ·åˆå§‹åŒ–ã€å…ƒæ•°æ®åˆ›å»ºåŠæ•°æ®å­˜å‚¨ã€‚
è¾“å…¥å‚æ•° EtfTokenArgs
å®¢æˆ·ç«¯ä¼ å…¥çš„ETFé…ç½®ä¿¡æ¯ï¼Œç”¨äºåˆå§‹åŒ–é“¾ä¸Šæ•°æ®ï¼š
#[account]
pub struct EtfTokenArgs &#123;
    pub name: String,        // ETFåç§°
    pub symbol: String,      // ETFç¬¦å·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼Œç”¨äºæ´¾ç”Ÿåœ°å€ï¼‰
    pub description: String, // ETFæè¿°
    pub url: String,         // ETFå…ƒæ•°æ®URLï¼ˆå¦‚å®˜ç½‘ã€è¯¦æƒ…é¡µï¼‰
    pub assets: Vec&lt;EtfAsset>, // åŒ…å«çš„èµ„äº§åˆ—è¡¨
&#125;
è´¦æˆ·çº¦æŸ EtfTokenCreate
å®šä¹‰æŒ‡ä»¤æ‰€éœ€çš„è´¦æˆ·åŠçº¦æŸæ¡ä»¶ï¼Œç¡®ä¿è´¦æˆ·åˆæ³•æ€§ï¼š
#[derive(Accounts)]
#[instruction(args: EtfTokenArgs)]
pub struct EtfTokenCreate&lt;'info> &#123;
    // ETFä¿¡æ¯è´¦æˆ·ï¼ˆPDAï¼‰ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆå§‹åŒ–
    #[account(
        init_if_needed,
        payer = authority,
        space = 8 + EtfToken::INIT_SPACE,  // 8å­—èŠ‚ä¸ºè´¦æˆ· discriminator
        seeds = [EtfToken::SEEDS_PREFIX.as_bytes(), etf_token_mint_account.key().as_ref()],
        bump
    )]
    pub etf_token_info: Account&lt;'info, EtfToken>,

    // ETFå…ƒæ•°æ®è´¦æˆ·ï¼ˆå…³è”Mintï¼Œé€šè¿‡å…ƒæ•°æ®ç¨‹åºè§„åˆ™æ´¾ç”Ÿï¼‰
    #[account(
        mut,
        seeds = [b"metadata", token_metadata_program.key().as_ref(), etf_token_mint_account.key().as_ref()],
        bump,
        seeds::program = token_metadata_program.key()
    )]
    pub etf_metadata_account: UncheckedAccount&lt;'info>,

    // ETFä»£å¸Mintè´¦æˆ·ï¼ˆPDAï¼‰ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆå§‹åŒ–
    #[account(
        init_if_needed,
        payer = authority,
        seeds = [EtfToken::SEEDS_PREFIX.as_bytes(), args.symbol.as_bytes()],
        bump,
        mint::decimals = 9,  // å›ºå®šå°æ•°ä½ä¸º9
        mint::authority = etf_token_info.key()  // æƒé™å½’å±äºETFä¿¡æ¯è´¦æˆ·
    )]
    pub etf_token_mint_account: Account&lt;'info, Mint>,

    #[account(mut)]
    pub authority: Signer&lt;'info>,  // äº¤æ˜“ç­¾åè€…ï¼ˆåˆ›å»ºè€…é’±åŒ…ï¼‰
    pub rent: Sysvar&lt;'info, Rent>, // Solanaç§Ÿé‡‘ç³»ç»Ÿå˜é‡
    pub token_program: Program&lt;'info, Token>, // SPL Tokenç¨‹åº
    pub system_program: Program&lt;'info, System>, // ç³»ç»Ÿç¨‹åº
    pub token_metadata_program: Program&lt;'info, Metadata>, // MPLå…ƒæ•°æ®ç¨‹åº
&#125;
æŒ‡ä»¤é€»è¾‘ etf_token_create

æ´¾ç”ŸPDAç­¾åç§å­ï¼šä½¿ç”¨etf_token_infoçš„ç§å­å’Œbumpç”Ÿæˆç­¾åç§å­ï¼ˆç”¨äºCPIæˆæƒï¼‰ã€‚
åˆ›å»ºå…ƒæ•°æ®è´¦æˆ·ï¼šé€šè¿‡CPIè°ƒç”¨MPLå…ƒæ•°æ®ç¨‹åºï¼Œåˆ›å»ºå…³è”ETF Mintçš„å…ƒæ•°æ®è´¦æˆ·ï¼ŒåŒ…å«åç§°ã€ç¬¦å·ã€URLç­‰ä¿¡æ¯ã€‚
åˆå§‹åŒ–ETFä¿¡æ¯è´¦æˆ·ï¼šå°†EtfTokenArgsè½¬æ¢ä¸ºEtfTokenå®ä¾‹ï¼Œå­˜å‚¨åˆ›å»ºè€…ã€Mintåœ°å€ã€æ—¶é—´ç­‰æ•°æ®ã€‚

ä¸‰ã€å®¢æˆ·ç«¯æ ¸å¿ƒé€»è¾‘ï¼ˆTypeScriptï¼‰
å®¢æˆ·ç«¯è´Ÿè´£æ„å»ºäº¤æ˜“ã€æ´¾ç”Ÿåœ°å€ã€å¤„ç†è´¦æˆ·äº¤äº’ï¼Œæœ€ç»ˆè°ƒç”¨é“¾ä¸Šç¨‹åºå®ŒæˆETFåˆ›å»ºã€‚
1. åŸºç¡€é…ç½®ï¼ˆconst.tsï¼‰
æä¾›ç¨‹åºå®ä¾‹ã€ProvideråŠé»˜è®¤é’±åŒ…ï¼Œä½œä¸ºå®¢æˆ·ç«¯ä¸é“¾ä¸Šäº¤äº’çš„åŸºç¡€ï¼š
import * as anchor from "@coral-xyz/anchor";
import &#123; Iswap &#125; from "../../target/types/iswap";

// åˆå§‹åŒ–Providerï¼ˆè¿æ¥Solanaç½‘ç»œï¼‰
let provider = anchor.AnchorProvider.env();
anchor.setProvider(provider);

// ç¨‹åºå®ä¾‹ï¼ˆå…³è”iSwapç¨‹åºï¼‰
const program = anchor.workspace.Iswap as anchor.Program&lt;Iswap>;

// é»˜è®¤é’±åŒ…ï¼ˆæœ¬åœ°é’±åŒ…ï¼‰
export function useDefaultWallet() &#123;
    const wallet = anchor.Wallet.local();
    return wallet;
&#125;

export &#123; program, provider &#125;;
2. åœ°å€æ´¾ç”Ÿï¼ˆaddress.tsï¼‰
é€šè¿‡ç§å­è§„åˆ™æ´¾ç”ŸETFç›¸å…³è´¦æˆ·çš„PDAåœ°å€ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¸é“¾ä¸Šç¨‹åºåœ°å€ä¸€è‡´ã€‚
deriveEtfTokenMintAccount
æ ¹æ®ETFç¬¦å·ï¼ˆsymbolï¼‰æ´¾ç”ŸMintè´¦æˆ·åœ°å€ï¼š
export function deriveEtfTokenMintAccount(symbol: string) &#123;
    return anchor.web3.PublicKey.findProgramAddressSync(
        [Buffer.from("etf_token"), Buffer.from(symbol)], // ç§å­ï¼šå‰ç¼€ + symbol
        program.programId
    );
&#125;
deriveEtfInfoAccount
æ ¹æ®Mintè´¦æˆ·åœ°å€æ´¾ç”ŸETFä¿¡æ¯è´¦æˆ·ï¼ˆetf_token_infoï¼‰åœ°å€ï¼š
export function deriveEtfInfoAccount(symbol: string) &#123;
    const [mintAccount,] = deriveEtfTokenMintAccount(symbol);
    return anchor.web3.PublicKey.findProgramAddressSync(
        [Buffer.from("etf_token"), mintAccount.toBuffer()], // ç§å­ï¼šå‰ç¼€ + Mintåœ°å€
        program.programId
    );
&#125;
3. ETFåˆ›å»ºå‡½æ•°ï¼ˆetf_token.tsï¼‰
createETFå‡½æ•°æ˜¯å®¢æˆ·ç«¯åˆ›å»ºETFçš„å…¥å£ï¼Œè´Ÿè´£æ„å»ºäº¤æ˜“å¹¶å‘é€è‡³é“¾ä¸Šï¼š
æ ¸å¿ƒæµç¨‹ï¼š

æ´¾ç”Ÿè´¦æˆ·åœ°å€ï¼šé€šè¿‡deriveEtfInfoAccountè·å–etf_token_infoè´¦æˆ·åœ°å€ã€‚
åˆ›å»ºèµ„äº§ATAè´¦æˆ·ï¼šä¸ºETFåŒ…å«çš„æ¯ä¸ªèµ„äº§åˆ›å»ºå…³è”Tokenè´¦æˆ·ï¼ˆATAï¼‰ï¼Œè‹¥è´¦æˆ·ä¸å­˜åœ¨åˆ™æ·»åŠ åˆ›å»ºæŒ‡ä»¤ï¼ˆç¡®ä¿ETFèƒ½æŒæœ‰èµ„äº§ï¼‰ã€‚
æ„å»ºäº¤æ˜“ï¼š

æ·»åŠ ATAåˆ›å»ºæŒ‡ä»¤ï¼ˆè‹¥éœ€è¦ï¼‰ã€‚
æ·»åŠ è°ƒç”¨é“¾ä¸ŠetfCreateæ–¹æ³•çš„æŒ‡ä»¤ï¼ˆä¼ å…¥åç§°ã€ç¬¦å·ã€èµ„äº§ç­‰å‚æ•°ï¼‰ã€‚


å‘é€äº¤æ˜“ï¼šä½¿ç”¨Providerå‘é€äº¤æ˜“ï¼Œç”±åˆ›å»ºè€…é’±åŒ…ç­¾åã€‚

export async function createETF(wallet: anchor.Wallet, name: string, symbol: string, description: string, url: string, assets: &#123; token: PublicKey, weight: number &#125;[]) &#123;
    // æ´¾ç”ŸETFä¿¡æ¯è´¦æˆ·åœ°å€
    const [etfTokenInfoAddress,] = deriveEtfInfoAccount(symbol);

    // åˆå§‹åŒ–äº¤æ˜“
    let tx = new anchor.web3.Transaction();

    // ä¸ºæ¯ä¸ªèµ„äº§åˆ›å»ºATAï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰
    for (const &#123; token &#125; of assets) &#123;
        const address = await getAssociatedTokenAddressSync(token, etfTokenInfoAddress, true);
        try &#123;
            await getAccount(provider.connection, address); // æ£€æŸ¥è´¦æˆ·æ˜¯å¦å­˜åœ¨
        &#125; catch (e) &#123;
            if (e instanceof TokenAccountNotFoundError) &#123;
                // æ·»åŠ åˆ›å»ºATAçš„æŒ‡ä»¤
                tx.add(createAssociatedTokenAccountInstruction(
                    wallet.payer.publicKey, //  payer
                    address,                // ATAåœ°å€
                    etfTokenInfoAddress,    // æ‰€æœ‰è€…ï¼ˆETFä¿¡æ¯è´¦æˆ·ï¼‰
                    token                   // èµ„äº§ä»£å¸Mint
                ));
            &#125;
        &#125;
    &#125;

    // æ·»åŠ è°ƒç”¨é“¾ä¸Šç¨‹åºçš„æŒ‡ä»¤
    tx.add(await program.methods.etfCreate(&#123;
        name, symbol, description, url, assets
    &#125;).transaction());

    // å‘é€å¹¶ç¡®è®¤äº¤æ˜“
    return await anchor.web3.sendAndConfirmTransaction(
        provider.connection,
        tx,
        [wallet.payer] // ç­¾åè€…
    );
&#125;
4. ç¤ºä¾‹è°ƒç”¨ï¼ˆindex.tsï¼‰
æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨createETFå‡½æ•°åˆ›å»ºETFï¼ŒåŒ…å«å‚æ•°ç¤ºä¾‹ï¼š
(async () => &#123;
    const defaultWallet = useDefaultWallet(); // ä½¿ç”¨é»˜è®¤é’±åŒ…
    // ETFåŸºæœ¬ä¿¡æ¯
    const [name, symbol, description, url] = [
        "MyETF3",
        "MYETF3",
        "This is my ETF3",
        "https://my-etf.com",
    ];
    // åŒ…å«çš„èµ„äº§ï¼ˆä»£å¸åœ°å€+æƒé‡ï¼‰
    const assets = [
        &#123;
            token: new anchor.web3.PublicKey("FGNSbKTiKd4d1Zv97c2iQACADB8N7MnDnDsv5auHGAHo"),
            weight: 90,
        &#125;,
        &#123;
            token: new anchor.web3.PublicKey("GTzKipZ6PcTEV2iV4LP1Yowwc4QPt1hvKmk6vuqY8ywp"),
            weight: 10,
        &#125;,
    ];
    // è°ƒç”¨åˆ›å»ºå‡½æ•°å¹¶æ‰“å°äº¤æ˜“å“ˆå¸Œ
    const tx = await createETF(defaultWallet, name, symbol, description, url, assets);
    console.log(tx);
&#125;)();
å››ã€å®Œæ•´æµç¨‹æ€»ç»“

å®¢æˆ·ç«¯å‡†å¤‡ï¼šç”¨æˆ·æŒ‡å®šETFå‚æ•°ï¼ˆåç§°ã€ç¬¦å·ã€èµ„äº§ç­‰ï¼‰ï¼Œé€šè¿‡useDefaultWalletè·å–ç­¾åé’±åŒ…ã€‚
åœ°å€æ´¾ç”Ÿï¼šå®¢æˆ·ç«¯é€šè¿‡deriveEtfTokenMintAccountå’ŒderiveEtfInfoAccountè®¡ç®—Mintå’Œä¿¡æ¯è´¦æˆ·çš„PDAåœ°å€ã€‚
äº¤æ˜“æ„å»ºï¼š

æ£€æŸ¥å¹¶åˆ›å»ºèµ„äº§ATAè´¦æˆ·ï¼ˆç¡®ä¿ETFå¯æŒæœ‰èµ„äº§ï¼‰ã€‚
æ„å»ºè°ƒç”¨é“¾ä¸ŠetfCreateæŒ‡ä»¤çš„äº¤æ˜“ã€‚


é“¾ä¸Šå¤„ç†ï¼š

ç¨‹åºéªŒè¯è´¦æˆ·çº¦æŸï¼Œåˆå§‹åŒ–Mintè´¦æˆ·ï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰ã€‚
é€šè¿‡CPIåˆ›å»ºå…ƒæ•°æ®è´¦æˆ·ï¼Œå…³è”Mintã€‚
åˆå§‹åŒ–etf_token_infoè´¦æˆ·ï¼Œå­˜å‚¨ETFæ•°æ®ã€‚


äº¤æ˜“ç¡®è®¤ï¼šå®¢æˆ·ç«¯æ¥æ”¶äº¤æ˜“å“ˆå¸Œï¼Œå®ŒæˆETFåˆ›å»ºã€‚

äº”ã€å…³é”®æŠ€æœ¯ç‚¹

PDAï¼ˆProgram Derived Addressï¼‰ï¼šç”¨äºç”ŸæˆMintå’Œä¿¡æ¯è´¦æˆ·åœ°å€ï¼Œç¡®ä¿åœ°å€å”¯ä¸€æ€§å’Œç¨‹åºæ§åˆ¶æƒã€‚
ATAï¼ˆAssociated Token Accountï¼‰ï¼šä¸ºETFè‡ªåŠ¨åˆ›å»ºèµ„äº§æŒæœ‰è´¦æˆ·ï¼Œéµå¾ªSPL Tokenæ ‡å‡†ã€‚
CPIï¼ˆCross-Program Invocationï¼‰ï¼šè°ƒç”¨MPLå…ƒæ•°æ®ç¨‹åºåˆ›å»ºå…ƒæ•°æ®ï¼Œå®ç°æ¨¡å—åŒ–åŠŸèƒ½å¤ç”¨ã€‚
åŸå­æ€§äº¤æ˜“ï¼šæ‰€æœ‰æ“ä½œï¼ˆATAåˆ›å»ºã€ç¨‹åºè°ƒç”¨ï¼‰åœ¨åŒä¸€äº¤æ˜“ä¸­å®Œæˆï¼Œç¡®ä¿è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚

]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part20]_ETFçš„è´­ä¹°</title>
    <url>/2025/08/25/Solana-part20-ETF%E7%9A%84%E8%B4%AD%E4%B9%B0/</url>
    <content><![CDATA[Solana[part20]_ETFçš„è´­ä¹°
è´­ä¹° ETF
åŸºæœ¬æ€è·¯
ä»¥ ETF No.1 ä¸ºä¾‹ï¼ŒETF No.1 åŒ…å« jitoSOL å’Œ mSOLï¼Œæƒé‡åˆ†åˆ«ä¸º 20%ã€80%ã€‚ ã€Œ etfé‡Œé¢ä¸æ˜¯tokenè´¦æˆ·å— æ‹¿æ¥çš„sol ã€
å½“å‰ä»·æ ¼

1 JitoSOL = 1.16 SOL
1 mSOL = 1.25 SOL

ç”¨æˆ·éœ€æ±‚ä¸æˆæœ¬è®¡ç®—
ç”¨æˆ·å½“å‰æŒæœ‰ SOLï¼Œè®¡åˆ’è´­ä¹° ETF No.1 100 ä»½ï¼Œéœ€èŠ±è´¹ï¼š100Ã—20%Ã—1.16+100Ã—80%Ã—1.25=123.2 SOL
æ–¹æ¡ˆä¸€ï¼šå‰ç«¯ swap

ã€ç”¨æˆ·ã€‘ é€šè¿‡ ray æˆ– okx ç­‰å¹³å°ï¼Œå°† 123.2 SOL æ¢å‡º 80 mSOL å’Œ 20 JitoSOLã€‚
ã€ç”¨æˆ·ã€‘ æ‰§è¡Œã€Transferã€‘æ“ä½œï¼Œå°† JitoSOL 20 ä»½å’Œ mSOL 80 ä»½è½¬å…¥ã€åˆçº¦ã€‘ã€‚
ã€åˆçº¦ã€‘ æ‰§è¡Œã€Mintã€‘æ“ä½œï¼Œå‘ã€ç”¨æˆ·ã€‘å‘è¡Œ 100 ä»½ ETF No.1ã€‚

æ–¹æ¡ˆäºŒï¼šåˆçº¦ swap

ã€ç”¨æˆ·ã€‘ æ‰§è¡Œã€Transferã€‘æ“ä½œï¼Œå°† 123.2 SOL è½¬å…¥ã€åˆçº¦ã€‘ã€‚
ã€åˆçº¦ã€‘ é€šè¿‡ ray æˆ– okx ç­‰å¹³å°ï¼Œå°† 123.2 SOL æ¢å‡º 80 mSOL å’Œ 20 JitoSOLã€‚
ã€åˆçº¦ã€‘ æ‰§è¡Œã€Mintã€‘æ“ä½œï¼Œå‘ã€ç”¨æˆ·ã€‘å‘è¡Œ 100 ä»½ ETF No.1ã€‚

ï¼ˆæ³¨ï¼šæ“ä½œä¸­çš„ã€Transferã€‘ã€Mintã€‘ä¸ºé“¾ä¸Šäº¤äº’åŠ¨ä½œï¼Œéœ€ç»“åˆå…·ä½“åˆçº¦é€»è¾‘æ‰§è¡Œã€‚ï¼‰
å‰ç½®å‡†å¤‡ï¼š
âœ  anchor git:(main) âœ— spl-token create-token
Creating token HCux2X4pDQe79mwhAwcfjBPYXf5ocU6VN9HSjxzuJVzk under program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA

Address:  HCux2X4pDQe79mwhAwcfjBPYXf5ocU6VN9HSjxzuJVzk
Decimals:  9

Signature: qkrfqj8QKGHWiCSr3DjooVd9EB2FHvSPMfgk95f3R4n2G7AkdoSN1ufoFj6Suw9rYKzxcDJa441uokk5i5xosfC

âœ  anchor git:(main) âœ— spl-token create-token
Creating token D5izrwQEikX5FGhzkgG4HgBNWXXaayNy4UF1X1YNVJFW under program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA

Address:  D5izrwQEikX5FGhzkgG4HgBNWXXaayNy4UF1X1YNVJFW
Decimals:  9

Signature: aR8akG7j4A15h9Qs4MnUMbMtNA965g5rDSj53oaCyvfXNQsQHYDSVQ6Mw5En8EcMLwfX3AHWNjCWpGciHJQZTbb

âœ  anchor git:(main) âœ— spl-token create-account D5izrwQEikX5FGhzkgG4HgBNWXXaayNy4UF1X1YNVJFW
Creating account FKFZdRon44c7UG3sWDhkfdRhsbnjnPdERFHT4eVwZbkM

Signature: 5xoKsk1VmbSYzsVivUv3vQqEjpURMBqPzDDbLDHZ1DsWqJjdqoJbcUAUBAFR5VdGcjrh5ik3mdJo85SRiHgotK8k

âœ  anchor git:(main) âœ— spl-token create-account HCux2X4pDQe79mwhAwcfjBPYXf5ocU6VN9HSjxzuJVzk
Creating account For4aUqGLAVwvJCJ7W7xp9oNXAtQQqTdyA5kityMxhkB

Signature: 3o2UV8S756A6vtL4bKgpWQRf8oS5mmQx5RuG8drarjFpnEFwucVyAZoapcRrBVVryukmu8Mxuf7EyrnLJyVy3Rpp

âœ  anchor git:(main) âœ— spl-token mint HCux2X4pDQe79mwhAwcfjBPYXf5ocU6VN9HSjxzuJVzk  100
Minting 100 tokens
  Token: HCux2X4pDQe79mwhAwcfjBPYXf5ocU6VN9HSjxzuJVzk
  Recipient: For4aUqGLAVwvJCJ7W7xp9oNXAtQQqTdyA5kityMxhkB

Signature: 5mijdTfBDZvD51zKfhw31JNaxNvZYesCKoHbDD48zCcMkwN1oMqZcjYamjpM4MCAD1fvbsu1BK5sKoHX4Ghiehfo

âœ  anchor git:(main) âœ— spl-token mint D5izrwQEikX5FGhzkgG4HgBNWXXaayNy4UF1X1YNVJFW 100
Minting 100 tokens
  Token: D5izrwQEikX5FGhzkgG4HgBNWXXaayNy4UF1X1YNVJFW
  Recipient: FKFZdRon44c7UG3sWDhkfdRhsbnjnPdERFHT4eVwZbkM

Signature: 5ZMfewBZQfrVC7jcE62FtKNKckcDk4WfwiLhqQAmukgGYBpNwnhoirTNHT31oFoaYVje29fhp9ege4KATAiKPt2n

âœ  anchor git:(main) âœ— spl-token accounts
Token                                         Balance
-----------------------------------------------------
D5izrwQEikX5FGhzkgG4HgBNWXXaayNy4UF1X1YNVJFW  100
HCux2X4pDQe79mwhAwcfjBPYXf5ocU6VN9HSjxzuJVzk  100
è¿è¡ŒæˆåŠŸï¼š
âœ  anchor git:(main) âœ— anchor run example
6RQFEKBGuqJAasPDLZEK2Uk3pLMEEo3xfSgz5AvjU65H
4Zcee6VcEoATiTjwMHp9LPsvYLW2tmYmExQFhZ6TkQGYGganfDJGKXSuicAdFrWMZJjWomgunEQ3keGHNEyvfhLN
âœ  anchor git:(main) âœ— spl-token accounts
Token                                         Balance
-----------------------------------------------------
6RQFEKBGuqJAasPDLZEK2Uk3pLMEEo3xfSgz5AvjU65H  200
D5izrwQEikX5FGhzkgG4HgBNWXXaayNy4UF1X1YNVJFW  90 
HCux2X4pDQe79mwhAwcfjBPYXf5ocU6VN9HSjxzuJVzk  10 
ä½†æ˜¯å´æ˜¯ä¸¤ç™¾ä»½
å®šä½é—®é¢˜å‘ç°æ˜¯minté€»è¾‘æ”¾åœ¨äº†å¾ªç¯é‡Œé¢ï¼Œè´­ä¹°äº†ä¸¤æ¬¡
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part2]_Solanaå¼€å‘å…¥é—¨</title>
    <url>/2025/08/05/Solana-part2-Solana%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[Solana[part2]_Solanaå¼€å‘å…¥é—¨
è™šæ‹Ÿæœº
Solanaçš„æ‰§è¡Œç¯å¢ƒä¸å…¶ä»–åŒºå—é“¾å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œå…¶è™šæ‹Ÿæœºæ¶æ„æ˜¯å®ç°é«˜ååé‡çš„æ ¸å¿ƒåŸºç¡€ä¹‹ä¸€ï¼š

EVMï¼ˆEthereum Virtual Machineï¼‰ï¼šä»¥å¤ªåŠç­‰åŒºå—é“¾é‡‡ç”¨çš„è™šæ‹Ÿæœºï¼ŒåŸºäºæ ˆå¼æ¶æ„ï¼ŒSolanaä¸ç›´æ¥æ”¯æŒEVMï¼Œä½†å¯é€šè¿‡è·¨é“¾æ¡¥æˆ–å…¼å®¹å±‚ï¼ˆå¦‚Neon EVMï¼‰å®ç°EVMåˆçº¦è¿ç§»ã€‚
WASMï¼ˆWebAssemblyï¼‰ï¼šé€šç”¨äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ï¼ŒSolanaæ—©æœŸæ›¾è€ƒè™‘é‡‡ç”¨ï¼Œä½†æœ€ç»ˆé€‰æ‹©äº†æ›´è½»é‡çš„æ–¹æ¡ˆã€‚
Sealevel VMï¼šSolanaåŸç”Ÿè™šæ‹Ÿæœºï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡Œï¼ˆåŒºåˆ«äºEVMçš„ä¸²è¡Œæ‰§è¡Œï¼‰ï¼Œæ˜¯Solanaé«˜TPSï¼ˆæ¯ç§’äº¤æ˜“æ•°ï¼‰çš„å…³é”®ï¼Œå¯åŒæ—¶å¤„ç†æ•°åƒä¸ªç‹¬ç«‹åˆçº¦è°ƒç”¨ã€‚
BPFæ‰©å±•æŒ‡ä»¤é›†ï¼šSealevel VMåŸºäºBPFï¼ˆBerkeley Packet Filterï¼‰æ‰©å±•ï¼Œå…·æœ‰é«˜æ•ˆã€å®‰å…¨ã€ä½èµ„æºå ç”¨çš„ç‰¹ç‚¹ï¼Œé€‚åˆåŒºå—é“¾åœºæ™¯çš„æ²™ç®±æ‰§è¡Œç¯å¢ƒã€‚

é¡¹ç›®æ­å»º
1. Native Rustå¼€å‘ï¼ˆåŸç”Ÿå¼€å‘æ–¹å¼ï¼‰
ç›´æ¥ä½¿ç”¨Rustç¼–å†™Solanaåˆçº¦ï¼Œé€‚åˆæ·±å…¥ç†è§£åº•å±‚æœºåˆ¶ã€‚
ç¯å¢ƒå‡†å¤‡

å®‰è£…Rustï¼šcurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
å®‰è£…Solana CLIï¼šsh -c &quot;$(curl -sSfL https://release.solana.com/v1.18.4/install)&quot;ï¼ˆç‰ˆæœ¬å·å¯æŒ‰éœ€æ›´æ–°ï¼‰
é…ç½®ç½‘ç»œï¼šsolana config set --url https://api.devnet.solana.comï¼ˆä½¿ç”¨devnetæµ‹è¯•ç½‘ï¼‰
è·å–æµ‹è¯•ç½‘SOLï¼ˆç”¨äºæ”¯ä»˜gasï¼‰ï¼šsolana airdrop 1ï¼ˆæ¯æ¬¡æœ€å¤š1 SOLï¼Œä¸è¶³å¯é‡å¤ç”³è¯·ï¼‰

æ­¥éª¤è¯¦è§£


åˆ›å»ºé¡¹ç›®
cargo new --lib native-rust &amp;&amp; cd native-rust
cargo add solana-program  # æ·»åŠ Solanaåˆçº¦æ ¸å¿ƒä¾èµ–


ä¿®æ”¹ç¼–è¯‘é…ç½®
ç¼–è¾‘Cargo.tomlï¼ŒæŒ‡å®šè¾“å‡ºä¸ºåŠ¨æ€é“¾æ¥åº“ï¼ˆSolanaåˆçº¦è¦æ±‚ï¼‰ï¼š
# é¡¶éƒ¨æ·»åŠ ï¼ˆè§£å†³edition2024å…¼å®¹é—®é¢˜ï¼‰
cargo-features = ["edition2024"]

[package]
name = "native-rust"
version = "0.1.0"
edition = "2024"  # éœ€ä¸cargo-featureså¯¹åº”

[lib]
crate-type = ["cdylib", "lib"]  # è¾“å‡ºä¸ºåŠ¨æ€é“¾æ¥åº“

[dependencies]
solana-program = "1.18.0"  # å»ºè®®æŒ‡å®šæ˜ç¡®ç‰ˆæœ¬


ç¼–å†™åŸºç¡€åˆçº¦
ç¼–è¾‘src/lib.rsï¼Œå®ç°åˆçº¦å…¥å£å‡½æ•°ï¼ˆSolanaåˆçº¦å¿…é¡»åŒ…å«entrypoint!å®å®šä¹‰çš„å…¥å£ï¼‰ï¼š
use solana_program::&#123;
    entrypoint,
    account_info::AccountInfo,
    entrypoint::ProgramResult,
    msg,  // ç”¨äºæ—¥å¿—è¾“å‡ºï¼ˆé“¾ä¸Šå¯è§ï¼‰
    pubkey::Pubkey,
&#125;;

// å®šä¹‰å…¥å£å‡½æ•°
entrypoint!(process_instruction);

/// åˆçº¦æ ¸å¿ƒé€»è¾‘
/// å‚æ•°è¯´æ˜ï¼š
/// - program_id: åˆçº¦æœ¬èº«çš„å…¬é’¥
/// - accounts: æœ¬æ¬¡äº¤äº’æ¶‰åŠçš„è´¦æˆ·åˆ—è¡¨
/// - instruction_data: ä¼ å…¥çš„æŒ‡ä»¤æ•°æ®ï¼ˆäºŒè¿›åˆ¶ï¼‰
fn process_instruction(
    program_id: &amp;Pubkey,
    accounts: &amp;[AccountInfo],
    instruction_data: &amp;[u8],
) -> ProgramResult &#123;
    // é“¾ä¸Šæ—¥å¿—ï¼ˆå¯é€šè¿‡solana logsæŸ¥çœ‹ï¼‰
    msg!("Hello Solana!");
    msg!("Program ID: &#123;&#125;", program_id);
    msg!("Accounts involved: &#123;:?&#125;", accounts.len());
    msg!("Instruction data length: &#123;&#125;", instruction_data.len());
    
    Ok(())  // è¿”å›æˆåŠŸç»“æœ
&#125;


æ„å»ºåˆçº¦
ä½¿ç”¨Solanaçš„BPFç¼–è¯‘å™¨ç¼–è¯‘ï¼ˆç”Ÿæˆ.soæ–‡ä»¶ï¼‰ï¼š
cargo build-sbf  # ç¼–è¯‘ä¸ºSolanaå…¼å®¹çš„BPFæ ¼å¼
ç¼–è¯‘æˆåŠŸåï¼Œè¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼štarget/sbpf-solana-solana/release/native_rust.so


éƒ¨ç½²ä¸éªŒè¯


éƒ¨ç½²åˆ°æµ‹è¯•ç½‘ï¼š
solana program deploy target/sbpf-solana-solana/release/native_rust.so
éƒ¨ç½²æˆåŠŸåä¼šè¿”å›Program Id: &lt;YOUR_PROGRAM_ID&gt;ï¼ˆè®°å½•æ­¤IDç”¨äºåç»­äº¤äº’ï¼‰ã€‚


éªŒè¯éƒ¨ç½²ï¼š
solana program show &lt;YOUR_PROGRAM_ID>  # æŸ¥çœ‹åˆçº¦çŠ¶æ€




åˆçº¦ç®¡ç†

å‡çº§åˆçº¦ï¼ˆéœ€æå‰é…ç½®å‡çº§æƒé™ï¼‰ï¼šsolana program upgrade &lt;new_so_file> &lt;YOUR_PROGRAM_ID> --upgrade-authority &lt;AUTHORITY_KEYPAIR>

å…³é—­åˆçº¦ï¼ˆå›æ”¶å­˜å‚¨ç©ºé—´ï¼Œéœ€åˆçº¦æ‰€æœ‰è€…æƒé™ï¼‰ï¼šsolana program close &lt;YOUR_PROGRAM_ID>




å¸¸è§é—®é¢˜

ç¼–è¯‘æŠ¥é”™feature edition2024 is requiredï¼šç¡®ä¿Cargo.tomlé¡¶éƒ¨æ·»åŠ äº†cargo-features = [&quot;edition2024&quot;]ã€‚
éƒ¨ç½²å¤±è´¥Insufficient fundsï¼šé€šè¿‡solana airdrop 1è·å–æ›´å¤šæµ‹è¯•ç½‘SOLã€‚
æ—¥å¿—æ— æ³•æŸ¥çœ‹ï¼šä½¿ç”¨solana logs --url https://api.devnet.solana.comç›‘å¬é“¾ä¸Šæ—¥å¿—ã€‚

2. Playgroundï¼ˆåœ¨çº¿å¼€å‘å·¥å…·ï¼‰
é€‚åˆå¿«é€ŸåŸå‹å¼€å‘ï¼Œæ— éœ€æœ¬åœ°ç¯å¢ƒé…ç½®ï¼Œæ¨èæ–°æ‰‹å…¥é—¨ä½¿ç”¨ã€‚
æ“ä½œæ­¥éª¤

è®¿é—®åœ¨çº¿IDEï¼šSolana Playground
ç‚¹å‡»New Project â†’ é€‰æ‹©Solana Programï¼Œè‡ªåŠ¨ç”ŸæˆåŸºç¡€æ¡†æ¶ã€‚
ç¼–è¾‘src/lib.rsï¼ˆåŒNativeæ–¹å¼çš„åˆçº¦é€»è¾‘ï¼‰ã€‚
è¿æ¥é’±åŒ…ï¼šç‚¹å‡»å·¦ä¾§Build &amp; Deploy â†’ Connect Walletï¼ˆæ¨èä½¿ç”¨Phantomé’±åŒ…ï¼Œåˆ‡æ¢åˆ°devnetï¼‰ã€‚
æ„å»ºéƒ¨ç½²ï¼šç‚¹å‡»Buildç¼–è¯‘ï¼ŒæˆåŠŸåç‚¹å‡»Deployï¼Œç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆéœ€æ”¯ä»˜å°‘é‡gasï¼‰ã€‚
æŸ¥çœ‹éƒ¨ç½²è¯¦æƒ…ï¼šéƒ¨ç½²æˆåŠŸåï¼Œå·¦ä¸‹è§’ä¼šæ˜¾ç¤ºProgram IDï¼Œç‚¹å‡»é“¾æ¥å¯åœ¨Solana Explorerä¸­æŸ¥çœ‹åˆçº¦ä¿¡æ¯ã€‚

äº¤äº’ç¤ºä¾‹ï¼ˆå®¢æˆ·ç«¯ï¼‰
é€šè¿‡è‡ªåŠ¨ç”Ÿæˆçš„client.tsï¼ˆTypeScriptï¼‰ä¸åˆçº¦äº¤äº’ï¼š
import &#123; Connection, PublicKey, Transaction, SystemProgram &#125; from "@solana/web3.js";
import &#123; sendTransaction &#125; from "./utils/sendTransaction";

// åˆçº¦åœ°å€ï¼ˆæ›¿æ¢ä¸ºä½ çš„Program IDï¼‰
const PROGRAM_ID = new PublicKey("YOUR_PROGRAM_ID");

async function main() &#123;
  const connection = new Connection("https://api.devnet.solana.com");
  const payer = (await window.solana.connect()).publicKey;

  // æ„å»ºäº¤æ˜“
  const transaction = new Transaction().add(&#123;
    programId: PROGRAM_ID,
    keys: [&#123; pubkey: payer, isSigner: true, isWritable: false &#125;],  // ä¼ å…¥ payer è´¦æˆ·
    data: Buffer.from([]),  // ç©ºæŒ‡ä»¤æ•°æ®
  &#125;);

  // å‘é€äº¤æ˜“
  const signature = await sendTransaction(transaction, connection);
  console.log("Transaction signature:", signature);
  console.log("View on Explorer: https://explorer.solana.com/tx/" + signature + "?cluster=devnet");
&#125;

main();
ç‚¹å‡»Runæ‰§è¡Œå®¢æˆ·ç«¯ä»£ç ï¼Œåœ¨æ§åˆ¶å°æŸ¥çœ‹äº¤æ˜“ç»“æœã€‚
3. Anchorï¼ˆå¼€å‘æ¡†æ¶ï¼‰
Anchoræ˜¯Solanaç”Ÿæ€æœ€æµè¡Œçš„å¼€å‘æ¡†æ¶ï¼Œç®€åŒ–äº†åˆçº¦ç¼–å†™ã€æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹ï¼Œå†…ç½®ç±»å‹å®‰å…¨å’Œåºåˆ—åŒ–å·¥å…·ã€‚
ç¯å¢ƒå®‰è£…
# å®‰è£…Anchor CLI
cargo install --git https://github.com/coral-xyz/anchor anchor-cli --locked

# éªŒè¯å®‰è£…
anchor --version  # éœ€æ˜¾ç¤º0.29.0+ç‰ˆæœ¬

# å®‰è£…yarn
npm install -g yarn
æˆ–è€…
brew install yarn # è¿™ä¸ªä¼šé»˜è®¤ç³»ç»Ÿé…ç½®
é¡¹ç›®æ“ä½œ


åˆ›å»ºé¡¹ç›®
anchor init anchor-project &amp;&amp; cd anchor-project
é¡¹ç›®ç»“æ„ï¼š
anchor-project&#x2F;
â”œâ”€â”€ programs&#x2F;          # åˆçº¦ä»£ç ï¼ˆRustï¼‰
â”‚   â””â”€â”€ anchor_project&#x2F;
â”œâ”€â”€ tests&#x2F;             # æµ‹è¯•ä»£ç ï¼ˆTypeScriptï¼‰
â”œâ”€â”€ migrations&#x2F;        # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ Anchor.toml        # é¡¹ç›®é…ç½®ï¼ˆç½‘ç»œã€åˆçº¦åœ°å€ç­‰ï¼‰
â””â”€â”€ Cargo.toml         # ä¾èµ–ç®¡ç†


ç¼–å†™åˆçº¦ï¼ˆä»¥è®¡æ•°å™¨ä¸ºä¾‹ï¼‰
ç¼–è¾‘programs/anchor_project/src/lib.rsï¼š
use anchor_lang::prelude::*;

// å£°æ˜ç¨‹åºIDï¼ˆéœ€ä¸Anchor.tomlä¸­ä¸€è‡´ï¼‰
declare_id!("Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS");

#[program]
pub mod anchor_project &#123;
    use super::*;

    // åˆå§‹åŒ–è®¡æ•°å™¨
    pub fn initialize(ctx: Context&lt;Initialize>) -> Result&lt;()> &#123;
        let counter = &amp;mut ctx.accounts.counter;
        counter.count = 0;  // åˆå§‹å€¼ä¸º0
        msg!("Counter initialized! Current count: &#123;&#125;", counter.count);
        Ok(())
    &#125;

    // å¢åŠ è®¡æ•°
    pub fn increment(ctx: Context&lt;Increment>) -> Result&lt;()> &#123;
        let counter = &amp;mut ctx.accounts.counter;
        counter.count += 1;
        msg!("Count incremented! New count: &#123;&#125;", counter.count);
        Ok(())
    &#125;
&#125;

// åˆå§‹åŒ–æ—¶çš„è´¦æˆ·çº¦æŸ
#[derive(Accounts)]
pub struct Initialize&lt;'info> &#123;
    // è®¡æ•°å™¨è´¦æˆ·ï¼ˆéœ€è¦å­˜å‚¨æ•°æ®ï¼Œå› æ­¤is_writable=trueï¼‰
    #[account(init, payer = user, space = 8 + 8)]  // 8å­—èŠ‚ discriminator + 8å­—èŠ‚u64
    pub counter: Account&lt;'info, Counter>,
    // æ”¯ä»˜è€…ï¼ˆç­¾åè€…ï¼‰
    #[account(mut)]
    pub user: Signer&lt;'info>,
    // ç³»ç»Ÿç¨‹åºï¼ˆç”¨äºåˆ›å»ºè´¦æˆ·ï¼‰
    pub system_program: Program&lt;'info, System>,
&#125;

// å¢åŠ è®¡æ•°æ—¶çš„è´¦æˆ·çº¦æŸ
#[derive(Accounts)]
pub struct Increment&lt;'info> &#123;
    #[account(mut)]  // å¯å†™ï¼ˆéœ€è¦ä¿®æ”¹countï¼‰
    pub counter: Account&lt;'info, Counter>,
&#125;

// è®¡æ•°å™¨æ•°æ®ç»“æ„
#[account]
pub struct Counter &#123;
    pub count: u64,
&#125;


é…ç½®ç½‘ç»œ
ç¼–è¾‘Anchor.tomlï¼ŒæŒ‡å®šéƒ¨ç½²ç½‘ç»œï¼š
[provider]
cluster = "devnet"  # å¯é€‰ï¼šlocalnet, testnet, mainnet-beta
wallet = "~/.config/solana/id.json"  # æœ¬åœ°é’±åŒ…è·¯å¾„

[programs.devnet]
anchor_project = "Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS"  # ç¨‹åºIDï¼ˆéœ€ä¸åˆçº¦ä¸­ä¸€è‡´ï¼‰


æµ‹è¯•åˆçº¦
ç¼–è¾‘tests/anchor_project.tsç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼š
import * as anchor from "@coral-xyz/anchor";
import &#123; Program &#125; from "@coral-xyz/anchor";
import &#123; AnchorProject &#125; from "../target/types/anchor_project";
import &#123; expect &#125; from "chai";

describe("anchor-project", () => &#123;
  // é…ç½®Anchor providerå’Œprogram
  const provider = anchor.AnchorProvider.env();
  anchor.setProvider(provider);

  const program = anchor.workspace.AnchorProject as Program&lt;AnchorProject>;
  
  // ä¸ºæ¯ä¸ªæµ‹è¯•ç”Ÿæˆä¸€ä¸ªæ–°çš„è´¦æˆ·å¯†é’¥å¯¹
  let counterKeypair: anchor.web3.Keypair;

  beforeEach(() => &#123;
    counterKeypair = anchor.web3.Keypair.generate();
  &#125;);

  it("Initialize counter", async () => &#123;
    // è°ƒç”¨initializeæ–¹æ³•
    const tx = await program.methods.initialize()
      .accounts(&#123;
        counter: counterKeypair.publicKey,
        user: provider.wallet.publicKey,
        systemProgram: anchor.web3.SystemProgram.programId,
      &#125;)
      .signers([counterKeypair])
      .rpc();
    
    console.log("Your transaction signature", tx);

    // è·å–counterè´¦æˆ·å¹¶éªŒè¯åˆå§‹å€¼
    const counter = await program.account.counter.fetch(counterKeypair.publicKey);
    expect(counter.count.toNumber()).to.equal(0);
    console.log("Initial count:", counter.count.toString());
  &#125;);

  it("Increment counter", async () => &#123;
    // é¦–å…ˆåˆå§‹åŒ–è´¦æˆ·
    await program.methods.initialize()
      .accounts(&#123;
        counter: counterKeypair.publicKey,
        user: provider.wallet.publicKey,
        systemProgram: anchor.web3.SystemProgram.programId,
      &#125;)
      .signers([counterKeypair])
      .rpc();

    // è°ƒç”¨incrementæ–¹æ³•
    const tx = await program.methods.increment()
      .accounts(&#123; 
        counter: counterKeypair.publicKey 
      &#125;)
      .rpc();
    
    console.log("Your transaction signature", tx);

    // è·å–counterè´¦æˆ·å¹¶éªŒè¯è®¡æ•°å¢åŠ 
    const counter = await program.account.counter.fetch(counterKeypair.publicKey);
    expect(counter.count.toNumber()).to.equal(1);
    console.log("After increment:", counter.count.toString());
  &#125;);

  it("Increment counter multiple times", async () => &#123;
    // é¦–å…ˆåˆå§‹åŒ–è´¦æˆ·
    await program.methods.initialize()
      .accounts(&#123;
        counter: counterKeypair.publicKey,
        user: provider.wallet.publicKey,
        systemProgram: anchor.web3.SystemProgram.programId,
      &#125;)
      .signers([counterKeypair])
      .rpc();

    // å¤šæ¬¡è°ƒç”¨incrementæ–¹æ³•
    await program.methods.increment()
      .accounts(&#123; 
        counter: counterKeypair.publicKey 
      &#125;)
      .rpc();

    await program.methods.increment()
      .accounts(&#123; 
        counter: counterKeypair.publicKey 
      &#125;)
      .rpc();

    await program.methods.increment()
      .accounts(&#123; 
        counter: counterKeypair.publicKey 
      &#125;)
      .rpc();

    // è·å–counterè´¦æˆ·å¹¶éªŒè¯è®¡æ•°
    const counter = await program.account.counter.fetch(counterKeypair.publicKey);
    expect(counter.count.toNumber()).to.equal(3);
    console.log("After 3 increments:", counter.count.toString());
  &#125;);
&#125;);
è¿è¡Œæµ‹è¯•ï¼š
anchor test  # è‡ªåŠ¨å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ï¼Œè¿è¡Œæµ‹è¯•åå…³é—­
æµ‹è¯•å®Œæˆï¼š
anchor-project
Your transaction signature 3DBSMCVTW65CDsuPLx4jB3CosozZSjQbCurXo2KcfMSkfr2nZRHz5XQuEzEXr56bf1qY2MVsoYuQsYePwAuLLY4F
Initial count: 0
 âœ” Initialize counter (592ms)
Your transaction signature 36wPyPxho2rGRiRxM2ihF2cvfKENbNFKzNEr3ida4mEVeiRSmnEMbKqeg7BuTWdiDeKzd7dktn5WjbpNv4mWhNnF
After increment: 1
 âœ” Increment counter (915ms)
After 3 increments: 3
 âœ” Increment counter multiple times (1905ms)
 3 passing (3s)


éƒ¨ç½²åˆçº¦
anchor deploy  # éƒ¨ç½²åˆ°Anchor.tomlæŒ‡å®šçš„ç½‘ç»œ
-------------
âœ  anchor-project anchor deploy
Error: error sending request for url (http://127.0.0.1:8899/): error trying to connect: tcp connect error: Connection refused (os error 61)

Caused by:
    0: error sending request for url (http://127.0.0.1:8899/): error trying to connect: tcp connect error: Connection refused (os error 61)
    1: error trying to connect: tcp connect error: Connection refused (os error 61)
    2: tcp connect error: Connection refused (os error 61)
    3: Connection refused (os error 61)
éƒ¨ç½²å¤±è´¥ï¼Œå‘ç°æ²¡æœ‰åˆ‡æ¢ devnet
[provider]
cluster = "devnet"                  # å¯é€‰ï¼šlocalnet, testnet, mainnet-beta
wallet = "~/.config/solana/id.json" # æœ¬åœ°é’±åŒ…è·¯å¾„
éƒ¨ç½²æˆåŠŸåï¼Œä¼šè¿”å›Program Id: &lt;DEPLOYED_PROGRAM_ID&gt;ï¼Œå¯åœ¨Solana Explorerä¸­æŸ¥çœ‹ã€‚
âœ  anchor-project anchor deploy
Deploying cluster: https://api.devnet.solana.com
Upgrade authority: /Users/tinachan/.config/solana/id.json
Deploying program "anchor_project"...
Program path: /Users/tinachan/rust/anchor-project/target/deploy/anchor_project.so...
Program Id: HDvugLuzT7XtdaskGkYw9DJZqNLtDLeVXfMeET9bne9y

Signature: 4ArrCsQQu4zCU7455yeoo3L5LvTiWngXq3gMCHoA42Z25tSHgMrVKPiQd4yhSvu37n28cwWPysrDiMAMfA21BNfF

Deploy success



ä¼˜åŠ¿æ€»ç»“

è‡ªåŠ¨å¤„ç†è´¦æˆ·åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆæ— éœ€æ‰‹åŠ¨å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚
å†…ç½®æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒTypeScriptæµ‹è¯•åˆçº¦ã€‚
ç®€åŒ–è´¦æˆ·æƒé™ç®¡ç†ï¼ˆé€šè¿‡#[derive(Accounts)]çº¦æŸï¼‰ã€‚
è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯SDKï¼ˆtarget/types/ç›®å½•ä¸‹ï¼‰ï¼Œæ–¹ä¾¿å‰ç«¯é›†æˆã€‚

è¸©å‘

ç¨‹åºIDä¸åŒ¹é…é—®é¢˜ï¼š

Rustä»£ç ä¸­çš„[declare_id!](javascript:void(0))ä¸Anchor.tomlä¸­çš„ç¨‹åºIDä¸ä¸€è‡´
æˆ‘ä»¬å°†Rustä»£ç ä¸­çš„ç¨‹åºIDä»Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnSæ›´æ–°ä¸º5vhtLSUBXoqe3a2Kxtx8tcNdTNTaXaSgFT7MGN1bWxz5ï¼Œä¸Anchor.tomlä¿æŒä¸€è‡´


æµ‹è¯•ç¯å¢ƒé…ç½®é—®é¢˜ï¼š

å°†Anchor.tomlä¸­çš„[cluster](javascript:void(0))ä»devnetæ”¹ä¸ºlocalnetï¼Œè¿™æ ·æµ‹è¯•å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œè€Œä¸éœ€è¦è¿æ¥åˆ°Devnet


æ–­è¨€æ¯”è¾ƒé—®é¢˜ï¼š

Solanaç¨‹åºè¿”å›çš„æ•°å­—æ˜¯BNï¼ˆBigNumberï¼‰ç±»å‹ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰ç›´æ¥ä¸JavaScriptæ•°å­—æ¯”è¾ƒ
é€šè¿‡ä½¿ç”¨.toNumber()æ–¹æ³•å°†BNç±»å‹è½¬æ¢ä¸ºæ™®é€šæ•°å­—è¿›è¡Œæ¯”è¾ƒï¼Œè§£å†³äº†æ–­è¨€å¤±è´¥é—®é¢˜


ä¾èµ–å®‰è£…ï¼š

ç¡®ä¿å®‰è£…äº†chaiä¾èµ–ä»¥æ”¯æŒæµ‹è¯•æ–­è¨€ npm install chai



æ€»ç»“

Native Rustï¼šé€‚åˆæ·±å…¥ç†è§£Solanaåº•å±‚ï¼Œçµæ´»æ€§é«˜ä½†å¼€å‘æ•ˆç‡ä½ã€‚
Playgroundï¼šé€‚åˆå¿«é€ŸéªŒè¯æƒ³æ³•ï¼Œæ— éœ€é…ç½®ç¯å¢ƒï¼Œé€‚åˆæ–°æ‰‹å…¥é—¨ã€‚
Anchorï¼šç”Ÿäº§ç¯å¢ƒé¦–é€‰ï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ï¼Œç”Ÿæ€å·¥å…·ä¸°å¯Œã€‚

]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part21]_ETFçš„èµå›</title>
    <url>/2025/08/26/Solana-part21-ETF%E7%9A%84%E8%B5%8E%E5%9B%9E/</url>
    <content><![CDATA[Solana[part21]_ETFçš„èµå›

ä»£ç ï¼šhttps://github.com/SoniaChan33/iswap/commit/c648cb122b2cc9a80a8085d78bdc9033ab83c954

èµå› ETF
ä»¥ ETF No.1 ä¸ºä¾‹ï¼ŒETF No.1 åŒ…å« jitoSOL å’Œ mSOLï¼Œæƒé‡ä¸º 20%ã€80%
å½“å‰ä»·æ ¼ï¼š 1 JitoSOL = 1.06 SOL 1 mSOL = 1.35 SOL
ç”¨æˆ·å½“å‰æŒæœ‰ 100 ä»½ ETF No.1ï¼Œè®¡åˆ’å–å‡º ETF No.1 100 ä»½
è·å¾—ï¼š(100 \times 20% \times 1.06 + 100 \times 80% \times 1.35 = 129.2 \ \text{SOL})
æ–¹æ¡ˆï¼š

ã€ç”¨æˆ·ã€‘ã€Burnã€‘100 ä»½ ETF No.1ï¼ˆæ³¨ï¼šåŸæ–‡ â€œETEâ€ ä¸ºç¬”è¯¯ï¼Œåº”ä¸º â€œETFâ€ï¼‰
ã€åˆçº¦ã€‘ã€Transferã€‘JitoSOL 20 ä»½å’Œ mSOL 80 ä»½åˆ°ã€ç”¨æˆ·ã€‘
ã€ç”¨æˆ·ã€‘é€šè¿‡ ray æˆ–è€… okx ç­‰å¹³å°ï¼Œå°† 80 mSOL å’Œ 20 JitoSOL å…‘æ¢ä¸º 129.2 SOL

âœ  anchor git:(main) âœ— spl-token accounts                        
Token                                         Balance
-----------------------------------------------------
6RQFEKBGuqJAasPDLZEK2Uk3pLMEEo3xfSgz5AvjU65H  200
76EV8QxLELcs63zrjwu9o1ifeX9LaYMixrzwmSHp7EHH  10 
HhGykz9QW6hTZ4kcfcfGPDVxmRQ2hGAFtAehBrwxdDNE  90 
æˆåŠŸèµå›

âœ  anchor git:(main) âœ— spl-token accounts           
Token                                         Balance
-----------------------------------------------------
6RQFEKBGuqJAasPDLZEK2Uk3pLMEEo3xfSgz5AvjU65H  100
76EV8QxLELcs63zrjwu9o1ifeX9LaYMixrzwmSHp7EHH  100
HhGykz9QW6hTZ4kcfcfGPDVxmRQ2hGAFtAehBrwxdDNE  100
æ‰©å±•ä¿¡æ¯
å‰ç½®å‡†å¤‡ï¼šå®‰è£…ä¸€äº›ä¾èµ–
âœ  anchor git:(main) âœ— pnpm install @metaplex-foundation/mpl-token-metadata
âœ  anchor git:(main) âœ— pnpm install @metaplex-foundation/umi
âœ  anchor git:(main) âœ— pnpm install @metaplex-foundation/umi-web3js-adapters


å¯¼å…¥
import &#123; createUmi &#125; from "@metaplex-foundation/umi-bundle-defaults"
import &#123; fetchDigitalAsset, mplTokenMetadata &#125; from "@metaplex-foundation/mpl-token-metadata";
import &#123; fromWeb3JsPublicKey &#125; from "@metaplex-foundation/umi-web3js-adapters"
è·å–ETFçš„ä¸€äº›ä¿¡æ¯
// è·å–etfè¯¦æƒ…
export async function etfDetail(
    wallet: anchor.Wallet,
    eftAddress: PublicKey,
) &#123;

    // const mintAccount = await getMint(provider.connection, eftAddress);
    // return mintAccount;

    const [etfTokenInfoAddress,] = deriveEtfInfoAccount(eftAddress);
    const etfInfo = await program.account.etfToken.fetch(etfTokenInfoAddress);

    // åˆ›å»ºUmiå®ä¾‹
    const umi = createUmi(provider.connection.rpcEndpoint)
    umi.use(mplTokenMetadata())
    // è·å–mintè´¦æˆ·ä¿¡æ¯
    const mintAccount = await fetchDigitalAsset(umi, fromWeb3JsPublicKey(eftAddress));
    let log = ""
    if (mintAccount.metadata.uri) &#123;
        const response = await fetch(mintAccount.metadata.uri);
        const rj = await response.json();
        log = rj.image;
    &#125;
    return &#123;
        public_key: eftAddress.toString(),
        supply: mintAccount.mint.supply,
        decimal: mintAccount.mint.decimals,
        name: mintAccount.metadata.name,
        symbol: mintAccount.metadata.symbol,
        description: etfInfo.descriptor,
        creator: etfInfo.creator.toString(),
        create_at: etfInfo.createAt.toNumber(),
        logo: log
    &#125;
&#125;

// è·å–etfçš„æ•°é‡
export async function etfAmount(
    wallet: anchor.Wallet,
    eftAddress: PublicKey,
) &#123;

    // ç”¨æˆ·é’±åŒ…ATA
    const ata = getAssociatedTokenAddressSync(
        eftAddress,
        wallet.publicKey
    );

    const mintAccount = await getAccount(provider.connection, ata);
    return mintAccount.amount;
&#125;
è¾“å‡º
âœ  anchor git:(main) âœ— anchor run example
&#123;
  address: PublicKey [PublicKey(2cKK6qLFkNGUxaBeLkPDyDkecroPVXYU1gAuadAD9KUx)] &#123;
    _bn: &lt;BN: 17e7b884e0e312137f273e5411cb4e238a7ad46b7efa97e71f6d19e86774a8fd>
  &#125;,
  mint: PublicKey [PublicKey(6RQFEKBGuqJAasPDLZEK2Uk3pLMEEo3xfSgz5AvjU65H)] &#123;
    _bn: &lt;BN: 508aa85ad2105c7f71d84700d877d7ae7910d5de69aa3742f381f1da8e3938e4>
  &#125;,
  owner: PublicKey [PublicKey(FcKkQZRxD5P6JwGv58vGRAcX3CkjbX8oqFiygz6ohceU)] &#123;
    _bn: &lt;BN: d91024e709f54d65b29c9328658d06a488414c4cabc36522130c330322428769>
  &#125;,
  amount: 100000000000n,
  delegate: null,
  delegatedAmount: 0n,
  isInitialized: true,
  isFrozen: false,
  isNative: false,
  rentExemptReserve: null,
  closeAuthority: null,
  tlvData: &lt;Buffer >
&#125;


]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part22]_DeFié¡¹ç›®æ‹†è§£</title>
    <url>/2025/08/26/Solana-part22-DeFi%E9%A1%B9%E7%9B%AE%E6%8B%86%E8%A7%A3/</url>
    <content><![CDATA[
DeFiç›¸å…³æ¦‚å¿µ
ä»€ä¹ˆæ˜¯ DeFi?

å®šä¹‰ï¼šå»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDecentralized Financeï¼Œç®€ç§° DeFiï¼‰æ˜¯åŸºäºåŒºå—é“¾æŠ€æœ¯ï¼Œæä¾›æ— éœ€ä¸­ä»‹çš„é‡‘èæœåŠ¡ï¼Œå¦‚å€Ÿè´·ã€äº¤æ˜“ã€ä¿é™©ç­‰ã€‚
ç‰¹ç‚¹ï¼š
â—‹ å»ä¸­å¿ƒåŒ–ï¼šæ— éœ€ä¼ ç»Ÿé‡‘èæœºæ„
â—‹ å¼€æ”¾æ€§ï¼šä»»ä½•äººéƒ½å¯ä»¥å‚ä¸
â—‹ é€æ˜æ€§ï¼šæ‰€æœ‰äº¤æ˜“è®°å½•å…¬å¼€å¯æŸ¥

ä»€ä¹ˆæ˜¯ Swap?

å®šä¹‰ï¼šSwap æ˜¯ä¸€ç§å»ä¸­å¿ƒåŒ–äº¤æ˜“åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·åœ¨æ— éœ€ä¸­ä»‹çš„æƒ…å†µä¸‹ç›´æ¥äº¤æ¢ä¸¤ç§åŠ å¯†èµ„äº§ã€‚
å¸¸è§åœºæ™¯ï¼š
â—‹ å…‘æ¢å°é¢ä»£å¸ï¼ˆå¦‚å°† USDC æ¢æˆ ETHï¼‰ã€‚
â—‹ è°ƒæ•´æŠ•èµ„ç»„åˆã€‚
â—‹ æä¾›äº¤æ˜“æµåŠ¨æ€§ã€‚

å…¶ä»–æ¦‚å¿µ
1. AMMï¼ˆAutomated Market Makerï¼Œè‡ªåŠ¨åšå¸‚å•†ï¼‰

æƒå¨å®šä¹‰ï¼š
ä¸€ç§åŸºäºç®—æ³•çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æœºåˆ¶ï¼Œé€šè¿‡æ•°å­¦å…¬å¼ï¼ˆå¦‚æ’å®šä¹˜ç§¯å…¬å¼ x*y=kï¼‰è‡ªåŠ¨åŒ¹é…ä¹°å–è®¢å•ã€å®šä»·èµ„äº§ï¼Œæ— éœ€ä¼ ç»Ÿè®¢å•ç°¿å’Œä¸­å¿ƒåŒ–æœºæ„ã€‚
é€šä¿—è§£é‡Šï¼š
æŠŠâ€œäº¤æ˜“â€å˜æˆâ€œä»èµ„é‡‘æ± é‡Œå–å¸â€ã€‚æ¯”å¦‚ä½ æƒ³æ‹¿ETHæ¢USDTï¼Œä¸ç”¨ç­‰æœ‰äººå–USDTç»™ä½ ï¼Œç›´æ¥ä»ä¸€ä¸ªå­˜ç€ETHå’ŒUSDTçš„æ± å­é‡Œå…‘æ¢ï¼Œä»·æ ¼ç”±å…¬å¼è‡ªåŠ¨ç®—ï¼ˆæ± é‡ŒETHå°‘äº†ï¼Œä»·æ ¼å°±æ¶¨ï¼›USDTå°‘äº†ï¼Œä»·æ ¼å°±è·Œï¼‰ã€‚

2. æµåŠ¨æ€§æ± ï¼ˆLiquidity Poolï¼‰

æƒå¨å®šä¹‰ï¼š
å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä¸­ï¼Œç”¨æˆ·å­˜å…¥çš„ä¸¤ç§ï¼ˆæˆ–å¤šç§ï¼‰ä»£å¸ç»„æˆçš„èµ„é‡‘æ± ï¼Œä¸ºäº¤æ˜“æä¾›æµåŠ¨æ€§ï¼ˆå³äº¤æ˜“çš„â€œè´§æºâ€ï¼‰ï¼Œæ”¯æ’‘AMMçš„è¿è¡Œã€‚
é€šä¿—è§£é‡Šï¼š
å¤§å®¶å‡‘é’±å»ºçš„â€œå…¬å…±é’±åŒ…â€ï¼Œé‡Œé¢å­˜ç€ä¸¤ç§å¸ï¼ˆæ¯”å¦‚ETHå’ŒUSDTï¼‰ã€‚æœ‰äººäº¤æ˜“æ—¶ï¼Œå°±ä»è¿™ä¸ªé’±åŒ…é‡Œæ‹¿å¸ã€æ”¾å¸ã€‚ä½ å¾€æ± å­é‡Œå­˜é’±ï¼Œå°±èƒ½åˆ†äº¤æ˜“æ‰‹ç»­è´¹ã€‚

3. LP Tokenï¼ˆLiquidity Provider Tokenï¼ŒæµåŠ¨æ€§æä¾›è€…ä»£å¸ï¼‰

æƒå¨å®šä¹‰ï¼š
ç”¨æˆ·å‘æµåŠ¨æ€§æ± æä¾›èµ„é‡‘åï¼Œè·å¾—çš„â€œä»½é¢å‡­è¯â€ï¼Œä»£è¡¨å…¶åœ¨æ± ä¸­çš„èµ„äº§å æ¯”ï¼Œå¯ç”¨äºèµå›æœ¬é‡‘ã€åˆ†é…äº¤æ˜“è´¹æ”¶ç›Šï¼Œæˆ–å‚ä¸å…¶ä»–DeFiåè®®ã€‚
é€šä¿—è§£é‡Šï¼š
ä½ å¾€èµ„é‡‘æ± é‡Œå­˜äº†1ä¸ªETHå’Œ1000 USDTï¼Œç³»ç»Ÿç»™ä½ å‘ä¸ªâ€œå­˜å•â€ï¼ˆæ¯”å¦‚LP Tokenï¼‰ã€‚æ‹¿ç€è¿™ä¸ªå­˜å•ï¼Œä½ å¯ä»¥éšæ—¶æŠŠè‡ªå·±çš„ETHå’ŒUSDTæ‹¿å›æ¥ï¼Œè¿˜èƒ½åˆ†åˆ°æ± å­äº§ç”Ÿçš„æ‰‹ç»­è´¹ã€‚å°±åƒé“¶è¡Œå­˜å®šæœŸç»™çš„å­˜å•ï¼Œåªæ˜¯æ›´çµæ´»ã€‚

4. æ»‘ç‚¹ï¼ˆSlippageï¼‰

æƒå¨å®šä¹‰ï¼š
äº¤æ˜“ä¸­å®é™…æˆäº¤ä»·æ ¼ä¸é¢„æœŸä»·æ ¼çš„åå·®ï¼Œæºäºäº¤æ˜“å¯¹æµåŠ¨æ€§æ± çš„å†²å‡»ï¼ˆäº¤æ˜“è§„æ¨¡è¶Šå¤§ï¼Œæ»‘ç‚¹é€šå¸¸è¶Šé«˜ï¼‰ã€‚
é€šä¿—è§£é‡Šï¼š
ä½ ä»¥ä¸º1 ETHèƒ½æ¢1800 USDTï¼Œç»“æœå®é™…åªæ¢åˆ°1790 USDTâ€”â€”å·®çš„10 USDTå°±æ˜¯æ»‘ç‚¹ã€‚å› ä¸ºä½ ä¹°çš„æ—¶å€™ï¼ŒæŠŠæ± å­é‡Œçš„USDTä¹°èµ°äº†ä¸€éƒ¨åˆ†ï¼Œå¯¼è‡´USDTå˜è´µï¼ŒETHç›¸å¯¹è´¬å€¼ï¼Œä»·æ ¼å°±â€œæ»‘â€äº†ã€‚

5. äº¤æ˜“è´¹ï¼ˆTrading Feeï¼‰

æƒå¨å®šä¹‰ï¼š
ç”¨æˆ·åœ¨å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€äº¤æ˜“æ—¶æ”¯ä»˜çš„è´¹ç”¨ï¼Œé€šå¸¸æŒ‰äº¤æ˜“é‡‘é¢çš„æ¯”ä¾‹æ”¶å–ï¼ˆå¦‚0.3%ï¼‰ï¼Œå¤§éƒ¨åˆ†åˆ†é…ç»™æµåŠ¨æ€§æä¾›è€…ï¼ˆLPï¼‰ä½œä¸ºæ”¶ç›Šã€‚
é€šä¿—è§£é‡Šï¼š
æ¯æ¬¡äº¤æ˜“æ‰£çš„â€œæ‰‹ç»­è´¹â€ã€‚æ¯”å¦‚ä½ ç”¨1ä¸‡USDTä¹°ETHï¼Œæ‰£0.3%å°±æ˜¯30 USDTï¼Œè¿™30 USDTä¼šåˆ†ç»™æ‰€æœ‰å¾€æ± å­é‡Œå­˜é’±çš„äººï¼ˆç›¸å½“äºç»™ä»–ä»¬çš„â€œæ‰“å·¥è´¹â€ï¼‰ã€‚

6. ä»·æ ¼å½±å“ï¼ˆPrice Impactï¼‰

æƒå¨å®šä¹‰ï¼š
å•ç¬”äº¤æ˜“å¯¹æµåŠ¨æ€§æ± å†…èµ„äº§ä»·æ ¼çš„å½±å“ç¨‹åº¦ï¼Œäº¤æ˜“è§„æ¨¡å æ± å†…èµ„äº§æ¯”ä¾‹è¶Šé«˜ï¼Œä»·æ ¼å½±å“è¶Šå¤§ã€‚
é€šä¿—è§£é‡Šï¼š
ä½ ä¹°çš„é‡è¶Šå¤§ï¼ŒæŠŠæ± å­é‡Œçš„å¸ä¹°å¾—è¶Šâ€œç©ºâ€ï¼Œä»·æ ¼å°±æ¶¨å¾—è¶Šå‡¶ã€‚æ¯”å¦‚æ± é‡Œåªæœ‰10ä¸ªETHï¼Œä½ ä¸€ä¸‹ä¹°5ä¸ªï¼Œå‰©ä¸‹çš„5ä¸ªETHä»·æ ¼ä¼šçªç„¶é£™å‡â€”â€”è¿™å°±æ˜¯ä½ çš„äº¤æ˜“å¯¹ä»·æ ¼çš„â€œå†²å‡»â€ã€‚

7. æ— å¸¸æŸå¤±ï¼ˆImpermanent Lossï¼ŒILï¼‰

æƒå¨å®šä¹‰ï¼š
æµåŠ¨æ€§æä¾›è€…å› æ± å†…ä»£å¸ä»·æ ¼æ³¢åŠ¨ï¼Œå¯¼è‡´æŒæœ‰çš„LP Tokenä»·å€¼ ä½äºæŒæœ‰åŸå§‹ä»£å¸çš„ä»·å€¼ çš„æŸå¤±ï¼ˆè‹¥ä»·æ ¼å›å½’ï¼ŒæŸå¤±å¯èƒ½æ¶ˆå¤±ï¼Œæ•…ç§°ä¸ºâ€œæ— å¸¸â€ï¼‰ã€‚
é€šä¿—è§£é‡Šï¼š
ä¸¾ä¸ªä¾‹å­ï¼š

ä½ å­˜äº†1 ETHï¼ˆ2000 USDTï¼‰å’Œ2000 USDTè¿›æ± å­ï¼Œæ­¤æ—¶ETHä»·æ ¼2000 USDTã€‚
åæ¥ETHæ¶¨åˆ°4000 USDTï¼Œæ± å­é‡Œçš„ETHå˜å°‘ã€USDTå˜å¤šï¼ˆå› ä¸ºå…¬å¼ x*y=k ä¼šè®©ä»·æ ¼è‡ªåŠ¨è°ƒæ•´ï¼‰ã€‚
å¦‚æœä½ å½“åˆä¸å­˜æ± å­ï¼Œç›´æ¥æ‹¿ç€1 ETHï¼Œç°åœ¨èƒ½å€¼4000 USDTï¼›ä½†å­˜æ± å­åï¼Œèµå›çš„ETH+USDTæ€»ä»·å€¼å¯èƒ½åªæœ‰3500 USDTâ€”â€”å·®çš„500 USDTå°±æ˜¯æ— å¸¸æŸå¤±ã€‚
ä½†å¦‚æœETHåˆè·Œå›2000 USDTï¼Œè¿™ä¸ªæŸå¤±ä¼šæ¶ˆå¤±ï¼ˆæ‰€ä»¥å«â€œæ— å¸¸â€ï¼‰ã€‚



æœ€å®¹æ˜“ç†è§£çš„é€šä¿—è§£é‡ŠğŸ¤”
é€šè¿‡ä¹‹å‰å­¦ä¹ çš„ETFè´¨æŠ¼æ¥è¿›è¡Œç†è§£
å¦‚æœç”¨ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼ŒäºŒè€…çš„åŒºåˆ«ï¼š

LP æä¾›æµåŠ¨æ€§ â‰ˆ å¼€ä¸€å®¶ â€œè´§å¸å…‘æ¢å°åº—â€ï¼š
ä½ è¦å¼€åº—ï¼Œå¿…é¡»åŒæ—¶å¤‡ç€ â€œäººæ°‘å¸â€ å’Œ â€œç¾å…ƒâ€ï¼ˆä¸¤ç§èµ„äº§ï¼‰ï¼Œä¸ç„¶å®¢äººæƒ³æ¢ç¾å…ƒä½ æ²¡è´§ï¼Œæƒ³æ¢äººæ°‘å¸ä½ ä¹Ÿæ²¡è´§ã€‚å®¢äººæ¥å…‘æ¢æ—¶ï¼Œä¼šç»™ä½ æ‰‹ç»­è´¹ï¼ˆä½ çš„æ”¶ç›Šï¼‰ï¼›ä½†å¦‚æœäººæ°‘å¸å’Œç¾å…ƒæ±‡ç‡æ³¢åŠ¨å¤ªå¤§ï¼ˆæ¯”å¦‚äººæ°‘å¸çªç„¶å‡å€¼ï¼‰ï¼Œä½ æ‰‹é‡Œçš„ç¾å…ƒå¯èƒ½è´¬å€¼ï¼Œå¯¼è‡´ä½  â€œæ‰‹é‡Œçš„é’±ä¸å¦‚å½“åˆç›´æ¥æ‹¿ç€ä¸å¼€åº—â€ï¼ˆè¿™å°±æ˜¯æ— å¸¸æŸå¤±ï¼‰ã€‚
ETF è´¨æŠ¼ â‰ˆ æŠŠé’±å­˜é“¶è¡Œå®šæœŸï¼š
ä½ æŠŠ â€œ1 ä¸‡å…ƒå®šæœŸå­˜æ¬¾å•â€ï¼ˆç±»æ¯” ETF ä»½é¢ï¼‰äº¤ç»™é“¶è¡Œï¼Œé“¶è¡Œç”¨ä½ çš„é’±å»æ”¾è´·ï¼Œç»™ä½ ä»˜åˆ©æ¯ï¼ˆä½ çš„æ”¶ç›Šï¼‰ã€‚æœŸé—´ä½ ä¸èƒ½éšä¾¿å–èµ°è¿™ç¬”é’±ï¼ˆæµåŠ¨æ€§é™åˆ¶ï¼‰ï¼Œä½†åˆ°æœŸåä½ èƒ½å®Œæ•´æ‹¿å› 1 ä¸‡å…ƒæœ¬é‡‘ + åˆ©æ¯ï¼Œä¸ä¼šå› ä¸ºé“¶è¡Œæ”¾è´·çš„æ“ä½œï¼ŒæŠŠä½ çš„ â€œäººæ°‘å¸â€ å˜æˆ â€œç¾å…ƒâ€ï¼ˆä¸ä¼šæ¢èµ„äº§ç±»å‹ï¼‰ï¼Œä¹Ÿä¸ä¼šæœ‰ â€œæ±‡ç‡æ³¢åŠ¨å¯¼è‡´æœ¬é‡‘å˜ç›¸ç¼©æ°´â€ çš„é—®é¢˜ï¼ˆé™¤éå­˜æ¬¾åˆ©ç‡è·‘ä¸èµ¢é€šèƒ€ï¼Œä½†è¿™å’Œæ— å¸¸æŸå¤±æ˜¯ä¸¤å›äº‹ï¼‰ã€‚

è¯´ç™½äº†ï¼ŒLP å°±åƒæ˜¯åœ¨ä¸€ä¸ªæ± å­é‡Œæ”¾ç€ä¸¤ç§é’±ï¼Œæ¯”å¦‚ç¾å…ƒå’Œäººæ°‘å¸ã€‚ä½ è¦æ˜¯å½“ LPï¼Œå°±é åˆ«äººåœ¨è¿™ä¸ªæ± å­é‡Œæ¢é’±ï¼ˆä¹Ÿå°±æ˜¯ swapï¼‰èµšç‚¹æ‰‹ç»­è´¹ã€‚ä½ çš„è¿™ä¸¤ç§é’±ç›¸å½“äºæŠ¼åœ¨æ± å­é‡Œäº†ï¼Œäººå®¶ä¼šç»™ä½ ç‚¹ LP tokenï¼Œåé¢æƒ³æŠŠé’±æ‹¿å‡ºæ¥ï¼Œå°±ç”¨è¿™ LP token æ¢å›å»å°±è¡Œã€‚
é‚£åˆšå¼€å§‹å’‹æŠ•å‘¢ï¼Ÿå¾—æŒ‰å½“æ—¶çš„ä»·æ ¼æ¯”ä¾‹æ¥ã€‚å°±åƒé‚£ä¸ªå…¬å¼ x*y=k è¯´çš„é‚£æ · â€”â€” å¦‚æœä½ æ˜¯åˆåˆ›æ± å­åˆå½“ LP çš„äººï¼Œæœ€å¼€å§‹æ”¾çš„é’±è‚¯å®šå¾—è·Ÿå¤–é¢å¸‚åœºä»·å¯¹å¾—ä¸Šï¼Œæ¯”å¦‚å¤–é¢ 1 ç¾å…ƒæ¢ 7 äººæ°‘å¸ï¼Œä½ åˆ›æ± å­æ—¶å°±å¾—æ”¾ 10 ç¾å…ƒé… 70 äººæ°‘å¸è¿™ç§æ¯”ä¾‹ï¼Œä¸ç„¶ä¸€ä¸‹å­å°±è¢«äººè–…ç¾Šæ¯›äº†ã€‚
è¦æ˜¯åé¢å†æœ‰äººæ¥å½“ LPï¼Œå°±ä¸èƒ½çœ‹å¤–é¢å¸‚åœºä»·äº†ï¼Œå¾—æŒ‰æ± å­é‡Œç°åœ¨çš„æ¯”ä¾‹æ¥ï¼Œè¿™ä¹Ÿæ˜¯é‚£ä¸ª x*y=k ç®—å‡ºæ¥çš„ã€‚
è‡³äºé‚£ä¸ªæ— å¸¸æŸå¤±ï¼Œè¿™ä¹ˆæƒ³å°±å¯¹äº†ï¼šæ¯”å¦‚å¤–é¢ç¾å…ƒæ¶¨ä»·äº†ï¼Œ1 ç¾å…ƒèƒ½æ¢ 14 äººæ°‘å¸äº†ï¼Œä½†æ± å­é‡Œçš„ä»·æ ¼è¿˜æ²¡è·Ÿä¸Šï¼Œè¿˜æ˜¯ 1:7ã€‚è¿™æ—¶å€™è‚¯å®šæœ‰äººæ¥å¥—åˆ©å•Š â€”â€” ç”¨è‡ªå·±çš„äººæ°‘å¸ï¼ŒæŒ‰æ± å­é‡Œ 1:7 çš„è€æ¯”ä¾‹æ¢ç¾å…ƒï¼Œæ¢å®Œå»å¤–é¢æŒ‰ 1:14 å–æ‰ï¼Œè¿™ä¸å°±èµšäº†å—ï¼Ÿ
è¿™ä¹ˆä¸€æ¥ï¼Œæ± å­é‡Œçš„ç¾å…ƒå°±å˜å°‘äº†ï¼Œäººæ°‘å¸å˜å¤šäº†ã€‚å°±åƒåŸæ¥æ± å­é‡Œæ˜¯ 10 ç¾å…ƒ Ã—70 äººæ°‘å¸ = 700ï¼ˆè¿™ä¸ª k å€¼ä¸å˜ï¼‰ï¼Œæœ‰äººæ‹¿ 28.98 äººæ°‘å¸æ¥æ¢ç¾å…ƒï¼Œåˆçº¦å°±æŒ‰ (10 - æ¢èµ°çš„ç¾å…ƒ)Ã—(70+28.98)=700 æ¥ç®—ï¼Œæœ€åä»–èƒ½æ¢èµ°å¤§æ¦‚ 2.93 ç¾å…ƒã€‚
äº¤æ˜“å®Œä¹‹åï¼Œæ± å­é‡Œå°±å‰© 7.07 ç¾å…ƒå’Œ 98.98 äººæ°‘å¸äº†ï¼Œk è¿˜æ˜¯ 700ï¼Œä½†æ¯”ä¾‹å˜æˆ 1:14 äº†ï¼ˆè·Ÿå¤–é¢å¸‚åœºä»·å¯¹ä¸Šäº†ï¼‰ã€‚è¿™æ—¶å€™ä½ è¦æ˜¯æŠŠæ± å­é‡Œçš„é’±æ¢æˆå¤–é¢çš„ä»·ï¼Œå°±ä¼šæ¯”æœ€å¼€å§‹ç›´æ¥æ‹¿ç€è¿™ä¸¤ç§é’±ä¸åŠ¨å°‘ç‚¹ï¼Œè¿™å°±æ˜¯æ— å¸¸æŸå¤±ã€‚ä¸è¿‡è¿˜å¥½æœ‰æ‰‹ç»­è´¹ï¼Œè¦æ˜¯æ‰‹ç»­è´¹èµšå¾—å¤šï¼Œè¯´ä¸å®šè¿˜èƒ½è¡¥å›æ¥
æ‹†è§£DeFié¡¹ç›®â€”â€”raydium-cp-swap æ ¸å¿ƒæŒ‡ä»¤è¯¦è§£

ä»£ç åœ°å€ï¼šhttps://github.com/SoniaChan33/raydium-cp-swap

é¦–å…ˆæœ‰å››ä¸ªè§’è‰²éœ€è¦æ˜ç¡®ï¼š
ç»“åˆé¡¹ç›®ä»£ç å’ŒåŠŸèƒ½è®¾è®¡ï¼Œè¯¥é¡¹ç›®ä¸»è¦æ¶‰åŠ 4 ä¸ªæ ¸å¿ƒè§’è‰²ï¼Œå„è‡ªæ‰¿æ‹…ä¸åŒèŒè´£å¹¶å‚ä¸è´¹ç”¨åˆ†é…ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
1. æµåŠ¨æ€§æä¾›è€…ï¼ˆLP æŒæœ‰è€…ï¼‰

è§’è‰²ï¼šä¸ºäº¤æ˜“æ± æä¾›ä»£å¸æµåŠ¨æ€§çš„ç”¨æˆ·/åœ°å€ã€‚
æ ¸å¿ƒè¡Œä¸ºï¼šé€šè¿‡ deposit æŒ‡ä»¤å‘æ± å­é‡Œæ³¨å…¥ä¸¤ç§ä»£å¸ï¼ˆå¦‚ token0 å’Œ token1ï¼‰ï¼Œè·å¾—å¯¹åº”çš„ LP ä»£å¸ä½œä¸ºå‡­è¯ï¼›åç»­å¯é€šè¿‡ withdraw æŒ‡ä»¤é”€æ¯ LP ä»£å¸ï¼Œå–å›å¯¹åº”çš„ä»£å¸å’Œäº¤æ˜“è´¹åˆ†æˆã€‚
æ”¶ç›Šæ¥æºï¼šäº¤æ˜“äº§ç”Ÿçš„æ‰‹ç»­è´¹ä¸­ï¼Œæ‰£é™¤åè®®è´¹ï¼ˆprotocol_feeï¼‰å’Œèµ„é‡‘è´¹ï¼ˆfund_feeï¼‰åçš„å‰©ä½™éƒ¨åˆ†ï¼ŒæŒ‰ LP æŒæœ‰æ¯”ä¾‹åˆ†é…ã€‚

2. åè®®æ‰€æœ‰è€…ï¼ˆProtocol Ownerï¼‰

è§’è‰²ï¼šæ•´ä¸ª AMM åè®®çš„ç®¡ç†è€…ï¼ˆå¦‚é¡¹ç›®å›¢é˜Ÿã€å¤šç­¾åœ°å€æˆ– DAOï¼‰ã€‚
æ ¸å¿ƒè¡Œä¸ºï¼šé€šè¿‡ create_amm_config åˆå§‹åŒ–åè®®é…ç½®ï¼Œè®¾å®š protocol_fee_rateï¼›é€šè¿‡ collect_protocol_fee æŒ‡ä»¤æå–ç´¯ç§¯çš„åè®®è´¹ã€‚
æ”¶ç›Šæ¥æºï¼šæ¯ç¬”äº¤æ˜“è´¹æŒ‰ protocol_fee_rate æ¯”ä¾‹æŠ½å–çš„è´¹ç”¨ï¼Œç”¨äºåè®®å¼€å‘ã€ç»´æŠ¤ç­‰è¿è¥æˆæœ¬ã€‚
æƒé™ï¼šå¯é€šè¿‡ update_amm_config æ›´æ¢è‡ªèº«åœ°å€æˆ–è°ƒæ•´è´¹ç‡ï¼ˆéœ€ç¬¦åˆæƒé™æ ¡éªŒï¼‰ã€‚

3. èµ„é‡‘æ‰€æœ‰è€…ï¼ˆFund Ownerï¼‰

è§’è‰²ï¼šç®¡ç†ä¸“é¡¹åŸºé‡‘çš„è´¦æˆ·ï¼ˆå¦‚ç”Ÿæ€åŸºé‡‘ã€ç¤¾åŒºå›½åº“ï¼‰ã€‚
æ ¸å¿ƒè¡Œä¸ºï¼šé€šè¿‡ collect_fund_fee æŒ‡ä»¤æå–ç´¯ç§¯çš„èµ„é‡‘è´¹ï¼Œç”¨äºç”Ÿæ€å»ºè®¾ï¼ˆå¦‚è¡¥è´´ã€æ¿€åŠ±ç­‰ï¼‰ã€‚
æ”¶ç›Šæ¥æºï¼šæ¯ç¬”äº¤æ˜“è´¹æŒ‰ fund_fee_rate æ¯”ä¾‹æŠ½å–çš„è´¹ç”¨ï¼Œç”¨é€”å—é™äºç”Ÿæ€ç‰¹å®šéœ€æ±‚ã€‚
æƒé™ï¼šç”± amm_config é…ç½®æŒ‡å®šï¼Œå¯ç‹¬ç«‹äºåè®®æ‰€æœ‰è€…æ›´æ¢ï¼ˆé€šè¿‡ update_amm_configï¼‰ã€‚

4. æ± å­åˆ›å»ºè€…ï¼ˆPool Creatorï¼‰

è§’è‰²ï¼šå‘èµ·åˆ›å»ºäº¤æ˜“æ± çš„ç”¨æˆ·/åœ°å€ï¼ˆé€šè¿‡ initialize æˆ– initialize_with_permission æŒ‡ä»¤ï¼‰ã€‚
æ ¸å¿ƒè¡Œä¸ºï¼šè®¾å®šåˆå§‹æµåŠ¨æ€§ã€é€‰æ‹©äº¤æ˜“å¯¹ï¼Œæ”¯ä»˜åˆ›å»ºè´¹ç”¨ï¼ˆcreate_pool_feeï¼‰ã€‚
ç‰¹æ®Šæƒé™ï¼šéƒ¨åˆ†åœºæ™¯ä¸‹å¯é€šè¿‡ collect_creator_fee æŒ‡ä»¤æå–ç‰¹å®šè´¹ç”¨ï¼ˆä»£ç ä¸­æ˜ç¡®çº¦æŸâ€œä»…åˆ›å»ºè€…å¯è°ƒç”¨â€ï¼‰ï¼Œå…·ä½“é€»è¾‘éœ€ç»“åˆä¸šåŠ¡åœºæ™¯åˆ¤æ–­ï¼ˆå¯èƒ½æ˜¯å¯¹åˆ›å»ºè€…çš„é¢å¤–æ¿€åŠ±ï¼‰ã€‚

æ€»ç»“
å››ä¸ªè§’è‰²çš„æ ¸å¿ƒåŒºåˆ«åœ¨äº èŒè´£å’Œæ”¶ç›Šæ¥æºï¼š

LP æŒæœ‰è€…ï¼šæä¾›æµåŠ¨æ€§ï¼Œèµšå‰©ä½™äº¤æ˜“è´¹ï¼›
åè®®æ‰€æœ‰è€…ï¼šç®¡ç†åè®®ï¼Œèµšåè®®è¿è¥è´¹ï¼›
èµ„é‡‘æ‰€æœ‰è€…ï¼šç®¡ç†ç”Ÿæ€åŸºé‡‘ï¼Œèµšä¸“é¡¹ç”¨é€”è´¹ï¼›
æ± å­åˆ›å»ºè€…ï¼šå‘èµ·å»ºæ± ï¼Œå¯èƒ½è·å¾—åˆ›å»ºè€…ä¸“å±è´¹ç”¨ã€‚

è¿™ç§è§’è‰²æ‹†åˆ†æ˜¯ä¸ºäº†ç²¾ç»†åŒ–ç®¡ç†æ”¶ç›Šåˆ†é…ï¼Œé€‚é…åè®®è¿è¥ã€ç”Ÿæ€å»ºè®¾ã€ç”¨æˆ·æ¿€åŠ±ç­‰ä¸åŒéœ€æ±‚ã€‚
admin
create_amm_config
update_amm_config
update_pool_status
collect_protocol_fee
collect_fund_fee
User
initialize(åˆ›å»ºæµåŠ¨æ± )
depositï¼ˆæ·»åŠ æµåŠ¨æ€§ï¼‰
withdrawï¼ˆæç°-å‡å°‘æµåŠ¨æ€§ï¼‰
swap_base_inputï¼ˆåŸºäºè¾“å…¥æ•°é‡çš„ä»£å¸äº¤æ¢ï¼‰
swap_base_outputï¼ˆåŸºäºè¾“å‡ºæ•°é‡çš„ä»£å¸äº¤æ¢ï¼‰
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part3]_solanaè´¦æˆ·&amp;ç®€å•çš„äº¤äº’</title>
    <url>/2025/08/06/Solana-part3-solana%E8%B4%A6%E6%88%B7-%E7%AE%80%E5%8D%95%E7%9A%84%E4%BA%A4%E4%BA%92/</url>
    <content><![CDATA[Solana[part3]_solanaè´¦æˆ·&amp;ç®€å•çš„äº¤äº’
solana è´¦æˆ·

æ•°æ®è´¦æˆ·ï¼Œç”¨æ¥å­˜å‚¨æ•°æ®

ç³»ç»Ÿæ‰€æœ‰è´¦æˆ·
ç¨‹åºæ´¾ç”Ÿè´¦æˆ·ï¼ˆPDAï¼‰


ç¨‹åºè´¦æˆ·ï¼Œç”¨æ¥å­˜å‚¨å¯æ‰§è¡Œç¨‹åºï¼ˆæ™ºèƒ½åˆçº¦ï¼‰ï¼Œå…¶æ•°æ®å­—æ®µä¸ºç¨‹åºçš„å­—èŠ‚ç ï¼Œexecutable æ ‡å¿—ä¸º true
åŸç”Ÿè´¦æˆ·ï¼ŒæŒ‡ Solana ä¸Šçš„åŸç”Ÿç¨‹åºï¼Œä¾‹å¦‚ï¼šsystemï¼ˆç³»ç»Ÿç¨‹åºï¼Œå¤„ç†è´¦æˆ·åˆ›å»ºã€è½¬è´¦ç­‰åŸºç¡€æ“ä½œï¼‰ï¼Œstakeï¼ˆè´¨æŠ¼ç¨‹åºï¼‰ï¼Œä»¥åŠ voteï¼ˆæŠ•ç¥¨ç¨‹åºï¼‰

è´¦æˆ·ç»“æ„ä½“
Account
Account ç»“æ„ä½“ä¸»è¦ç”¨äºå®¢æˆ·ç«¯ï¼ˆå¦‚ RPC è°ƒç”¨ï¼‰è·å–è´¦æˆ·çš„å®Œæ•´æ•°æ®ï¼ŒåŒ…å«è´¦æˆ·çš„æ‰€æœ‰æ ¸å¿ƒå±æ€§ã€‚
ä»£ç ç¤ºä¾‹ï¼š
use solana_sdk::account::Account;

// è´¦æˆ·ç»“æ„ä½“å®šä¹‰ï¼ˆç®€åŒ–ç‰ˆï¼‰
pub struct Account &#123;
    // è´¦æˆ·ä¸­çš„lamportsæ•°é‡ï¼ˆSolçš„æœ€å°å•ä½ï¼‰
    pub lamports: u64,
    // è´¦æˆ·å­˜å‚¨çš„äºŒè¿›åˆ¶æ•°æ®
    pub data: Vec&lt;u8>,
    // è´¦æˆ·æ‰€æœ‰è€…çš„å…¬é’¥ï¼ˆé€šå¸¸æ˜¯ç¨‹åºçš„å…¬é’¥ï¼‰
    pub owner: Pubkey,
    // æ ‡è¯†è¯¥è´¦æˆ·æ˜¯å¦ä¸ºå¯æ‰§è¡Œç¨‹åºï¼ˆç¨‹åºè´¦æˆ·ä¸ºtrueï¼Œæ•°æ®è´¦æˆ·ä¸ºfalseï¼‰
    pub executable: bool,
    // ä¸‹ä¸€æ¬¡éœ€è¦æ”¯ä»˜ç§Ÿé‡‘çš„ epoch
    pub rent_epoch: Epoch,
&#125;
Account Info
AccountInfo æ˜¯æ™ºèƒ½åˆçº¦ç¨‹åºä¸­ç”¨äºè®¿é—®è´¦æˆ·çš„ç»“æ„ä½“ï¼ŒåŒ…å«æ›´å¤šä¸ç¨‹åºæ‰§è¡Œç›¸å…³çš„å…ƒæ•°æ®ï¼ˆå¦‚ç­¾åçŠ¶æ€ã€å¯å†™æ€§ï¼‰ï¼Œé€šå¸¸é€šè¿‡å‚æ•°ä¼ é€’ç»™ç¨‹åºå…¥å£å‡½æ•°ã€‚
ä»£ç ç¤ºä¾‹ï¼š
use solana_program::account_info::AccountInfo;

// è´¦æˆ·ä¿¡æ¯ç»“æ„ä½“ï¼ˆç®€åŒ–ç‰ˆï¼‰
pub struct AccountInfo&lt;'a> &#123;
    // è´¦æˆ·çš„å…¬é’¥
    pub key: &amp;'a Pubkey,
    // æ ‡è¯†è¯¥è´¦æˆ·æ˜¯å¦ä¸ºäº¤æ˜“ç­¾åè€…
    pub is_signer: bool,
    // æ ‡è¯†è¯¥è´¦æˆ·åœ¨æœ¬æ¬¡äº¤æ˜“ä¸­æ˜¯å¦å¯å†™
    pub is_writable: bool,
    // è´¦æˆ·ä¸­lamportsçš„å¯å˜å¼•ç”¨
    pub lamports: Rc&lt;RefCell&lt;&amp;'a mut u64>>,
    // è´¦æˆ·æ•°æ®çš„å¯å˜å¼•ç”¨
    pub data: Rc&lt;RefCell&lt;&amp;'a mut [u8]>>,
    // è´¦æˆ·æ‰€æœ‰è€…çš„å…¬é’¥
    pub owner: &amp;'a Pubkey,
    // æ ‡è¯†è¯¥è´¦æˆ·æ˜¯å¦ä¸ºå¯æ‰§è¡Œç¨‹åº
    pub executable: bool,
    // ç§Ÿé‡‘ç›¸å…³çš„epochä¿¡æ¯
    pub rent_epoch: Epoch,
&#125;
å¯¹æ¯”



ç‰¹æ€§
Accountï¼ˆå®¢æˆ·ç«¯ï¼‰
AccountInfoï¼ˆç¨‹åºå†…ï¼‰




ä½¿ç”¨åœºæ™¯
å®¢æˆ·ç«¯æŸ¥è¯¢è´¦æˆ·æ•°æ®ï¼ˆå¦‚ RPC è¿”å›ï¼‰
æ™ºèƒ½åˆçº¦ä¸­æ“ä½œè´¦æˆ·ï¼ˆå‡½æ•°å‚æ•°ï¼‰


æ ¸å¿ƒæ•°æ®
åŒ…å«è´¦æˆ·å®Œæ•´é™æ€æ•°æ®
åŒ…å«æ•°æ®çš„å¯å˜å¼•ç”¨åŠæ“ä½œæƒé™æ ‡è®°


ç­¾å / å¯å†™æ ‡è®°
æ— ï¼ˆå®¢æˆ·ç«¯æ— éœ€å…³å¿ƒäº¤æ˜“æ‰§è¡Œæ—¶çš„æƒé™ï¼‰
æœ‰ï¼ˆis_signer/is_writableï¼Œç”¨äºç¨‹åºéªŒè¯ï¼‰


æ•°æ®è®¿é—®æ–¹å¼
ä¸å¯å˜ï¼ˆå®¢æˆ·ç«¯åªè¯»ï¼‰
å¯å˜å¼•ç”¨ï¼ˆç¨‹åºå¯ä¿®æ”¹æ•°æ®ï¼‰



è¦ç‚¹

è´¦æˆ·æ˜¯ç”¨æ¥å­˜æ”¾æ•°æ®çš„åŸºæœ¬å•å…ƒï¼Œæ‰€æœ‰é“¾ä¸Šæ•°æ®å‡å­˜å‚¨åœ¨è´¦æˆ·ä¸­
æ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„åœ°å€ï¼ˆå…¬é’¥ï¼‰ï¼Œç”± 32 å­—èŠ‚ç»„æˆ
æ¯ä¸ªè´¦æˆ·å¤§å°ä¸èƒ½è¶…è¿‡ 10MBï¼Œä¸”å¤§å°æ˜¯é™æ€çš„ï¼ˆåˆ›å»ºåæ— æ³•åŠ¨æ€æ‰©å®¹ï¼Œéœ€æå‰è§„åˆ’ï¼‰
è´¦æˆ·æ•°æ®å­˜å‚¨éœ€è¦ä»˜ç§Ÿé‡‘ï¼šå¦‚æœè´¦æˆ·ä½™é¢ä½äºç§Ÿé‡‘é˜ˆå€¼ï¼Œä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼›è‹¥å­˜å…¥è¶³å¤Ÿ lamportsï¼ˆçº¦ 2 å¹´ç§Ÿé‡‘ï¼‰ï¼Œå¯æˆä¸ºrent-exemptï¼ˆå…ç§Ÿé‡‘ï¼‰çŠ¶æ€
é»˜è®¤çš„è´¦æˆ·æ‰€æœ‰è€…æ˜¯ç³»ç»Ÿç¨‹åºï¼ˆ11111111111111111111111111111111ï¼‰ï¼Œåªæœ‰æ‰€æœ‰è€…ç¨‹åºæœ‰æƒä¿®æ”¹è´¦æˆ·æ•°æ®

ç¨‹åºæ´¾ç”Ÿè´¦æˆ·ï¼ˆPDAï¼‰
ç›¸å…³æ–‡æ¡£ï¼šhttps://solana.com/zh/docs/core/pda
ç¨‹åºæ´¾ç”Ÿè´¦æˆ·ï¼ˆPDAï¼‰æ˜¯ç”±æ™ºèƒ½åˆçº¦ç¨‹åºé€šè¿‡ç‰¹å®šç®—æ³•ç”Ÿæˆçš„ç‰¹æ®Šè´¦æˆ·ï¼Œæ— å¯¹åº”ç§é’¥ï¼Œä»…ç”±ç”Ÿæˆå®ƒçš„ç¨‹åºæ§åˆ¶ã€‚
æ³¨æ„äº‹é¡¹

ä¸èƒ½ç›´æ¥ç­¾åäº¤æ˜“
PDA æ²¡æœ‰ç§é’¥ï¼Œæ— æ³•åƒæ™®é€šè´¦æˆ·é‚£æ ·ç­¾åäº¤æ˜“ï¼Œåªèƒ½ç”±å…¶å…³è”çš„ç¨‹åºæ§åˆ¶æ“ä½œï¼ˆç¡®ä¿å®‰å…¨æ€§ï¼‰ã€‚
åœ°å€ç¢°æ’çš„å¯èƒ½æ€§
ç†è®ºä¸Šï¼Œç›¸åŒç¨‹åº ID å’Œç§å­å¯èƒ½ç”Ÿæˆç›¸åŒ PDA åœ°å€ï¼ˆæ¦‚ç‡æä½ï¼‰ã€‚éœ€é€šè¿‡å”¯ä¸€ç§å­ï¼ˆå¦‚ç”¨æˆ·å…¬é’¥ + æ—¶é—´æˆ³ï¼‰é¿å…ç¢°æ’ã€‚
ç§å­é•¿åº¦é™åˆ¶
ç§å­ç»„åˆçš„æ€»é•¿åº¦ä¸èƒ½è¶…è¿‡ 32 å­—èŠ‚ï¼Œè¶…è¿‡æ—¶éœ€å“ˆå¸Œå¤„ç†ï¼ˆå¦‚ç”¨sha256å‹ç¼©ï¼‰ã€‚
ç”Ÿæˆæˆæœ¬
PDA é€šè¿‡find_program_addresså‡½æ•°ç”Ÿæˆï¼ˆå†…éƒ¨è°ƒç”¨sha256å“ˆå¸Œï¼‰ï¼Œé¢‘ç¹ç”Ÿæˆä¼šå¢åŠ é“¾ä¸Šè®¡ç®—æˆæœ¬ã€‚
å•ä¸€ç¨‹åºè®¿é—®
ä»…ç”Ÿæˆ PDA çš„ç¨‹åºå¯ä¿®æ”¹å…¶æ•°æ®ï¼Œè·¨ç¨‹åºå…±äº«éœ€ç‰¹æ®Šè®¾è®¡ï¼ˆå¦‚æƒé™å§”æ‰˜ï¼‰ã€‚
å­˜å‚¨é™åˆ¶
ä½œä¸ºæ•°æ®è´¦æˆ·æ—¶ï¼Œå¤§å°å— 10MB é™åˆ¶ï¼Œè¶…å¤§æ•°æ®éœ€æ‹†åˆ†åˆ°å¤šä¸ª PDAã€‚

åº”ç”¨åœºæ™¯

ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼šå­˜å‚¨ç”¨æˆ·åœ¨ DApp ä¸­çš„èµ„äº§ã€ç­‰çº§ç­‰æ•°æ®
å»ä¸­å¿ƒåŒ–é‡‘è (DeFi) åè®®ï¼šå­˜å‚¨æµåŠ¨æ€§æ± ã€å€Ÿè´·è®°å½•ç­‰
NFT å…ƒæ•°æ®å­˜å‚¨ï¼šå…³è” NFT çš„å±æ€§ã€åˆ›ä½œè€…ä¿¡æ¯ç­‰
DAO æŠ•ç¥¨ç³»ç»Ÿï¼šè®°å½•ææ¡ˆã€æŠ•ç¥¨ç»“æœç­‰
æ—¶é—´é”åˆçº¦ï¼šå­˜å‚¨å¾…æ‰§è¡Œçš„å®šæ—¶äº¤æ˜“
å¤šç­¾é’±åŒ…ï¼šå­˜å‚¨ç­¾åé˜ˆå€¼ã€æˆæƒåˆ—è¡¨ç­‰
å»ä¸­å¿ƒåŒ–èº«ä»½éªŒè¯ï¼šå­˜å‚¨ç”¨æˆ·èº«ä»½å‡­è¯

ç”Ÿæˆ PDA çš„ä»£ç ç¤ºä¾‹
use solana_program::&#123;program_pack::Pack, pubkey::Pubkey&#125;;

// ç”ŸæˆPDA
fn create_pda(program_id: &amp;Pubkey, seeds: &amp;[&amp;[u8]]) -> (Pubkey, u8) &#123;
    // ç”ŸæˆPDAåœ°å€å’Œbumpï¼ˆç”¨äºç¡®ä¿åœ°å€ä¸åœ¨Ed25519æ›²çº¿å†…ï¼‰
    Pubkey::find_program_address(seeds, program_id)
&#125;

// ç¤ºä¾‹ï¼šç”¨ç”¨æˆ·å…¬é’¥å’Œ"profile"ä½œä¸ºç§å­ç”ŸæˆPDA
let user_pubkey = Pubkey::from_str("...").unwrap();
let seeds = &amp;[b"profile", user_pubkey.as_ref()];
let (pda_address, bump) = create_pda(&amp;program_id, seeds);
println!("PDAåœ°å€: &#123;&#125;", pda_address);
println!("Bumpå€¼: &#123;&#125;", bump);
Ruståº“

solana_clientï¼šå®¢æˆ·ç«¯åº“ï¼Œç”¨äºä¸ Solana RPC èŠ‚ç‚¹äº¤äº’ï¼ˆæŸ¥è¯¢ä½™é¢ã€å‘é€äº¤æ˜“ç­‰ï¼‰
solana_sdkï¼šæ ¸å¿ƒ SDKï¼Œå®šä¹‰è´¦æˆ·ã€äº¤æ˜“ã€ç­¾åç­‰åŸºç¡€ç»“æ„
solana_programï¼šæ™ºèƒ½åˆçº¦å¼€å‘åº“ï¼ŒåŒ…å«ç¨‹åºå¼€å‘æ‰€éœ€çš„è´¦æˆ·æ“ä½œã€æŒ‡ä»¤å¤„ç†ç­‰å·¥å…·

å®æˆ˜


å¯åŠ¨æœ¬åœ°ç¯å¢ƒ solana-test-validator
âœ  ~ solana-test-validator
Ledger location: test-ledger
Log: test-ledger/validator.log
â  Initializing...                                                               Waiting for fees to stabilize 1...
Identity: GmyJV396jL2hnhcooyMs9U8UeWrBSadDYGbLrd8PvAL6
Genesis Hash: ATymZxWB3G7W8Qyjp7AVBLVN2ZLk1ssiWsTNsehNFczA
Version: 2.2.21
Shred Version: 31032
Gossip Address: 127.0.0.1:1024
TPU Address: 127.0.0.1:1027
JSON RPC URL: http://127.0.0.1:8899
WebSocket PubSub URL: ws://127.0.0.1:8900
â ’ 03:14:40 | Processed Slot: 21992 | Confirmed Slot: 21992 | Finalized Slot: 219



é…ç½®æœ¬åœ°ç¯å¢ƒ
# æŸ¥çœ‹å½“å‰é…ç½®
solana config get

# åˆ‡æ¢åˆ°æœ¬åœ°æµ‹è¯•ç½‘
solana config set --url http://127.0.0.1:8899

# ç¡®è®¤é…ç½®ç”Ÿæ•ˆ
solana config get
# è¾“å‡ºåº”æ˜¾ç¤ºRPC URLä¸ºæœ¬åœ°åœ°å€


åˆ›å»ºæœ¬åœ°è´¦æˆ·
# ç”Ÿæˆæ–°è´¦æˆ·ï¼ˆä¿å­˜åˆ°æ–‡ä»¶ï¼‰
solana-keygen new --outfile my-wallet.json

# æŸ¥çœ‹è´¦æˆ·å…¬é’¥
solana address --keypair my-wallet.json


ç»™è´¦æˆ·ç©ºæŠ• SOL
# å‘è´¦æˆ·ç©ºæŠ•1 SOLï¼ˆ1 SOL = 1e9 lamportsï¼‰
solana airdrop 1 &lt;ä½ çš„è´¦æˆ·å…¬é’¥> --url http://127.0.0.1:8899

# æ£€æŸ¥ä½™é¢
solana balance &lt;ä½ çš„è´¦æˆ·å…¬é’¥>


ä½¿ç”¨sdk


è·å–è´¦æˆ·ä¿¡æ¯
 use solana_client::rpc_client::RpcClient;
use solana_sdk::&#123;pubkey::Pubkey, signature&#125;;
use std::str::FromStr;
fn main() &#123;
    // åˆ›å»ºsolanaè¿æ¥
    let rpc_url = "http://127.0.0.1:8899";
    let client = RpcClient::new(rpc_url);

    // æŒ‡å®šä½ è¦æŸ¥è¯¢çš„ä½™é¢è´¦æˆ·å…¬é’¥
    // æ¥æ”¶ç©ºæŠ•è´¦æˆ·
    let account_pubkey = Pubkey::from_str("FcKkQZRxD5P6JwGv58vGRAcX3CkjbX8oqFiygz6ohceU").unwrap();

    // è·å–è´¦æˆ·ä½™é¢
    match client.get_balance(&amp;account_pubkey) &#123;
        Ok(balance) => &#123;
            println!("è´¦æˆ·ä½™é¢ä¸º: &#123;&#125;", balance);
        &#125;
        Err(err) => &#123;
            eprintln!("è·å–è´¦æˆ·ä½™é¢æ—¶å‡ºé”™: &#123;&#125;", err);
        &#125;
    &#125;
&#125;


ç©ºæŠ•sol
   use solana_client::rpc_client::RpcClient;
   use solana_sdk::&#123;pubkey::Pubkey, signature&#125;;
   use std::str::FromStr;
   fn main() &#123;
       // åˆ›å»ºsolanaè¿æ¥
       let rpc_url = "http://127.0.0.1:8899";
       let client = RpcClient::new(rpc_url);
   
       // æŒ‡å®šä½ è¦æŸ¥è¯¢çš„ä½™é¢è´¦æˆ·å…¬é’¥
       // æ¥æ”¶ç©ºæŠ•è´¦æˆ·
       let account_pubkey = Pubkey::from_str("FcKkQZRxD5P6JwGv58vGRAcX3CkjbX8oqFiygz6ohceU").unwrap();
   
       // å®šä¹‰ç©ºæŠ•æ•°é‡
       let amount = 1 * 1_000_000_000;
   
       match client.request_airdrop(&amp;account_pubkey, amount) &#123;
           Ok(signature) => &#123;
               println!("ç©ºæŠ•æˆåŠŸï¼Œç­¾åä¸º: &#123;&#125;", signature);
           &#125;
           Err(err) => &#123;
               eprintln!("ç©ºæŠ•æ—¶å‡ºé”™: &#123;&#125;", err);
           &#125;
       &#125;
   
       // è·å–è´¦æˆ·ä½™é¢
       match client.get_balance(&amp;account_pubkey) &#123;
           Ok(balance) => &#123;
               println!("è´¦æˆ·ä½™é¢ä¸º: &#123;&#125;", balance);
           &#125;
           Err(err) => &#123;
               eprintln!("è·å–è´¦æˆ·ä½™é¢æ—¶å‡ºé”™: &#123;&#125;", err);
           &#125;
       &#125;
   &#125;
   ----------------
   ç©ºæŠ•æˆåŠŸï¼Œç­¾åä¸º: 36wYSruZNjLDiBvxG2XGNJDEDi2fmSZs9ViwYMAhEPJdpoTJMtdg5gvgRCC4VpXuDogC8YuDywCLE1ffcCDCVVnQ
   è´¦æˆ·ä½™é¢ä¸º: 500000000000000000


è½¬ç§»sol
   use solana_client::rpc_client::RpcClient;
   use solana_sdk::signature::Signer;
   use solana_sdk::signature::read_keypair_file;
   use solana_sdk::system_instruction::transfer;
   use solana_sdk::transaction;
   use solana_sdk::&#123;pubkey::Pubkey, signature&#125;;
   use std::str::FromStr;
   fn main() &#123;
       // åˆ›å»ºsolanaè¿æ¥s
       let rpc_url = "http://127.0.0.1:8899";
       let client = RpcClient::new(rpc_url);
   
   
       // è®¾ç½®æ¥æ”¶æ–¹
       let receive = Pubkey::from_str("6qkpaXM6Q9z9rsJQ4qpHV8soGmw2uVTFdJ8KvHR32GDe").unwrap();
   
       // è®¾ç½®å‘é€æ–¹ï¼Œéœ€è¦é€šè¿‡ç­¾åè·å–
       let sender = read_keypair_file("/Users/tinachan/.config/solana/id.json")
           .expect("failed to read keypair file");
   
       // å®šä¹‰ç©ºæŠ•æ•°é‡ æœ€å°å•ä½æ˜¯lamports
       let amount = 1 * 1_000_000_000;
   
       // åˆ›å»ºè½¬è´¦çš„æŒ‡ä»¤
       let transfer = transfer(&amp;sender.pubkey(), &amp;receive, amount);
   
       // åˆ›å»ºäº¤æ˜“
       let recent_blockhash = client.get_latest_blockhash().unwrap();
       let transaction = transaction::Transaction::new_signed_with_payer(
           &amp;[transfer],
           Some(&amp;sender.pubkey()),
           &amp;[&amp;sender],
           recent_blockhash,
       );
       let result = client.send_and_confirm_transaction(&amp;transaction);
       match result &#123;
           Ok(signature) => &#123;
               println!("äº¤æ˜“æˆåŠŸï¼Œç­¾åä¸º: &#123;&#125;", signature);
           &#125;
           Err(err) => &#123;
               eprintln!("äº¤æ˜“æ—¶å‡ºé”™: &#123;&#125;", err);
           &#125;
       &#125;
       
   &#125;
   ----------------
   äº¤æ˜“æˆåŠŸï¼Œç­¾åä¸º: 5yPGuuN7hbVqv1wTvsSryYG6rfaW6FNWTyih2PpwpSPxywjZ6LLMBGxdTjo59ZDdt8DfPShiq4KU4KXXvPBbevLc


æ€»ç»“ï¼šï¼ˆä»£è¡¥å……ï¼‰
â€‹


é€šè¿‡JsonRpcè·å–è´¦æˆ·ä¿¡æ¯ https://solana.com/zh/docs/rpc/http/getaccountinfo


æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£ï¼ŒæŒ‘é€‰getaccountinfoæ¥ç©ç©
curl https://api.devnet.solana.com -s -X \
  POST -H "Content-Type: application/json" -d ' 
  &#123;
    "jsonrpc": "2.0",
    "id": 1,
    "method": "getAccountInfo",
    "params": [
      "vines1vzrYbzLMRdu58ou5XTby4qAqVRLmqo36NKPTg",
      &#123;
        "commitment": "finalized",
        "encoding": "base58"
      &#125;
    ]
  &#125;
'


æ›¿æ¢è‡ªå·±çš„è´¦æˆ·pubkeyä»¥åŠæœ¬åœ°è¿è¡Œé“¾æ¥
âœ  sol git:(master) âœ— curl http://127.0.0.1:8899 -s -X \
  POST -H "Content-Type: application/json" -d '
  &#123;
    "jsonrpc": "2.0",
    "id": 1,
    "method": "getAccountInfo",
    "params": [
      "6qkpaXM6Q9z9rsJQ4qpHV8soGmw2uVTFdJ8KvHR32GDe",
      &#123;
        "commitment": "finalized",
        "encoding": "base58"
      &#125;
    ]
  &#125;
'
&#123;"jsonrpc":"2.0","result":&#123;"context":&#123;"apiVersion":"2.2.21","slot":33045&#125;,"value":&#123;"data":["","base58"],"executable":false,"lamports":1000000000,"owner":"11111111111111111111111111111111","rentEpoch":18446744073709551615,"space":0&#125;&#125;,"id":1&#125;




]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part4]_Tokenè§£æ&amp;åˆ›å»º</title>
    <url>/2025/08/06/Solana-part4-Token%E8%A7%A3%E6%9E%90-%E5%88%9B%E5%BB%BA/</url>
    <content><![CDATA[Solana[part4]_Tokenè§£æ&amp;åˆ›å»º
solanaä¸Šçš„ä»£å¸
ä»£å¸æ˜¯ä»£è¡¨å¯¹å„ç§èµ„äº§æ‰€æœ‰æƒçš„æ•°å­—èµ„äº§ã€‚ä»£å¸åŒ–ä½¿å¾—è´¢äº§æƒçš„æ•°å­—åŒ–æˆä¸ºå¯èƒ½ï¼Œæ˜¯ç®¡ç†å¯æ›¿ä»£å’Œä¸å¯æ›¿ä»£èµ„äº§çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†

å¯æ›¿ä»£ä»£å¸ä»£è¡¨åŒç±»å‹å’ŒåŒä»·å€¼çš„å¯äº’æ¢å’Œå¯åˆ†å‰²èµ„äº§ï¼ˆä¾‹å¦‚ USDCï¼‰
ä¸å¯æ›¿ä»£ä»£å¸ï¼ˆNFTï¼‰ä»£è¡¨ä¸å¯åˆ†éš”èµ„äº§çš„æ‰€æœ‰æƒï¼ˆä¾‹å¦‚è‰ºæœ¯å“ï¼‰

SPL(Solana Program Library)
SPL æ˜¯ Solana ç”Ÿæ€çš„æ ¸å¿ƒç¨‹åºåº“ï¼Œå…¶ä¸­ Token Program æ˜¯åˆ›å»ºå’Œç®¡ç†ä»£å¸çš„åŸºç¡€åè®®ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹æ ¸å¿ƒæ¦‚å¿µï¼š

Token Programï¼šSolana ä¸Šçš„æ ‡å‡†ä»£å¸åè®®ï¼Œå®šä¹‰äº†ä»£å¸çš„åˆ›å»ºã€è½¬è´¦ã€é“¸å¸ã€é”€æ¯ç­‰æ ¸å¿ƒé€»è¾‘
Mint Accountï¼šä»£å¸çš„&quot;é“¸é€ æº&quot;ï¼Œå­˜å‚¨ä»£å¸çš„å…ƒæ•°æ®ï¼ˆå¦‚æ€»ä¾›åº”é‡ã€å°æ•°ä½æ•°ã€æ˜¯å¦å¯é“¸å¸/å†»ç»“ç­‰ï¼‰ï¼Œæ¯ä¸ªä»£å¸ç±»å‹å¯¹åº”å”¯ä¸€çš„ Mint è´¦æˆ·
Token Accountï¼šç”¨æˆ·æŒæœ‰ç‰¹å®šä»£å¸çš„è´¦æˆ·ï¼Œå…³è”åˆ°ä¸€ä¸ª Mint è´¦æˆ·å’Œä¸€ä¸ªæ‰€æœ‰è€…é’±åŒ…ï¼Œç”¨äºå®é™…å­˜å‚¨ä»£å¸ä½™é¢
Associated Token Account (ATA)ï¼šä¸é’±åŒ…åœ°å€ç»‘å®šçš„æ ‡å‡†ä»£å¸è´¦æˆ·ï¼Œéµå¾ªå›ºå®šåœ°å€æ¨å¯¼è§„åˆ™ï¼ˆç”±é’±åŒ…åœ°å€å’Œ Mint åœ°å€è®¡ç®—å¾—å‡ºï¼‰ï¼Œæ–¹ä¾¿ç”¨æˆ·ç®¡ç†ä¸åŒä»£å¸

Tokenåˆ›å»ºå®Œæ•´æµç¨‹ï¼ˆåŸºäºspl-token-cliï¼‰
å‰ç½®å‡†å¤‡


å®‰è£…å·¥å…·
# å®‰è£…Solanaå‘½ä»¤è¡Œå·¥å…·
sh -c "$(curl -sSfL https://release.solana.com/v1.18.4/install)"
# å®‰è£…SPL Tokenå‘½ä»¤è¡Œå·¥å…·ï¼ˆé”å®šç‰ˆæœ¬ç¡®ä¿å…¼å®¹æ€§ï¼‰
cargo install spl-token-cli --version 2.0.0 --locked


åˆå§‹åŒ–æœ¬åœ°ç¯å¢ƒ
# å¯åŠ¨æœ¬åœ°Solanaæµ‹è¯•èŠ‚ç‚¹ï¼ˆé»˜è®¤ç«¯å£8899ï¼‰
solana-test-validator
# æ–°å»ºç»ˆç«¯ï¼Œé…ç½®é›†ç¾¤ä¸ºæœ¬åœ°èŠ‚ç‚¹
solana config set --url http://localhost:8899


åˆ›å»ºæµ‹è¯•é’±åŒ…å¹¶è·å–ç©ºæŠ•ï¼ˆç”¨äºæ”¯ä»˜Gasè´¹ï¼‰
# åˆ›å»ºæ–°é’±åŒ…ï¼ˆç”Ÿæˆå¯†é’¥å¯¹æ–‡ä»¶ï¼‰
solana-keygen new --outfile ~/my-wallet.json
# é…ç½®é»˜è®¤é’±åŒ…
solana config set --keypair ~/my-wallet.json
# è·å–æµ‹è¯•ç½‘ç©ºæŠ•ï¼ˆæœ¬åœ°èŠ‚ç‚¹æ— éœ€çœŸå®ä»£å¸ï¼‰
solana airdrop 10
# éªŒè¯ä½™é¢
solana balance


æ ¸å¿ƒæ­¥éª¤ï¼šåˆ›å»ºå¹¶ç®¡ç†ä»£å¸
1. åˆ›å»ºMintè´¦æˆ·ï¼ˆä»£å¸ç±»å‹ï¼‰
Mintè´¦æˆ·æ˜¯ä»£å¸çš„&quot;æ ¹&quot;ï¼Œå†³å®šä»£å¸çš„åŸºæœ¬å±æ€§ï¼š
  # åˆ›å»ºé»˜è®¤å¯æ›¿ä»£ä»£å¸ï¼ˆå¯é“¸å¸ã€å¯å†»ç»“ï¼Œå°æ•°ä½6ï¼‰
âœ  ~ spl-token create-token
Creating token 3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9 under program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA

Address:  3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9
Decimals:  9

Signature: 5RHsDWPbGkFs8Cuq5G8wRGwfKhgAYqAejLc5nGwLSoDSHxWNV3CmX6wpYy5yPjYWvPuZVqUwYXEMt9M3ByJTKzqM
---------------------------------------

 # è‡ªå®šä¹‰å‚æ•°ç¤ºä¾‹ï¼š
 # åˆ›å»ºNFTï¼ˆä¸å¯åˆ†å‰²ï¼Œå°æ•°ä½0ï¼Œä¸å¯å¢å‘ï¼‰
 spl-token create-token --decimals 0 --no-mint-authority --no-freeze-authority

 # å‘½ä»¤è¾“å‡ºè§£æï¼š
 # Creating token &lt;MINT_ADDRESS>
 # Signature: &lt;TRANSACTION_SIGNATURE>
 # å…¶ä¸­&lt;MINT_ADDRESS>æ˜¯æ–°ä»£å¸çš„å”¯ä¸€æ ‡è¯†ï¼Œéœ€è®°å½•
 
 ---------------------------------
 ## æŸ¥çœ‹mint account info
 âœ  ~ spl-token account-info --address 3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9

SPL Token Mint
  Address: 3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9
  Program: TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
  Supply: 0
  Decimals: 9
  Mint authority: FcKkQZRxD5P6JwGv58vGRAcX3CkjbX8oqFiygz6ohceU
  Freeze authority: (not set)
å‚æ•°è¯´æ˜ï¼š

--decimalsï¼šä»£å¸å°æ•°ä½æ•°ï¼ˆé»˜è®¤6ï¼Œå¦‚USDCï¼‰ï¼ŒNFTéœ€è®¾ä¸º0
--mint-authorityï¼šæŒ‡å®šé“¸å¸æƒé™è´¦æˆ·ï¼ˆé»˜è®¤å½“å‰é’±åŒ…ï¼‰ï¼Œ--no-mint-authorityè¡¨ç¤ºæ°¸ä¹…ä¸å¯é“¸å¸
--freeze-authorityï¼šæŒ‡å®šå†»ç»“æƒé™è´¦æˆ·ï¼ˆé»˜è®¤å½“å‰é’±åŒ…ï¼‰ï¼Œ--no-freeze-authorityè¡¨ç¤ºæ°¸ä¹…ä¸å¯å†»ç»“

2. åˆ›å»ºToken Accountï¼ˆä»£å¸æŒæœ‰è´¦æˆ·ï¼‰
ç”¨æˆ·éœ€è¦å…³è”Mintè´¦æˆ·çš„Token Accountæ‰èƒ½æ¥æ”¶ä»£å¸ï¼Œæ¨èä½¿ç”¨ATAï¼ˆè‡ªåŠ¨å…³è”é’±åŒ…ï¼‰ï¼š
  # åˆ›å»ºä¸å½“å‰é’±åŒ…å…³è”çš„ATAï¼ˆè‡ªåŠ¨æ¨å¯¼åœ°å€ï¼‰
 spl-token create-account &lt;MINT_ADDRESS>
 --------------------
 âœ  ~ spl-token create-account 3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9
Creating account 7i8smGYKco3hicJThL8WYrMaGKpceeKkZRekqR4aWKFJ

Signature: 5AiPVz8Kjc9RYEtMGQAgx8Mdgy8cNiAwnprAHK14JYyciNJr1ufmPu3AQAwXbr5w1hRV1tTbiDDfEQz66yKkvxVy
----------------------

 # æ‰‹åŠ¨æŒ‡å®šæ‰€æœ‰è€…åˆ›å»ºToken Accountï¼ˆéATAï¼‰
 spl-token create-account &lt;MINT_ADDRESS> &lt;OWNER_WALLET_ADDRESS>
 
 ---------------------
âœ  ~ spl-token create-account 3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9 /Users/tinachan/.config/solana/t2.json
Creating account 2tQibfGH1UX4PEA1dNWJ8zvnpSbKRBr5a5eVhaRxF6EX

Signature: 4dvu4YNxgfbEAyGiBxYxDqGHdsEgamZ8MMEE8uNBdoGJWZg3UM4eGk3v4BsEMQADut7VeYx32Ng7p4r4zWL6CMaK
 ---------------------

 # å‘½ä»¤è¾“å‡ºè§£æï¼š
 # Creating account &lt;TOKEN_ACCOUNT_ADDRESS>
 # Signature: &lt;TRANSACTION_SIGNATURE>
 # &lt;TOKEN_ACCOUNT_ADDRESS>ä¸ºæ–°åˆ›å»ºçš„ä»£å¸æŒæœ‰è´¦æˆ·åœ°å€
ä»£ç ä¸­ç¬¬ä¸€ä¸ªåˆ›å»ºçš„å°±æ˜¯ATAï¼Œé»˜è®¤å…³è”çš„token accountï¼› ç¬¬äºŒä¸ªç”¨ç§é’¥åˆ›å»ºçš„æ˜¯éATAçš„token account ï¼Œä¸¤è€…åŒºåˆ«ï¼š

åœ°å€ç”Ÿæˆæ–¹å¼ä¸åŒ


ATAï¼ˆè‡ªåŠ¨å…³è”ä»£å¸è´¦æˆ·ï¼‰ï¼š
åœ°å€æ˜¯é€šè¿‡å›ºå®šç®—æ³•æ¨å¯¼å‡ºæ¥çš„ï¼Œå…¬å¼ä¸ºï¼š
ATAåœ°å€ = åŸºäºé’±åŒ…åœ°å€ + Mintåœ°å€ + ä»£å¸ç¨‹åºID æ¨å¯¼çš„å”¯ä¸€åœ°å€
è¿™ç§æ¨å¯¼è§„åˆ™æ˜¯ Solana çš„å®˜æ–¹æ ‡å‡†ï¼Œç¡®ä¿ä¸€ä¸ªé’±åŒ…ï¼ˆæ‰€æœ‰è€…ï¼‰å¯¹ä¸€ä¸ª Mint åªèƒ½æœ‰å”¯ä¸€å¯¹åº”çš„ ATAã€‚
ä¾‹å¦‚ï¼šä½ çš„é’±åŒ…åœ°å€ä¸ºAï¼ŒMint åœ°å€ä¸ºMï¼Œé‚£ä¹ˆå¯¹åº”çš„ ATA åœ°å€æ˜¯å”¯ä¸€ç¡®å®šçš„ï¼Œä»»ä½•äººç”¨Aå’ŒMæ¨å¯¼éƒ½ä¼šå¾—åˆ°åŒä¸€ä¸ªåœ°å€ã€‚
é ATA Token Accountï¼ˆæ‰‹åŠ¨æŒ‡å®šæ‰€æœ‰è€…ï¼‰ï¼š
åœ°å€æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä¸éµå¾ªä¸Šè¿°æ¨å¯¼è§„åˆ™ã€‚æ¯æ¬¡æ‰§è¡Œcreate-account &lt;MINT&gt; &lt;OWNER&gt;å‘½ä»¤ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„éšæœºåœ°å€ï¼Œå³ä½¿æ‰€æœ‰è€…å’Œ Mint ç›¸åŒï¼Œä¹Ÿä¼šå¾—åˆ°ä¸åŒçš„åœ°å€ã€‚


ä¸æ‰€æœ‰è€…çš„å…³è”æ€§ä¸åŒ


ATAï¼š
å¼ºåˆ¶ä¸ã€Œåˆ›å»ºæ—¶çš„é’±åŒ…åœ°å€ã€ç»‘å®šï¼Œå³ ATA çš„æ‰€æœ‰è€…ï¼ˆownerï¼‰å°±æ˜¯è¯¥é’±åŒ…åœ°å€ï¼Œä¸”æ— æ³•ä¿®æ”¹ã€‚
ä¸€ä¸ªé’±åŒ…å¯¹ä¸€ä¸ª Mint åªèƒ½æœ‰1 ä¸ª ATAï¼ˆå› ä¸ºåœ°å€å”¯ä¸€ï¼‰ï¼Œè¿™æ˜¯é’±åŒ…ç®¡ç†ä»£å¸çš„ã€Œé»˜è®¤è´¦æˆ·ã€ã€‚
é ATA Token Accountï¼š
æ‰€æœ‰è€…å¯ä»¥æ˜¯ä»»æ„åœ°å€ï¼ˆå¯ä»¥æ˜¯ä½ çš„é’±åŒ…ã€å…¶ä»–ç”¨æˆ·çš„é’±åŒ…ï¼Œç”šè‡³æ˜¯æ™ºèƒ½åˆçº¦åœ°å€ï¼‰ï¼Œä¸”å…è®¸ä¸€ä¸ªæ‰€æœ‰è€…å¯¹ä¸€ä¸ª Mint åˆ›å»ºå¤šä¸ªé ATA è´¦æˆ·ï¼ˆå› ä¸ºåœ°å€éšæœºï¼‰ã€‚
ä¾‹å¦‚ï¼šä½ å¯ä»¥ç”¨è‡ªå·±çš„é’±åŒ…ä½œä¸ºæ‰€æœ‰è€…ï¼Œä¸ºåŒä¸€ä¸ª Mint åˆ›å»º 10 ä¸ªä¸åŒçš„é ATA è´¦æˆ·ï¼Œåˆ†åˆ«æŒæœ‰ä¸åŒæ•°é‡çš„ä»£å¸ã€‚


é’±åŒ…ä¸ DApp å…¼å®¹æ€§ä¸åŒ


ATAï¼š
éµå¾ª Solana å®˜æ–¹æ ‡å‡†ï¼Œæ‰€æœ‰ä¸»æµé’±åŒ…ï¼ˆå¦‚ Phantomã€Solflareï¼‰å’Œ DApp éƒ½ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æ˜¾ç¤º ATA ä¸­çš„ä»£å¸ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ åœ°å€ã€‚
ä¾‹å¦‚ï¼šä½ åœ¨ Phantom é’±åŒ…ä¸­çœ‹åˆ°çš„æŸä»£å¸ä½™é¢ï¼Œå®é™…å°±æ˜¯ä½ é’±åŒ…å¯¹åº”çš„ ATA ä¸­çš„ä½™é¢ã€‚
é ATA Token Accountï¼š
ä¸è¢«é’±åŒ…è‡ªåŠ¨è¯†åˆ«ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ è´¦æˆ·åœ°å€æ‰èƒ½åœ¨é’±åŒ…ä¸­æ˜¾ç¤ºä½™é¢ã€‚
å¤§å¤šæ•° DApp ä¹Ÿä¸ä¼šé»˜è®¤ä¸é ATA äº¤äº’ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šè´¦æˆ·åœ°å€æ‰èƒ½è¿›è¡Œè½¬è´¦ã€äº¤æ˜“ç­‰æ“ä½œã€‚


ä½¿ç”¨åœºæ™¯ä¸åŒ


ATAï¼š
é€‚åˆæ™®é€šç”¨æˆ·æ—¥å¸¸ä½¿ç”¨ï¼Œç”¨äºæ¥æ”¶ã€å­˜å‚¨å’Œç®¡ç†ä»£å¸ï¼Œå› ä¸ºå…¼å®¹æ€§å¥½ã€ç®¡ç†ç®€å•ï¼ˆä¸€ä¸ª Mint å¯¹åº”ä¸€ä¸ªè´¦æˆ·ï¼Œä¸æ˜“æ··ä¹±ï¼‰ã€‚
ä¾‹å¦‚ï¼šåˆ«äººå‘ä½ è½¬è´¦æŸä»£å¸æ—¶ï¼Œåªéœ€æä¾›ä½ çš„é’±åŒ…åœ°å€ï¼Œå¯¹æ–¹ä¼šè‡ªåŠ¨å‘ä½ çš„ ATA è½¬è´¦ï¼ˆå› ä¸º ATA åœ°å€å¯æ¨å¯¼ï¼‰ã€‚
é ATA Token Accountï¼š
é€‚åˆç‰¹æ®Šåœºæ™¯ï¼Œä¾‹å¦‚ï¼š

æ™ºèƒ½åˆçº¦éœ€è¦æ§åˆ¶ä»£å¸ï¼ˆå°†æ‰€æœ‰è€…è®¾ä¸ºåˆçº¦åœ°å€ï¼‰ï¼›
éœ€å°†åŒä¸€ Mint çš„ä»£å¸æ‹†åˆ†åˆ°å¤šä¸ªè´¦æˆ·ç®¡ç†ï¼ˆå¦‚åˆ†è´¦ã€éš”ç¦»èµ„é‡‘ï¼‰ï¼›
ä¸´æ—¶è´¦æˆ·ï¼ˆç”¨å®Œå³å¼ƒï¼‰ç­‰ã€‚



æ€»ç»“æ¥è¯´ï¼ŒATA æ˜¯ã€Œæ ‡å‡†åŒ–ã€è‡ªåŠ¨å…³è”ã€æ˜“ç®¡ç†ã€çš„ä»£å¸è´¦æˆ·ï¼Œé€‚åˆå¤§å¤šæ•°æ—¥å¸¸åœºæ™¯ï¼›é ATA æ˜¯ã€Œçµæ´»ã€è‡ªå®šä¹‰ã€éœ€æ‰‹åŠ¨ç®¡ç†ã€çš„è´¦æˆ·ï¼Œé€‚åˆç‰¹æ®Šéœ€æ±‚ã€‚å®é™…å¼€å‘æˆ–ä½¿ç”¨ä¸­ï¼Œä¼˜å…ˆæ¨èä½¿ç”¨ ATAï¼Œé™¤éæœ‰æ˜ç¡®çš„ç‰¹æ®Šåœºæ™¯éœ€è¦é ATAã€‚
3. é“¸å¸ï¼ˆå¢åŠ ä»£å¸ä¾›åº”é‡ï¼‰
åªæœ‰Mintè´¦æˆ·çš„mint-authorityæœ‰æƒé™é“¸å¸ï¼š
  # å‘æŒ‡å®šToken Accounté“¸å¸100å•ä½ï¼ˆæ³¨æ„å°æ•°ä½ï¼Œå®é™…é‡‘é¢=æ•°é‡*10^decimalsï¼‰
 spl-token mint &lt;MINT_ADDRESS> 100 &lt;TOKEN_ACCOUNT_ADDRESS>

 # ç¤ºä¾‹ï¼šå‘å½“å‰é’±åŒ…çš„ATAé“¸å¸1000ï¼ˆå‡è®¾decimals=6ï¼Œå®é™…ä¸º1000 * 10^6 æœ€å°å•ä½ï¼‰
 spl-token mint &lt;MINT_ADDRESS> 1000
 
 --------
 âœ  ~ spl-token mint 3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9 100
Minting 100 tokens
  Token: 3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9
  Recipient: 7i8smGYKco3hicJThL8WYrMaGKpceeKkZRekqR4aWKFJ

Signature: USQP7cDcCip1ePdgKDxEXobBm8ohtaVwDRmGFt2BmDyi3tRQMrxtbvMkXbrUcdkoSNuQ2X9k6u1NNbztHeYY97Y

 --------

 # éªŒè¯é“¸å¸ç»“æœ
 spl-token balance &lt;MINT_ADDRESS>
  --------
 âœ  ~ spl-token balance 3F14kaMXjdC1mFx5LRdD19amiMneKhgJsmMzGQUJjTt9
100
 --------
4. ä»£å¸è½¬è´¦
 # ä»å½“å‰é’±åŒ…çš„ATAå‘ç›®æ ‡é’±åŒ…çš„ATAè½¬è´¦50å•ä½
spl-token transfer &lt;MINT_ADDRESS> 50 &lt;RECIPIENT_WALLET_ADDRESS> --fund-recipient

# å‚æ•°è¯´æ˜ï¼š
# --fund-recipientï¼šè‡ªåŠ¨ä¸ºæ¥æ”¶è€…åˆ›å»ºATAï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰å¹¶æ”¯ä»˜åˆ›å»ºè´¹ç”¨
5. é”€æ¯ä»£å¸ï¼ˆå‡å°‘ä¾›åº”é‡ï¼‰
ä»£å¸æŒæœ‰è€…å¯é”€æ¯è‡ªå·±æŒæœ‰çš„ä»£å¸ï¼š
 # é”€æ¯å½“å‰é’±åŒ…ATAä¸­çš„20å•ä½ä»£å¸
spl-token burn &lt;TOKEN_ACCOUNT_ADDRESS> 20
6. æŸ¥çœ‹ä»£å¸ä¿¡æ¯
 # æŸ¥çœ‹Mintè´¦æˆ·è¯¦æƒ…ï¼ˆæ€»ä¾›åº”é‡ã€æƒé™ç­‰ï¼‰
spl-token mint-info &lt;MINT_ADDRESS>

# æŸ¥çœ‹Token Accountè¯¦æƒ…ï¼ˆä½™é¢ã€æ‰€æœ‰è€…ç­‰ï¼‰
spl-token account-info &lt;TOKEN_ACCOUNT_ADDRESS>
å…³é”®æ³¨æ„äº‹é¡¹

æƒé™ç®¡ç†ï¼šMintè´¦æˆ·çš„é“¸å¸/å†»ç»“æƒé™é»˜è®¤å½’åˆ›å»ºè€…ï¼Œå¯é€šè¿‡spl-token authorizeè½¬ç§»æˆ–æ’¤é”€
NFTç‰¹æ®Šå¤„ç†ï¼šå¿…é¡»è®¾ç½®--decimals 0ï¼Œä¸”é€šå¸¸åªé“¸å¸1ä¸ªå•ä½ï¼ˆspl-token mint &lt;MINT&gt; 1ï¼‰
ä¸»ç½‘æ“ä½œï¼šåˆ‡æ¢é›†ç¾¤ä¸ºhttps://api.mainnet-beta.solana.comæ—¶ï¼Œéœ€ä½¿ç”¨çœŸå®SOLæ”¯ä»˜Gasè´¹
åœ°å€è®°å½•ï¼šMintåœ°å€æ˜¯ä»£å¸çš„å”¯ä¸€æ ‡è¯†ï¼Œéœ€å¦¥å–„ä¿å­˜ï¼ˆå¯é€šè¿‡solana address -k &lt;MINT_KEYPAIR_FILE&gt;æŸ¥è¯¢ï¼‰

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå³å¯å®Œæˆä»ä»£å¸åˆ›å»ºåˆ°è½¬è´¦é”€æ¯çš„å…¨æµç¨‹æ“ä½œã€‚å®é™…å¼€å‘ä¸­ï¼Œå¯é€šè¿‡Solana Rust SDKæˆ–Web3.jsè°ƒç”¨Token Programçš„æŒ‡ä»¤å®ç°ç›¸åŒåŠŸèƒ½ã€‚
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part5]_SPLTokenåˆçº¦ç®€å•å®ç°</title>
    <url>/2025/08/07/Solana-part5-SPLToken%E5%90%88%E7%BA%A6%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[Solana[part5]_SPLTokenåˆçº¦ç®€å•å®ç°

å®ç°Tokené¡¹ç›®


åˆ›å»ºä¸€ä¸ªtokené¡¹ç›®


token é¡¹ç›®ä¾èµ–ï¼š
[dependencies]
borsh = "1.5.7"
solana-program = "2.3.0"
spl-associated-token-account = &#123; version = "7.0.0", features = [
    "no-entrypoint",
] &#125;
spl-token = &#123; version = "8.0.0", features = ["no-entrypoint"] &#125;

[lib]
crate-type = ["cdylib", "lib"]



ç¼–å†™åˆçº¦,å…·ä½“ä»£ç è§: https://github.com/SoniaChan33/token


èµ·æœ¬åœ°ç¯å¢ƒï¼šâœ  ~ solana-test-validator


æ‰“å¼€log
âœ  ~ solana logs


ç¼–è¯‘åˆçº¦ï¼š
âœ  token git:(master) âœ— cargo build-sbf


éƒ¨ç½²åˆçº¦, è·å–programID
âœ  token git:(master) âœ— solana program deploy target/deploy/token.so
Program Id: 5DPHC1PjRftRHJLKD4WSSXt83h1AChJy2pHXUqGdKD9X

Signature: 29PquhXv5Jw9c8p6k3jGK9UoLATg5rUpk3Mx8BBiJK8vxNEcLru4t7xYn6EdxXVeivUP7urczzoQY3KSvgGbEdhR


æ ¸å¿ƒæ–‡ä»¶
å…·ä½“å®ç°æ–‡æ¡£è§ä»“åº“readmeæ–‡æ¡£ï¼šhttps://github.com/SoniaChan33/token?tab=readme-ov-file#spl-tokenåˆçº¦é¡¹ç›®å®ç°æ–‡æ¡£
processor.rsï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†æŒ‡ä»¤
state.rsï¼šå®šä¹‰è´¦æˆ·çš„çŠ¶æ€å’Œæ‰©å±•å­—æ®µ
instruction.rsï¼šå®šä¹‰å„ç§ä»£å¸æ“ä½œçš„æŒ‡ä»¤
oerror.rsï¼šå®šä¹‰äº†ç¨‹åºå¯èƒ½æŠ›å‡ºçš„é”™è¯¯
olib.rsï¼šç¨‹åºå…¥å£ç‚¹ï¼Œæ±‡æ€»å„ä¸ªæ¨¡å—ã€‚

å®ç°è°ƒç”¨æ–¹Cli


åˆ›å»ºé¡¹ç›®


ç¼–å†™ï¼šå…·ä½“ä»£ç è§ï¼šhttps://github.com/SoniaChan33/solana-cli


æµ‹è¯•ç»“æœï¼š
running 1 test
test test_fn ... ok

successes:

---- test_fn stdout ----
Mint Account: 54b3u3wmAzM7LdPpERfa3iZGjkbafaD5FQ3aXV8iRaQk
Transaction result: zaWCinW8Kmjh6sQ3jRPcrntZ5yFWhuQM6GwWuGBJxCPPRJUiEcVRC1hKtaw1TSGZ5QB3nnEqBPieG3HzCvuEv5A
Token created successfully with mint account: 54b3u3wmAzM7LdPpERfa3iZGjkbafaD5FQ3aXV8iRaQk


successes:
    test_fn


]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part6]_ç¤¾äº¤é¡¹ç›®1-åˆçº¦éƒ¨åˆ†æ–‡æ¡£</title>
    <url>/2025/08/08/Solana-part6-%E7%A4%BE%E4%BA%A4%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[Solana[part6]_ç¤¾äº¤é¡¹ç›®1-åˆçº¦éƒ¨åˆ†

ç¤¾äº¤é¡¹ç›®åœ°å€é“¾æ¥
ğŸ”— åˆçº¦åœ°å€ï¼šhttps://github.com/SoniaChan33/sol-friend
ğŸ”— å®¢æˆ·ç«¯åœ°å€ï¼š https://github.com/SoniaChan33/solana-friend-cli

ä¸€ã€é¡¹ç›®æ¦‚è¿°
æœ¬é¡¹ç›®æ˜¯åŸºäºSolanaåŒºå—é“¾çš„å»ä¸­å¿ƒåŒ–ç¤¾äº¤åº”ç”¨åˆçº¦ï¼Œä½¿ç”¨Rustè¯­è¨€å¼€å‘ã€‚åˆçº¦æ”¯æŒç”¨æˆ·è´¦æˆ·åˆå§‹åŒ–ã€å…³æ³¨/å–æ¶ˆå…³æ³¨å…¶ä»–ç”¨æˆ·ã€å‘å¸ƒå†…å®¹ã€æŸ¥è¯¢ç²‰ä¸åˆ—è¡¨åŠæŸ¥è¯¢å¸–å­ç­‰æ ¸å¿ƒç¤¾äº¤åŠŸèƒ½ã€‚é€šè¿‡Solanaçš„Program Derived Address (PDA)æœºåˆ¶ç®¡ç†ç”¨æˆ·æ•°æ®ï¼Œä½¿ç”¨Borshè¿›è¡Œæ•°æ®åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œç¡®ä¿é“¾ä¸Šæ•°æ®çš„é«˜æ•ˆå­˜å‚¨ä¸è¯»å–ã€‚
äºŒã€æ ¸å¿ƒæ¨¡å—ä¸æ•°æ®ç»“æ„
1. æŒ‡ä»¤å®šä¹‰ï¼ˆinstruction.rsï¼‰
å®šä¹‰äº†åˆçº¦æ”¯æŒçš„æ‰€æœ‰æ“ä½œæŒ‡ä»¤ï¼Œé€šè¿‡SocialInstructionæšä¸¾å®ç°ï¼ŒåŒ…å«ä»¥ä¸‹æŒ‡ä»¤ï¼š



æŒ‡ä»¤å
åŠŸèƒ½æè¿°
å‚æ•°è¯´æ˜




InitializeUser
åˆå§‹åŒ–ç”¨æˆ·è´¦æˆ·ï¼ˆ profile æˆ– post ç±»å‹ï¼‰
seed_type: è´¦æˆ·ç±»å‹ï¼ˆâ€œprofileâ€ æˆ– â€œpostâ€ï¼‰


FollowUser
å…³æ³¨æŒ‡å®šç”¨æˆ·
user_to_follow: è¢«å…³æ³¨ç”¨æˆ·çš„Pubkey


UnfollowUser
å–æ¶ˆå…³æ³¨æŒ‡å®šç”¨æˆ·
user_to_unfollow: è¢«å–æ¶ˆå…³æ³¨ç”¨æˆ·çš„Pubkey


QueryFollowers
æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„ç²‰ä¸åˆ—è¡¨
æ— å‚æ•°


PostContent
å‘å¸ƒå†…å®¹
content: å¸–å­å†…å®¹å­—ç¬¦ä¸²


QueryPosts
æŸ¥è¯¢ç”¨æˆ·çš„å¸–å­ä¿¡æ¯
æ— å‚æ•°



2. çŠ¶æ€æ•°æ®ç»“æ„ï¼ˆstate.rsï¼‰
å®šä¹‰äº†é“¾ä¸Šå­˜å‚¨çš„æ•°æ®ç»“æ„åŠæ“ä½œæ–¹æ³•ï¼Œæ ¸å¿ƒç»“æ„å¦‚ä¸‹ï¼š
ï¼ˆ1ï¼‰UserProfile
å­˜å‚¨ç”¨æˆ·çš„ç²‰ä¸åˆ—è¡¨ä¿¡æ¯ï¼š
pub struct UserProfile &#123;
    pub data_len: u16,       // ç²‰ä¸æ•°é‡ï¼ˆä¸followers.len()ä¸€è‡´ï¼Œç”¨äºå¿«é€Ÿè®¡ç®—å­˜å‚¨ç©ºé—´ï¼‰
    pub followers: Vec&lt;Pubkey>, // ç²‰ä¸çš„Pubkeyåˆ—è¡¨
&#125;
æ ¸å¿ƒæ–¹æ³•ï¼š

new()ï¼šåˆå§‹åŒ–ç©ºçš„ç”¨æˆ·èµ„æ–™
follow(&amp;mut self, user: Pubkey)ï¼šæ·»åŠ ç²‰ä¸ï¼ˆå»é‡ï¼‰
unfollow(&amp;mut self, user_to_follow: Pubkey)ï¼šç§»é™¤ç²‰ä¸ï¼ˆæ›´æ–°æ•°é‡ï¼‰

ï¼ˆ2ï¼‰UserPost
è®°å½•ç”¨æˆ·å‘å¸ƒçš„å¸–å­æ•°é‡ï¼š
pub struct UserPost &#123;
    pub post_count: u16, // å¸–å­æ€»æ•°
&#125;
æ ¸å¿ƒæ–¹æ³•ï¼š

new()ï¼šåˆå§‹åŒ–å¸–å­è®¡æ•°å™¨ï¼ˆåˆå§‹ä¸º0ï¼‰
add_post(&amp;mut self)ï¼šå‘å¸ƒæ–°å¸–å­æ—¶é€’å¢è®¡æ•°å™¨
get_count(&amp;self)ï¼šè·å–å½“å‰å¸–å­æ€»æ•°

ï¼ˆ3ï¼‰Post
å­˜å‚¨å•æ¡å¸–å­çš„å…·ä½“å†…å®¹ï¼š
pub struct Post &#123;
    pub content: String,  // å¸–å­å†…å®¹
    pub timestamp: u64,   // å‘å¸ƒæ—¶é—´æˆ³ï¼ˆåŸºäºSolanaç½‘ç»œæ—¶é’Ÿï¼‰
&#125;
æ ¸å¿ƒæ–¹æ³•ï¼š

new(content: String, timestamp: u64)ï¼šåˆ›å»ºæ–°å¸–å­å®ä¾‹

ä¸‰ã€æŒ‡ä»¤å¤„ç†é€»è¾‘ï¼ˆprocessor.rsï¼‰
Processorç»“æ„ä½“å®ç°äº†æ‰€æœ‰æŒ‡ä»¤çš„å…·ä½“å¤„ç†é€»è¾‘ï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š
1. initialize_userï¼šåˆå§‹åŒ–ç”¨æˆ·è´¦æˆ·

åŠŸèƒ½ï¼šåˆ›å»ºç”¨æˆ·çš„PDAè´¦æˆ·ï¼ˆåˆ†ä¸ºprofileå’Œpostä¸¤ç§ç±»å‹ï¼‰ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·èµ„æ–™æˆ–å¸–å­è®¡æ•°å™¨ã€‚
æµç¨‹ï¼š

è§£æè´¦æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·è´¦æˆ·ã€PDAè´¦æˆ·ã€ç³»ç»Ÿç¨‹åºï¼‰ï¼›
åŸºäºç”¨æˆ·Pubkeyå’Œseed_typeï¼ˆâ€œprofile&quot;æˆ–&quot;postâ€ï¼‰ç”ŸæˆPDAåœ°å€ï¼ŒéªŒè¯ä¼ å…¥çš„PDAè´¦æˆ·æ˜¯å¦åŒ¹é…ï¼›
è®¡ç®—è´¦æˆ·æ‰€éœ€å­˜å‚¨ç©ºé—´ï¼ˆprofileè´¦æˆ·æ ¹æ®æœ€å¤§ç²‰ä¸æ•°è®¡ç®—ï¼Œpostè´¦æˆ·å›ºå®šå¤§å°ï¼‰ï¼›
è°ƒç”¨ç³»ç»Ÿç¨‹åºåˆ›å»ºPDAè´¦æˆ·ï¼ˆé¢„å­˜è¶³å¤Ÿç§Ÿé‡‘ä»¥è±å…ç§Ÿé‡‘ï¼‰ï¼›
åˆå§‹åŒ–å¯¹åº”çš„æ•°æ®ç»“æ„ï¼ˆUserProfileæˆ–UserPostï¼‰å¹¶åºåˆ—åŒ–åˆ°PDAè´¦æˆ·ä¸­ã€‚



2. follow_userï¼šå…³æ³¨ç”¨æˆ·

åŠŸèƒ½ï¼šå°†è¢«å…³æ³¨ç”¨æˆ·çš„Pubkeyæ·»åŠ åˆ°å½“å‰ç”¨æˆ·çš„UserProfileç²‰ä¸åˆ—è¡¨ä¸­ã€‚
æµç¨‹ï¼š

è§£æPDAè´¦æˆ·ï¼ˆå­˜å‚¨å½“å‰ç”¨æˆ·çš„UserProfileï¼‰ï¼›
è¯»å–data_lenè®¡ç®—å½“å‰ç²‰ä¸åˆ—è¡¨çš„å­˜å‚¨ç©ºé—´ï¼Œååºåˆ—åŒ–UserProfileï¼›
è°ƒç”¨followæ–¹æ³•æ·»åŠ ç²‰ä¸ï¼ˆè‡ªåŠ¨å»é‡ï¼‰ï¼›
å°†æ›´æ–°åçš„UserProfileé‡æ–°åºåˆ—åŒ–å¹¶å†™å…¥PDAè´¦æˆ·ã€‚



3. unfollow_userï¼šå–æ¶ˆå…³æ³¨ç”¨æˆ·

åŠŸèƒ½ï¼šä»å½“å‰ç”¨æˆ·çš„UserProfileç²‰ä¸åˆ—è¡¨ä¸­ç§»é™¤æŒ‡å®šç”¨æˆ·çš„Pubkeyã€‚
æµç¨‹ï¼š

è§£æPDAè´¦æˆ·ï¼ˆå­˜å‚¨å½“å‰ç”¨æˆ·çš„UserProfileï¼‰ï¼›
ååºåˆ—åŒ–UserProfileï¼›
è°ƒç”¨unfollowæ–¹æ³•ç§»é™¤ç²‰ä¸ï¼ˆæ›´æ–°data_lenï¼‰ï¼›
å°†æ›´æ–°åçš„UserProfileé‡æ–°åºåˆ—åŒ–å¹¶å†™å…¥PDAè´¦æˆ·ã€‚



4. query_followersï¼šæŸ¥è¯¢ç²‰ä¸åˆ—è¡¨

åŠŸèƒ½ï¼šè¯»å–å½“å‰ç”¨æˆ·çš„UserProfileå¹¶è¾“å‡ºç²‰ä¸åˆ—è¡¨ã€‚
æµç¨‹ï¼š

è§£æPDAè´¦æˆ·ï¼ˆå­˜å‚¨å½“å‰ç”¨æˆ·çš„UserProfileï¼‰ï¼›
ååºåˆ—åŒ–UserProfileå¹¶é€šè¿‡msg!æ‰“å°ç²‰ä¸åˆ—è¡¨ã€‚



5. post_contentï¼šå‘å¸ƒå†…å®¹

åŠŸèƒ½ï¼šåˆ›å»ºæ–°çš„å¸–å­PDAè´¦æˆ·ï¼Œå­˜å‚¨å¸–å­å†…å®¹å’Œæ—¶é—´æˆ³ï¼Œå¹¶æ›´æ–°ç”¨æˆ·çš„å¸–å­è®¡æ•°å™¨ã€‚
æµç¨‹ï¼š

è§£æè´¦æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·è´¦æˆ·ã€å¸–å­è®¡æ•°å™¨PDAã€æ–°å¸–å­PDAã€ç³»ç»Ÿç¨‹åºï¼‰ï¼›
è¯»å–å½“å‰ç”¨æˆ·çš„UserPostï¼Œé€’å¢post_countå¹¶é‡æ–°åºåˆ—åŒ–ï¼›
åŸºäºç”¨æˆ·Pubkeyã€&quot;post&quot;ç§å­å’Œæœ€æ–°post_countç”Ÿæˆæ–°å¸–å­çš„PDAåœ°å€ï¼›
è®¡ç®—å¸–å­æ‰€éœ€å­˜å‚¨ç©ºé—´ï¼ˆåŸºäºPostç»“æ„ä½“å¤§å°ï¼‰ï¼Œåˆ›å»ºæ–°å¸–å­PDAè´¦æˆ·ï¼›
å°†å¸–å­å†…å®¹å’Œå½“å‰æ—¶é—´æˆ³ï¼ˆé€šè¿‡Solanaæ—¶é’Ÿè·å–ï¼‰åºåˆ—åŒ–åˆ°æ–°å¸–å­PDAä¸­ã€‚



6. query_postï¼šæŸ¥è¯¢å¸–å­ä¿¡æ¯

åŠŸèƒ½ï¼šè¯»å–ç”¨æˆ·çš„å¸–å­è®¡æ•°å™¨å’ŒæŒ‡å®šå¸–å­çš„å†…å®¹ã€‚
æµç¨‹ï¼š

è§£æè´¦æˆ·ä¿¡æ¯ï¼ˆå¸–å­è®¡æ•°å™¨PDAã€ç›®æ ‡å¸–å­PDAï¼‰ï¼›
åˆ†åˆ«ååºåˆ—åŒ–UserPostå’ŒPostï¼Œé€šè¿‡msg!æ‰“å°å¸–å­æ•°é‡å’Œå†…å®¹ã€‚




å››ã€é‡åˆ°çš„å‘
1. å…³äºRustå€Ÿç”¨è§„åˆ™ï¼ˆfollow_userä¸­çš„ä½œç”¨åŸŸï¼‰
&#123;
    let data = &amp;pda_account.data.borrow(); // ä¸å¯å˜å¼•ç”¨
    // ... è¯»å–dataè®¡ç®—size
&#125; // dataçš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œä¸å¯å˜å¼•ç”¨é‡Šæ”¾
åŸå› ï¼šRustçš„å€Ÿç”¨è§„åˆ™ç¦æ­¢åŒä¸€ä½œç”¨åŸŸå†…åŒæ—¶å­˜åœ¨ä¸å¯å˜å¼•ç”¨å’Œå¯å˜å¼•ç”¨ã€‚æ­¤å¤„ç”¨ä½œç”¨åŸŸé™åˆ¶dataï¼ˆä¸å¯å˜å¼•ç”¨ï¼‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿åç»­è°ƒç”¨try_borrow_mut_data()ï¼ˆè·å–å¯å˜å¼•ç”¨ï¼‰æ—¶ä¸ä¼šè§¦å‘å€Ÿç”¨å†²çªã€‚
2. æ•°ç»„åˆ‡ç‰‡çš„ä½¿ç”¨ï¼ˆfollow_userä¸­çš„&amp;data[..U16_SIZE]ï¼‰
let len: &amp;[u8] = &amp;data[..U16_SIZE]; // U16_SIZE=2
åŸå› ï¼šUserProfileçš„data_lenæ˜¯u16ç±»å‹ï¼ˆå 2å­—èŠ‚ï¼‰ï¼Œå­˜å‚¨åœ¨è´¦æˆ·æ•°æ®çš„å‰2å­—èŠ‚ã€‚é€šè¿‡æ•°ç»„åˆ‡ç‰‡æå–å‰2å­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºu16ï¼Œç”¨äºè®¡ç®—ç²‰ä¸åˆ—è¡¨çš„æ€»å­˜å‚¨ç©ºé—´ï¼ˆdata_lenå³ç²‰ä¸æ•°é‡ï¼‰ã€‚
3. åºåˆ—åŒ–çš„å¿…è¦æ€§ï¼ˆä¿®æ”¹æ•°æ®åé‡æ–°åºåˆ—åŒ–ï¼‰
user_profile.serialize(&amp;mut *pda_account.try_borrow_mut_data()?)?;
åŸå› ï¼šé“¾ä¸Šè´¦æˆ·å­˜å‚¨çš„æ˜¯å­—èŠ‚æ•°æ®ï¼Œuser_profileæ˜¯å†…å­˜ä¸­çš„ç»“æ„ä½“å®ä¾‹ã€‚å½“ç»“æ„ä½“è¢«ä¿®æ”¹ï¼ˆå¦‚æ·»åŠ ç²‰ä¸ï¼‰åï¼Œå¿…é¡»é€šè¿‡serializeå°†å†…å­˜ä¸­çš„æœ€æ–°çŠ¶æ€è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œå†™å…¥è´¦æˆ·æ•°æ®åŒºåŸŸï¼Œå¦åˆ™ä¿®æ”¹ä¸ä¼šè¢«æŒä¹…åŒ–åˆ°é“¾ä¸Šã€‚
4. PDAåœ°å€è®¡ç®—ï¼ˆpost_contentä¸­çš„ç§å­ï¼‰
Pubkey::find_program_address(&amp;[user_account.key.as_ref(), "post".as_bytes(), &amp;[count as u8]], program_id)
åŸå› ï¼šPDAï¼ˆç¨‹åºæ´¾ç”Ÿåœ°å€ï¼‰éœ€é€šè¿‡â€œç§å­+ç¨‹åºIDâ€ç”Ÿæˆï¼Œç¡®ä¿å”¯ä¸€æ€§ã€‚æ­¤å¤„ä½¿ç”¨ï¼š

ç”¨æˆ·Pubkeyï¼ˆåŒºåˆ†ä¸åŒç”¨æˆ·ï¼‰ï¼›
&quot;post&quot;å­—ç¬¦ä¸²ï¼ˆæ ‡è¯†å¸–å­ç±»å‹ï¼‰ï¼›
å¸–å­è®¡æ•°å™¨countï¼ˆåŒºåˆ†åŒä¸€ç”¨æˆ·çš„ä¸åŒå¸–å­ï¼‰ï¼›
ä¸‰è€…ç»„åˆä½œä¸ºç§å­ï¼Œç¡®ä¿æ¯ä¸ªå¸–å­çš„PDAåœ°å€å”¯ä¸€ã€‚

5. unwrap()ä¸?çš„åŒºåˆ«

unwrap()ï¼šå½“Resultä¸ºOkæ—¶è¿”å›å€¼ï¼Œä¸ºErræ—¶ç›´æ¥è§¦å‘ç¨‹åºææ…Œï¼ˆpanicï¼‰ï¼Œé€‚åˆç¡®å®šä¸ä¼šå‡ºé”™çš„åœºæ™¯ï¼ˆå¦‚å·²çŸ¥åºåˆ—åŒ–Postå¿…ç„¶æˆåŠŸï¼‰ã€‚
?ï¼šå½“Resultä¸ºErræ—¶å°†é”™è¯¯è¿”å›ç»™è°ƒç”¨è€…ï¼Œç”±ä¸Šå±‚å¤„ç†ï¼Œé€‚åˆéœ€è¦ä¼ æ’­é”™è¯¯çš„åœºæ™¯ï¼ˆå¦‚è´¦æˆ·è§£æå¤±è´¥ï¼‰ã€‚

6. create_accountæŒ‡ä»¤å‚æ•°
system_instruction::create_account(
    user_account.key,    // èµ„é‡‘æ¥æºï¼ˆåˆ›å»ºè€…ï¼‰
    &amp;pda,                // æ–°è´¦æˆ·åœ°å€ï¼ˆPDAï¼‰
    lamports,            // åˆå§‹Lamportsï¼ˆéœ€è¦†ç›–ç§Ÿé‡‘ï¼‰
    space as u64,        // è´¦æˆ·å­˜å‚¨ç©ºé—´
    program_id           // è´¦æˆ·æ‰€æœ‰è€…ï¼ˆå½“å‰åˆçº¦ï¼‰
)
åŸå› ï¼šåˆ›å»ºSolanaè´¦æˆ·å¿…é¡»æŒ‡å®šï¼šèµ„é‡‘æ¥æºï¼ˆæ”¯ä»˜ç§Ÿé‡‘ï¼‰ã€è´¦æˆ·åœ°å€ã€å­˜å‚¨ç©ºé—´ï¼ˆå†³å®šç§Ÿé‡‘é‡‘é¢ï¼‰ã€æ‰€æœ‰è€…ï¼ˆåªæœ‰æ‰€æœ‰è€…ç¨‹åºå¯ä¿®æ”¹è´¦æˆ·æ•°æ®ï¼‰ã€‚
7. invoke_signedä¸­çš„signer_seeds
&amp;[&amp;[user_account.key.as_ref(), "post".as_bytes(), &amp;[count as u8], &amp;[bump_seed]]]
åŸå› ï¼šPDAæœ¬èº«ä¸æ˜¯ç§é’¥æ§åˆ¶çš„è´¦æˆ·ï¼Œæ— æ³•ç›´æ¥ç­¾åã€‚signer_seedsç”¨äºè¯æ˜â€œå½“å‰åˆçº¦æœ‰æƒé™æ“ä½œè¯¥PDAâ€â€”â€”é€šè¿‡ç§å­é‡æ–°è®¡ç®—PDAåœ°å€ï¼ŒéªŒè¯ä¸ç›®æ ‡åœ°å€ä¸€è‡´ï¼Œä»è€Œè·å¾—ä¸´æ—¶ç­¾åæƒé™ï¼Œç¡®ä¿è´¦æˆ·åˆ›å»ºçš„å®‰å…¨æ€§ã€‚
8. modè¯­å¥è°ƒç”¨æ³¨æ„
åœ¨ Rust ä¸­ï¼Œmod è¯­å¥ç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨åŒ…å«æŸä¸ªæ¨¡å—çš„æºæ–‡ä»¶ã€‚åªæœ‰åœ¨æ¨¡å—è¢«å£°æ˜ä¸º pub mod xxx; åï¼Œå…¶ä»–æ–‡ä»¶ï¼ˆå¦‚ processor.rsï¼‰æ‰èƒ½é€šè¿‡ use crate::xxx::â€¦ è®¿é—®å…¶å†…å®¹ã€‚
åŸå› å¦‚ä¸‹ï¼š
state.rs åªæ˜¯ç‰©ç†å­˜åœ¨äº src ç›®å½•ä¸‹ï¼Œåªæœ‰åœ¨ lib.rs é‡Œç”¨ pub mod state; å£°æ˜åï¼Œstate æ¨¡å—æ‰ä¼šè¢«ç¼–è¯‘è¿› crate å¹¶å¯¹å¤–å¯è§ã€‚
å¦‚æœä¸åœ¨ lib.rs é‡Œå£°æ˜ï¼Œcrate::state è¿™ä¸ªè·¯å¾„åœ¨å…¶ä»–æ–‡ä»¶é‡Œå°±æ‰¾ä¸åˆ°ã€‚
processor.rs åªæ˜¯ä½¿ç”¨ stateï¼Œä½†æ¨¡å—çš„â€œå¼•å…¥â€å¿…é¡»åœ¨ crate çš„æ ¹ï¼ˆå³ lib.rsï¼‰å£°æ˜ã€‚
äº”ã€ç¨‹åºå…¥å£ï¼ˆlib.rsï¼‰
å®šä¹‰äº†Solanaç¨‹åºçš„å…¥å£ç‚¹process_instructionï¼Œå°†æŒ‡ä»¤å¤„ç†é€»è¾‘å§”æ‰˜ç»™Processor::process_instructionï¼Œç¬¦åˆSolanaç¨‹åºçš„æ ‡å‡†å…¥å£è§„èŒƒã€‚
å…­ã€æ€»ç»“
æœ¬åˆçº¦é€šè¿‡PDAç®¡ç†ç”¨æˆ·æ•°æ®ï¼Œç»“åˆBorshåºåˆ—åŒ–å’ŒSolanaç³»ç»ŸæŒ‡ä»¤ï¼Œå®ç°äº†å»ä¸­å¿ƒåŒ–ç¤¾äº¤åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ã€‚å…³é”®è®¾è®¡ç‚¹åŒ…æ‹¬ï¼šç”¨PDAç¡®ä¿æ•°æ®æ‰€æœ‰æƒã€é€šè¿‡è®¡æ•°å™¨å’Œç§å­ç”Ÿæˆå”¯ä¸€å¸–å­åœ°å€ã€ä¸¥æ ¼éµå¾ªRustå†…å­˜å®‰å…¨è§„åˆ™å¤„ç†è´¦æˆ·æ•°æ®ã€‚
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part7]_ç¤¾äº¤é¡¹ç›®2-å®¢æˆ·ç«¯æ–‡æ¡£</title>
    <url>/2025/08/11/Solana-part7-%E7%A4%BE%E4%BA%A4%E9%A1%B9%E7%9B%AE2%E2%80%94%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[Solana[part7]_ç¤¾äº¤é¡¹ç›®2â€”å®¢æˆ·ç«¯æ–‡æ¡£

ç¤¾äº¤é¡¹ç›®åœ°å€é“¾æ¥
ğŸ”— åˆçº¦åœ°å€ï¼šhttps://github.com/SoniaChan33/sol-friend
ğŸ”— å®¢æˆ·ç«¯åœ°å€ï¼š https://github.com/SoniaChan33/solana-friend-cli

ä¸€ã€æ¦‚è¿°
æœ¬æ–‡æ¡£ä»‹ç»åŸºäºSolanaåŒºå—é“¾çš„ç¤¾äº¤åº”ç”¨å®¢æˆ·ç«¯ä»£ç çš„æ ¸å¿ƒåŠŸèƒ½ã€æ•°æ®ç»“æ„åŠä½¿ç”¨æ–¹æ³•ã€‚è¯¥å®¢æˆ·ç«¯é€šè¿‡RPCä¸Solanaç½‘ç»œäº¤äº’ï¼Œå®ç°ç”¨æˆ·èµ„æ–™ç®¡ç†ã€å…³æ³¨/å–æ¶ˆå…³æ³¨ã€å†…å®¹å‘å¸ƒä¸æŸ¥è¯¢ç­‰ç¤¾äº¤åŠŸèƒ½ï¼Œä¾èµ–é“¾ä¸Šç¨‹åºå¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚
äºŒã€ä¾èµ–è¯´æ˜
å®¢æˆ·ç«¯ä»£ç ä¾èµ–ä»¥ä¸‹Rust crateï¼š

solana-clientï¼šæä¾›Solana RPCå®¢æˆ·ç«¯åŠŸèƒ½ï¼Œç”¨äºä¸èŠ‚ç‚¹äº¤äº’
solana-sdkï¼šSolanaæ ¸å¿ƒSDKï¼ŒåŒ…å«è´¦æˆ·ã€äº¤æ˜“ã€ç­¾åç­‰åŸºç¡€ç±»å‹
borshï¼šç”¨äºé“¾ä¸Šæ•°æ®çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆSolanaç”Ÿæ€å¸¸ç”¨ï¼‰
std::str::FromStrï¼šç”¨äºPubkeyå­—ç¬¦ä¸²è§£æ

ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„
1. è´¦æˆ·æ•°æ®ç»“æ„
ç”¨äºåœ¨é“¾ä¸Šå­˜å‚¨ç”¨æˆ·ç›¸å…³æ•°æ®ï¼Œéœ€å®ç°BorshDeserializeå’ŒBorshSerializeä»¥æ”¯æŒé“¾ä¸Šä¼ è¾“ã€‚
UserProfile

åŠŸèƒ½ï¼šå­˜å‚¨ç”¨æˆ·çš„å…³æ³¨è€…åˆ—è¡¨ä¿¡æ¯
å­—æ®µï¼š

data_len: u16ï¼šå…³æ³¨è€…æ•°é‡ï¼ˆä¸followersé•¿åº¦ä¸€è‡´ï¼‰
followers: Vec&lt;Pubkey&gt;ï¼šå…³æ³¨å½“å‰ç”¨æˆ·çš„ç”¨æˆ·å…¬é’¥åˆ—è¡¨


æ–¹æ³•ï¼š

new()ï¼šåˆ›å»ºç©ºçš„ç”¨æˆ·èµ„æ–™å®ä¾‹
follow(&amp;mut self, user: Pubkey)ï¼šæ·»åŠ æ–°å…³æ³¨è€…ï¼ˆå»é‡å¤„ç†ï¼‰



UserPost

åŠŸèƒ½ï¼šè®°å½•ç”¨æˆ·çš„å‘å¸–æ•°é‡
å­—æ®µï¼š

post_count: u16ï¼šç”¨æˆ·å‘å¸ƒçš„å†…å®¹æ€»æ•°



Post

åŠŸèƒ½ï¼šå­˜å‚¨å•æ¡å¸–å­å†…å®¹
å­—æ®µï¼š

content: Stringï¼šå¸–å­æ–‡æœ¬å†…å®¹
timestamp: u64ï¼šå‘å¸–æ—¶é—´æˆ³ï¼ˆé€šå¸¸ä¸ºåŒºå—æ—¶é—´ï¼‰



2. å®¢æˆ·ç«¯æ ¸å¿ƒç»“æ„
SocialClient

åŠŸèƒ½ï¼šå°è£…ä¸Solanaé“¾ä¸Šç¤¾äº¤ç¨‹åºäº¤äº’çš„æ‰€æœ‰æ–¹æ³•
å­—æ®µï¼š

rpc_client: RpcClientï¼šSolana RPCå®¢æˆ·ç«¯å®ä¾‹
program_id: Pubkeyï¼šé“¾ä¸Šç¤¾äº¤ç¨‹åºçš„å…¬é’¥


æ„é€ æ–¹æ³•ï¼špub fn new(rpc_url: &amp;str, program_id: Pubkey) -> Self

å‚æ•°ï¼šrpc_urlï¼ˆSolanaèŠ‚ç‚¹RPCåœ°å€ï¼‰ã€program_idï¼ˆé“¾ä¸Šç¨‹åºå…¬é’¥ï¼‰
è¿”å›ï¼šSocialClientå®ä¾‹



3. æŒ‡ä»¤æšä¸¾ SocialInstruction
å®šä¹‰å®¢æˆ·ç«¯å‘é“¾ä¸Šç¨‹åºå‘é€çš„æŒ‡ä»¤ç±»å‹ï¼Œéœ€å®ç°BorshDeserializeå’ŒBorshSerializeï¼š

InitializeUser &#123; seed_type: String &#125;ï¼šåˆå§‹åŒ–ç”¨æˆ·è´¦æˆ·ï¼ˆèµ„æ–™/å¸–å­è´¦æˆ·ï¼‰
FollowUser &#123; user_to_follow: Pubkey &#125;ï¼šå…³æ³¨æŒ‡å®šç”¨æˆ·
UnfollowUser &#123; user_to_unfollow: Pubkey &#125;ï¼šå–æ¶ˆå…³æ³¨æŒ‡å®šç”¨æˆ·
QueryFollowersï¼šæŸ¥è¯¢å½“å‰ç”¨æˆ·çš„å…³æ³¨è€…åˆ—è¡¨
PostContent &#123; content: String &#125;ï¼šå‘å¸ƒæ–°å†…å®¹
QueryPostsï¼šæŸ¥è¯¢æŒ‡å®šå¸–å­å†…å®¹

å››ã€æ ¸å¿ƒåŠŸèƒ½è¯´æ˜
1. PDAç”Ÿæˆï¼ˆget_pdaå‡½æ•°ï¼‰

åŠŸèƒ½ï¼šåŸºäºç¨‹åºIDå’Œç§å­ï¼ˆseedï¼‰ç”ŸæˆProgram Derived Addressï¼ˆPDAï¼‰ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†é“¾ä¸Šè´¦æˆ·
å‚æ•°ï¼šprogram_idï¼ˆç¨‹åºå…¬é’¥ï¼‰ã€seedï¼ˆç§å­æ•°ç»„ï¼Œç”¨äºåŒºåˆ†ä¸åŒè´¦æˆ·ï¼‰
ç§å­ä½œç”¨ï¼šé€šè¿‡ä¸åŒç§å­ç”Ÿæˆå”¯ä¸€PDAï¼Œé¿å…è´¦æˆ·åœ°å€å†²çªï¼ˆä¾‹å¦‚ï¼šUSER_PROFILE_SEEDç”¨äºç”¨æˆ·èµ„æ–™è´¦æˆ·ï¼ŒUSER_POST_SEEDç”¨äºå¸–å­ç›¸å…³è´¦æˆ·ï¼‰
ä»£ç ï¼šfn get_pda(program_id: &amp;Pubkey, seed: &amp;[&amp;[u8]]) -> Pubkey &#123;
    let (pda, _bump) = Pubkey::find_program_address(seed, &amp;program_id);
    pda
&#125;


2. è´¦æˆ·åˆå§‹åŒ–ï¼ˆinitialize_userï¼‰

åŠŸèƒ½ï¼šåˆ›å»ºç”¨æˆ·çš„PDAè´¦æˆ·ï¼ˆæ”¯æŒèµ„æ–™è´¦æˆ·æˆ–å¸–å­è´¦æˆ·ï¼Œé€šè¿‡seed_typeåŒºåˆ†ï¼‰
å‚æ•°ï¼š

user_keypair: &amp;Keypairï¼šç”¨æˆ·ç­¾åå¯†é’¥å¯¹ï¼ˆäº¤æ˜“ payerï¼‰
seed_type: &amp;strï¼šç§å­ç±»å‹ï¼ˆUSER_PROFILE_SEEDæˆ–USER_POST_SEEDï¼‰


æµç¨‹ï¼š

åŸºäºç”¨æˆ·å…¬é’¥å’Œseed_typeç”ŸæˆPDA
æ„å»ºInitializeUseræŒ‡ä»¤ï¼ŒåŒ…å«ç”¨æˆ·è´¦æˆ·ã€PDAè´¦æˆ·å’Œç³»ç»Ÿç¨‹åºï¼ˆç”¨äºåˆ›å»ºè´¦æˆ·ï¼‰
å‘é€äº¤æ˜“å¹¶ç¡®è®¤


è¿”å›ï¼šResult&lt;(), Box&lt;dyn Error&gt;&gt;ï¼ˆæˆåŠŸ/é”™è¯¯ä¿¡æ¯ï¼‰

3. å…³æ³¨/å–æ¶ˆå…³æ³¨
follow_user

åŠŸèƒ½ï¼šè®©å½“å‰ç”¨æˆ·å…³æ³¨æŒ‡å®šç”¨æˆ·
å‚æ•°ï¼š

user_keypair: &amp;Keypairï¼šå½“å‰ç”¨æˆ·å¯†é’¥å¯¹
follow_user: Pubkeyï¼šè¢«å…³æ³¨ç”¨æˆ·çš„å…¬é’¥


æµç¨‹ï¼šç”Ÿæˆç”¨æˆ·èµ„æ–™PDAï¼Œå‘é€FollowUseræŒ‡ä»¤æ›´æ–°å…³æ³¨è€…åˆ—è¡¨

unfollow_user

åŠŸèƒ½ï¼šè®©å½“å‰ç”¨æˆ·å–æ¶ˆå…³æ³¨æŒ‡å®šç”¨æˆ·
å‚æ•°ï¼š

user_keypair: &amp;Keypairï¼šå½“å‰ç”¨æˆ·å¯†é’¥å¯¹
unfollow_user: Pubkeyï¼šè¢«å–æ¶ˆå…³æ³¨ç”¨æˆ·çš„å…¬é’¥


æµç¨‹ï¼šç”Ÿæˆç”¨æˆ·èµ„æ–™PDAï¼Œå‘é€UnfollowUseræŒ‡ä»¤ä»å…³æ³¨è€…åˆ—è¡¨ç§»é™¤

4. å…³æ³¨è€…æŸ¥è¯¢ï¼ˆquery_followersï¼‰

åŠŸèƒ½ï¼šæŸ¥è¯¢å½“å‰ç”¨æˆ·çš„å…³æ³¨è€…åˆ—è¡¨
å‚æ•°ï¼šuser_keypair: &amp;Keypairï¼ˆå½“å‰ç”¨æˆ·å¯†é’¥å¯¹ï¼‰
æµç¨‹ï¼šç”Ÿæˆç”¨æˆ·èµ„æ–™PDAï¼Œå‘é€QueryFollowersæŒ‡ä»¤ï¼Œç”±é“¾ä¸Šç¨‹åºè¿”å›å…³æ³¨è€…æ•°æ®

5. å†…å®¹å‘å¸ƒä¸æŸ¥è¯¢
post_content

åŠŸèƒ½ï¼šå‘å¸ƒæ–°å¸–å­
å‚æ•°ï¼š

user_keypair: &amp;Keypairï¼šå‘å¸ƒè€…å¯†é’¥å¯¹
content: Stringï¼šå¸–å­å†…å®¹
id: u64ï¼šå¸–å­å”¯ä¸€IDï¼ˆç”¨äºç”Ÿæˆå¸–å­PDAï¼‰


æµç¨‹ï¼š

ç”Ÿæˆç”¨æˆ·å¸–å­ä¸»PDAï¼ˆè®°å½•å‘å¸–æ•°é‡ï¼‰å’Œå½“å‰å¸–å­PDAï¼ˆå­˜å‚¨å†…å®¹ï¼‰
å‘é€PostContentæŒ‡ä»¤ï¼ŒåŒ…å«å†…å®¹å’Œæ—¶é—´æˆ³
é“¾ä¸Šç¨‹åºæ›´æ–°UserPostçš„post_countå¹¶å­˜å‚¨Postæ•°æ®



query_posts

åŠŸèƒ½ï¼šæŸ¥è¯¢æŒ‡å®šIDçš„å¸–å­å†…å®¹
å‚æ•°ï¼š

user_keypair: &amp;Keypairï¼šç”¨æˆ·å¯†é’¥å¯¹
id: u64ï¼šå¸–å­ID


æµç¨‹ï¼šç”Ÿæˆç”¨æˆ·å¸–å­ä¸»PDAå’Œç›®æ ‡å¸–å­PDAï¼Œå‘é€QueryPostsæŒ‡ä»¤æŸ¥è¯¢å†…å®¹

6. äº¤æ˜“å‘é€ï¼ˆsend_instructionï¼‰

åŠŸèƒ½ï¼šé€šç”¨äº¤æ˜“å‘é€å·¥å…·ï¼Œå°è£…äº¤æ˜“ç­¾åã€å‘é€å’Œç¡®è®¤é€»è¾‘
å‚æ•°ï¼š

payer: &amp;Keypairï¼šäº¤æ˜“ä»˜è´¹è€…å¯†é’¥å¯¹
instruction: Vec&lt;Instruction&gt;ï¼šå¾…æ‰§è¡Œçš„æŒ‡ä»¤åˆ—è¡¨


æµç¨‹ï¼š

è·å–æœ€æ–°åŒºå—å“ˆå¸Œï¼ˆç”¨äºäº¤æ˜“æœ‰æ•ˆæ€§ï¼‰
ç”Ÿæˆå¹¶ç­¾åäº¤æ˜“
å‘é€äº¤æ˜“å¹¶ç­‰å¾…ç¡®è®¤ï¼Œè¿”å›ç­¾åä¿¡æ¯



äº”ã€ä½¿ç”¨ç¤ºä¾‹
ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå®¢æˆ·ç«¯æ ¸å¿ƒåŠŸèƒ½çš„è°ƒç”¨æµç¨‹ï¼ˆå‚è€ƒmainå‡½æ•°ï¼‰ï¼š
// 1. åˆå§‹åŒ–å®¢æˆ·ç«¯
let program_id = Pubkey::from_str("9ti8R5H2Ru5553wi419aj2h5cZJbbJEk6zr8insVphJe")?; // é“¾ä¸Šç¨‹åºå…¬é’¥
let user_keypair = read_keypair_file("/Users/tinachan/.config/solana/id.json")?; // åŠ è½½ç”¨æˆ·å¯†é’¥å¯¹
let client = SocialClient::new("http://127.0.0.1:8899", program_id); // è¿æ¥æœ¬åœ°æµ‹è¯•ç½‘

// 2. åˆå§‹åŒ–ç”¨æˆ·èµ„æ–™è´¦æˆ·
client.initialize_user(&amp;user_keypair, USER_PROFILE_SEED)?;

// 3. å…³æ³¨æŒ‡å®šç”¨æˆ·
let follow_user = Pubkey::from_str("2tQibfGH1UX4PEA1dNWJ8zvnpSbKRBr5a5eVhaRxF6EX")?;
client.follow_user(&amp;user_keypair, follow_user)?;

// 4. æŸ¥è¯¢å…³æ³¨è€…åˆ—è¡¨
client.query_followers(&amp;user_keypair)?;

// 5. å–æ¶ˆå…³æ³¨
client.unfollow_user(&amp;user_keypair, follow_user)?;

// 6. åˆå§‹åŒ–å¸–å­è´¦æˆ·
client.initialize_user(&amp;user_keypair, USER_POST_SEED)?;

// 7. å‘å¸ƒå¸–å­
client.post_content(&amp;user_keypair, "Hello, world!".into(), 1)?;

// 8. æŸ¥è¯¢å¸–å­
client.query_posts(&amp;user_keypair, 1)?;
å…­ã€æ³¨æ„äº‹é¡¹

åºåˆ—åŒ–å¿…è¦æ€§ï¼šæ‰€æœ‰é“¾ä¸Šæ•°æ®ï¼ˆå¦‚UserProfileã€SocialInstructionï¼‰éœ€é€šè¿‡borshåºåˆ—åŒ–ï¼Œå› ä¸ºSolanaé“¾ä¸Šç¨‹åºä»…èƒ½å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œä¸”borshæ˜¯Solanaç”Ÿæ€çš„æ ‡å‡†åºåˆ—åŒ–æ–¹å¼ã€‚
PDAå”¯ä¸€æ€§ï¼šç§å­ï¼ˆseedï¼‰éœ€ç¡®ä¿å”¯ä¸€ï¼Œé¿å…ä¸åŒç±»å‹è´¦æˆ·åœ°å€å†²çªï¼ˆä¾‹å¦‚ç”¨æˆ·èµ„æ–™å’Œå¸–å­è´¦æˆ·éœ€ä½¿ç”¨ä¸åŒç§å­ï¼‰ã€‚
é”™è¯¯å¤„ç†ï¼šæ‰€æœ‰æ–¹æ³•è¿”å›Resultç±»å‹ï¼Œéœ€å¤„ç†å¯èƒ½çš„é”™è¯¯ï¼ˆå¦‚RPCè¿æ¥å¤±è´¥ã€äº¤æ˜“ç¡®è®¤è¶…æ—¶ã€è´¦æˆ·æœªåˆå§‹åŒ–ç­‰ï¼‰ã€‚
æµ‹è¯•ç¯å¢ƒï¼šç¤ºä¾‹ä¸­ä½¿ç”¨æœ¬åœ°æµ‹è¯•ç½‘ï¼ˆhttp://127.0.0.1:8899ï¼‰ï¼Œæ­£å¼ç¯å¢ƒéœ€åˆ‡æ¢ä¸ºSolanaä¸»ç½‘æˆ–devnet RPCåœ°å€ã€‚

]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part8]_Solana ç”Ÿæ€ä¸­çš„åè®®ä¸æ ‡å‡†åº“</title>
    <url>/2025/08/12/Solana-part8-Solana-%E7%94%9F%E6%80%81%E4%B8%AD%E7%9A%84%E5%8D%8F%E8%AE%AE%E4%B8%8E%E6%A0%87%E5%87%86%E5%BA%93/</url>
    <content><![CDATA[Solana[part8]_Solana ç”Ÿæ€ä¸­çš„åè®®ä¸æ ‡å‡†åº“
ä¸€ã€åè®®åŸºç¡€ï¼šå®šä¹‰ä¸ç”Ÿæ€å·®å¼‚
1.1 åŒºå—é“¾åè®®çš„æœ¬è´¨
åŒºå—é“¾åè®®æ˜¯å®šä¹‰ç½‘ç»œäº¤äº’è§„åˆ™ã€æ•°æ®ç»“æ„å’Œä¸šåŠ¡é€»è¾‘çš„è§„èŒƒï¼Œæ˜¯æ™ºèƒ½åˆçº¦å’Œåº”ç”¨çš„â€œåº•å±‚è§„åˆ™é›†â€ã€‚ä¾‹å¦‚ï¼š

ä»£å¸åè®®è§„å®šèµ„äº§çš„å‘è¡Œï¼ˆMintï¼‰ã€è½¬ç§»ï¼ˆTransferï¼‰ã€é”€æ¯ï¼ˆBurnï¼‰ é€»è¾‘ï¼›
Swapåè®®å®šä¹‰ä¸¤ç§èµ„äº§çš„å…‘æ¢è§„åˆ™ï¼ˆå¦‚ä»·æ ¼ç®—æ³•ã€æµåŠ¨æ€§æ± äº¤äº’ï¼‰ã€‚
ç±»æ¯”äº’è”ç½‘ï¼šå¦‚åŒHTTPåè®®è§„å®šç½‘é¡µä¼ è¾“è§„åˆ™ï¼ŒåŒºå—é“¾åè®®å®šä¹‰â€œä»·å€¼ä¸é€»è¾‘â€çš„ä¼ è¾“æ ‡å‡†ã€‚

1.2 ä¸åŒå…¬é“¾åè®®çš„æ ¸å¿ƒå·®å¼‚
ä»¥ ä»¥å¤ªåŠï¼ˆERCæ ‡å‡†ï¼‰ å’Œ Solanaï¼ˆSPLæ ‡å‡†ï¼‰ å¯¹æ¯”ï¼š



ç»´åº¦
ä»¥å¤ªåŠï¼ˆERCï¼‰
Solanaï¼ˆSPLï¼‰




åº•å±‚æ¶æ„
è´¦æˆ·æ¨¡å‹ï¼ˆEOA+åˆçº¦è´¦æˆ·ï¼‰ï¼Œå•çº¿ç¨‹æ‰§è¡Œ
è´¦æˆ·æ¨¡å‹ï¼ˆå¯æ‰§è¡Œ+æ•°æ®è´¦æˆ·ï¼Œå…³è”è´¦æˆ·ï¼‰ï¼Œå¹¶è¡Œæ‰§è¡Œï¼ˆSealevelï¼‰


å¼€å‘è¯­è¨€
Solidity
Rust


æ€§èƒ½å¯¼å‘
é€šç”¨æ€§ä¼˜å…ˆï¼ˆç‰ºç‰²éƒ¨åˆ†æ•ˆç‡ï¼‰
é«˜æ€§èƒ½ä¼˜å…ˆï¼ˆé«˜TPSã€ä½å»¶è¿Ÿï¼‰


åè®®è®¾è®¡
çµæ´»ï¼ˆå¦‚ERC-721Aä¼˜åŒ–NFTæ‰¹é‡Mintï¼‰
é«˜æ•ˆï¼ˆå¦‚SPL-Tokenæ”¯æŒå¹¶è¡Œè½¬ç§»ï¼‰



äºŒã€Solanaæ ¸å¿ƒåè®®è§£æï¼ˆSPLä½“ç³»ï¼‰
Solanaçš„åè®®å¤šé€šè¿‡ Solana Program Libraryï¼ˆSPLï¼Œæ ‡å‡†ç¨‹åºåº“ï¼‰ å®ç°ï¼Œä»¥ä¸‹æ˜¯æ ¸å¿ƒåè®®æ‹†è§£ï¼š
2.1 ä»£å¸åè®®ï¼šSPL-Token &amp; æ‰©å±•
ï¼ˆ1ï¼‰SPL-Tokenï¼ˆåŸºç¡€ç‰ˆï¼‰

åŠŸèƒ½ï¼šå‘è¡Œå¯æ›¿ä»£ä»£å¸ï¼ˆFungible Tokenï¼‰ï¼Œæ”¯æŒ Mintï¼ˆå¢å‘ï¼‰ã€Transferï¼ˆè½¬ç§»ï¼‰ã€Burnï¼ˆé”€æ¯ï¼‰ã€Approvalï¼ˆæˆæƒï¼‰ç­‰æ“ä½œã€‚
è´¦æˆ·æ¨¡å‹ï¼š

Mintè´¦æˆ·ï¼šè®°å½•ä»£å¸æ€»ä¾›åº”é‡ã€å°æ•°ä½ã€å‘è¡Œæ–¹ç­‰æ ¸å¿ƒä¿¡æ¯ï¼›
ä»£å¸è´¦æˆ·ï¼šç”¨æˆ·æŒæœ‰ä»£å¸çš„è½½ä½“ï¼ˆé»˜è®¤ä¸åˆ›å»ºï¼Œéœ€é€šè¿‡å…³è”è´¦æˆ·æœºåˆ¶ç”Ÿæˆï¼‰ã€‚


ç±»æ¯”ï¼šç±»ä¼¼ä»¥å¤ªåŠERC-20ï¼Œä½†å€ŸåŠ©Solanaå¹¶è¡Œå¤„ç†ï¼Œæ‰¹é‡è½¬ç§»æ•ˆç‡æ›´é«˜ã€‚

ï¼ˆ2ï¼‰SPL-Associated Token Accountï¼ˆATAï¼Œå…³è”è´¦æˆ·ï¼‰

ä½œç”¨ï¼šä¸º ç”¨æˆ·ä¸»è´¦æˆ· + ä»£å¸Mintåœ°å€ è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€å…³è”ä»£å¸è´¦æˆ·ï¼Œç»Ÿä¸€ç®¡ç†è¯¥ä»£å¸çš„ä½™é¢ã€‚
ä¼˜åŠ¿ï¼šé¿å…ç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºå¤šä¸ªä»£å¸è´¦æˆ·ï¼ˆå¦‚ä»¥å¤ªåŠéœ€ä¸ºæ¯ä¸ªERC-20ä»£å¸å•ç‹¬æˆæƒï¼‰ï¼Œç®€åŒ–èµ„äº§ç®¡ç†ã€‚

ï¼ˆ3ï¼‰SPL-Token 2022ï¼ˆå¢å¼ºç‰ˆï¼‰

æ–°å¢ç‰¹æ€§ï¼šå¯é€‰çš„å†»ç»“ï¼ˆFreezeï¼‰å’Œé”å®šï¼ˆLockingï¼‰æœºåˆ¶ï¼š

å†»ç»“ï¼šç®¡ç†å‘˜ï¼ˆå¦‚é¡¹ç›®æ–¹ï¼‰å¯å†»ç»“ç‰¹å®šATAçš„ä»£å¸è½¬ç§»ï¼Œç”¨äºåˆè§„ç®¡æ§ï¼ˆå¦‚é˜²æ­¢é»‘é’±äº¤æ˜“ï¼‰æˆ–é¡¹ç›®æ²»ç†ï¼›
é”å®šï¼šè®¾å®šä»£å¸è§£é”æ¡ä»¶ï¼ˆå¦‚ æ—¶é—´é”ï¼šå›¢é˜Ÿä»£å¸åˆ†é˜¶æ®µè§£é”ï¼›é€»è¾‘é”ï¼šæ»¡è¶³æŸæ¡ä»¶æ‰å…è®¸è½¬ç§»ï¼‰ï¼Œé€‚é…ç§å‹Ÿã€vestingè®¡åˆ’ç­‰åœºæ™¯ã€‚



2.2 äº¤äº’åè®®ï¼šä»Memoåˆ°Governance
ï¼ˆ1ï¼‰Memoï¼ˆäº¤æ˜“å¤‡æ³¨ï¼‰

åŠŸèƒ½ï¼šåœ¨Solanaäº¤æ˜“ä¸­é™„åŠ æ–‡æœ¬ä¿¡æ¯ï¼ˆå¦‚â€œè®¢å•ID#123â€ã€â€œNFTè´­ä¹°â€ï¼‰ï¼Œè™½ä¸å½±å“äº¤æ˜“é€»è¾‘ï¼Œä½†å¯ä½œä¸ºé“¾ä¸Šå®¡è®¡æˆ–äº¤äº’è®°å½•ã€‚
åº”ç”¨ï¼šDEXäº¤æ˜“è®°å½•è®¢å•ä¿¡æ¯ã€NFTå¸‚åœºè®°å½•è´­ä¹°å¤‡æ³¨ã€‚

ï¼ˆ2ï¼‰Name Serviceï¼ˆåŸŸåæœåŠ¡ï¼Œå¦‚SNSï¼‰

åŠŸèƒ½ï¼šå°†å¤æ‚çš„Solanaåœ°å€ï¼ˆå¦‚ 8X...yzï¼‰æ˜ å°„ä¸ºæ˜“è®°åŸŸåï¼ˆå¦‚ user.solï¼‰ï¼Œæ–¹ä¾¿è½¬è´¦å’Œç¤¾äº¤å±•ç¤ºã€‚
ç±»æ¯”ï¼šç±»ä¼¼ä»¥å¤ªåŠENSï¼ˆ.ethï¼‰ï¼Œä½†Solanaçš„SNSæ›´è½»é‡ï¼Œç»“åˆé“¾ä¸Šå­˜å‚¨å®ç°ã€‚

ï¼ˆ3ï¼‰Swapåè®®ï¼ˆå¦‚Serumçš„SPL Swapï¼‰

æœºåˆ¶ï¼šå®ç°ä¸¤ç§ä»£å¸çš„å…‘æ¢ï¼Œæ”¯æŒ è®¢å•ç°¿æ¨¡å¼ï¼ˆå¦‚Serumï¼‰æˆ– AMMæ¨¡å¼ï¼ˆè‡ªåŠ¨åšå¸‚å•†ï¼Œå¦‚Raydiumï¼‰ã€‚
æ ¸å¿ƒï¼šé€šè¿‡SPL-Tokençš„Transferæ¥å£ï¼Œç»“åˆä»·æ ¼ç®—æ³•ï¼ˆå¦‚æ’å®šä¹˜ç§¯å…¬å¼ï¼‰ï¼Œå®ç°å»ä¸­å¿ƒåŒ–äº¤æ˜“ã€‚

ï¼ˆ4ï¼‰Stakingï¼ˆè´¨æŠ¼åè®®ï¼‰

æµç¨‹ï¼šç”¨æˆ·å°†ä»£å¸è´¨æŠ¼ç»™éªŒè¯è€…æˆ–è´¨æŠ¼æ± ï¼Œè·å–è´¨æŠ¼æ”¶ç›Šï¼ˆå¦‚SOLä»£å¸è´¨æŠ¼è·å¾—é€šèƒ€å¥–åŠ±ï¼‰ã€‚
åè®®é€»è¾‘ï¼šæ¶‰åŠ å§”æ‰˜ï¼ˆDelegateï¼‰ã€è§£ç»‘ï¼ˆUnstakeï¼Œå«è§£é”æœŸï¼‰ã€æ”¶ç›Šåˆ†å‘ï¼Œä¿éšœSolanaç½‘ç»œçš„PoSå…±è¯†å®‰å…¨ã€‚

ï¼ˆ5ï¼‰Governanceï¼ˆæ²»ç†åè®®ï¼Œå¦‚Realmsï¼‰

åŠŸèƒ½ï¼šç¤¾åŒºæŠ•ç¥¨å†³å®šåè®®å‡çº§ã€èµ„é‡‘åˆ†é…ç­‰ï¼Œé€šå¸¸ç»“åˆâ€œæ²»ç†ä»£å¸â€ï¼ˆå¦‚$SRMç”¨äºSerumæ²»ç†ï¼‰ã€‚
æµç¨‹ï¼šææ¡ˆåˆ›å»º â†’ ä»£å¸åŠ æƒæŠ•ç¥¨ â†’ é€šè¿‡CPIè°ƒç”¨æ‰§è¡Œç¨‹åºï¼ˆå¦‚è½¬ç§»ç¤¾åŒºé‡‘åº“èµ„é‡‘ï¼‰ã€‚

ï¼ˆ6ï¼‰Flash Loansï¼ˆé—ªç”µè´·ï¼‰

åŸç†ï¼šåœ¨åŒä¸€åŸå­äº¤æ˜“ä¸­ï¼Œç”¨æˆ·å¯æ— æŠµæŠ¼å€Ÿå‡ºèµ„äº§ï¼Œå‰ææ˜¯â€œå€Ÿå‡ºâ†’ä½¿ç”¨â†’å¿è¿˜â€å…¨æµç¨‹å®Œæˆï¼ˆå¦åˆ™äº¤æ˜“å›æ»šï¼‰ã€‚
åº”ç”¨ï¼šå¥—åˆ©ï¼ˆè·¨äº¤æ˜“æ‰€ä»·æ ¼å·®ï¼‰ã€ä¸´æ—¶èµ„é‡‘åˆ©ç”¨ï¼Œä¾èµ–Solanaé«˜TPSå’Œä½å»¶è¿Ÿå®ç°é«˜æ•ˆæ“ä½œã€‚

ä¸‰ã€Solanaæ ‡å‡†åº“ï¼ˆSPLï¼‰çš„æ ¸å¿ƒä»·å€¼ï¼šæ¨¡å—åŒ–ä¸CPI
3.1 æ¨¡å—åŒ–å¼€å‘ï¼šç«™åœ¨å·¨äººè‚©è†€ä¸Š

SPLå®šä½ï¼šSolanaå®˜æ–¹ç»´æŠ¤çš„æ ‡å‡†ç¨‹åºåº“ï¼Œæä¾›ç»è¿‡å®¡è®¡ã€é«˜æ€§èƒ½çš„åŸºç¡€æ¨¡å—ï¼ˆå¦‚tokenã€swapã€æ²»ç†ï¼‰ã€‚
å¼€å‘è€…æ”¶ç›Šï¼š

æ— éœ€ä»å¤´å¼€å‘ä»£å¸ç³»ç»Ÿï¼Œç›´æ¥è°ƒç”¨ SPL-Token æ¥å£ï¼›
å¼€å‘DEXæ—¶ï¼Œå¤ç”¨ SPL-Swap çš„å…‘æ¢é€»è¾‘ï¼ŒèŠ‚çœæ—¶é—´å’Œå®‰å…¨æˆæœ¬ã€‚


æ¡ˆä¾‹ï¼šNFTå¹³å°å¯å¤ç”¨SPL-Tokenï¼ˆæ‰‹ç»­è´¹ä»£å¸ï¼‰å’ŒMetaplex NFTæ ‡å‡†ï¼ˆåŸºäºSPLå¼€å‘ï¼Œç®¡ç†NFTå…ƒæ•°æ®ï¼‰ã€‚

3.2 è·¨ç¨‹åºè°ƒç”¨ï¼ˆCPIï¼‰ï¼šç¨‹åºé—´çš„â€œåä½œé­”æ³•â€

å®šä¹‰ï¼šSolanaå…è®¸ä¸€ä¸ªæ™ºèƒ½åˆçº¦ï¼ˆç¨‹åºï¼‰è°ƒç”¨å¦ä¸€ä¸ªç¨‹åºçš„æŒ‡ä»¤ï¼Œæ‰€æœ‰æ“ä½œåœ¨åŒä¸€åŸå­äº¤æ˜“ä¸­æ‰§è¡Œï¼ˆè¦ä¹ˆå…¨æˆï¼Œè¦ä¹ˆå…¨è´¥ï¼‰ã€‚
åº”ç”¨åœºæ™¯ï¼š

DEXäº¤æ˜“ï¼šSwapç¨‹åºè°ƒç”¨SPL-Tokençš„TransferæŒ‡ä»¤ï¼Œå®Œæˆä»£å¸å…‘æ¢ï¼›
å€Ÿè´·åè®®ï¼šå€Ÿè´·ç¨‹åºè°ƒç”¨SPL-Tokenè½¬ç§»æŠµæŠ¼å“ï¼ŒåŒæ—¶è°ƒç”¨ä»·æ ¼é¢„è¨€æœºç¨‹åºè·å–èµ„äº§ä»·æ ¼ï¼›
æ²»ç†æ‰§è¡Œï¼šGovernanceç¨‹åºé€šè¿‡CPIè°ƒç”¨SPL-Tokenè½¬ç§»ç¤¾åŒºé‡‘åº“èµ„é‡‘ã€‚


ä¼˜åŠ¿ï¼šå®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚â€œè´¨æŠ¼+å€Ÿè´·+Swapâ€ç»„åˆæ“ä½œï¼‰ï¼ŒåŒæ—¶é€šè¿‡åŸå­æ€§é¿å…ä¸­é—´çŠ¶æ€é£é™©ã€‚

å››ã€æ€»ç»“ï¼šåè®®ä¸æ ‡å‡†åº“çš„ç”Ÿæ€æ„ä¹‰

åè®®æ˜¯è§„åˆ™åŸºçŸ³ï¼šå®šä¹‰èµ„äº§ã€äº¤äº’ã€æ²»ç†çš„æ ‡å‡†ï¼Œè®©ä¸åŒåº”ç”¨äº’æ“ä½œï¼ˆå¦‚ä¸åŒDEXéƒ½ç”¨SPL-Swapï¼Œç”¨æˆ·èµ„äº§é€šç”¨ï¼‰ã€‚
SPLæ˜¯å¼€å‘åŠ é€Ÿå™¨ï¼šæ¨¡å—åŒ–è®¾è®¡å’ŒCPIæœºåˆ¶ï¼Œé™ä½å¼€å‘é—¨æ§›ï¼Œä¿ƒè¿›ç”Ÿæ€ç¹è£ï¼ˆå¦‚å¤§é‡é¡¹ç›®åŸºäºSPLå¿«é€Ÿè¿­ä»£ï¼‰ã€‚
å¯¹æ¯”ä¸å±•æœ›ï¼šä¸ä»¥å¤ªåŠERCä½“ç³»ç›¸æ¯”ï¼ŒSolanaçš„SPLæ›´æ³¨é‡æ€§èƒ½å’Œå¹¶è¡Œï¼›éšç€SPL-Token 2022ç­‰å‡çº§ï¼Œåœ¨åˆè§„ã€å¤æ‚èµ„äº§ç®¡ç†ä¸Šä¼šæ›´çµæ´»ã€‚

é™„å½•ï¼šå…³é”®æœ¯è¯­é€ŸæŸ¥è¡¨



æœ¯è¯­
è§£é‡Š




SPL
Solana Program Libraryï¼ˆSolanaæ ‡å‡†ç¨‹åºåº“ï¼‰


ATA
Associated Token Accountï¼ˆå…³è”ä»£å¸è´¦æˆ·ï¼‰


CPI
Cross Program Invocationï¼ˆè·¨ç¨‹åºè°ƒç”¨ï¼‰


Mint Account
ä»£å¸å‘è¡Œè´¦æˆ·ï¼ˆè®°å½•æ€»ä¾›åº”é‡ã€å°æ•°ä½ç­‰ï¼‰


Vesting
ä»£å¸é”å®šè®¡åˆ’ï¼ˆå¦‚å›¢é˜Ÿä»£å¸åˆ†é˜¶æ®µè§£é”ï¼‰



]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana[part9]_Anchorå…¥é—¨&amp;è´¦æˆ·çš„æ¦‚å¿µå’Œç”¨æ³•</title>
    <url>/2025/08/13/Solana-part9-Anchor%E5%85%A5%E9%97%A8-%E8%B4%A6%E6%88%B7%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E7%94%A8%E6%B3%95-1/</url>
    <content><![CDATA[Solana[part9]_Anchorå…¥é—¨&amp;è´¦æˆ·çš„æ¦‚å¿µå’Œç”¨æ³•
ä¸€ã€Anchoræ¡†æ¶æ¦‚è¿°
Anchoræ˜¯SolanaåŒºå—é“¾ç”Ÿæ€ä¸­ç”¨äºç®€åŒ–æ™ºèƒ½åˆçº¦å¼€å‘çš„æ ¸å¿ƒæ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå°†å¤æ‚çš„è´¦æˆ·éªŒè¯é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œé€šè¿‡å£°æ˜å¼è¯­æ³•é™ä½å¼€å‘é—¨æ§›ã€‚Anchoræä¾›äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

è´¦æˆ·éªŒè¯ï¼šé€šè¿‡#[account]å®å®šä¹‰è´¦æˆ·ç»“æ„ï¼Œè‡ªåŠ¨éªŒè¯è´¦æˆ·çŠ¶æ€
æŒ‡ä»¤åˆ†ç¦»ï¼šå°†äº¤æ˜“é€»è¾‘æ‹†åˆ†ä¸ºç‹¬ç«‹çš„æŒ‡ä»¤å¤„ç†å‡½æ•°
PDAç®¡ç†ï¼šå†…ç½®å¯¹Program Derived Addressesï¼ˆPDAï¼‰çš„æ”¯æŒ
é”™è¯¯å¤„ç†ï¼šè‡ªå®šä¹‰é”™è¯¯ç±»å‹åŠå‹å¥½çš„é”™è¯¯æç¤º

å®‰è£…ä¸é…ç½®
# å®‰è£…Anchor CLI
cargo install --git https://github.com/coral-xyz/anchor anchor-cli --locked

# åˆå§‹åŒ–é¡¹ç›®
anchor init my_project
cd my_project
äºŒã€PDAï¼ˆProgram Derived Addressï¼‰æ ¸å¿ƒæ¦‚å¿µ
PDAæ˜¯Solanaä¸­ä¸€ç§ç‰¹æ®Šçš„è´¦æˆ·åœ°å€ï¼Œå…¶ç”ŸæˆåŸºäºç‰¹å®šçš„ç§å­ï¼ˆseedsï¼‰å’Œç¨‹åºIDï¼ˆProgram IDï¼‰ã€‚ä¸æ™®é€šè´¦æˆ·çš„åŒºåˆ«åœ¨äºï¼š

æ— ç§é’¥æ§åˆ¶ï¼šPDAåœ°å€æ— æ³•é€šè¿‡ç§é’¥ç­¾åï¼Œåªèƒ½ç”±å…³è”ç¨‹åºæ“ä½œ
ç¡®å®šæ€§ç”Ÿæˆï¼šç›¸åŒç§å­å’Œç¨‹åºIDç”Ÿæˆçš„PDAåœ°å€å”¯ä¸€
å®‰å…¨å­˜å‚¨ï¼šç”¨äºå­˜å‚¨ç¨‹åºä¸“å±æ•°æ®ï¼Œé˜²æ­¢å¤–éƒ¨ç¯¡æ”¹

PDAç”Ÿæˆå…¬å¼
use anchor_lang::prelude::*;

fn derive_pda(seeds: &amp;[&amp;[u8]], program_id: &amp;Pubkey) -> (Pubkey, u8) &#123;
    Pubkey::find_program_address(seeds, program_id)
&#125;
ä¸‰ã€Anchorä¸­ä½¿ç”¨PDAçš„å…¸å‹åœºæ™¯

å“ˆå¸Œè¡¨ç»“æ„ï¼šé€šè¿‡ç§å­ç»„åˆå®ç°é”®å€¼å¯¹å­˜å‚¨
æƒé™æ§åˆ¶ï¼šä½œä¸ºç¨‹åºä¸“å±ç­¾åè€…
çŠ¶æ€éš”ç¦»ï¼šä¸åŒä¸šåŠ¡é€»è¾‘ä½¿ç”¨ç‹¬ç«‹PDAè´¦æˆ·

ç¤ºä¾‹ï¼šåˆ›å»ºPDAè´¦æˆ·
use anchor_lang::solana_program::system_program;

#[derive(Accounts)]
pub struct CreatePdaAccount&lt;'info> &#123;
    #[account(mut)]
    pub user: Signer&lt;'info>,
    #[account(
        init,
        seeds = [b"user_stats", user.key().as_ref()],
        bump,
        payer = user,
        space = 8 + std::mem::size_of::&lt;UserStats>(),
        program = my_program::ID
    )]
    pub user_stats: Account&lt;'info, UserStats>,
    pub system_program: Program&lt;'info, System>,
&#125;

#[derive(Default, AnchorSerialize, AnchorDeserialize)]
pub struct UserStats &#123;
    pub level: u16,
    pub name: String,
&#125;
å››ã€PDAè´¦æˆ·æ“ä½œè¯¦è§£

åˆå§‹åŒ–è´¦æˆ·
é€šè¿‡initçº¦æŸè‡ªåŠ¨åˆ›å»ºPDAè´¦æˆ·å¹¶åˆ†é…å­˜å‚¨ç©ºé—´ï¼š

#[derive(Accounts)]
pub struct InitPda&lt;'info> &#123;
    #[account(mut)]
    pub authority: Signer&lt;'info>,
    #[account(
        init,
        seeds = [b"pda", authority.key().as_ref()],
        bump,
        payer = authority,
        space = 8 + 32,
        program = my_program::ID
    )]
    pub pda_account: Account&lt;'info, PdaData>,
    pub system_program: Program&lt;'info, System>,
&#125;

é‡æ–°åˆ†é…ç©ºé—´
ä½¿ç”¨reallocçº¦æŸåŠ¨æ€è°ƒæ•´è´¦æˆ·å­˜å‚¨ï¼š

#[derive(Accounts)]
pub struct ReallocPda&lt;'info> &#123;
    #[account(
        mut,
        realloc,
        realloc::payer = authority,
        realloc::zero = false,
    )]
    pub pda_account: Account&lt;'info, PdaData>,
    #[account(mut)]
    pub authority: Signer&lt;'info>,
    pub system_program: Program&lt;'info, System>,
&#125;

å…³é—­è´¦æˆ·
é€šè¿‡closeçº¦æŸé‡Šæ”¾è´¦æˆ·èµ„æºï¼š

#[derive(Accounts)]
pub struct ClosePda&lt;'info> &#123;
    #[account(
        mut,
        close = authority,
    )]
    pub pda_account: Account&lt;'info, PdaData>,
    #[account(mut)]
    pub authority: Signer&lt;'info>,
&#125;
äº”ã€PDAå®‰å…¨æœ€ä½³å®è·µ

ç§å­è®¾è®¡åŸåˆ™


é¿å…ä½¿ç”¨å¯å˜å‚æ•°ä½œä¸ºä¸»ç§å­
å…³é”®ä¸šåŠ¡ä½¿ç”¨å¤åˆç§å­ï¼ˆå¦‚[b&quot;order&quot;, order_id.as_ref(), user.key().as_ref()]ï¼‰
æ•æ„Ÿæ“ä½œæ·»åŠ æ—¶é—´æˆ³æˆ–éšæœºæ•°ç§å­


Bumpå€¼ç®¡ç†


ä½¿ç”¨canonical bumpï¼ˆé»˜è®¤255ï¼‰ç®€åŒ–å¼€å‘
å¤æ‚åœºæ™¯å¯è‡ªå®šä¹‰bumpå€¼éªŒè¯
é€šè¿‡Pubkey::find_program_addressé¢„è®¡ç®—åœ°å€


æƒé™æ§åˆ¶


é™åˆ¶PDAæ“ä½œæƒé™åˆ°ç‰¹å®šæŒ‡ä»¤
ä½¿ç”¨#[access_control]å®å®ç°ç»†ç²’åº¦è®¿é—®æ§åˆ¶

å…­ã€å…¸å‹åº”ç”¨æ¡ˆä¾‹

è·¨é“¾èµ„äº§æ‰˜ç®¡

// ç”Ÿæˆæ‰˜ç®¡PDAåœ°å€
let (escrow_pda, _) = Pubkey::find_program_address(
    &amp;[b"escrow", token_mint.as_ref(), buyer.as_ref(), seller.as_ref()],
    program_id,
);

// æ‰˜ç®¡èµ„é‡‘è½¬ç§»
transfer(
    CpiContext::new(
        token_program.to_account_info(),
        Transfer &#123;
            from: user_wallet.to_account_info(),
            to: escrow_pda.to_account_info(),
            authority: user_wallet.to_account_info(),
        &#125;,
    ),
    amount,
);

å¯éªŒè¯éšæœºæ•°ç”Ÿæˆ

// ç”Ÿæˆéšæœºæ•°PDA
let (random_pda, _) = Pubkey::find_program_address(
    &amp;[b"random", user.key().as_ref(), blockhash.as_ref()],
    program_id,
);

// å­˜å‚¨éšæœºæ•°ç»“æœ
random_pda_account.value = calculate_hash(random_seed);
ä¸ƒã€å¼€å‘å·¥å…·é“¾æ”¯æŒ

Anchor IDLç”Ÿæˆ

anchor idl generate

å®¢æˆ·ç«¯SDKé›†æˆ

import &#123; Program, web3 &#125; from '@project-serum/anchor';
import &#123; MyProgram &#125; from '../target/types/my_program';

const program = new Program&lt;MyProgram>(
    idl,
    new web3.PublicKey('PROGRAM_ID'),
    provider
);

// è®¡ç®—PDAåœ°å€
const [pdaAddress, bump] = await web3.PublicKey.findProgramAddress(
    [Buffer.from('user_stats'), user.publicKey.toBuffer()],
    program.programId
);
å…«ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

PDAåœ°å€ä¸åŒ¹é…


æ£€æŸ¥ç§å­é¡ºåºåŠç¼–ç æ ¼å¼
ç¡®è®¤ç¨‹åºIDæ˜¯å¦æ­£ç¡®
ä½¿ç”¨solana address -k ~/.config/solana/id.jsonéªŒè¯åœ°å€ç”Ÿæˆ


è´¦æˆ·ç©ºé—´ä¸è¶³


é¢„è®¡ç®—æ‰€éœ€å­˜å‚¨ç©ºé—´ï¼ˆ8å­—èŠ‚ç³»ç»Ÿå¼€é”€ + æ•°æ®ç»“æ„å¤§å°ï¼‰
ä½¿ç”¨reallocåŠ¨æ€è°ƒæ•´ç©ºé—´
é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯è´¦æˆ·


ç­¾åæƒé™é—®é¢˜


ç¡®ä¿PDAæ“ä½œæŒ‡ä»¤åŒ…å«æ­£ç¡®çš„æˆæƒè´¦æˆ·
æ£€æŸ¥#[account]å®ä¸­çš„signerçº¦æŸ
ä½¿ç”¨invoke_signedè¿›è¡ŒPDAç­¾åæ¨¡æ‹Ÿ

ä¹ã€å»¶ä¼¸å­¦ä¹ èµ„æº

å®˜æ–¹æ–‡æ¡£


Anchor Book
Solana PDAæŒ‡å—


å®æˆ˜é¡¹ç›®


Anchorç¤ºä¾‹ä»“åº“
Solana Cookbook PDAç« èŠ‚


ç¤¾åŒºæ”¯æŒ


Solana Stack Exchange
Anchor Discordé¢‘é“

]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Solana é¡¹ç›®æ„å»ºé—®é¢˜ï¼šå·¥å…·é“¾ç‰ˆæœ¬ä¸å…¼å®¹</title>
    <url>/2025/09/22/Solana-%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E9%97%AE%E9%A2%98%EF%BC%9A%E5%B7%A5%E5%85%B7%E9%93%BE%E7%89%88%E6%9C%AC%E4%B8%8D%E5%85%BC%E5%AE%B9/</url>
    <content><![CDATA[è§£å†³ Rust ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜  error: rustc 1.79.0-dev is not supported by the following packages:
é—®é¢˜èƒŒæ™¯
åœ¨å¼€å‘ Solana Anchor é¡¹ç›®æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°å·¥å…·é“¾ç‰ˆæœ¬ä¸å…¼å®¹çš„é—®é¢˜ã€‚æœ¬æ–‡æ¡£è®°å½•äº†ä¸€æ¬¡å…¸å‹çš„å·¥å…·é“¾é‡è£…è¿‡ç¨‹ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å¿«é€Ÿè§£å†³ç±»ä¼¼çš„ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚
é—®é¢˜ç°è±¡
1. åˆå§‹ç¼–è¯‘é”™è¯¯
Error: Function _ZN131_$LT$solana_program_ed25519_dalek_bump..instruction..InstructionError$u20$as$u20$solana_frozen_abi..abi_example..AbiEnumVisitor$GT$13visit_for_abi17h93da246eef4af815E Stack offset of 6592 exceeded max offset of 4096 by 2496 bytes, please minimize large stack variables. Estimated function frame size: 6656 bytes. Exceeding the maximum stack offset may cause undefined behavior during execution.
2. Rust ç‰ˆæœ¬å…¼å®¹æ€§é”™è¯¯
error: rustc 1.79.0-dev is not supported by the following packages:
  base64ct@1.7.3 requires rustc 1.81
  solana-address@1.0.0 requires rustc 1.81.0
  solana-hash@3.0.0 requires rustc 1.81.0
  solana-instruction-error@2.0.0 requires rustc 1.81.0
  solana-program@3.0.0 requires rustc 1.81.0
  solana-program-entrypoint@3.1.0 requires rustc 1.81.0
  solana-program-error@3.0.0 requires rustc 1.81.0
  solana-pubkey@3.0.0 requires rustc 1.81.0
  solana-sanitize@3.0.1 requires rustc 1.81.0
3. Cargo.lock ç‰ˆæœ¬é—®é¢˜
error: failed to parse lock file at: &#x2F;Users&#x2F;tinachan&#x2F;temple&#x2F;anchor&#x2F;Cargo.lock

Caused by:
  lock file version 4 requires &#96;-Znext-lockfile-bump&#96;
é—®é¢˜æ ¹æºåˆ†æ

æ ˆå†…å­˜æº¢å‡ºï¼šAnchor ç¨‹åºä¸­çš„è´¦æˆ·ç»“æ„ä½“è¿‡å¤§ï¼Œè¶…è¿‡äº† Solana çš„ 4096 å­—èŠ‚æ ˆé™åˆ¶
å·¥å…·é“¾ç‰ˆæœ¬è¿‡æ—§ï¼šå½“å‰ä½¿ç”¨çš„ Solana CLI (v2.1.21) å†…ç½®çš„ rustc ç‰ˆæœ¬ä¸º 1.79.0-devï¼Œæ— æ³•æ»¡è¶³æ–°ç‰ˆæœ¬ä¾èµ–çš„è¦æ±‚
ä¾èµ–ç‰ˆæœ¬å†²çªï¼šé¡¹ç›®ä¾èµ–çš„åŒ…éœ€è¦æ›´æ–°çš„ Rust ç¼–è¯‘å™¨ç‰ˆæœ¬
Cargo.lock æ ¼å¼é—®é¢˜ï¼šä½¿ç”¨äº†å®éªŒæ€§åŠŸèƒ½ç”Ÿæˆçš„é”æ–‡ä»¶ç‰ˆæœ¬ä¸ç¨³å®šå·¥å…·é“¾ä¸å…¼å®¹

è§£å†³æ–¹æ¡ˆ
ç¬¬ä¸€é˜¶æ®µï¼šä¿®å¤æ ˆå†…å­˜æº¢å‡º
å¯¹å¤§å‹è´¦æˆ·ç»“æ„ä½“åº”ç”¨ Box&lt;Account&lt;'info, T&gt;&gt; åŒ…è£…ï¼š
ç¬¬äºŒé˜¶æ®µï¼šæ¸…ç†æ„å»ºç¼“å­˜
cd anchor
rm -rf target
rm Cargo.lock
cargo clean
ç¬¬ä¸‰é˜¶æ®µï¼šé™çº§ä¸å…¼å®¹ä¾èµ–
å°è¯•é™çº§ç‰¹å®šåŒ…ç‰ˆæœ¬ä»¥åŒ¹é…å½“å‰å·¥å…·é“¾ï¼š
cargo update base64ct@1.7.3 --precise 1.6.0
...
æ²¡ç”¨ï¼Œå¥½åƒå› ä¸ºæŸä¸ªä¾èµ–ä¸€ç›´éƒ½æ²¡æ³•ç¼–è¯‘æˆåŠŸï¼Œæ‰€ä»¥å‡†å¤‡é‡è£…solana
ç¬¬å››é˜¶æ®µï¼šé‡è£… Solana å·¥å…·é“¾
è°ƒç”¨
sh -c "$(curl -sSfL https://release.solana.com/stable/install)"
ä¼šæŠ¥é”™ï¼Œæ— æ³•è¿æ¥ã€‚ã€‚ã€‚
ä½¿ç”¨ Anza å®˜æ–¹çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼š

# å®‰è£…æ–°å·¥å…·é“¾
sh -c "$(curl -sSfL https://release.anza.xyz/stable/install)"

âœ  anchor git:(main) âœ— solana --version                                                                           
solana-cli 2.3.10 (src:b3ae6759; feat:2142755730, client:Agave)
æˆåŠŸå…¼å®¹æ‰€æœ‰ä¾èµ–ï¼ï¼
å‚è€ƒ
https://solana.stackexchange.com/questions/19629/anchor-build-error-solana-program-requires-rust-1-79-0-but-solana-tools-use-1
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Bug</tag>
      </tags>
  </entry>
  <entry>
    <title>Solanaå®æˆ˜Bugè®°å½•</title>
    <url>/2025/08/24/Solana%E5%AE%9E%E6%88%98Bug%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[Solanaå®æˆ˜Bugè®°å½•
Cross-program invocation with unauthorized signer or writable account



é—®é¢˜
è§£å†³æ–¹æ¡ˆ




PDA æ´¾ç”Ÿè·¯å¾„ä¸ä¸€è‡´
ç»Ÿä¸€ seeds å’Œ signer_seeds


Mint Authority æœªæˆæƒ
åœ¨ CPI ä¸­ä½¿ç”¨ signer_seeds æ˜¾å¼æˆæƒ


Metadata è´¦æˆ·çº¦æŸé”™è¯¯
æ˜¾å¼æŒ‡å®š Token Metadata Program åœ°å€


Mint Authority è®¾ç½®é”™è¯¯
ç¡®ä¿ mint::authority æŒ‡å‘ PDA å¹¶é€šè¿‡ç­¾åæˆæƒ



let signer_seeds: &amp;[&amp;[&amp;[u8]]] = &amp;[&amp;[
        EtfToken::SEEDS_PREFIX.as_bytes(),
        m.as_ref(),
        &amp;[ctx.bumps.etf_token_info],
    ]];
// 	éœ€è¦å’Œåˆ›å»ºè´¦æˆ·çš„æ—¶å€™è®¾ç½®çš„çº¦æŸä¸€è‡´
-----
 #[account(
        init_if_needed,
        payer = authority,
        space = 8 + EtfToken::INIT_SPACE,
        seeds = [
            EtfToken::SEEDS_PREFIX.as_bytes(),
            etf_token_mint_account.key().as_ref()
        ],
        bump,
    )]
    pub etf_token_info: Account&lt;'info, EtfToken>,
TypeError: anchor.BN is not a constructor
å¯å‚è€ƒï¼š
https://solana.stackexchange.com/questions/22096/typeerror-anchor-bn-is-not-a-constructor-due-to-tsconfig-json
æœ€ç»ˆæ˜¯æ‰‹åŠ¨å¯¼å…¥
import &#123; BN &#125; from "bn.js";
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>Rust</tag>
        <tag>Bug</tag>
      </tags>
  </entry>
  <entry>
    <title>Solanaé¡¹ç›®å®æˆ˜_TypeScriptæµ‹è¯•æ–‡ä»¶è¯­æ³•ä¸å…³é”®è¯</title>
    <url>/2025/09/07/Solana%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-TypeScript%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6%E8%AF%AD%E6%B3%95%E4%B8%8E%E5%85%B3%E9%94%AE%E8%AF%8D/</url>
    <content><![CDATA[TypeScriptæµ‹è¯•æ–‡ä»¶è¯­æ³•ä¸å…³é”®è¯
å®æˆ˜ä¸­å‘ç°æµ‹è¯•æ–‡ä»¶tsçš„è¯­æ³•æœ‰å¾ˆå¤šä¸æ‡‚ï¼Œé›†ä¸­æ€»ç»“ä¸€ä»½ä¾›å­¦ä¹ å’Œå‚è€ƒå¤‡ç”¨ã€‚ã€‚ã€‚
1. åŸºç¡€æµ‹è¯•ç»“æ„
describe('æµ‹è¯•ç»„åç§°', () => &#123;
    it('æµ‹è¯•ç”¨ä¾‹åç§°', () => &#123;
        // æµ‹è¯•ä»£ç 
    &#125;)
&#125;)
2. æ ¸å¿ƒå…³é”®è¯è§£é‡Š
describe - æµ‹è¯•ç»„/æµ‹è¯•å¥—ä»¶
describe('User Management', () => &#123;
    // è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç»„ï¼ŒåŒ…å«å¤šä¸ªç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹
    // æ‰€æœ‰ç”¨æˆ·ç›¸å…³çš„æµ‹è¯•éƒ½å¯ä»¥æ”¾åœ¨è¿™é‡Œ
&#125;)
ä½œç”¨ï¼š

ç»„ç»‡ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹
æä¾›æµ‹è¯•çš„ä¸Šä¸‹æ–‡æè¿°
å¯ä»¥åµŒå¥—ä½¿ç”¨

it - å•ä¸ªæµ‹è¯•ç”¨ä¾‹
it('should validate user state structure', () => &#123;
    // è¿™æ˜¯ä¸€ä¸ªå…·ä½“çš„æµ‹è¯•ç”¨ä¾‹
    // æµ‹è¯•ç”¨æˆ·çŠ¶æ€ç»“æ„æ˜¯å¦æ­£ç¡®
&#125;)
ä½œç”¨ï¼š

å®šä¹‰å…·ä½“çš„æµ‹è¯•åœºæ™¯
æè¿°æµ‹è¯•çš„ç›®çš„å’ŒæœŸæœ›ç»“æœ
æ¯ä¸ªitéƒ½æ˜¯ç‹¬ç«‹çš„æµ‹è¯•

expect - æ–­è¨€ï¼ˆéªŒè¯ç»“æœï¼‰
expect(mockUserState.user).toBe('test-user')
expect(mockUserState.incensePoints).toBe(0n)
expect(mockUserState.incenseBalance).toEqual([])
ä½œç”¨ï¼š

éªŒè¯å®é™…ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ
å¦‚æœæ–­è¨€å¤±è´¥ï¼Œæµ‹è¯•å°±ä¼šå¤±è´¥

3. å¸¸ç”¨æ–­è¨€æ–¹æ³•
åŸºæœ¬æ–­è¨€
expect(value).toBe(expected)           // ä¸¥æ ¼ç›¸ç­‰
expect(value).toEqual(expected)        // æ·±åº¦ç›¸ç­‰ï¼ˆå¯¹è±¡ï¼‰
expect(value).toBeTruthy()             // çœŸå€¼
expect(value).toBeFalsy()              // å‡å€¼
æ•°å€¼æ–­è¨€
expect(value).toBeGreaterThan(5)       // å¤§äº
expect(value).toBeLessThan(10)         // å°äº
expect(value).toBeGreaterThanOrEqual(0) // å¤§äºç­‰äº
æ•°ç»„/å­—ç¬¦ä¸²æ–­è¨€
expect(array).toContain(item)          // åŒ…å«
expect(array).toHaveLength(3)          // é•¿åº¦
expect(string).toMatch(/pattern/)      // æ­£åˆ™åŒ¹é…
4. æµ‹è¯•ç”Ÿå‘½å‘¨æœŸ
beforeAll - æ‰€æœ‰æµ‹è¯•å‰æ‰§è¡Œ
describe('User Management', () => &#123;
    let payer: any
    let rpc: any

    beforeAll(async () => &#123;
        // åœ¨æ‰€æœ‰æµ‹è¯•å¼€å§‹å‰æ‰§è¡Œä¸€æ¬¡
        const env = await setupTestEnvironment()
        payer = env.payer
        rpc = env.rpc
    &#125;)

    it('test 1', () => &#123; /* ä½¿ç”¨payerå’Œrpc */ &#125;)
    it('test 2', () => &#123; /* ä½¿ç”¨payerå’Œrpc */ &#125;)
&#125;)
beforeEach - æ¯ä¸ªæµ‹è¯•å‰æ‰§è¡Œ
beforeEach(() => &#123;
    // åœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¼€å§‹å‰æ‰§è¡Œ
    // é‡ç½®æµ‹è¯•çŠ¶æ€
&#125;)
afterAll / afterEach - æ¸…ç†å‡½æ•°
afterAll(() => &#123;
    // åœ¨æ‰€æœ‰æµ‹è¯•ç»“æŸåæ‰§è¡Œ
    // æ¸…ç†èµ„æº
&#125;)
5. å®é™…æµ‹è¯•ç¤ºä¾‹è§£æ
import &#123; describe, it, expect &#125; from 'vitest'

describe('User Management', () => &#123;           // ğŸ”¸ æµ‹è¯•ç»„å¼€å§‹
    it('should validate user state structure', () => &#123;  // ğŸ”¸ ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        const mockUserState = &#123;
            user: 'test-user',
            incensePoints: 0n,
            merit: 0n,
            incenseBalance: [],
            incenseNumber: 0,
            updateTime: 1234567890n,
            dailyIncenseCount: [],
            bump: 255
        &#125;

        // éªŒè¯ç”¨æˆ·åœ°å€
        expect(mockUserState.user).toBe('test-user')    // ğŸ”¸ æ–­è¨€ï¼šç”¨æˆ·åœ°å€åº”è¯¥ç­‰äº'test-user'
        
        // éªŒè¯åˆå§‹é¦™ç«å€¼
        expect(mockUserState.incensePoints).toBe(0n)   // ğŸ”¸ æ–­è¨€ï¼šé¦™ç«å€¼åº”è¯¥ä¸º0
        
        // éªŒè¯åŠŸå¾·å€¼
        expect(mockUserState.merit).toBe(0n)           // ğŸ”¸ æ–­è¨€ï¼šåŠŸå¾·å€¼åº”è¯¥ä¸º0
        
        // éªŒè¯é¦™ä½™é¢æ•°ç»„
        expect(mockUserState.incenseBalance).toEqual([]) // ğŸ”¸ æ–­è¨€ï¼šé¦™ä½™é¢åº”è¯¥æ˜¯ç©ºæ•°ç»„
    &#125;)

    it('should handle incense balance operations', () => &#123;  // ğŸ”¸ ç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹
        let balance = 100
        
        // æµ‹è¯•å¢åŠ ä½™é¢
        balance += 50
        expect(balance).toBe(150)                      // ğŸ”¸ æ–­è¨€ï¼š100+50=150
        
        // æµ‹è¯•å‡å°‘ä½™é¢
        balance -= 30
        expect(balance).toBe(120)                      // ğŸ”¸ æ–­è¨€ï¼š150-30=120
        
        // æµ‹è¯•ä½™é¢ä¸è¶³çš„æƒ…å†µ
        const hasEnough = balance >= 200
        expect(hasEnough).toBe(false)                  // ğŸ”¸ æ–­è¨€ï¼š120 >= 200 åº”è¯¥æ˜¯false
    &#125;)

    it('should validate daily incense limits', () => &#123;     // ğŸ”¸ ç¬¬ä¸‰ä¸ªæµ‹è¯•ç”¨ä¾‹
        const dailyLimit = 10
        const currentCount = 5
        const requestedAmount = 3

        // æµ‹è¯•æ˜¯å¦å¯ä»¥ç»§ç»­çƒ§é¦™
        const canBurn = currentCount + requestedAmount &lt;= dailyLimit
        expect(canBurn).toBe(true)                     // ğŸ”¸ æ–­è¨€ï¼š5+3 &lt;= 10 åº”è¯¥æ˜¯true

        // æµ‹è¯•è¶…å‡ºé™åˆ¶çš„æƒ…å†µ
        const overLimit = currentCount + 8 > dailyLimit
        expect(overLimit).toBe(true)                   // ğŸ”¸ æ–­è¨€ï¼š5+8 > 10 åº”è¯¥æ˜¯true
    &#125;)
&#125;)
6. æµ‹è¯•å‘½åè§„èŒƒ
æµ‹è¯•ç»„å‘½å
describe('User Management', () => &#123;&#125;)      // âœ… åŠŸèƒ½æ¨¡å—
describe('Incense Operations', () => &#123;&#125;)   // âœ… æ“ä½œç±»å‹
describe('Daily Limits', () => &#123;&#125;)          // âœ… ä¸šåŠ¡è§„åˆ™
æµ‹è¯•ç”¨ä¾‹å‘½å
it('should initialize user correctly', () => &#123;&#125;)        // âœ… æè¿°æœŸæœ›è¡Œä¸º
it('should handle insufficient balance', () => &#123;&#125;)      // âœ… æè¿°è¾¹ç•Œæƒ…å†µ
it('should validate daily limits', () => &#123;&#125;)            // âœ… æè¿°éªŒè¯é€»è¾‘
it('should update incense count', () => &#123;&#125;)             // âœ… æè¿°çŠ¶æ€å˜åŒ–
7. æµ‹è¯•è¿è¡Œç»“æœ
å½“ä½ è¿è¡Œæµ‹è¯•æ—¶ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
âœ“ User Management
  âœ“ should validate user state structure
  âœ“ should handle incense balance operations  
  âœ“ should validate daily incense limits

Test Results: 3 passed, 0 failed
8. ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ç§è¯­æ³•ï¼Ÿ

ç»“æ„åŒ– - æ¸…æ™°çš„æµ‹è¯•ç»„ç»‡æ–¹å¼
å¯è¯»æ€§ - è‹±æ–‡æè¿°å®¹æ˜“ç†è§£
æ ‡å‡†åŒ– - è¡Œä¸šé€šç”¨çš„æµ‹è¯•æ ¼å¼
å·¥å…·æ”¯æŒ - IDEå’Œæµ‹è¯•æ¡†æ¶åŸç”Ÿæ”¯æŒ
æŠ¥å‘Šå‹å¥½ - ç”Ÿæˆç¾è§‚çš„æµ‹è¯•æŠ¥å‘Š

9. è¿è¡Œæµ‹è¯•çš„å‘½ä»¤
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx vitest anchor/tests/unit/user.test.ts

# ç›‘å¬æ¨¡å¼ï¼ˆæ–‡ä»¶å˜åŒ–è‡ªåŠ¨è¿è¡Œï¼‰
npx vitest --watch
]]></content>
      <categories>
        <category>Solana</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>SolidityåŸºç¡€[part1]</title>
    <url>/2025/06/17/Solidity%E5%9F%BA%E7%A1%80%5Bpart1%5D/</url>
    <content><![CDATA[Solidity åŸºç¡€[part1]
Remix IDE

å‡½æ•°
æ— è¿”å›ä½“å‡½æ•°ç¤ºä¾‹ï¼š
// SPDX-License-Identifier: MIT
pragma solidity 0.8.19; // chose our solidity version 

contract SimpleStorage &#123;
    uint256 public myFavoriteNumber; // åˆå§‹å€¼å°±æ˜¯0 è€Œä¸”æ˜¯internal ä¹Ÿå°±æ˜¯å†…éƒ¨ä¸å¯è§çš„

    function store(uint256 favoriteNumber) public &#123;
        myFavoriteNumber = favoriteNumber;
    &#125;

&#125;
æœ‰è¿”å›ä½“ç¤ºä¾‹ï¼š
function recive() public view returns (uint256) &#123;
       return myFavoriteNumber;
   &#125;
æ•°ç»„
// æ•°ç»„
uint256[] public myFavoriteNumbers;


Person public newPerson = Person(1, 'jack');

Person public myPerson;


function setPerson(string memory name, uint256 person_number) public &#123;
    myPersonArray.push(Person(person_number,name));
&#125;

ç»“æ„
// ç»“æ„
    struct Person &#123;
        uint256 personNumber;
        string name;
    &#125;

æ•°ç»„åŠ ç»“æ„
// æ•°ç»„åŠ ç»“æ„
 Person[] public myPersonArray;
å¯è§æ€§
å‡½æ•°å’Œå˜é‡æœ‰å››ç§å¯è§æ€§ä¿®é¥°ç¬¦ï¼š

publicï¼šå¯ä»åˆçº¦å†…éƒ¨å’Œå¤–éƒ¨åˆçº¦è®¿é—®
privateï¼šä»…é™å½“å‰åˆçº¦å†…éƒ¨è®¿é—®ã€‚ä¸ä¼šéšè—å€¼ï¼Œä»…é™åˆ¶å…¶è®¿é—®æƒé™ã€‚
externalï¼šä»…é€‚ç”¨äºå¤–éƒ¨çš„åˆçº¦è®¿é—®ã€‚âš ï¸
internalï¼š å½“å‰åˆçº¦å’Œæ´¾ç”Ÿçš„åˆçº¦å¯ä»¥è®¿é—®ã€‚

å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯internal
view ã€pure
å‡½æ•°æ“ä½œæƒé™ä¿®é¥°ç¬¦
1. view å…³é”®å­—


åŠŸèƒ½ï¼šä½¿ç”¨viewå…³é”®å­—ä¿®é¥°çš„å‡½æ•°ï¼Œæ‰¿è¯ºä¸ä¼šå¯¹åŒºå—é“¾çš„çŠ¶æ€è¿›è¡Œä¿®æ”¹ã€‚


å¯æ‰§è¡Œæ“ä½œ

èƒ½å¤Ÿè¯»å–åŒºå—é“¾ä¸Šçš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯çŠ¶æ€å˜é‡ï¼‰ã€‚
å¯ä»¥è®¿é—® msg.senderã€block.number ç­‰å…¨å±€å˜é‡ã€‚
æ”¯æŒè°ƒç”¨å…¶ä»–åŒæ ·è¢«æ ‡è®°ä¸ºviewæˆ–è€…pureçš„å‡½æ•°ã€‚



ä¸å¯æ‰§è¡Œæ“ä½œï¼šç¦æ­¢å¯¹çŠ¶æ€å˜é‡è¿›è¡Œå†™å…¥æ“ä½œã€‚


ç¤ºä¾‹ï¼š


contract ViewExample &#123;
    uint public balance;

    // æ­¤å‡½æ•°ä»…è¯»å–çŠ¶æ€å˜é‡ï¼Œä¸ä¼šå¯¹å…¶è¿›è¡Œä¿®æ”¹
    function getBalance() public view returns (uint) &#123;
        return balance;
    &#125;
&#125;
2. pure å…³é”®å­—


åŠŸèƒ½ï¼šè¢«pureå…³é”®å­—ä¿®é¥°çš„å‡½æ•°ï¼Œæ—¢ä¸ä¼šè¯»å–ä¹Ÿä¸ä¼šä¿®æ”¹åŒºå—é“¾çš„çŠ¶æ€ã€‚


å¯æ‰§è¡Œæ“ä½œ

å¯ä»¥ä½¿ç”¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚
èƒ½å¤Ÿæ“ä½œä¼ å…¥å‡½æ•°çš„å‚æ•°ã€‚
æ”¯æŒè¿›è¡Œæ•°å­¦è¿ç®—ã€‚
å¯ä»¥è°ƒç”¨å…¶ä»–pureå‡½æ•°ã€‚



ä¸å¯æ‰§è¡Œæ“ä½œ

ç¦æ­¢è®¿é—®çŠ¶æ€å˜é‡ã€‚
ä¸å…è®¸è°ƒç”¨éviewæˆ–pureçš„å‡½æ•°ã€‚



ç¤ºä¾‹ï¼š


contract PureExample &#123;
    // è¯¥å‡½æ•°ä¸ä¾èµ–ä»»ä½•çŠ¶æ€å˜é‡ï¼Œä»…å¯¹è¾“å…¥å‚æ•°è¿›è¡Œè®¡ç®—
    function add(uint a, uint b) public pure returns (uint) &#123;
        return a + b;
    &#125;
&#125;
3. å…³é”®åŒºåˆ«



ç‰¹æ€§
view å‡½æ•°
pure å‡½æ•°




èƒ½å¦è¯»å–çŠ¶æ€å˜é‡
å¯ä»¥
ä¸å¯ä»¥


èƒ½å¦ä¿®æ”¹çŠ¶æ€å˜é‡
ä¸å¯ä»¥
ä¸å¯ä»¥


æ˜¯å¦æ¶ˆè€— Gasï¼ˆå¤–éƒ¨è°ƒç”¨æ—¶ï¼‰
ä¸æ¶ˆè€—
ä¸æ¶ˆè€—


æ˜¯å¦æ¶ˆè€— Gasï¼ˆå†…éƒ¨è°ƒç”¨æ—¶ï¼‰
æ¶ˆè€—
æ¶ˆè€—




âš ï¸ ä¸€èˆ¬è°ƒç”¨è¿™ä¸¤ä¸ªå…³é”®å­—éƒ½ä¸ä¼šæ¶ˆè€—gasè´¹ï¼Œ ä½†æ˜¯å¦‚æœæ˜¯å†…éƒ¨è°ƒç”¨ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­, storeé‡Œé¢è°ƒç”¨reciveå°±ä¼šå¯¼è‡´gasè´¹äº§ç”Ÿã€‚

function store(uint256 favoriteNumber) public &#123;// å­˜å‚¨
       myFavoriteNumber = favoriteNumber;
       recive(favoriteNumber);
   &#125;

 function recive() public view returns (uint256) &#123;
     return myFavoriteNumber;
 &#125;
å®Œæ•´ä»£ç ï¼š
// SPDX-License-Identifier: MIT
pragma solidity 0.8.19; // stating our version 

contract SimpleStorage &#123;
    uint256 public myFavoriteNumber; // åˆå§‹å€¼å°±æ˜¯0 è€Œä¸”æ˜¯internal ä¹Ÿå°±æ˜¯å†…éƒ¨ä¸å¯è§çš„



    // æ•°ç»„
    uint256[] public myFavoriteNumbers;

    // ç»“æ„
    struct Person &#123;
        uint256 personNumber;
        string name;
    &#125;

    Person public newPerson = Person(1, 'jack');

    Person public myPerson;

    Person[] public myPersonArray;

    function setPerson(string memory name, uint256 person_number) public &#123;
        myPerson = Person(person_number, name);
        myPersonArray.push(myPerson);
    &#125;

    function store(uint256 favoriteNumber) public &#123;// å­˜å‚¨
        myFavoriteNumber = favoriteNumber;
    &#125;

    // view å¯è¯»ä¸å¯å†™ pure ä¸å¯è¯»ä¸å¯å†™
    function recive() public view returns (uint256) &#123;
        return myFavoriteNumber;
    &#125;



&#125;
]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Solidity</tag>
        <tag>EVM</tag>
      </tags>
  </entry>
  <entry>
    <title>BlockChain Basic 1</title>
    <url>/2025/06/17/WEB3%20Day1%20%E2%80%94%E2%80%94%20BlockChain%20Basic%201/</url>
    <content><![CDATA[WEB3 Day1â€”BlockChain Basic 1
è½¬å‹æ–¹å‘
ä» Java å¼€å‘è½¬å‹è‡³æ™ºèƒ½åˆçº¦å¼€å‘ã€‚
å­¦ä¹ èµ„æº
å­¦ä¹ è§†é¢‘
æ¨è patrick collins ã€Cyfrinã€‘çš„æ•™å­¦è§†é¢‘ ã€‚
åŒæ—¶ï¼ŒCyfrin Updraft å®˜ç½‘æä¾›äº†æ–‡å­—ç¬”è®°å’Œè§†é¢‘è¯¾ç¨‹ã€‚ä¸è¿‡ï¼ŒæŸäº›ç¿»è¯‘æ’ä»¶çš„åŒè¯­å­—å¹•ä¸æ”¯æŒè¯¥ç½‘ç«™ï¼Œå› æ­¤æˆ‘é€‰æ‹©åœ¨ YouTube ä¸Šè§‚çœ‹å®Œæ•´è§†é¢‘ï¼Œå¹¶ä¸”å°†ä¸¤è€…ç»“åˆèµ·æ¥å­¦ä¹ ã€‚
ç¿»è¯‘æ’ä»¶æ¨è
è¿™é‡Œæ¨èä¸€æ¬¾ç¿»è¯‘æ’ä»¶â€”â€”æ²‰æµ¸å¼ç¿»è¯‘
åˆ›å»ºè‡ªå·±çš„é’±åŒ…
å®‰è£… MetaMask æ’ä»¶
é¦–å…ˆï¼Œè¿›å…¥ MetaMask å®˜ç½‘ï¼Œå°†å…¶ä½œä¸º Chrome æµè§ˆå™¨æ’ä»¶æ·»åŠ åˆ°æµè§ˆå™¨ä¸­ã€‚
åˆ›å»ºé’±åŒ…
åˆ›å»ºè‡ªå·±çš„é’±åŒ…åï¼Œä¼šå¾—åˆ°ä¸‰ä¸ªå…³é”®ä¿¡æ¯ï¼šç§é’¥ï¼ˆprivate keyï¼‰ã€åŠ©è®°è¯ï¼ˆMnemonic Keyï¼‰å’Œå…¬é’¥åœ°å€ï¼ˆpublic Addressï¼‰ã€‚å…¶ä¸­ï¼Œç§é’¥å’ŒåŠ©è®°è¯æå…¶é‡è¦ï¼ŒåŠ¡å¿…å®‰å…¨ä¿å­˜ï¼å› ä¸ºæ‹¥æœ‰ç§é’¥å°±å¯ä»¥ç›´æ¥è®¿é—®ä½ çš„é’±åŒ…è´¦æˆ·ï¼Œæ‰€ä»¥åƒä¸‡ä¸èƒ½æœ‰ä¾¥å¹¸å¿ƒç†ã€‚å»ºè®®å°†åŠ©è®°è¯è®°å½•åœ¨çº¸ä¸Šï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨ç”µè„‘é‡Œï¼Œå¦‚æœèƒ½è®°åœ¨å¤§è„‘ä¸­ï¼ˆå¦‚ä½¿ç”¨è®°å¿†å®«æ®¿çš„æ–¹æ³•ï¼‰åˆ™æ˜¯æœ€å®‰å…¨çš„ã€‚ä¸‰è€…çš„é‡è¦æ€§æ’åºä¸ºï¼šã€Mnemonic &gt; Private Key &gt; public Addressã€‘ã€‚
ç›¸å…³å›¾ç¤ºå¦‚ä¸‹ï¼š


æ¨¡æ‹Ÿäº¤æ˜“
åˆ›å»ºè™šæ‹Ÿæµ‹è¯•ç½‘ç»œ
ç™»å½• Tenderly æµ‹è¯•ç½‘ç«™ï¼ˆhttps://tenderly.co/?mtm_campaign=partner&amp;mtm_kwd=cyfrin ï¼‰ï¼Œé€šè¿‡è¯¥é“¾æ¥æ³¨å†Œå¹¶åˆ›å»ºè´¦æˆ·æ˜¯å…è´¹çš„ã€‚åœ¨ç½‘ç«™å·¦ä¾§ç‚¹å‡»â€œvirtual TestNetsâ€ï¼Œåˆ›å»ºè™šæ‹Ÿæµ‹è¯•ç½‘ç»œã€‚

ç½‘ç»œè®¾ç½®
è¿›è¡Œç®€å•è®¾ç½®ï¼Œæ— ç‰¹å®šè¦æ±‚ã€‚è®¾ç½®å®Œæˆåï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ¨¡æ‹ŸåŒºå—é“¾ï¼Œæ¥ä¸‹æ¥å¯ä»¥å°†å…¶æ·»åŠ åˆ° MetaMask ä¸­ã€‚

æ‰‹åŠ¨æ·»åŠ ç½‘ç»œé—®é¢˜å¤„ç†
åœ¨è¿æ¥åï¼Œå¯èƒ½ä¼šé‡åˆ° MetaMask ä¸­æœªæ˜¾ç¤ºåˆ›å»ºçš„è™šæ‹Ÿç½‘ç»œçš„é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚æ³¨æ„ï¼ŒåŸç³»ç»Ÿé»˜è®¤çš„ chainIdï¼ˆ11155111ï¼‰æ— æ³•ä¿®æ”¹ï¼Œå› æ­¤éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªé“¾ï¼Œå¹¶åœ¨åˆ›å»ºæ—¶åœ¨â€œcustomâ€å¤„ä¿®æ”¹è‡ªå·±çš„ IDã€‚

æœ‰å…¶ä»–å¼€å‘è€…ä¹Ÿé‡åˆ°äº†åŒæ ·çš„é—®é¢˜ï¼Œå¯å‚è€ƒï¼šhttps://github.com/Cyfrin/foundry-full-course-cu/discussions/4066?sort=old
æ³¨èµ„æ“ä½œ
å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œè¿›è¡Œæ³¨èµ„ã€‚

æŸ¥çœ‹æ³¨èµ„ç»“æœ
æ³¨èµ„å®Œæˆåï¼Œç­‰å¾…å‡ åˆ†é’Ÿï¼Œå°±å¯ä»¥åœ¨è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œä¸­çœ‹åˆ°èµ„é‡‘åˆ°è´¦å•¦ï¼Œä»¿ä½›ç¬é—´â€œæš´å¯Œâ€ï¼ˆå½“ç„¶è¿™åªæ˜¯æ¨¡æ‹Ÿï¼‰ã€‚

è´¦æˆ·é—´è½¬è´¦
åœ¨æ¨¡æ‹Ÿç½‘ç»œä¸­ï¼Œä»ä¸€ä¸ªè´¦æˆ·å‘å¦ä¸€ä¸ªè´¦æˆ·è½¬è´¦éå¸¸ç®€å•ï¼Œç›´æ¥è¿›è¡Œå‘é€æ“ä½œå³å¯ã€‚


å¦å¤–ï¼ŒTenderly ä¸ Cypher æœ‰åˆä½œï¼Œè´¦æˆ·å¯ä»¥ç»­æœŸã€‚

åŒºå—é“¾æ•°æ®ç»“æ„
å¯ä»¥é€šè¿‡ BlockChain Demo ç½‘ç«™ï¼ˆhttps://andersbrownworth.com/blockchain/block ï¼‰æ¥å¸®åŠ©ç†è§£åŒºå—é“¾çš„åº•å±‚æ•°æ®ç»“æ„ã€‚
äº¤æ˜“è´¹ç”¨ç›¸å…³æ¦‚å¿µ
äº¤æ˜“è´¹ç”¨ï¼ˆTransaction Feeï¼‰
äº¤æ˜“è´¹ç”¨æ˜¯æ”¯ä»˜ç»™åŒºå—ç”Ÿäº§è€…å¤„ç†äº¤æ˜“çš„å¥–åŠ±é‡‘é¢ï¼Œé€šå¸¸é€šè¿‡ä»¥å¤ªå¸æˆ–è€… Gwei æ”¯ä»˜ã€‚
ç‡ƒæ°”ä»·æ ¼ï¼ˆGas Priceï¼‰
åŒæ ·ä»¥ä»¥å¤ªå¸æˆ–è€… Gwei æ¥å®šä¹‰ï¼Œç‡ƒæ°”ä»·æ ¼æ˜¯äº¤æ˜“ä¸­æŒ‡å®šçš„æ¯å•ä½ç‡ƒæ°”ï¼ˆGasï¼‰çš„æˆæœ¬ã€‚ä»·æ ¼è¶Šé«˜ï¼Œäº¤æ˜“è¢«æ‰“åŒ…è¿›åŒºå—çš„æœºä¼šå°±è¶Šå¤§ï¼Œå®ƒç”¨äºè®¾å®šäº¤æ˜“ä¸­æ¯å•ä½ç‡ƒæ°”çš„æˆæœ¬ã€‚
ç‡ƒæ°”ï¼ˆGasï¼‰
ä¸è¦å°†ç‡ƒæ°”ä¸ç‡ƒæ°”ä»·æ ¼æ··æ·†ã€‚ç‡ƒæ°”æŒ‡çš„æ˜¯æ‰§è¡Œäº¤æ˜“æ‰€éœ€è¦çš„å·¥ä½œé‡ï¼Œè€Œç‡ƒæ°”ä»·æ ¼åˆ™æ˜¯æ¯å•ä½å·¥ä½œé‡çš„æˆæœ¬ã€‚
äº¤æ˜“è´¹ç”¨çš„è®¡ç®—å…¬å¼ä¸ºï¼š
Transaction fee =  gasPrice * gasUsed
ç®€å•æ¥è¯´ï¼Œå½“å¤§é‡ç”¨æˆ·è¿›è¡Œäº¤æ˜“æ—¶ï¼Œç‰¹å®šåŒºå—çš„ç©ºé—´ç«äº‰ä¼šå˜å¾—æ¿€çƒˆï¼Œæ­¤æ—¶æé«˜ç‡ƒæ°”ä»·æ ¼å¯ä»¥åœ¨æ‹¥å µæ—¶é™åˆ¶äº¤æ˜“ï¼Œå¹¶ä¼˜å…ˆå¤„ç†éƒ¨åˆ†äº¤æ˜“ã€‚
]]></content>
      <categories>
        <category>Web3</category>
      </categories>
      <tags>
        <tag>Web3</tag>
        <tag>BlockChain</tag>
      </tags>
  </entry>
  <entry>
    <title>BlockChain Basic 2</title>
    <url>/2025/06/17/WEB3%20Day2%20%E2%80%94%E2%80%94%20BlockChain%20Basic%202+Solidity%E5%9F%BA%E7%A1%80%5Bpart1%5D/</url>
    <content><![CDATA[WEB3 Day2â€”BlockChain Basic 2
Layer1
â€‹	blockChainçš„base layerï¼Œä¾‹å¦‚bitcoinã€BNB chainã€Solana,and Avalanche.
Layer2
æ„å»ºåœ¨L1åŒºå—é“¾å¤–éƒ¨ä½†æ˜¯ä¹Ÿä¸ä¹‹è¿æ¥çš„ä»»ä½•åº”ç”¨applicationã€‚æœ‰å„ç§ç±»å‹ï¼Œæ¯”å¦‚for example ChainLink(å»ä¸­å¿ƒåŒ–é¢„è¨€æœºç½‘ç»œ) ï¼Œä»¥åŠåƒThe Graph(äº‹ä»¶ç´¢å¼•ç½‘ç»œ)ã€‚
å¥½çš„ï¼Œæˆ‘å°†ä¸ºä½ ä¼˜åŒ–è¿™æ®µåŒºå—é“¾æŠ€æœ¯æè¿°ï¼Œæå‡ä¸“ä¸šæ€§å’Œæ¸…æ™°åº¦ï¼š
Rollup æŠ€æœ¯ï¼šä»¥å¤ªåŠLayer2æ‰©å®¹çš„æ ¸å¿ƒæ–¹æ¡ˆ
Rollupæ˜¯Layer2ï¼ˆL2ï¼‰æ‰©å®¹çš„ä¸»æµè§£å†³æ–¹æ¡ˆï¼Œå…¶æ ¸å¿ƒåŸç†æ˜¯å°†å¤šç¬”é“¾ä¸‹äº¤æ˜“æ‰“åŒ…ä¸ºä¸€ä¸ªèšåˆäº¤æ˜“ï¼Œä»…å°†äº¤æ˜“æ‘˜è¦ï¼ˆè€Œéå®Œæ•´æ•°æ®ï¼‰æäº¤è‡³ä»¥å¤ªåŠä¸»é“¾ï¼ˆLayer1ï¼‰ï¼Œå¤§å¹…æå‡äº¤æ˜“ååé‡å¹¶é™ä½Gasè´¹ç”¨ã€‚æ ¹æ®éªŒè¯æœºåˆ¶ä¸åŒï¼ŒRollupå¯åˆ†ä¸ºä¸¤ç±»ï¼š
1. Optimistic Rollupsï¼ˆä¹è§‚æ±‡æ€»ï¼‰

å·¥ä½œæœºåˆ¶ï¼šé»˜è®¤æ‰€æœ‰é“¾ä¸‹äº¤æ˜“å‡ä¸ºæœ‰æ•ˆï¼Œè¿è¥å•†ï¼ˆOperatorï¼‰å®šæœŸå‘ä¸»é“¾æäº¤çŠ¶æ€æ ¹ï¼ˆState Rootï¼‰å’Œäº¤æ˜“å“ˆå¸Œã€‚è‹¥å…¶ä»–å‚ä¸è€…å‘ç°æ¬ºè¯ˆäº¤æ˜“ï¼Œå¯åœ¨æŒ‘æˆ˜æœŸï¼ˆé€šå¸¸7å¤©ï¼‰å†…æäº¤æ¬ºè¯ˆè¯æ˜ï¼ˆFraud Proofï¼‰è¿›è¡Œè´¨ç–‘ã€‚
å®‰å…¨æ€§ï¼šä¾èµ–ç»æµæƒ©ç½šæœºåˆ¶ï¼ˆæŠ¼é‡‘é”å®šï¼‰å’Œé“¾ä¸ŠéªŒè¯åˆçº¦ï¼Œè‹¥è¿è¥å•†è¢«è¯æ˜æ¬ºè¯ˆï¼Œå°†æŸå¤±æŠ¼é‡‘å¹¶å›æ»šçŠ¶æ€ã€‚
ä»£è¡¨é¡¹ç›®ï¼šArbitrumã€Optimismã€Baseã€‚

2. Zero-Knowledge Rollupsï¼ˆé›¶çŸ¥è¯†æ±‡æ€»ï¼‰

å·¥ä½œæœºåˆ¶ï¼šé€šè¿‡é›¶çŸ¥è¯†è¯æ˜ï¼ˆZK Proofï¼‰æŠ€æœ¯ç”Ÿæˆæœ‰æ•ˆæ€§è¯æ˜ï¼ˆValidity Proofï¼‰ï¼Œè¯æ˜äº¤æ˜“æ‰¹æ¬¡çš„åˆæ³•æ€§ã€‚éªŒè¯è€…åªéœ€æ£€æŸ¥è¯æ˜ï¼Œæ— éœ€é‡æ”¾æ‰€æœ‰äº¤æ˜“ã€‚
æ ¸å¿ƒä¼˜åŠ¿ï¼š

å³æ—¶ç¡®å®šæ€§ï¼šæ— éœ€æŒ‘æˆ˜æœŸï¼Œäº¤æ˜“ç¡®è®¤åä¸å¯é€†è½¬ã€‚
æ›´é«˜å®‰å…¨æ€§ï¼šæ•°å­¦è¯æ˜ä¿è¯çŠ¶æ€æ­£ç¡®æ€§ï¼Œæ— éœ€ä¾èµ–ä¿¡ä»»å‡è®¾ã€‚
æ›´ä½Gasæˆæœ¬ï¼šæ•°æ®å‹ç¼©ç‡å¯è¾¾1000:1ï¼ŒéªŒè¯æˆæœ¬æ˜¾è‘—ä½äºOptimisticæ–¹æ¡ˆã€‚


ä»£è¡¨é¡¹ç›®ï¼šzkSyncã€StarkNetã€Polygon zkEVMã€‚

3. è§è¯ï¼ˆWitnessï¼‰ä¸é›¶çŸ¥è¯†è¯æ˜

è§è¯ï¼ˆWitnessï¼‰ï¼šæ˜¯è¯æ˜è€…ï¼ˆProverï¼‰ç”Ÿæˆçš„ä¸€ç»„ä¸­é—´å€¼ï¼Œç”¨äºè¯æ˜è¾“å…¥æ•°æ®æ»¡è¶³ç‰¹å®šæ•°å­¦å…³ç³»ï¼ˆå¦‚å“ˆå¸Œå‡½æ•°ã€æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼‰ã€‚åœ¨ZK Rollupsä¸­ï¼ŒWitnessåŒ…å«äº¤æ˜“æ•°æ®ã€çŠ¶æ€è½¬æ¢é€»è¾‘ç­‰ä¿¡æ¯ï¼Œä½†ä¸æ³„éœ²å…·ä½“å†…å®¹ã€‚
éªŒè¯æµç¨‹ï¼š

è¯æ˜è€…æ”¶é›†äº¤æ˜“å¹¶ç”ŸæˆçŠ¶æ€è½¬æ¢ã€‚
åŸºäºWitnessç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜ï¼ˆå¦‚SNARKæˆ–STARKï¼‰ã€‚
éªŒè¯è€…ï¼ˆVerifierï¼‰é€šè¿‡æ™ºèƒ½åˆçº¦æ£€æŸ¥è¯æ˜ï¼Œç¡®è®¤è¾“å‡ºçŠ¶æ€ä¸é¢„æœŸä¸€è‡´ã€‚


æŠ€æœ¯ç‰¹æ€§ï¼š

ç®€æ´æ€§ï¼šè¯æ˜å¤§å°é€šå¸¸ä»…å‡ åKBï¼ŒéªŒè¯æ—¶é—´æçŸ­ï¼ˆæ¯«ç§’çº§ï¼‰ã€‚
éäº¤äº’æ€§ï¼šå•ä¸ªè¯æ˜å¯ç‹¬ç«‹éªŒè¯ï¼Œæ— éœ€ä¸è¯æ˜è€…äº¤äº’ã€‚



å¯¹æ¯”ä¸åº”ç”¨åœºæ™¯



ç‰¹æ€§
Optimistic Rollups
ZK Rollups




éªŒè¯æœºåˆ¶
æ¬ºè¯ˆè¯æ˜ï¼ˆé»˜è®¤æœ‰æ•ˆï¼Œéœ€æŒ‘æˆ˜ï¼‰
æœ‰æ•ˆæ€§è¯æ˜ï¼ˆæ•°å­¦è¯æ˜ï¼‰


æœ€ç»ˆç¡®è®¤æ—¶é—´
7å¤©æŒ‘æˆ˜æœŸå
å‡ ç§’è‡³å‡ åˆ†é’Ÿï¼ˆè¯æ˜ç”Ÿæˆåï¼‰


å…¼å®¹æ€§
å®Œå…¨å…¼å®¹EVMï¼ˆæ”¯æŒæ‰€æœ‰Solidityåˆçº¦ï¼‰
éƒ¨åˆ†å…¼å®¹ï¼ˆéœ€é€‚é…ZK-EVMï¼‰


é€‚ç”¨åœºæ™¯
DeFiåè®®ã€å¤æ‚æ™ºèƒ½åˆçº¦
NFTé“¸é€ ã€é«˜é¢‘äº¤æ˜“ã€éšç§ä¿æŠ¤



RollupæŠ€æœ¯é€šè¿‡é“¾ä¸‹è®¡ç®—+é“¾ä¸ŠéªŒè¯çš„æ¨¡å¼ï¼Œå°†ä»¥å¤ªåŠçš„ç†è®ºTPSä»15æå‡è‡³2000+ï¼ŒGasæˆæœ¬é™ä½90%ä»¥ä¸Šã€‚Optimisticæ–¹æ¡ˆä¾§é‡å…¼å®¹æ€§ï¼ŒZKæ–¹æ¡ˆä¾§é‡å®‰å…¨æ€§ä¸æ•ˆç‡ï¼Œä¸¤è€…å…±åŒæ¨åŠ¨åŒºå—é“¾åº”ç”¨è¿›å…¥è§„æ¨¡åŒ–é˜¶æ®µã€‚éšç€ZK-EVMï¼ˆå¦‚zkSync 2.0ï¼‰çš„æˆç†Ÿï¼Œæœªæ¥å¤§å¤šæ•°åº”ç”¨å¯èƒ½è½¬å‘é›¶çŸ¥è¯†Rollupæ¶æ„ã€‚
RollUp stage (Rollup å‘å±•é˜¶æ®µ)
Stage 0
åœ¨è¿™ä¸ªåˆå§‹çš„é˜¶æ®µï¼ŒRollUpçš„æ²»ç†ä¸»è¦ç”±è¿è¥æ–¹å’Œå®‰å…¨å§”å‘˜ä¼šæŒæ§ï¼Œç¡®ä¿å…³é”®å†³ç­–å¹¶ä¸”æœ‰å¯ä¿¡çš„å›¢ä½“å»ä¸“é—¨ç›‘ç£ï¼ˆä¸­å¿ƒåŒ–çš„ï¼‰ï¼Œæ­¤é˜¶æ®µçš„ç”¨æˆ·æ‹¥æœ‰é€€å‡ºæœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¸ƒå¤©å†…ç¦»å¼€rollupï¼Œä½†æ˜¯é€šå¸¸éœ€è¦å®ä½“å’Œè¿è¥æ–¹çš„æ“ä½œè¿›è¡Œç»“åˆã€‚
Stage 1
ä¸­å¿ƒåŒ–çš„æ²»ç†æ¼”åŒ–ä¸ºæ™ºèƒ½åˆçº¦ç®¡ç†ï¼Œå½“ç„¶å®‰å…¨å§”å‘˜ä¼šåŒæ—¶å‘æŒ¥ä½œç”¨ã€‚
è¯æ˜ç³»ç»Ÿå®Œå…¨å¼€å§‹è¿ä½œï¼Œæ”¯æŒå»ä¸­å¿ƒåŒ–çš„æœ‰æ•ˆè¯æ˜ã€‚
é€€å‡ºæœºåˆ¶ä¹Ÿå¾—åˆ°æ”¹è¿›ï¼Œç”¨æˆ·å¯ç‹¬ç«‹é€€å‡ºè€Œæ— éœ€è¿è¥æ–¹åè°ƒã€‚
Stage 2
é€šè¿‡å®Œå…¨ç”±æ™ºèƒ½åˆçº¦ç®¡ç†çš„æ²»ç†æœºåˆ¶å®ç°å®Œå…¨å»ä¸­å¿ƒåŒ–ã€‚
æ— éœ€è¿è¥æ–¹å’Œå®‰å…¨å§”å‘˜ä¼šå¹²é¢„ã€‚
è¯æ˜ç³»ç»Ÿæ˜¯æ— è®¸å¯çš„ï¼Œé€€å‡ºæœºåˆ¶ä¹Ÿå®Œå…¨å»ä¸­å¿ƒåŒ–ã€‚
ZKSync Risk Analysis[é£é™©åˆ†æ]
https://l2beat.com/scaling/summary  L2Beatæ‘˜è¦ä¸­å¯ä»¥æŸ¥çœ‹å„Rollupæ‰€å¤„çš„stage
Risksé‚£ä¸€åˆ—çš„é¥¼å›¾å¯ä»¥ä½“ç°å½“å‰é˜¶æ®µçš„ä¸€äº›é£é™©ï¼Œä¾‹å¦‚ZkSync Eraä¸“å±é¡µé¢ä¸­ï¼š



Data Availability: refers to the ability to reconstruct the L2 state from L1 data, ensuring that anyone can verify and rebuild the L2 state if necessary.
èƒ½å¤Ÿä»L1çš„æ•°æ®ä¸­é‡å»ºL2çŠ¶æ€


State Validation: involves verifying the legitimacy of a set of bundled transactions. For ZK Sync, this is done using zero-knowledge proofs through an algorithm known as PLONK (Permutations over Lagrange-bases for Oecumenical Noninteractive arguments of Knowledge).
æ¶‰åŠéªŒè¯ä¸€ç»„æ‰“åŒ…äº¤æ˜“çš„åˆæ³•æ€§ã€‚


Sequencer Failure: describes the ability to process transactions even if the sequencer is down. In ZK Sync, transactions can still be submitted to L1, though not necessarily enforced immediately.
æ’åºå™¨æ•…éšœï¼Œæè¿°äº†å³ä½¿æ’åºå™¨å®•æœºè¿˜èƒ½å¤Ÿå¤„ç†äº¤æ˜“çš„èƒ½åŠ›ï¼Œè¿™é‡Œé»„è‰²åŒºå—è¡¨ç¤ºï¼Œåœ¨ZKsyncä¸­ï¼Œäº¤æ˜“ä»ç„¶å¯ä»¥æäº¤åˆ°L1ï¼Œä½†ä¸ä¸€å®šèƒ½å¤Ÿå¼ºåˆ¶æ‰§è¡Œã€‚

æ’åºå™¨ï¼šæ˜¯è´Ÿè´£å¯¹æ‰“åŒ…çš„ç”¨æˆ·äº¤æ˜“è¿›è¡Œæ’åºçš„æ“ä½œæ–¹ï¼ˆè¿è¥å•†ï¼‰
The sequencer is the operator responsible for ordering user transactions and often batching them before committing them to Layer 1.



Proposer Failure: describes the ability to process transactions even if the proposer is down. In this case, ZK Sync will halt all withdrawals and transactions executions.
æè®®è€…å®•æœºä½†æ˜¯å¯ä»¥å¤„ç†äº¤æ˜“çš„èƒ½åŠ›ã€‚åœ¨Zksyncä¸­å›æš‚åœæ‰€æœ‰çš„ææ¬¾å’Œäº¤æ˜“æ‰§è¡Œã€‚


Exit Window: In the current ZK Sync stage, there is no window for exit during unwanted upgrades.
çº¢è‰²åŒºå—è¡¨ç¤ºZksyncåœ¨éé¢„æœŸçš„å‡çº§æ—¶ä¸å­˜åœ¨é€€å‡ºçª—å£æœŸã€‚


First Transaction On ZKSync
chainList å®˜ç½‘æœç´¢ZKsync sepolia
https://chainlist.org/?search=zksync+sepolia&amp;testnets=true

è¿›è¡Œconnect


åœ¨zkSyncå®˜ç½‘çš„block explorer ä¸­ï¼Œå¯æœç´¢åˆ°è‡ªå·±çš„è´¦æˆ·ï¼ŒæŸ¥çœ‹äº¤æ˜“è¯¦æƒ…
å¦‚ä½•è·å–æµ‹è¯•ç½‘ç»œçš„åŸºé‡‘ï¼Ÿ

ğŸ“’ NOTE
Network Fauncets

è¿™é‡Œå¯ä»¥é€šè¿‡brigeæ¡¥æ¥æºé“¾å’Œç›®æ ‡é“¾æ¥è¿›è¡Œï¼Œä¹Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯lockå’Œunlock å¦ä¸€ç§æ˜¯çƒ§æ¯å’Œé“¸é€ ï¼›
å¯èƒ½ä¼šæœ‰å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯åŸºäºZkSyncä½¿ç”¨è¿‡ç¨‹çš„ç»éªŒæ¥è¯´ï¼Œæ˜¯æ¯”è¾ƒå®‰å…¨çš„ã€‚

äº†è§£åŸç†ä¹‹åï¼Œæˆ‘ä»¬åœ¨æ¨èçš„faunceté‡Œè·å–æˆ‘ä»¬çš„fund

è¿™é‡Œæˆ‘reciveå¤±è´¥äº†ï¼Œé‡æ–°æ‰¾äº†å…¶ä»–funsets ï¼Œå¯ä»¥ç”¨å›tenderlyè¯•è¯•çœ‹
Solidity åŸºç¡€[part1]
Remix IDE

å‡½æ•°
æ— è¿”å›ä½“å‡½æ•°ç¤ºä¾‹ï¼š
// SPDX-License-Identifier: MIT
pragma solidity 0.8.19; // chose our solidity version 

contract SimpleStorage &#123;
    uint256 public myFavoriteNumber; // åˆå§‹å€¼å°±æ˜¯0 è€Œä¸”æ˜¯internal ä¹Ÿå°±æ˜¯å†…éƒ¨ä¸å¯è§çš„

    function store(uint256 favoriteNumber) public &#123;
        myFavoriteNumber = favoriteNumber;
    &#125;

&#125;
æœ‰è¿”å›ä½“ç¤ºä¾‹ï¼š
function recive() public view returns (uint256) &#123;
       return myFavoriteNumber;
   &#125;
æ•°ç»„
// æ•°ç»„
uint256[] public myFavoriteNumbers;


Person public newPerson = Person(1, 'jack');

Person public myPerson;


function setPerson(string memory name, uint256 person_number) public &#123;
    myPersonArray.push(Person(person_number,name));
&#125;

ç»“æ„
// ç»“æ„
    struct Person &#123;
        uint256 personNumber;
        string name;
    &#125;

æ•°ç»„åŠ ç»“æ„
// æ•°ç»„åŠ ç»“æ„
 Person[] public myPersonArray;
å¯è§æ€§
å‡½æ•°å’Œå˜é‡æœ‰å››ç§å¯è§æ€§ä¿®é¥°ç¬¦ï¼š

publicï¼šå¯ä»åˆçº¦å†…éƒ¨å’Œå¤–éƒ¨åˆçº¦è®¿é—®
privateï¼šä»…é™å½“å‰åˆçº¦å†…éƒ¨è®¿é—®ã€‚ä¸ä¼šéšè—å€¼ï¼Œä»…é™åˆ¶å…¶è®¿é—®æƒé™ã€‚
externalï¼šä»…é€‚ç”¨äºå¤–éƒ¨çš„åˆçº¦è®¿é—®ã€‚âš ï¸
internalï¼š å½“å‰åˆçº¦å’Œæ´¾ç”Ÿçš„åˆçº¦å¯ä»¥è®¿é—®ã€‚

å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯internal
view ã€pure
å‡½æ•°æ“ä½œæƒé™ä¿®é¥°ç¬¦
1. view å…³é”®å­—


åŠŸèƒ½ï¼šä½¿ç”¨viewå…³é”®å­—ä¿®é¥°çš„å‡½æ•°ï¼Œæ‰¿è¯ºä¸ä¼šå¯¹åŒºå—é“¾çš„çŠ¶æ€è¿›è¡Œä¿®æ”¹ã€‚


å¯æ‰§è¡Œæ“ä½œ

èƒ½å¤Ÿè¯»å–åŒºå—é“¾ä¸Šçš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯çŠ¶æ€å˜é‡ï¼‰ã€‚
å¯ä»¥è®¿é—® msg.senderã€block.number ç­‰å…¨å±€å˜é‡ã€‚
æ”¯æŒè°ƒç”¨å…¶ä»–åŒæ ·è¢«æ ‡è®°ä¸ºviewæˆ–è€…pureçš„å‡½æ•°ã€‚



ä¸å¯æ‰§è¡Œæ“ä½œï¼šç¦æ­¢å¯¹çŠ¶æ€å˜é‡è¿›è¡Œå†™å…¥æ“ä½œã€‚


ç¤ºä¾‹ï¼š


contract ViewExample &#123;
    uint public balance;

    // æ­¤å‡½æ•°ä»…è¯»å–çŠ¶æ€å˜é‡ï¼Œä¸ä¼šå¯¹å…¶è¿›è¡Œä¿®æ”¹
    function getBalance() public view returns (uint) &#123;
        return balance;
    &#125;
&#125;
2. pure å…³é”®å­—


åŠŸèƒ½ï¼šè¢«pureå…³é”®å­—ä¿®é¥°çš„å‡½æ•°ï¼Œæ—¢ä¸ä¼šè¯»å–ä¹Ÿä¸ä¼šä¿®æ”¹åŒºå—é“¾çš„çŠ¶æ€ã€‚


å¯æ‰§è¡Œæ“ä½œ

å¯ä»¥ä½¿ç”¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚
èƒ½å¤Ÿæ“ä½œä¼ å…¥å‡½æ•°çš„å‚æ•°ã€‚
æ”¯æŒè¿›è¡Œæ•°å­¦è¿ç®—ã€‚
å¯ä»¥è°ƒç”¨å…¶ä»–pureå‡½æ•°ã€‚



ä¸å¯æ‰§è¡Œæ“ä½œ

ç¦æ­¢è®¿é—®çŠ¶æ€å˜é‡ã€‚
ä¸å…è®¸è°ƒç”¨éviewæˆ–pureçš„å‡½æ•°ã€‚



ç¤ºä¾‹ï¼š


contract PureExample &#123;
    // è¯¥å‡½æ•°ä¸ä¾èµ–ä»»ä½•çŠ¶æ€å˜é‡ï¼Œä»…å¯¹è¾“å…¥å‚æ•°è¿›è¡Œè®¡ç®—
    function add(uint a, uint b) public pure returns (uint) &#123;
        return a + b;
    &#125;
&#125;
3. å…³é”®åŒºåˆ«



ç‰¹æ€§
view å‡½æ•°
pure å‡½æ•°




èƒ½å¦è¯»å–çŠ¶æ€å˜é‡
å¯ä»¥
ä¸å¯ä»¥


èƒ½å¦ä¿®æ”¹çŠ¶æ€å˜é‡
ä¸å¯ä»¥
ä¸å¯ä»¥


æ˜¯å¦æ¶ˆè€— Gasï¼ˆå¤–éƒ¨è°ƒç”¨æ—¶ï¼‰
ä¸æ¶ˆè€—
ä¸æ¶ˆè€—


æ˜¯å¦æ¶ˆè€— Gasï¼ˆå†…éƒ¨è°ƒç”¨æ—¶ï¼‰
æ¶ˆè€—
æ¶ˆè€—




âš ï¸ ä¸€èˆ¬è°ƒç”¨è¿™ä¸¤ä¸ªå…³é”®å­—éƒ½ä¸ä¼šæ¶ˆè€—gasè´¹ï¼Œ ä½†æ˜¯å¦‚æœæ˜¯å†…éƒ¨è°ƒç”¨ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­, storeé‡Œé¢è°ƒç”¨reciveå°±ä¼šå¯¼è‡´gasè´¹äº§ç”Ÿã€‚

function store(uint256 favoriteNumber) public &#123;// å­˜å‚¨
       myFavoriteNumber = favoriteNumber;
       recive(favoriteNumber);
   &#125;

 function recive() public view returns (uint256) &#123;
     return myFavoriteNumber;
 &#125;
å®Œæ•´ä»£ç ï¼š
// SPDX-License-Identifier: MIT
pragma solidity 0.8.19; // stating our version 

contract SimpleStorage &#123;
    uint256 public myFavoriteNumber; // åˆå§‹å€¼å°±æ˜¯0 è€Œä¸”æ˜¯internal ä¹Ÿå°±æ˜¯å†…éƒ¨ä¸å¯è§çš„



    // æ•°ç»„
    uint256[] public myFavoriteNumbers;

    // ç»“æ„
    struct Person &#123;
        uint256 personNumber;
        string name;
    &#125;

    Person public newPerson = Person(1, 'jack');

    Person public myPerson;

    Person[] public myPersonArray;

    function setPerson(string memory name, uint256 person_number) public &#123;
        myPerson = Person(person_number, name);
        myPersonArray.push(myPerson);
    &#125;

    function store(uint256 favoriteNumber) public &#123;// å­˜å‚¨
        myFavoriteNumber = favoriteNumber;
    &#125;

    // view å¯è¯»ä¸å¯å†™ pure ä¸å¯è¯»ä¸å¯å†™
    function recive() public view returns (uint256) &#123;
        return myFavoriteNumber;
    &#125;



&#125;
]]></content>
      <categories>
        <category>Web3</category>
      </categories>
      <tags>
        <tag>Solidity</tag>
        <tag>BlockChain</tag>
      </tags>
  </entry>
  <entry>
    <title>SolidityåŸºç¡€[part2]</title>
    <url>/2025/06/26/WEB3%20Day3%20%E2%80%94%E2%80%94%20Solidity%E5%9F%BA%E7%A1%80%5Bpart2%5D/</url>
    <content><![CDATA[WEB3 Day3 â€” SolidityåŸºç¡€[part2]
å­˜å‚¨ä½ç½®
solidityé‡Œé¢æœ‰å…­ç§å­˜å‚¨ä½ç½®ã€‚

Calldata
Memory
Storage
Stack
Code
Logs

calldataå’Œmemoryæ˜¯å‡½æ•°æ‰§è¡ŒæœŸé—´å˜é‡çš„ä¸´æ—¶å­˜å‚¨ä½ç½®ï¼Œcalldataåªè¯»ï¼Œç”¨äºä¸å¯ä¿®æ”¹çš„å‡½æ•°è¾“å…¥ã€‚
ç›¸æ¯”ä¹‹ä¸‹ï¼Œmemoryå…è®¸è¯»å†™è®¿é—®ï¼Œä½¿å˜é‡èƒ½åœ¨å‡½æ•°å†…éƒ¨è¢«ä¿®æ”¹ã€‚
è¦ä¿®æ”¹calldataå˜é‡ï¼Œå¿…é¡»å…ˆè®²å®ƒä»¬åŠ è½½åˆ°memoryä¸­ã€‚
Calldata
åªè¯»çš„ï¼Œ æ¯”storageæ›´ç»æµï¼Œä¸»è¦ç”¨äºè¾“å…¥ã€‚
ä¸‹é¢å‡½æ•°ä¸­_name ç”¨calldataå…³é”®å­—ï¼Œå°±ä¼šæ”¶åˆ°é”™è¯¯æç¤ºï¼Œå› ä¸ºä¸å¯ä¿®æ”¹ã€‚

Memory
å¯è¯»å¯ä¿®æ”¹ï¼Œå¤§å¤šæ•°çš„å˜é‡é»˜è®¤è‡ªåŠ¨ä½¿ç”¨memoryï¼Œä½†æ˜¯å­—ç¬¦ä¸²ä¸èƒ½é»˜è®¤ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šmemoryæˆ–è€…calldata
string memory variableName = "someValue";
ä¸‹é¢ä¼šè®²åˆ°ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆç‰¹æ®Š
storage
å­˜å‚¨åœ¨storageçš„å˜é‡åœ¨åŒºå—é“¾ä¸Šæ˜¯æŒä¹…åŒ–çš„ï¼Œå…¶å€¼åœ¨å‡½æ•°è°ƒç”¨å’Œäº¤æ˜“ä¹‹é—´ä¿æŒä¸å˜ã€‚
æ¯”å¦‚ä¸‹é¢è¿™ä¸ªå˜é‡ favoriteNumber ï¼Œå£°æ˜åœ¨å‡½æ•°å¤–éƒ¨ï¼Œä¼šè¢«éšå¼è½¬æ¢ä¸ºå­˜å‚¨å˜é‡ã€‚
contract MyContract &#123;
    uint256 favoriteNumber; // this is a storage variable
&#125;;

âš ï¸ åŒç†ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¹Ÿä¸èƒ½ä½¿ç”¨storageï¼Œå› ä¸ºå‡½æ•°ä¸­çš„å˜é‡éƒ½æ˜¯ä¸´æ—¶å­˜åœ¨ã€‚

å­—ç¬¦ä¸²å’ŒåŸºæœ¬ç±»å‹çš„ç‰¹æ®Šå­˜å‚¨
åœ¨Solidityä¸­ï¼Œstringæ˜¯å­—èŠ‚æ•°æ®ï¼Œarrays of bytesï¼Œåœ¨ä¸Šæ–‡ä¸­æè¿‡éœ€è¦æŒ‡å®šç¡®åˆ‡çš„å­˜å‚¨ä½ç½®ï¼›
å¦ä¸€æ–¹é¢ï¼Œuint256åŸºæœ¬ç±»å‹æœ‰å†…ç½®æœºåˆ¶ï¼Œç”¨äºè§„å®šå®ƒä»¬çš„å­˜å‚¨ã€è®¿é—®å’Œæ“ä½œæ–¹å¼åŠä½ç½®ã€‚
æ‰€ä»¥ï¼Œåœ¨å‡½æ•°ç»™uint256æŒ‡å®šå…³é”®å­—å°±ä¼šæŠ¥é”™

mappingç±»å‹
éå†è¿‡äºæ¶ˆè€—èµ„æºï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨mappingç»“æ„
mapping (string => uint256) public nameToFavoriteNumber;
ğŸ§‘â€ğŸ’» Test yourself

ğŸ“• How does the Solidity compiler handle primitive types and strings in terms of memory management?
ğŸ“• Why canâ€™t the storage keyword be used for variables inside a function?
ğŸ§‘â€ğŸ’» Write a smart contract that uses storage, memory and calldata keywords for its variables.

]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Solidity</tag>
      </tags>
  </entry>
  <entry>
    <title>SolidityåŸºç¡€[part3]</title>
    <url>/2025/07/01/WEB3%20Day4%20%E2%80%94%20Solidity%E5%9F%BA%E7%A1%80%5Bpart3%5D/</url>
    <content><![CDATA[WEB3 Day4â€”SolidityåŸºç¡€[part3]
æ™ºèƒ½åˆçº¦éƒ¨ç½² Smart Contracts Deploying
Sepolia TestNet deploying
æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿›å…¥éƒ¨ç½²é€‰é¡¹å¡ï¼Œä»æœ¬åœ°è™šæ‹Ÿç¯å¢ƒï¼ˆRemix VMï¼‰åˆ‡æ¢åˆ°æ³¨å…¥çš„æä¾›è€… - MetaMask æ¥å¼€å§‹éƒ¨ç½²è¿‡ç¨‹ã€‚è¿™ä¸€æ“ä½œå°†å…è®¸Remixå‘é€è¯·æ±‚å¹¶ä¸æ‚¨çš„MetaMaskè´¦æˆ·è¿›è¡Œäº¤äº’ã€‚

éšåç³»ç»Ÿä¼šæç¤ºä½ å»é€‰æ‹©ä¸€ä¸ªè´¦å·ã€‚ åœ¨ä½ æˆåŠŸè¿æ¥åˆ°remixä¹‹åï¼Œä½ ä¼šçœ‹åˆ°è´¦å·å·²ç»æˆåŠŸé“¾æ¥åˆ°å¹¶ä¸”æ­£åœ¨ä½¿ç”¨sepoliaç½‘ç»œçš„ä¿¡æ¯ã€‚

æ³¨æ„ï¼Œéœ€è¦ä½ çš„æµ‹è¯•ç½‘ç»œé‡Œé¢å¿…é¡»æœ‰è¶³å¤Ÿçš„ sepolia ETHï¼Œå¦‚æœæ²¡æœ‰éœ€è¦ä»æ°´é¾™å¤´è·å–ï¼Œå…è´¹çš„æ°´é¾™å¤´æˆ‘è¿™è¾¹ä¼šé›†ä¸­æ”¶é›†ä¸€æ¬¡ï¼Œåç»­å¯ç‚¹å‡»è¿™ç¯‡æ–‡ç« ï¼šã€TODO æŒ–ä¸ªå‘ã€‘ï¼›
æš‚æ—¶å¯ä»¥å»è¿™é‡Œfaucetï¼Œ ä½†æ˜¯è¿˜æ˜¯éœ€è¦ä¸»è´¦æˆ·é‡Œé¢è¦æœ‰etherã€‚
éšåï¼ŒMetaMaskå°±ä¼šè¦æ±‚ä½ åœ¨æµ‹è¯•ç½‘ç«™ä¸Šç­¾ç½²å‘é€ï¼š

äº¤æ˜“æ‰§è¡Œä¹‹åï¼Œåˆçº¦åœ°å€ä¼šå°†äº¤æ˜“è¯¦æƒ…ä¸€åŒæ˜¾ç¤ºåœ¨å·²éƒ¨ç½²çš„åˆçº¦åˆ—è¡¨ä¸‹é¢ã€‚è¿™å°±æ˜¯Eherscanä¸Šéƒ¨ç½²äº¤æ˜“çš„æ˜¾ç¤ºæ–¹å¼ã€‚

åˆçº¦äº¤äº’ Contract interaction
åˆçº¦éƒ¨ç½²å®Œæˆä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä¹‹äº¤äº’å¹¶æ›´æ–°åŒºå—é“¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³å­˜å‚¨ä¸€ä¸ªæ•°å­—ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»storeæŒ‰é’®å®ç°ï¼›MetaMaskä¼šè¦æ±‚å†æ¬¡ç¡®è®¤äº¤æ˜“ã€‚ç„¶åæ›´è¡Œæ‚¨è®¾ç½®çš„æ•°å­—ã€‚è¿™äº›äº¤æ˜“éƒ½å¯ä»¥é€šè¿‡éƒ¨ç½²åœ°å€åœ¨etherscanä¸Šé¢æŸ¥è¯¢æŸ¥çœ‹ã€‚
Zksyncéƒ¨ç½²
ç”±äºä»¥å¤ªåŠä¸»ç½‘åˆçº¦éƒ¨ç½²æˆæœ¬æ¯”è¾ƒé«˜æ˜‚ï¼Œæ‰€ä»¥RollUpå’ŒLayer2ç½‘ç»œç­‰æ‰©å®¹è§£å†³æ–¹æ¡ˆæ›´ä½³ï¼Œéœ€è¦æŒæ¡éƒ¨ç½²åœ¨Zksyncçš„æµç¨‹ã€‚
é¦–å…ˆéœ€è¦Zksyncçš„æµ‹è¯•ç½‘åŸºé‡‘ä»¥åŠzkSyncçš„è·¨é“¾æ¡¥
å¯å‚ç…§ä¹‹å‰çš„ç¬”è®°
ç„¶åæ­¥éª¤å’Œä¸Šé¢ä¸»ç½‘çš„æµ‹è¯•ç½‘ç»œéƒ¨ç½²ç›¸ä¼¼ï¼Œåªä¸è¿‡éœ€è¦è·¨é“¾

è¿æ¥é’±åŒ…
éœ€è¦å°†Sepolia ETHè·¨é“¾åˆ°zkSyncï¼ŒZksync Bridgeåœ°å€

è¿æ¥é’±åŒ…ï¼Œä¿è¯ç½‘ç»œåœ¨sepolia
ä»sepoliaæµ‹è¯•ç½‘å‘é€ethåˆ°zksync




â€‹	


æœ‰æµ‹è¯•åŸºé‡‘ä»¥åï¼Œéœ€è¦å°†remixIDE ä¸‹è½½zksyncçš„æ’ä»¶



âš ï¸ zkSyncéƒ¨ç½²ç‰ˆæœ¬è¦æ±‚ â€˜0.8.24â€™ï¼Œå¹¶ä¸”åˆçº¦*.solæ–‡ä»¶å¿…é¡»æ”¾åœ¨ä¸€ä¸ªcontractsæ–‡ä»¶å¤¹ä¸­ï¼Œä¸ç„¶Zksynæ’ä»¶çš„deployæ ‡ç­¾é¡µå¯èƒ½ä¼šæ˜¾ç¤ºç©ºç™½


ç¼–è¯‘â€”â€”&gt;è¿æ¥é’±åŒ…â€”â€”&gt; éƒ¨ç½²



åˆçº¦ä¹‹é—´å¦‚ä½•ç›¸äº’éƒ¨ç½²ä»¥åŠäº¤äº’
é€šè¿‡importè¿›è¡Œå¯¼å…¥å¦ä¸€ä¸ªåˆçº¦
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.18;

import "./SimpleStorage.sol";

contract StorageFacotory &#123;

    SimpleStorage public simpleStorage;


    function createSimpleStorageContract() public  &#123;
        simpleStorage = new SimpleStorage();
    &#125;
&#125;
å¦‚æœå¯¼å…¥æ–‡ä»¶æœ‰å¤šä¸ªåˆçº¦ï¼Œä¸€èˆ¬importæœ€å¥½å£°æ˜å…·ä½“çš„åç§°ï¼Œå¯ä»¥ä¸ç”¨å¯¼å…¥è¯¥æ–‡ä»¶çš„æ‰€æœ‰åˆçº¦
import &#123;SimpleStorage, SimpleStorage2&#125; from "./SimpleStorage.sol";
è°ƒç”¨å¦å¤–ä¸€ä¸ªåˆçº¦çš„ABI[application binary interface]
å¯ä»¥åˆ›é€ ä¸€ä¸ªSimpleStorageçš„æ•°ç»„æ¥å­˜å‚¨æ‰€æœ‰åˆ›å»ºçš„simpleStorageçš„åœ°å€ï¼Œç„¶åé€šè¿‡åœ°å€å»è°ƒç”¨ç‰¹å®šçš„simplestorageçš„å‡½æ•°

pragma solidity ^0.8.19;

import &#123;SimpleStorage&#125; from "./SimpleStorage.sol";
contract StorageFacotory &#123;

    SimpleStorage[] public listOfSimpleStorage;


    // åˆ›å»ºéœ€è¦çš„SimpleStorage
    function createSimpleStorageContract() public  &#123;
        SimpleStorage simpleStorage = new SimpleStorage();
        listOfSimpleStorage.push(simpleStorage);
    &#125;

    // è°ƒç”¨simpleStorageçš„storeå‡½æ•°
    function sfStore(uint256 _index, uint256 myFavoriteNumber) public&#123;
        listOfSimpleStorage[_index].store(myFavoriteNumber);
    &#125;

    // è°ƒç”¨simpleStorageé‡Œé¢çš„reciveå‡½æ•°
    function sfRecive(uint256 _index) public view returns (uint256) &#123;
        return listOfSimpleStorage[_index].recive();
    &#125;

&#125;

ç»§æ‰¿å’Œé‡å†™
åˆ›å»ºç»§æ‰¿è‡ª SimpleStorage.sol çš„æ–°åˆçº¦ AddFiveStorage.solï¼Œå¹¶é€šè¿‡é‡å†™å‡½æ•°å®ç°åŠŸèƒ½æ‰©å±•ã€‚
SimpleStorage.solä»£ç 

virtual è¡¨ç¤ºåŸå‡½æ•°å¯ä»¥è¢«ç»§æ‰¿

function store(uint256 favoriteNumber) public virtual  &#123;// å­˜å‚¨
     myFavoriteNumber = favoriteNumber;
 &#125;
AddFiveStorage.solä»£ç 
// SPDX-License-Identifier:MIT

pragma solidity ^0.8.18;

import &#123;SimpleStorage&#125; from "./SimpleStorage.sol";

contract AddFiveStorage is SimpleStorage &#123;


    // éœ€è¦overrideå…³é”®å­— åŸå‡½æ•°éœ€è¦åŠ ä¸Švirtualå‡½æ•°
   function store(uint256 favoriteNumber) public override &#123;// å­˜å‚¨
        myFavoriteNumber = favoriteNumber + 5;
    &#125;
&#125;

is è¡¨ç¤ºç»§æ‰¿
override å…³é”®å­—è¡¨ç¤ºé‡å†™

]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Solidity</tag>
      </tags>
  </entry>
  <entry>
    <title>SolidityåŸºç¡€[part4]</title>
    <url>/2025/07/01/WEB3-Day5%E2%80%94Solidity%E5%9F%BA%E7%A1%80-part4/</url>
    <content><![CDATA[WEB3-Day5â€”SolidityåŸºç¡€[part4]
é€šè¿‡å‡½æ•°å‘é€ETH
æ–°å»ºåˆçº¦ FundMe.solï¼Œåœ¨æœ¬åˆçº¦ä¸­ä¼šé€šè¿‡fund()å‡½æ•°å‘æ™ºèƒ½åˆçº¦è½¬ç§»ä»¥å¤ªå¸ã€‚è¯¥å‡½æ•°å°†è¦æ±‚æœ€ä½æ•°é‡çš„ETHç¡®ä¿äº¤æ˜“æ­£å¸¸ã€‚
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract FundMe&#123;


    function fund() public &#123;
        
    &#125;
&#125;
æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªWithdrawå‡½æ•°ï¼Œè¿™æ ·åˆçº¦çš„owner(æ‹¥æœ‰è€…)å¯ä»¥æå–ä¸åŒçš„funder å‘é€çš„èµ„é‡‘ã€‚
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract FundMe&#123;


    function fund() public &#123;
        
    &#125;

    function withDraw() public &#123;
        
    &#125;
&#125;
å½“äº¤æ˜“è¢«å‘é€åˆ°åŒºå—é“¾æ—¶ï¼Œäº¤æ˜“æ•°æ®ä¸­å§‹ç»ˆåŒ…å«ä¸€ä¸ªvalueå­—æ®µã€‚è¯¥å­—æ®µè¡¨ç¤ºè¯¥äº¤æ˜“ä¸­è½¬è´¦çš„åŸç”ŸåŠ å¯†è´§å¸æ•°é‡ã€‚
è¦ä½¿fundå‡½æ•°å¯ä»¥æ¥å—etherï¼Œå¿…é¡»å°†å…¶å£°æ˜ä¸ºpayableã€‚åŒæ—¶åœ¨remixç•Œé¢ä¸­éƒ¨ç½²äº†å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªå…³é”®å­—ä¼šä½¿å‡½æ•°æ˜¾ç¤ºä¸ºçº¢è‰²ï¼Œè¡¨ç¤ºå®ƒå¯ä»¥æ¥å—åŠ å¯†è´§å¸ã€‚
function fund() public payable &#123;
        
    &#125;
msy.value å±æ€§
åœ¨solidityä¸­ï¼Œäº¤æ˜“çš„æ•°å€¼å¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§è¿›è¡Œè®¿é—®ï¼Œæ˜¯å…¨å±€å¯¹è±¡msgçš„ä¸€éƒ¨åˆ†ï¼Œè¡¨ç¤ºå½“å‰äº¤æ˜“ä¸­ä¼ è¾“çš„Weiçš„æ•°é‡ã€‚ã€Weiæ˜¯ETHçš„æœ€å°å•ä½ã€‘
function fund() public payable &#123;
    
    msg.value;
&#125;
äº¤æ˜“å­—æ®µ
ä»¥å¤ªåŠä¸Šå‘é€çš„æ¯ç¬”äº¤æ˜“éƒ½åŒ…å«ä¸€äº›å¿…è¦å­—æ®µï¼Œè¿™äº›å­—æ®µåŒ…æ‹¬ï¼š

Nonceï¼šè¿™æ˜¯å‘é€åœ°å€çš„äº¤æ˜“è®¡æ•°å™¨ã€‚å®ƒç¡®ä¿äº¤æ˜“æŒ‰é¡ºåºæ‰§è¡Œï¼Œå¹¶é˜²æ­¢é‡æ’­æ”»å‡»ã€‚
Gas Priceï¼šè¿™æ˜¯å‘é€è€…æ„¿æ„æ”¯ä»˜çš„ gas å•ä»·ï¼Œä»¥å¤ªåŠç½‘ç»œä¼šæ ¹æ® gas price å’Œ gas limit æ¥è®¡ç®—æ‰‹ç»­è´¹ã€‚
Gas Limitï¼šè¿™æ˜¯äº¤æ˜“æ‰§è¡Œæ‰€éœ€çš„æœ€å¤§ gas æ•°é‡ã€‚å®ƒå†³å®šäº†äº¤æ˜“çš„å¤æ‚ç¨‹åº¦å’Œæˆæœ¬ã€‚
Toï¼šè¿™æ˜¯æ¥æ”¶ä»¥å¤ªå¸æˆ–è€…è°ƒç”¨æ™ºèƒ½åˆçº¦çš„ç›®æ ‡åœ°å€ã€‚
Valueï¼šè¿™æ˜¯å‘é€çš„ä»¥å¤ªå¸æ•°é‡ã€‚
Dataï¼šè¿™æ˜¯å¯é€‰å­—æ®µï¼Œç”¨äºå‘æ™ºèƒ½åˆçº¦å‘é€æ•°æ®ã€‚
vã€rã€sï¼šè¿™äº›å­—æ®µç”¨äºäº¤æ˜“çš„ç­¾åéªŒè¯ï¼Œç¡®ä¿äº¤æ˜“çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚

åœ¨è½¬è´¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¡«å……å…¶ä¸­ä¸€äº›å­—æ®µï¼Œä¾‹å¦‚ï¼Œgas limitä¸­å¡«å……çš„21,000ï¼Œdataæ˜¯ç©ºçš„ï¼Œç„¶åtoæ˜¯æˆ‘ä»¬æƒ³è¦å°†äº¤æ˜“å‘é€åˆ°çš„åœ°å€ï¼Œåœ¨å‡½æ•°è°ƒç”¨çš„äº¤æ˜“ä¸­ï¼Œä»ç„¶å¯ä»¥ä»¥è¿™ç§æ–¹å¼å¡«å†™toï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åŒæ—¶è¿›è¡Œè½¬è´¦ã€‚
Value
æ¯å½“æˆ‘ä»¬åœ¨ä»»ä½•ä¸€ä¸ªå…¼å®¹EVMçš„åŒºå—é“¾ä¸Šåˆ›å»ºä¸€ç¬”äº¤æ˜“æ—¶ï¼Œè¿™ä¸ªvalueçš„å€¼ï¼Œä»£è¡¨æˆ‘ä»¬å°†é€šè¿‡è¿™ç¬”äº¤æ˜“å‘é€å¤šå°‘ETHï¼Œå½“æˆ‘ä»¬åœ¨ä¸åŒè´¦æˆ·é—´è½¬ç§»ETHæ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨valueä¸­å¡«å……ä¸åŒçš„ETHæ•°é‡ã€‚

æ’¤é”€äº¤æ˜“[Reverting Transactions]
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨requireså…³é”®å­—ä½œä¸ºæ£€æŸ¥å™¨ï¼Œå¼ºåˆ¶è¦æ±‚å‡½æ•°æ¥æ”¶è‡³å°‘valueä¸ªå®Œæ•´çš„ä»¥å¤ªå¸, ä¸æ»¡è¶³å°±ä¼šå›æ»šã€‚
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract FundMe&#123;


    function fund() public payable &#123;
        require(msg.value > 1 ether, "Didn't send enough ETH"); //if the condition is false, revert with the error message    &#125;
    &#125;
    function withDraw() public &#123;
        
    &#125;
&#125;
msg.value &gt; 1 etherç­‰åŒäº msg.value &gt; 1e18

ğŸ‘€â—æç¤º
1 Ether = 1e9 Gwei = 1e18 Wei
Gweiæ˜¯Gasè´¹ç”¨çš„å•ä½ã€‚

åœ¨çº¿è½¬æ¢å•ä½çš„å·¥å…· ï¼šEthconverter
å›æ»šæ“ä½œä¼šæ’¤é”€ä¹‹å‰çš„æ‰€æœ‰æ“ä½œï¼Œå¹¶å°†å‰©ä½™gasè´¹è¿”è¿˜ç»™äº¤æ˜“è€…ï¼Œæˆ‘ä»¬åœ¨fundå‡½æ•°ä¸­æ·»åŠ ä¸€äº›é€»è¾‘ï¼š
myvalue  += 2;
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract FundMe&#123;


    uint256 public  myvalue = 1;
    function fund() public payable &#123;
        myvalue  += 2;
        require(msg.value > 1 ether, "Didn't send enough ETH"); //if the condition is false, revert with the error message    &#125;
    &#125;

    function withDraw() public &#123;

    &#125;
&#125;
éƒ¨ç½²åˆçº¦ï¼Œç‚¹å‡»fundå‡½æ•°ï¼ŒæŠ¥é”™ä¿¡æ¯æˆåŠŸè¿”å›ï¼š


âš ï¸ å›æ»šä»¥åäº¤æ˜“æ¶ˆè€—çš„gasè´¹ä¸ä¼šè¿”å›çš„

]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>BlockChain</tag>
      </tags>
  </entry>
  <entry>
    <title>SolidityåŸºç¡€[part5]</title>
    <url>/2025/07/03/WEB3-Day6%E2%80%94Solidity%E5%9F%BA%E7%A1%80-part5/</url>
    <content><![CDATA[WEB3-Day6â€”SolidityåŸºç¡€[part5]

ç»§ç»­å®Œå–„fundMeåˆçº¦ çš„ fund() å’Œ withDraw()

è½¬æ¢ETHä¸ºUSD
å¦‚æœæˆ‘ä»¬çš„æœ€å°äº¤æ˜“å€¼éœ€è¦ç”¨ç¾å…ƒä¸ºå•ä½ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å’Œmsg.valueè¿›è¡Œæ¯”è¾ƒï¼Ÿ
æ–°å»ºä¸€ä¸ªå˜é‡ï¼š
uint256 public  minimumUsd = 5 * 1e18;  // è¡¥å…¨ç²¾åº¦
æ–°å»ºä¸¤ä¸ªå‡½æ•°ï¼š
// Function to get the price of Ethereum in USD
function getPrice() public &#123;&#125;
// Function to convert a value based on the price
function getConversionRate() public &#123;&#125;

getPrice():è·å–çœŸå®ä¸–ç•Œä¸­ä»¥å¤ªåŠå½“å‰çš„ç¾å…ƒå¸‚åœºä»·æ ¼
getConversionRate()ï¼šæ ¹æ®å½“å‰è¾“å…¥ä»·æ ¼è¿›è¡Œè®¡ç®—å’Œè½¬æ¢

å»ä¸­å¿ƒåŒ–é¢„è¨€æœº
ä»¥å¤ªåŠç­‰èµ„äº§çš„ç¾å…ƒä»·æ ¼æ— æ³•ä»…é€šè¿‡åŒºå—é“¾æŠ€æœ¯è·å–ï¼Œè€Œæ˜¯ç”±é‡‘èå¸‚åœºå†³å®šã€‚ä¸ºäº†è·å–æ­£ç¡®çš„ä»·æ ¼ä¿¡æ¯ï¼Œå¿…é¡»åœ¨é“¾ä¸‹æ•°æ®ä¸é“¾ä¸Šæ•°æ®ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œè¿™ä¸€éœ€æ±‚ç”±å»ä¸­å¿ƒåŒ–é¢„è¨€æœºç½‘ç»œå®ç°ã€‚
åŒºå—é“¾å­˜åœ¨è¿™ä¸€å±€é™æ€§ï¼Œæ˜¯å› ä¸ºå…¶ç¡®å®šæ€§æœ¬è´¨â€”â€”å®ƒç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹è¾¾æˆå”¯ä¸€å…±è¯†ã€‚è‹¥å°è¯•å°†å¤–éƒ¨æ•°æ®å¼•å…¥åŒºå—é“¾ï¼Œå°†ç ´åè¿™ç§å…±è¯†ï¼Œå¯¼è‡´æ‰€è°“çš„æ™ºèƒ½åˆçº¦è¿æ¥æ€§é—®é¢˜æˆ–é¢„è¨€æœºé—®é¢˜ã€‚
è‹¥æƒ³è®©æ™ºèƒ½åˆçº¦æœ‰æ•ˆæ›¿ä»£ä¼ ç»Ÿåè®®ï¼Œå®ƒä»¬å¿…é¡»å…·å¤‡ä¸ç°å®ä¸–ç•Œæ•°æ®äº¤äº’çš„èƒ½åŠ›ã€‚
ä¾èµ–ä¸­å¿ƒåŒ–é¢„è¨€æœºä¼ è¾“æ•°æ®æ˜¯ä¸è¶³çš„ï¼Œå› ä¸ºè¿™ä¼šé‡æ–°å¼•å…¥æ½œåœ¨çš„å•ç‚¹æ•…éšœé£é™©ã€‚ä¸­å¿ƒåŒ–æ•°æ®æºä¼šå‰Šå¼±åŒºå—é“¾åŠŸèƒ½æ‰€å¿…éœ€çš„ä¿¡ä»»å‰æã€‚å› æ­¤ï¼Œä¸­å¿ƒåŒ–èŠ‚ç‚¹æ— æ³•æ»¡è¶³å¤–éƒ¨æ•°æ®æˆ–è®¡ç®—éœ€æ±‚ã€‚Chainlinké€šè¿‡æä¾›å»ä¸­å¿ƒåŒ–é¢„è¨€æœºç½‘ç»œï¼Œè§£å†³äº†è¿™äº›ä¸­å¿ƒåŒ–æŒ‘æˆ˜ã€‚
ChainLinkæ•°æ®æº
Chainlink Data Feed documentation æä¾›å¦‚ä½•ä¸æ•°æ®æºåˆçº¦äº¤äº’çš„æ–‡æ¡£

AggregatorV3Interfaceï¼šæ˜¯ä¸€ä¸ªæ•°æ®æºåœ°å€ä½œä¸ºè¾“å…¥çš„åˆçº¦ã€‚ä¿æŒETH/USDä»·æ ¼å®æ—¶æ›´æ–°ã€‚
åˆçº¦ä¸­çš„latestRoundData å‡½æ•°è¿”å›æœ€æ–°çš„ä»¥å¤ªåŠä»·æ ¼ã€‚
ä¸ºäº†ä½¿ç”¨åˆçº¦ï¼Œæˆ‘ä»¬éœ€è¦å®ƒçš„åœ°å€å’ŒABIã€‚è¯¥åœ°å€å¯åœ¨Chainlinkæ–‡æ¡£ä¸­çš„ Price Feed Contract Addresseséƒ¨åˆ†æ‰¾åˆ°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ETH/USDã€‚
é¦–å…ˆå¯¼å…¥è¯¥åˆçº¦ï¼Œå¯ä»¥é€šè¿‡githubåœ°å€å¯¼å…¥
import &#123;AggregatorV3Interface&#125; from "@chainlink/contracts/src/v0.8/shared/interfaces/AggregatorV3Interface.sol";

åœ¨chainLinkæ‰¾åˆ°ETH/USDåœ°å€ï¼Œè°ƒç”¨latestRoundDataå‡½æ•°è·å–answerï¼Œä¸ç”¨çš„å‚æ•°å¯ä»¥ç”¨,ç›¸éš”ï¼Œå› ä¸ºè¿”å›çš„answeræ˜¯intç±»å‹éœ€è¦è½¬æ¢uint
å®Œå–„getPrice() :
function getPrice() public  view returns(uint256) &#123;
        AggregatorV3Interface addressToBeFetched = AggregatorV3Interface(0x694AA1769357215DE4FAC081bf1f309aDC325306);
        (, int256 answer,,,) = addressToBeFetched.latestRoundData(); // ( ,,,, , )  å–å‡ºåœ°å€ï¼Œå€¼ï¼Œé”™è¯¯ç ç­‰
        return uint256(answer * 1e18);
    &#125;
msg.value æ˜¯ä¸€ä¸ªå…·æœ‰ 18 ä½å°æ•°ç²¾åº¦çš„ uint256 å€¼ã€‚
answer æ˜¯ä¸€ä¸ªå…·æœ‰ 8 ä½å°æ•°ç²¾åº¦çš„ int256 å€¼ï¼ˆåŸºäº USD çš„äº¤æ˜“å¯¹ä½¿ç”¨ 8 ä½å°æ•°ï¼Œè€ŒåŸºäº ETH çš„äº¤æ˜“å¯¹ä½¿ç”¨ 18 ä½å°æ•°ï¼‰ã€‚
è¿™æ„å‘³ç€ä»æˆ‘ä»¬çš„latestRoundDataå‡½æ•°è¿”å›çš„ä»·æ ¼ä¸msg.valueä¸ç›´æ¥å…¼å®¹ã€‚ä¸ºäº†åŒ¹é…å°æ•°ä½æ•°ï¼Œæˆ‘ä»¬å°†ä»·æ ¼ä¹˜ä»¥1e10.

âš ï¸ å§‹ç»ˆå…ˆä¹˜åé™¤ä¿æŒç²¾åº¦é¿å…æˆªæ–­é”™è¯¯ã€‚

å®Œå–„getConversionRate():
function getConversionRate(uint256 ethAmmout) public view returns(uint256) &#123;
      uint256 ethPrice = getPrice();
      return (ethPrice*ethAmmout)/1e18;
  &#125;

uint256 ethAmountInUsd = (ethPrice * ethAmount)
å¾—åˆ°çš„ç»“æœç²¾åº¦ä¸º 1e18 * 1e18 = 1e36ã€‚ä¸ºäº†å°† ethAmountInUsd çš„ç²¾åº¦æ¢å¤åˆ° 1e18ï¼Œæˆ‘ä»¬éœ€è¦å°†ç»“æœé™¤ä»¥ 1e18ã€‚

æ›´æ”¹fund()ï¼š
require(getConversionRate(msg.value) >= MINIMUM_USD, "You need to spend more ETH!");
éƒ¨ç½²åˆçº¦ï¼Œè°ƒç”¨getPriceå‡½æ•°è·å–å½“å‰ä»¥å¤ªåŠä»·æ ¼ã€‚è¿˜å¯ä»¥å‘è¯¥åˆçº¦å‘é€èµ„é‡‘ï¼Œå¦‚æœETHé‡‘é¢ä½äº5ç¾å…ƒå°±ä¸€ä¼šæŠ¥é”™ã€‚
å®Œæ•´ä»£ç ï¼š
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import &#123;AggregatorV3Interface&#125; from "@chainlink/contracts/src/v0.8/shared/interfaces/AggregatorV3Interface.sol";

contract FundMe&#123;
    uint256 public  minimumUsd = 5 * 1e18; // è¡¥å…¨ç²¾åº¦
    
    function fund() public payable &#123;
        require(getConversionRate(msg.value) > minimumUsd, "Didn't send enough ETH"); //if the condition is false, revert with the error message    &#125;
    &#125;

    function withDraw() public &#123;

    &#125;

    // è·å–å½“å‰çš„ethå¯¹åº”å®é™…ä¸–ç•Œçš„ç¾å…ƒä»·æ ¼
    function getPrice() public view returns(uint256) &#123;
        AggregatorV3Interface addressToBeFetched = AggregatorV3Interface(0x1b44F3514812d835EB1BDB0acB33d3fA3351Ee43);
        (, int256 answer,,,) = addressToBeFetched.latestRoundData(); // ( ,,,, , )  å–å‡ºåœ°å€ï¼Œå€¼ï¼Œé”™è¯¯ç ç­‰
        return uint256(answer * 1e18);
    &#125;

    function getConversionRate(uint256 ethAmmout) public view returns(uint256) &#123;
        uint256 ethPrice = getPrice();
        return (ethPrice*ethAmmout)/1e18;
    &#125;

&#125;
è¿½è¸ªèµ„é‡‘
ä¸ºäº†è¿½è¸ªå‘åˆçº¦å‘é€èµ„é‡‘çš„åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºfundersçš„åœ°å€arrayè®°å½•ï¼š
address[] public funders;
fund()å‡½æ•°ä¸­æ·»åŠ ä»¥ä¸‹é€»è¾‘ï¼Œæ¯å½“æœ‰äººå‘åˆçº¦å‘é€é’±æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨pushå‡½æ•°å°†ä»–ä»¬çš„åœ°å€æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼š
funders.push(msg.sender);
åº“[Libraries]
å½“æŸä¸ªåŠŸèƒ½å…·æœ‰é€šç”¨æ€§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªlibraryåº“æ¥é«˜æ•ˆç®¡ç†é‡å¤ä»£ç ã€‚
getPrice()å‡½æ•°å’ŒgetConversionRate()è¿™äº›æ–¹æ³•å¯ä»¥è¢«ä»»ä½•ä½¿ç”¨ä»·æ ¼é¢„è¨€æœºçš„åˆçº¦å¤šæ¬¡å¤ç”¨ã€‚
åœ¨Solidityç¤ºä¾‹ç½‘ç«™ Solidity by exampleä¸Šå¯ä»¥æ‰¾åˆ°ä¼˜ç§€çš„åº“ç¤ºä¾‹ã€‚Solidityçš„åº“ä¸åˆçº¦ç±»ä¼¼ï¼Œä½†ä¸å…è®¸å£°æ˜ä»»ä½•çŠ¶æ€å˜é‡ï¼Œä¹Ÿä¸èƒ½æ¥æ”¶ETHã€‚

ğŸ“¢ åº“ä¸­æ‰€æœ‰çš„å‡½æ•°éƒ½å¿…é¡»å£°æ˜ä¸ºinternalï¼Œå¿…é¡»ç‹¬ç«‹éƒ¨ç½²ä»¥åå†é“¾æ¥åˆ°ä¸»åˆçº¦ã€‚

åˆ›å»ºæ–°æ–‡ä»¶PriceConverter.solï¼Œå°†ä¸¤ä¸ªå‡½æ•°çš„é€»è¾‘å‰ªåˆ‡åˆ°è¿™è¾¹ï¼Œæ³¨æ„å£°æ˜internal
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import &#123;AggregatorV3Interface&#125; from "@chainlink/contracts/src/v0.8/shared/interfaces/AggregatorV3Interface.sol";

library PriceConverter &#123;
    function getPrice() internal view returns (uint256) &#123;
        AggregatorV3Interface priceFeed = AggregatorV3Interface(0x694AA1769357215DE4FAC081bf1f309aDC325306);
        (, int256 answer, , , ) = priceFeed.latestRoundData();
        return uint256(answer * 10000000000);
    &#125;

    function getConversionRate(uint256 ethAmount) internal view returns (uint256) &#123;
        uint256 ethPrice = getPrice();
        uint256 ethAmountInUsd = (ethPrice * ethAmount) / 1000000000000000000;
        return ethAmountInUsd;
    &#125;
&#125;
ä¸»åˆçº¦FundMeä¿®æ”¹ä¸ºï¼š

importåº“
using PriceConvertor for uint256 ï¼šè¡¨ç¤ºæ‰€æœ‰uint256ç±»å‹å¯ä»¥è°ƒç”¨è¯¥libraryçš„å‡½æ•°
msg.value.getConversionRate() ç›´æ¥è°ƒç”¨

// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import &#123;PriceConvertor&#125; from "./PriceConvertor.sol";

contract FundMe&#123;

    // è¡¨ç¤ºæ‰€æœ‰uint256ç±»å‹å¯ä»¥è°ƒç”¨è¯¥libraryçš„å‡½æ•°
    using PriceConvertor for uint256;

    address[] public funders; 

    mapping(address funderAddress => uint256 funderAmount) public funderAmountMap;

    uint256 public  minimumUsd = 5 * 1e18;
    
    function fund() public payable &#123;
        require(msg.value.getConversionRate() > minimumUsd, "Didn't send enough ETH"); //if the condition is false, revert with the error message    &#125;
    
    		//è®°å½•è¿½è¸ªèµ„é‡‘
        funders.push(msg.sender);
        funderAmountMap[msg.sender] += msg.value;
    &#125;

    function withDraw() public &#123;

    &#125;

&#125;
solidity 0.8åå˜æ›´
safeMath ä½œä¸º0.8ç‰ˆæœ¬ä¹‹å‰å¹¿æ³›è¢«ä½¿ç”¨çš„åº“ï¼Œæ›¾æ˜¯æ™ºèƒ½åˆçº¦ä¸­çš„æ ‡é…åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆå¦‚ä»Šä¸å†ä½¿ç”¨äº†å‘¢ï¼Ÿ
å¯ä»¥è°ƒæ•´åˆ°ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸º0.6.0 ï¼Œæ–°å»ºä¸€ä¸ªåˆçº¦SafeMathTester
// SafeMathTester.sol
pragma solidity ^0.6.0;

contract SafeMathTester &#123;
    uint8 public bigNumber = 255;

    function add() public &#123;
        bigNumber = bigNumber + 1;
    &#125;
&#125;
ç¼–è¯‘è°ƒç”¨è¯¥å‡½æ•°ï¼Œå‘ç°bigNumberå€¼ä¼šè¢«é‡ç½®ä¸º0ï¼Œè¿™æ˜¯å› ä¸º0.8ç‰ˆæœ¬ä¹‹å‰ï¼Œæœ‰ç¬¦å·æˆ–è€…æ— ç¬¦å·çš„æ•´æ•°éƒ½æ˜¯æœªæ£€æŸ¥çš„ï¼Œæ„å‘³ç€å¦‚æœä»–ä»¬è¶…è¿‡å˜é‡ç±»å‹èƒ½å¤Ÿå®¹çº³çš„æœ€å¤§å€¼ï¼Œå°±ä¼šé‡ç½®ä¸ºä¸‹é™å€¼ã€‚
è€ŒsafeMathä¼šæä¾›ä¸€ä¸ªæœºåˆ¶ï¼Œè¾¾åˆ°æœ€å¤§é™åˆ¶æ—¶å›æ»šäº¤æ˜“ï¼Œé¿å…é”™è¯¯è®¡ç®—å’Œæ¼æ´ã€‚
function add(uint a, uint b) public pure returns (uint) &#123;
    uint c = a + b;
    require(c >= a, "SafeMath: addition overflow");
    return c;
&#125;
0.8.0ä»¥åï¼Œsolidityå·²ç»å®ç°è‡ªåŠ¨åŒ–æº¢å‡ºä¸‹æº¢æ£€æŸ¥ï¼Œåœ¨æ–°ç‰ˆæœ¬éƒ¨ç½²SafeMathTester å°†ä¼šæŠ¥é”™è€Œä¸æ˜¯é‡ç½®ä¸º0ï¼›
åŒæ—¶ï¼Œä¹Ÿå¼•å…¥uncheckedç»“æ„æ¥æé«˜ä»£ç çš„gasæ•ˆç‡ï¼š
uint8 public bigNumber = 255;

function add() public &#123;
    unchecked &#123;
        bigNumber = bigNumber + 1;
    &#125;
&#125;
è¢«uncheckedåŒ…è£¹çš„ä»£ç å—å°†å¿½ç•¥æº¢å‡ºå’Œä¸‹æº¢æ£€æŸ¥ï¼Œå¦‚æœè¶…å‡ºé™åˆ¶ï¼Œå°±ä¼šé‡ç½®åˆ°0ã€‚
ä»åˆçº¦å‘é€ETH
æ¥ä¸‹æ¥è¿›è¡Œèµ„é‡‘çš„æå–
é‡ç½®èµ„é‡‘
å‹Ÿé›†èµ„é‡‘äº†ä»¥åï¼Œåˆçº¦ä¸­å·²ç»å­˜å‚¨äº†æ‰€æœ‰å‹Ÿé›†çš„èµ„é‡‘ï¼Œæ‰€ä»¥åœ¨èµ„é‡‘æå–è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¸…ç©ºè¿½è¸ªèµ„é‡‘çš„æ•°ç»„å’Œé›†åˆï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°å¾ªç¯ï¼š
é¦–å…ˆå°†mapç½®ç©ºï¼Œå†å°†æ•°ç»„ç½®ç©º
function withDraw() public &#123;

    //  Reset the funder records
    for (uint256 funderIndex = 0; funderIndex &lt; funders.length; funderIndex ++) &#123;
        address funder = funders[funderIndex];
        funderAmountMap[funder] = 0;
    &#125;
    // reset the array
    funders = new address[](0);
&#125;

æ„é€ å‡½æ•°
ç›®å‰ï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ææ¬¾å‡½æ•°å¹¶å°†æ‰€æœ‰èµ„é‡‘ä»åˆçº¦ä¸­æèµ°ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å°†ææ¬¾å‡½æ•°é™åˆ¶ä¸ºä»…åˆçº¦æ‰€æœ‰è€…å¯ä»¥è°ƒç”¨ã€‚
è§£å†³åŠæ³•å°±æ˜¯æ„é€ å‡½æ•°ï¼š
constructor() &#123;&#125;
æ„é€ å‡½æ•°ä¼šåœ¨åˆçº¦éƒ¨ç½²æœŸé—´è‡ªåŠ¨è°ƒç”¨ï¼Œä¸éƒ¨ç½²åˆçº¦çš„äº¤æ˜“åœ¨åŒä¸€ç¬”äº¤æ˜“ä¸­æ‰§è¡Œã€‚
åœ¨å‡½æ•°é‡Œï¼Œæˆ‘ä»¬å°†çŠ¶æ€å˜é‡æ‰€æœ‰è€…åˆå§‹åŒ–ä¸ºåˆçº¦éƒ¨ç½²è€…çš„åœ°å€ï¼ˆmsg.senderï¼‰ã€‚
address public owner;
constructor() &#123;
    owner = msg.sender;
&#125;
æ›´æ–°withDrawå‡½æ•°ï¼š
function withdraw() public &#123;
    require(msg.sender == owner, "must be owner");
    // rest of the function here
&#125;
é™åˆ¶åªæœ‰åˆçº¦æ‹¥æœ‰è€…æ‰å¯ä»¥è¿›è¡Œæå–ã€‚
modifyä¼˜åŒ–
Solidity ä¸­çš„ä¿®é¥°å™¨ï¼ˆModifierï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„åˆçº¦å…ƒç¼–ç¨‹å·¥å…·ï¼Œç”¨äºåœ¨æ‰§è¡Œå‡½æ•°å‰ / åæ³¨å…¥é¢å¤–é€»è¾‘ï¼ˆå¦‚æƒé™æ£€æŸ¥ã€çŠ¶æ€éªŒè¯ç­‰ï¼‰ã€‚åˆç†ä½¿ç”¨ä¿®é¥°å™¨ä¸ä»…èƒ½æé«˜ä»£ç å¤ç”¨æ€§ï¼Œè¿˜èƒ½æ˜¾è‘—ä¼˜åŒ–åˆçº¦æ€§èƒ½ä¸å®‰å…¨æ€§ã€‚
ä¸Šè¿°çš„æƒé™æ£€æŸ¥å¯ä»¥å•ç‹¬æ‹†å‡ºæ¥ä½œä¸ºmodifyå‡½æ•°
modifier onlyOwner &#123;
        require(msg.sender == owner,"Must be the Owner!");
        _;
    &#125;
åŸå‡½æ•°æ·»åŠ onlyOwnerï¼š
function withdraw() public onlyOwner &#123;
   
&#125;
è½¬è´¦
Transfer
æ˜¯ä»¥å¤ªå¸è½¬å¸è‡³æ¥æ”¶åœ°å€çš„æœ€ç®€å•æ–¹å¼
payable(msg.sender).transfer(amount);
// the current contract sends the Ether amount to the msg.sender
ç„¶è€Œï¼Œtransferæœ‰ä¸€ä¸ªæ˜¾è‘—çš„é™åˆ¶ã€‚å®ƒåªèƒ½ä½¿ç”¨æœ€å¤š2300ä¸ªgasï¼Œå¹¶ä¸”å®ƒä¼šå›æ»šä»»ä½•è¶…å‡ºè¿™ä¸ªé™åˆ¶çš„äº¤æ˜“ï¼Œæ­£å¦‚ã€ŠSolidityå®ä¾‹æ•™ç¨‹ã€‹ Solidity by Exampleæ‰€ç¤ºã€‚

ğŸ§ ä¸ºä»€ä¹ˆéœ€è¦payableå…³é”®å­—ï¼Ÿ
å¿…é¡»å°†æ¥æ”¶è€…åœ°å€è½¬æ¢ä¸ºå¯æ”¯ä»˜åœ°å€ï¼Œä»¥ä¾¿å®ƒèƒ½å¤Ÿæ¥æ”¶ä»¥å¤ªå¸ã€‚å¯ä»¥é€šè¿‡å°†msg.senderç”¨å¯payableå…³é”®å­—åŒ…è£¹æ¥å®ç°ã€‚

Send
bool success = payable(msg.sender).send(address(this).balance);
require(success, "Send failed");
ä¸transferç±»ä¼¼ï¼Œsendä¹Ÿæœ‰2300çš„gasé™åˆ¶ã€‚å¦‚æœè¾¾åˆ°gasé™åˆ¶ï¼Œå®ƒä¸ä¼šæ’¤é”€äº¤æ˜“ï¼Œä½†ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆtrueæˆ–falseï¼‰ä»¥æŒ‡ç¤ºäº¤æ˜“çš„æˆåŠŸæˆ–å¤±è´¥ã€‚å¤„ç†å¤±è´¥æ˜¯å¼€å‘è€…çš„è´£ä»»ï¼Œå¦‚æœsendè¿”å›falseï¼Œè§¦å‘æ’¤é”€æ¡ä»¶æ˜¯ä¸€ç§è‰¯å¥½çš„å®è·µã€‚
Call
callå‡½æ•°éå¸¸çµæ´»å’Œå¼ºå¤§ã€‚å®ƒå¯ä»¥ç”¨æ¥è°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œè€Œä¸éœ€è¦å®ƒçš„ABIã€‚å®ƒæ²¡æœ‰gasé™åˆ¶ï¼Œå¹¶ä¸”åƒsendä¸€æ ·ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè€Œä¸æ˜¯åƒtransferé‚£æ ·å›æ»šã€‚
(bool success, ) = payable(msg.sender).call&#123;value: address(this).balance&#125;("");
require(success, "Call failed");
callå‡½æ•°è¿”å›ä¸¤ä¸ªå˜é‡(bool success, )ï¼šä¸€ä¸ªè¡¨ç¤ºæˆåŠŸæˆ–å¤±è´¥çš„å¸ƒå°”å€¼ï¼Œä»¥åŠä¸€ä¸ªå­˜å‚¨è¿”å›æ•°æ®çš„å­—èŠ‚å¯¹è±¡ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

â—callæ˜¯å‘é€å’Œæ¥æ”¶ä»¥å¤ªåŠæˆ–å…¶ä»–åŒºå—é“¾åŸç”Ÿä»£å¸çš„æ¨èæ–¹å¼ã€‚

å®Œæ•´ä»£ç 
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import &#123;PriceConvertor&#125; from "./PriceConvertor.sol";

contract FundMe&#123;

    address public owner;

    constructor () &#123;
        owner = msg.sender;
    &#125;

    // è¡¨ç¤ºæ‰€æœ‰uint256ç±»å‹å¯ä»¥è°ƒç”¨è¯¥libraryçš„å‡½æ•°
    using PriceConvertor for uint256;

    address[] public funders; 

    mapping(address funderAddress => uint256 funderAmount) public funderAmountMap;

    uint256 public  minimumUsd = 5 * 1e18;
    
    function fund() public payable &#123;
        require(msg.value.getConversionRate() > minimumUsd, "Didn't send enough ETH"); //if the condition is false, revert with the error message    &#125;
    
        funders.push(msg.sender);
        funderAmountMap[msg.sender] += msg.value;
    &#125;

    function withDraw() public onlyOwner&#123;

        //  Reset the funder records
        for (uint256 funderIndex = 0; funderIndex &lt; funders.length; funderIndex ++) &#123;
            address funder = funders[funderIndex];
            funderAmountMap[funder] = 0;
        &#125;
        // reset the array
        funders = new address[](0);

        // send money to msg.sender[three ways]
        // transfer
            // payable(msg.sender).transfer(amount); // the current contract sends the Ether amount to the msg.sender
        // send
            // bool success = payable(msg.sender).send(address(this).balance); require(success, "Send failed");
        // call
        (bool success, ) = payable(msg.sender).call&#123;value: address(this).balance&#125;("");
        require(success, "Call failed");
    &#125;

    // ä»»ä½•ç”±onlyOwnerä¿®é¥°éƒ½ä¼šå…ˆæ‰§è¡Œè¿™éƒ¨åˆ†ä»£ç ï¼Œâ€œ_;â€ä»£è¡¨è¢«ä¿®é¥°çš„å‡½æ•°çš„ä»£ç ï¼Œæ”¾åœ¨requireä¹‹å‰å°±æ˜¯å…ˆæ‰§è¡Œå®Œå‡½æ•°ä»£ç å†æ‰§è¡Œmodifierä»£ç å—ä¸­å†…å®¹
    modifier onlyOwner &#123;
        require(msg.sender == owner,"Must be the Owner!");
        _;
    &#125;
&#125;
]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>BlockChain</tag>
      </tags>
  </entry>
  <entry>
    <title>SolidityåŸºç¡€[part6]</title>
    <url>/2025/07/04/WEB3-Day7%E2%80%94Solidity%E5%9F%BA%E7%A1%80-part6/</url>
    <content><![CDATA[WEB3-Day7â€”SolidityåŸºç¡€[part6]
å˜é‡ä¼˜åŒ–
ä¼˜åŒ–ä»…è®¾ç½®ä¸€æ¬¡çš„å˜é‡çš„ç‡ƒæ°”æ¶ˆè€—ï¼ˆgas usageï¼‰
å˜é‡ owner å’Œ minimumUSD ä»…è®¾ç½®ä¸€æ¬¡ä¸”æ°¸ä¸æ”¹å˜ï¼šowner åœ¨åˆçº¦åˆ›å»ºæ—¶èµ‹å€¼ï¼ŒminimumUSD åœ¨åˆçº¦åˆå§‹åŒ–æ—¶è®¾å®šã€‚
è¯„ä¼° FundMe åˆçº¦
æˆ‘ä»¬å¯ä»¥é€šè¿‡éƒ¨ç½²åˆçº¦å¹¶åœ¨ç»ˆç«¯ä¸­è§‚å¯Ÿäº¤æ˜“æ¥è¯„ä¼°åˆ›å»ºåˆçº¦æ‰€éœ€çš„ç‡ƒæ°”é‡ã€‚åœ¨åŸå§‹åˆçº¦é…ç½®ä¸­ï¼Œæˆ‘ä»¬æ¶ˆè€—äº†è¿‘ 859,000 å•ä½ç‡ƒæ°”ã€‚
å¸¸é‡ï¼ˆConstantï¼‰
ä¸ºå‡å°‘ç‡ƒæ°”æ¶ˆè€—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ constant å’Œ immutable å…³é”®å­—ã€‚è¿™äº›å…³é”®å­—ç¡®ä¿å˜é‡å€¼ä¿æŒä¸å˜ã€‚æ›´å¤šä¿¡æ¯å¯å‚è€ƒ Solidity æ–‡æ¡£ã€‚
å¯¹äºä»…èµ‹å€¼ä¸€æ¬¡ä¸”æ°¸ä¸æ”¹å˜çš„å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨è¿™äº›å…³é”®å­—ã€‚
å¯¹äºç¼–è¯‘æ—¶å·²çŸ¥çš„å€¼ï¼Œä½¿ç”¨ constant å…³é”®å­—ã€‚å®ƒä¼šé¿å…å˜é‡å ç”¨å­˜å‚¨æ§½ä½ï¼Œä»è€Œä½¿è¯»å–æ›´ä¾¿å®œã€æ›´å¿«é€Ÿã€‚
ä½¿ç”¨ constant å…³é”®å­—å¯èŠ‚çœçº¦ 19,000 å•ä½ç‡ƒæ°”ï¼Œè¿™æ¥è¿‘åœ¨ä¸¤ä¸ªè´¦æˆ·ä¹‹é—´å‘é€ ETH çš„æˆæœ¬ã€‚

ğŸ“ æ³¨æ„ï¼š
constant å˜é‡çš„å‘½åçº¦å®šä¸ºå…¨å¤§å†™å¹¶ä»¥ä¸‹åˆ’çº¿åˆ†éš”ï¼ˆä¾‹å¦‚ MINIMUM_USDï¼‰ã€‚


âš ï¸ è­¦å‘Šï¼š
å°†å½“å‰ ETH ç‡ƒæ°”æˆæœ¬è½¬æ¢ä¸ºç¾å…ƒæ—¶å¯è§ï¼Œå½“ ETH ä»·æ ¼ä¸º 3000 ç¾å…ƒæ—¶ï¼Œå°† MINIMUM_USD å®šä¹‰ä¸ºå¸¸é‡éœ€èŠ±è´¹ 9 ç¾å…ƒï¼Œæ¯”å…¶å…¬å¼€å˜é‡ï¼ˆpublicï¼‰çš„ç­‰æ•ˆå®ç°å¤šè¿‘ 1 ç¾å…ƒã€‚

ä¸å¯å˜ï¼ˆImmutableï¼‰
constant å˜é‡é€‚ç”¨äºç¼–è¯‘æ—¶å·²çŸ¥çš„å€¼ï¼Œè€Œ immutable é€‚ç”¨äºéƒ¨ç½²æ—¶è®¾ç½®ä¸”ä¸å†æ”¹å˜çš„å˜é‡ã€‚immutable å˜é‡çš„å‘½åçº¦å®šæ˜¯åœ¨å˜é‡åå‰æ·»åŠ å‰ç¼€ i_ï¼ˆä¾‹å¦‚ i_ownerï¼‰ã€‚
å°† owner è®¾ä¸º immutable å˜é‡åï¼Œè§‚å¯Ÿåˆ°å…¶ç‡ƒæ°”èŠ‚çœæ•ˆæœä¸ constant å…³é”®å­—ç±»ä¼¼ã€‚

ğŸ’¡ æç¤ºï¼š
åœ¨å­¦ä¹ çš„æ—©æœŸé˜¶æ®µï¼Œä¸å¿…è¿‡äºå…³æ³¨ç‡ƒæ°”ä¼˜åŒ–ã€‚å…ˆä¿è¯åˆçº¦èƒ½å¤Ÿå®Œæ•´å†™å‡ºæ¥å…ˆã€‚

è‡ªå®šä¹‰é”™è¯¯
éœ€æ±‚æ£€æŸ¥ï¼ˆRequireï¼‰
æå‡ç‡ƒæ°”æ•ˆç‡çš„ä¸€ç§æ–¹å¼æ˜¯ä¼˜åŒ– require è¯­å¥ã€‚å½“å‰ï¼Œrequire è¯­å¥å¼ºåˆ¶æˆ‘ä»¬å­˜å‚¨å­—ç¬¦ä¸² 'sender is not an owner'ï¼Œè¯¥å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½ä¼šå•ç‹¬å­˜å‚¨ï¼Œå¯¼è‡´ç®¡ç†é€»è¾‘å¤æ‚ä¸”æˆæœ¬é«˜æ˜‚ã€‚
è‡ªå®šä¹‰é”™è¯¯ï¼ˆCustom Errorsï¼‰
è‡ª Solidity 0.8.4 ç‰ˆæœ¬å¼•å…¥çš„è‡ªå®šä¹‰é”™è¯¯å¯ç”¨äº revert è¯­å¥ä¸­ã€‚è¿™äº›é”™è¯¯éœ€åœ¨ä»£ç é¡¶éƒ¨å£°æ˜ï¼Œå¹¶åœ¨ if è¯­å¥ä¸­ä½¿ç”¨ã€‚ç›¸è¾ƒäºä¹‹å‰çš„é”™è¯¯æ¶ˆæ¯å­—ç¬¦ä¸²ï¼Œè°ƒç”¨æ›´è½»é‡çš„é”™è¯¯ä»£ç å¯é™ä½ç‡ƒæ°”æˆæœ¬ã€‚
æˆ‘ä»¬å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯ï¼š
error NotOwner();
ç„¶åç”¨ if è¯­å¥æ›¿æ¢ require å‡½æ•°ï¼Œå¹¶é€šè¿‡ revert è°ƒç”¨æ–°åˆ›å»ºçš„é”™è¯¯ï¼š
if (msg.sender != i_owner) &#123;
    revert NotOwner();
&#125;
é€šè¿‡å®ç°è‡ªå®šä¹‰é”™è¯¯ï¼Œæˆ‘ä»¬æ—¢èƒ½é™ä½ç‡ƒæ°”æ¶ˆè€—ï¼Œåˆèƒ½ç®€åŒ–æ™ºèƒ½åˆçº¦ä¸­çš„é”™è¯¯å¤„ç†ã€‚
ç»“è®º
æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯æ›¿ä»£ä¼ ç»Ÿå«å­—ç¬¦ä¸²çš„ require è¯­å¥ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ– Solidity åˆçº¦çš„ç‡ƒæ°”æ•ˆç‡ã€‚
receiveå’Œfallbackå‡½æ•°
receiveå’Œfallbackæ˜¯ç‰¹æ®Šå‡½æ•°ï¼Œå½“ç”¨æˆ·ç›´æ¥å‘åˆçº¦å‘é€ä»¥å¤ªå¸æˆ–è°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•°æ—¶ä¼šè§¦å‘ã€‚è¿™äº›å‡½æ•°ä¸è¿”å›ä»»ä½•å€¼ï¼Œä¸”å¿…é¡»å£°æ˜ä¸ºexternalã€‚
ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„åˆçº¦ï¼š
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.7;

contract FallbackExample &#123;
    uint256 public result;

    receive() external payable &#123;
        result = 1;
    &#125;

    fallback() external payable &#123;
        result = 2;
    &#125;
&#125;
åœ¨è¿™ä¸ªåˆçº¦ä¸­ï¼Œresultåˆå§‹åŒ–ä¸º0ã€‚å½“ä»¥å¤ªå¸å‘é€åˆ°åˆçº¦æ—¶ï¼Œreceiveå‡½æ•°ä¼šè¢«è§¦å‘ï¼Œå°†resultè®¾ä¸º1ã€‚å¦‚æœäº¤æ˜“åŒ…å«æ•°æ®ä½†æŒ‡å®šçš„å‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè§¦å‘fallbackå‡½æ•°ï¼Œå°†resultè®¾ä¸º2ã€‚
å¦‚éœ€å…¨é¢è§£é‡Šï¼Œè¯·å‚è€ƒSolidityByExampleã€‚
å‘é€ä»¥å¤ªå¸çš„é€»è¾‘æµç¨‹
å‘åˆçº¦å‘é€ä»¥å¤ªå¸
        |
        â†“
    msg.dataä¸ºç©ºå—ï¼Ÿ
      &#x2F;        \
     æ˜¯          å¦
    &#x2F;            \
  receive()å­˜åœ¨ï¼Ÿ   fallback()
    &#x2F;      \
   æ˜¯        å¦
  &#x2F;          \
receive()     fallback()
å‘fundMeåˆçº¦å‘é€ä»¥å¤ªå¸
å½“ç”¨æˆ·ç›´æ¥å‘fundMeåˆçº¦å‘é€ä»¥å¤ªå¸è€Œä¸è°ƒç”¨fundå‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨receiveå‡½æ•°å°†äº¤æ˜“é‡å®šå‘åˆ°fundå‡½æ•°ï¼š
receive() external payable &#123;
    fund();
&#125;

fallback() external payable &#123;
    fund();
&#125;
è¦æµ‹è¯•æ­¤åŠŸèƒ½ï¼Œå¯ä½¿ç”¨MetaMaskå‘fundMeåˆçº¦å‘é€ä¸€äº›Sepoliaæµ‹è¯•ç½‘ä»¥å¤ªå¸ã€‚æ­¤æ—¶å¹¶æœªç›´æ¥è°ƒç”¨fundå‡½æ•°ï¼Œä½†receiveå‡½æ•°ä¼šè§¦å‘å®ƒã€‚ç¡®è®¤äº¤æ˜“åï¼Œæ£€æŸ¥fundersæ•°ç»„ï¼Œä¼šå‘ç°å…¶å·²æ›´æ–°ï¼Œè¡¨æ˜receiveå‡½æ•°æˆåŠŸè°ƒç”¨äº†fundå‡½æ•°ã€‚
è¿™ç§æ–¹æ³•ç¡®ä¿æ‰€æœ‰äº¤æ˜“æŒ‰é¢„æœŸå¤„ç†ã€‚å°½ç®¡ç›´æ¥è°ƒç”¨fundå‡½æ•°æ¶ˆè€—çš„Gasæ›´å°‘ï¼Œä½†æ­¤æ–¹æ³•èƒ½ç¡®ä¿ç”¨æˆ·çš„è´¡çŒ®è¢«æ­£ç¡®ç¡®è®¤å’Œè®°å½•ã€‚
]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Solidity</tag>
      </tags>
  </entry>
  <entry>
    <title>Foundryæ¡†æ¶[part1]</title>
    <url>/2025/07/06/WEB3-Day8%E2%80%94Foundry%E6%A1%86%E6%9E%B6-part1/</url>
    <content><![CDATA[WEB3-Day8â€”Foundryæ¡†æ¶[part1]
ç®€ä»‹
Foundry Fundamentals
Foundry æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°ä½†å‘å±•è¿…çŒ›çš„æ™ºèƒ½åˆçº¦å¼€å‘æ¡†æ¶ï¼Œä»¥é«˜æ•ˆæ€§å’Œæ¨¡å—åŒ–è®¾è®¡è‘—ç§°ã€‚å…³äºè¿™ä¸ªå¼ºå¤§å·¥å…·çš„æœ€ä½³ç®€ä»‹å¯æŸ¥é˜… ã€ŠFoundry å®˜æ–¹æ‰‹å†Œã€‹ï¼š
Foundry å¯ç®¡ç†é¡¹ç›®ä¾èµ–ã€ç¼–è¯‘å·¥ç¨‹ã€è¿è¡Œæµ‹è¯•ã€éƒ¨ç½²åˆçº¦ï¼Œå¹¶æ”¯æŒé€šè¿‡å‘½ä»¤è¡ŒåŠ Solidity è„šæœ¬ä¸åŒºå—é“¾äº¤äº’ã€‚
è¯·åŠ¡å¿…æ”¶è— ã€ŠFoundry å®˜æ–¹æ‰‹å†Œã€‹â€”â€” å®ƒæ˜¯æœ€å…¨é¢çš„èµ„æºï¼Œå¯è§£ç­”æ‚¨çš„æ‰€æœ‰ç–‘é—®ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¼šæŒç»­æä¾›å¸®åŠ©ã€‚
Foundry çš„æ ¸å¿ƒä¼˜åŠ¿åŒ…æ‹¬ï¼š

å€ŸåŠ© Rust è¿›è¡Œç¼–è¯‘ï¼Œç›¸æ¯” Hardhat æˆ– Brownie ç­‰æ¡†æ¶ï¼Œæ„å»ºé€Ÿåº¦æ˜¾è‘—æå‡ï¼›
å®Œå…¨åŸºäº Solidity å¼€å‘ï¼Œæ— éœ€å­¦ä¹ å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼›
æ–‡æ¡£ä½“ç³»æä¸ºå®Œå–„ã€‚

æ¨èä»£ç ç¼–è¾‘å™¨ï¼šVisual Studio Code
åœ¨æœ¬è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Visual Studio Code å®Œæˆæ™ºèƒ½åˆçº¦çš„ ç¼–å†™ã€æµ‹è¯•ã€éƒ¨ç½² åŠ äº¤äº’ã€‚è¿™æ¬¾è½»é‡çº§ä»£ç ç¼–è¾‘å™¨åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒ Windowsã€macOS å’Œ Linux ç³»ç»Ÿï¼Œå…¶ä¸°å¯Œçš„æ‰©å±•ç”Ÿæ€ç³»ç»Ÿä½¿å…¶æˆä¸ºæ™ºèƒ½åˆçº¦å¼€å‘çš„é¦–é€‰å·¥å…·ä¹‹ä¸€ã€‚
å®‰è£…Foundry
curl -L https://foundry.paradigm.xyz | bash
source /Users/tinachan/.zshenv
foundryup
åˆ›å»ºæ–‡ä»¶å¤¹å’Œåˆå§‹åŒ–
åˆ›å»ºæ–‡ä»¶å¤¹
mkdir foundry-f23  
cd foundry-f23  
ç°åœ¨è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
mkdir foundry-simple-storage-f23  
cd foundry-simple-storage-f23  
æŠ€å·§ï¼šè¾“å…¥ç›®æ ‡è·¯å¾„çš„å‰å‡ ä¸ªå­—æ¯åæŒ‰ Tab é”®å¯å¿«é€Ÿè¡¥å…¨ cd å‘½ä»¤â€”â€”Tab é”®èƒ½è‡ªåŠ¨è¡¥å…¨å¤§éƒ¨åˆ†å‘½ä»¤/è·¯å¾„ã€‚
è‹¥è¾“å…¥ code .ï¼Œå°†æ‰“å¼€æ–°çš„ VS Code å®ä¾‹ï¼Œå¹¶é»˜è®¤ä»¥ foundry-simple-storage-f23 ä¸ºå·¥ä½œè·¯å¾„ã€‚
å¯é€šè¿‡å·¦ä¾§è¾¹æ æŸ¥çœ‹è¯¥æ–‡ä»¶å¤¹å†…å®¹ã€‚å°è¯•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
touch randomFile.txt  
è¿™å°†åˆ›å»ºä¸€ä¸ª randomFile.txt æ–‡ä»¶ã€‚
è‹¥éœ€åˆ é™¤è¯¥æ–‡ä»¶ï¼Œè¾“å…¥ï¼š
rm randomFile.txt  
ç»ˆç«¯åœ¨ç§»åŠ¨/æ‰“å¼€/åˆ›å»ºç›®å½•/æ–‡ä»¶ã€åˆ‡æ¢è·¯å¾„åŠè¿è¡Œç¨‹åºæ–¹é¢éå¸¸ä¾¿æ·ã€‚è‹¥æƒ³æå‡æ“ä½œæ•ˆç‡ï¼Œæ¨èé˜…è¯» æ­¤æ•™ç¨‹ã€‚
åˆ›å»ºæ–°é¡¹ç›®
åˆ›å»ºæ–°Foundryé¡¹ç›® çš„æ–¹å¼æ˜¯æ‰§è¡Œ forge init å‘½ä»¤ï¼Œè¿™å°†åœ¨å½“å‰å·¥ä½œç›®å½•ç”Ÿæˆä¸€ä¸ªæ–°çš„Foundryé¡¹ç›®ã€‚
è‹¥å¸Œæœ›Foundryåœ¨æ–°æ–‡ä»¶å¤¹ä¸­åˆ›å»ºé¡¹ç›®ï¼Œè¾“å…¥ï¼šforge init æ–°æ–‡ä»¶å¤¹åç§°ã€‚
æ³¨æ„ï¼šforge init é»˜è®¤è¦æ±‚ç›®æ ‡æ–‡ä»¶å¤¹ä¸ºç©ºã€‚è‹¥æ–‡ä»¶å¤¹éç©ºï¼Œéœ€æ‰§è¡Œ forge init --force .ã€‚
è‹¥é‡åˆ°Gité…ç½®ç›¸å…³é”™è¯¯ï¼Œéœ€å…ˆé…ç½®ç”¨æˆ·åå’Œé‚®ç®±ï¼š
git config --global user.email "ä½ çš„é‚®ç®±@æä¾›å•†.com"  
git config --global user.name "ä½ çš„ç”¨æˆ·å"  
å®Œæˆåï¼Œæ–‡ä»¶å¤¹ç»“æ„åº”å¦‚ä¸‹æ‰€ç¤ºï¼š

å„æ–‡ä»¶å¤¹å«ä¹‰è¯´æ˜ï¼š


libï¼šå­˜æ”¾æ‰€æœ‰ä¾èµ–é¡¹ï¼Œä¾‹å¦‚ï¼š

forge-stdï¼ˆç”¨äºæµ‹è¯•å’Œè„šæœ¬çš„forgeåº“ï¼‰
openzeppelin-contractsï¼ˆç»è¿‡å¤§é‡å®è·µéªŒè¯çš„æ™ºèƒ½åˆçº¦åº“ï¼‰
å…¶ä»–æŒ‰éœ€å®‰è£…çš„ä¾èµ–



scriptsï¼šå­˜æ”¾æ‰€æœ‰è„šæœ¬æ–‡ä»¶


srcï¼šå­˜æ”¾æ‰€æœ‰æ™ºèƒ½åˆçº¦æºæ–‡ä»¶


testï¼šå­˜æ”¾æ‰€æœ‰æµ‹è¯•æ–‡ä»¶


foundry.tomlï¼šFoundryçš„é…ç½®å‚æ•°æ–‡ä»¶


åç»­å°†è¯¦ç»†ä»‹ç»è¿™äº›æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ã€‚
ç°åœ¨è¯·å³é”®ç‚¹å‡» src æ–‡ä»¶å¤¹ï¼Œé€‰æ‹© New File å¹¶å‘½åä¸º SimpleStorage.solã€‚å°† æ­¤é“¾æ¥ ä¸­çš„ä»£ç å¤åˆ¶åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚
æœ€åä¸€æ­¥ï¼šè¯·åˆ é™¤ Counter.s.solã€Counter.sol å’Œ Counter.t.solã€‚è¿™äº›æ˜¯Foundryåˆ›å»ºæ–°é¡¹ç›®æ—¶é»˜è®¤æä¾›çš„åŸºç¡€æ™ºèƒ½åˆçº¦æ–‡ä»¶ã€‚
VSCodeæ’ä»¶
åˆšå¼€å§‹ç¼–å†™ä»£ç æ—¶ï¼Œç•Œé¢å¯èƒ½åªæ˜¯ä¸€ç‰‡å•è°ƒã€ç¼ºä¹æ ¼å¼çš„ç™½è‰²æ–‡æœ¬ã€‚
é€šè¿‡å®‰è£… Solidity æ‰©å±•å¯è½»æ¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨æ‰©å±•é€‰é¡¹å¡ï¼ˆæŒ‰ CTRL/CMD + SHIFT + Xï¼‰ä¸­ï¼Œä»¥ä¸‹å‡ ä¸ª Solidity æ‰©å±•å€¼å¾—å…³æ³¨ï¼š

Solidity by Juan Blanco â€”â€” æœ€å¸¸ç”¨çš„ Solidity æ‰©å±•ã€‚
Solidity by Nomic Foundation â€”â€” Patrick æœ€æ¨èçš„ Solidity æ‰©å±•ï¼Œæœ¬è¯¾ç¨‹å°†ä½¿ç”¨æ­¤æ‰©å±•æ¼”ç¤ºã€‚
Solidity Visual Developer â€”â€” å¦ä¸€æ¬¾çƒ­é—¨é€‰æ‹©ã€‚

æ³¨æ„ï¼šè‹¥å®‰è£…æ‰©å±•åä»£ç ä»æ— é«˜äº®ï¼Œå¯æŒ‰ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š
æŒ‰ä¸‹ Command + Shift + Pï¼ˆmacOSï¼‰æˆ– Control + Shift + Pï¼ˆWindowsï¼‰æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥â€œSettingsâ€å¹¶é€‰æ‹© â€œPreferences: Open User Settings (JSON)â€ã€‚
è‹¥æ–‡ä»¶ä¸ºç©ºï¼Œæ·»åŠ ä»¥ä¸‹è®¾ç½®ï¼š
&#123;
  "editor.defaultFormatter": "NomicFoundation.hardhat"
&#125;

è‹¥ä½¿ç”¨ Solidity Visual Developerï¼Œè®¾ç½®ä¸ºï¼š
&quot;editor.defaultFormatter&quot;: &quot;tintinweb.solidity-visual-auditor&quot;
è‹¥ä½¿ç”¨ Solidity by Juan Blancoï¼Œè®¾ç½®ä¸ºï¼š
&quot;editor.defaultFormatter&quot;: &quot;JuanBlanco.solidity&quot;

å…¶ä»–å®ç”¨æ‰©å±•
ä¸Šä¸€è¯¾æåˆ°çš„ foundry.toml é…ç½®æ–‡ä»¶ä¹Ÿæœ‰å¯¹åº”çš„æ ¼å¼åŒ–æ‰©å±•ï¼Œæ¨èå®‰è£… Even Better TOMLï¼Œæå‡ TOML æ–‡ä»¶çš„å¯è¯»æ€§ã€‚
å¦ä¸€æ¬¾å¿…å¤‡æ‰©å±•æ˜¯ Inline Bookmarksï¼Œå…¶åŠŸèƒ½å¦‚ä¸‹ï¼š
è¯¥æ’ä»¶æ”¯æŒåœ¨ä»£ç ä¸­æ·»åŠ ä¹¦ç­¾ï¼Œé€‚ç”¨äºæ–‡æ¡£è¯„å®¡ã€å®‰å…¨å®¡è®¡ã€æ—¥å¿—åˆ†æåŠè®°å½•å¼€å‘ç¬”è®°å’Œå¾…åŠäº‹é¡¹ã€‚ä¹¦ç­¾ä¼šéšæ–‡ä»¶ä¿å­˜ï¼Œå¯è½»æ¾ä¸ä»–äººå…±äº«ã€‚
é»˜è®¤é¢„è®¾çš„è§¦å‘æ ‡ç­¾/å…³é”®è¯å¦‚ä¸‹ï¼š

@todoï¼ˆè“è‰²ï¼‰ï¼šå¸¸è§„å¾…åŠäº‹é¡¹æ ‡è®°
@noteï¼ˆè“è‰²ï¼‰ï¼šå¸¸è§„æ³¨é‡Š
@remindï¼ˆè“è‰²ï¼‰ï¼šæé†’äº‹é¡¹
@follow-upï¼ˆè“è‰²ï¼‰ï¼šå¾…è·Ÿè¿›äº‹é¡¹
@auditï¼ˆçº¢è‰²ï¼‰ï¼šæ½œåœ¨é—®é¢˜æ ‡è®°
@audit-infoï¼ˆè“è‰²ï¼‰ï¼šå¾…åç»­å¤„ç†çš„ä¿¡æ¯æ ‡è®°
@audit-okï¼ˆç»¿è‰²ï¼‰ï¼šæ ‡è®°æŸè¡Œä»£ç æ— é—®é¢˜ï¼ˆå³ä½¿çœ‹ä¼¼æœ‰é—®é¢˜ï¼‰
@audit-issueï¼ˆç´«è‰²ï¼‰ï¼šæ ‡è®°å·²è®°å½•é—®é¢˜çš„ä»£ç ä½ç½®

æç¤ºï¼šè¿™äº›æ ‡ç­¾çš„é¢œè‰²å¯å®Œå…¨è‡ªå®šä¹‰ï¼å®ƒä»¬åœ¨å¼€å‘å°¤å…¶æ˜¯é¡¹ç›®å®¡è®¡ä¸­éå¸¸å®ç”¨ï¼Œæ›´å¤šç»†èŠ‚å¯æŸ¥é˜… å®˜æ–¹æ–‡æ¡£ã€‚
ç¼–è¯‘åˆçº¦
å¤åˆ¶ä¹‹å‰SolidityåŸºç¡€è¯¾ç¨‹ä¸­çš„ SimpleStorage.solåˆçº¦
ç„¶åæ‰“å¼€æ–°ç»ˆç«¯ã€‚è¾“å…¥ forge build æˆ– forge compile æ¥ç¼–è¯‘é¡¹ç›®ä¸­çš„æ™ºèƒ½åˆçº¦ã€‚

éƒ¨ç½²åˆçº¦
Anvil
éƒ¨ç½²æ™ºèƒ½åˆçº¦æœ‰å¤šç§æ–¹å¼å’Œå¹³å°ã€‚ä½¿ç”¨Foundryæ¡†æ¶å¼€å‘æ—¶ï¼Œæœ€ç®€å•ä¸”ç°æˆçš„éƒ¨ç½²ç¯å¢ƒæ˜¯Anvilã€‚
Anvilæ˜¯Foundryè‡ªå¸¦çš„æœ¬åœ°æµ‹è¯•ç½‘ç»œèŠ‚ç‚¹ï¼Œå¯ç”¨äºä»å‰ç«¯æµ‹è¯•åˆçº¦æˆ–é€šè¿‡RPCäº¤äº’ã€‚åœ¨ç»ˆç«¯è¾“å…¥anvilå³å¯è¿è¡Œï¼š

æ­¤æ—¶ä¼šç”Ÿæˆ10ä¸ªæµ‹è¯•åœ°å€ï¼Œæ¯ä¸ªåœ°å€é¢„å­˜10_000 ETHåŠå¯¹åº”çš„ç§é’¥ã€‚è¯¥æµ‹è¯•èŠ‚ç‚¹é»˜è®¤ç›‘å¬127.0.0.1:8545ï¼Œæ­¤åœ°å€å°†ä½œä¸ºéƒ¨ç½²åˆçº¦æ—¶çš„RPC_URLå‚æ•°ï¼ˆåç»­ä¼šè¯¦ç»†è¯´æ˜ï¼‰ã€‚æ›´å¤šAnvilç›¸å…³ä¿¡æ¯å¯æŸ¥é˜… å®˜æ–¹æ–‡æ¡£ã€‚
å¦‚éœ€å…³é—­Anvilï¼ŒæŒ‰Ctrl/CMD + Cå³å¯ã€‚æœ¬è¯¾ç¨‹å°†å…¨ç¨‹ä½¿ç”¨Anviléƒ¨ç½²å’Œæµ‹è¯•åˆçº¦ï¼Œåœ¨æ­¤ä¹‹å‰å…ˆäº†è§£ä¸€ä¸ªä¸­é—´æ­¥éª¤ã€‚
Ganache
Ganacheé€šå¸¸æŒ‡ç³•ç‚¹é…±ï¼Œç”±ç­‰é‡å¥¶æ²¹å’Œç¢å·§å…‹åŠ›åŠ çƒ­åˆ¶æˆï¼Œå…ˆæ¸©çƒ­å¥¶æ²¹å†æµ‡åœ¨å·§å…‹åŠ›ä¸Šã€‚
ç­‰ç­‰ï¼Œè¿™é‡Œè¯´çš„ä¸æ˜¯ç³•ç‚¹é…±ï¼å¦ä¸€ä¸ªGanacheï¼š
Ganacheæ˜¯ç”¨äºå¿«é€Ÿå¼€å‘ä»¥å¤ªåŠå’ŒFilecoinåˆ†å¸ƒå¼åº”ç”¨çš„ä¸ªäººåŒºå—é“¾ï¼Œå¯åœ¨æ•´ä¸ªå¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨ï¼Œæ”¯æŒåœ¨å®‰å…¨ä¸”ç¡®å®šçš„ç¯å¢ƒä¸­å¼€å‘ã€éƒ¨ç½²å’Œæµ‹è¯•dAppã€‚
è¯·ä» æ­¤å¤„ ä¸‹è½½Ganacheã€‚
ä½¿ç”¨Windows WSLçš„ç”¨æˆ·è¯·é˜…è¯» æ­¤æ–‡æ¡£â€”â€”åœ¨è¯¥ç¯å¢ƒä¸­é…ç½®Ganacheå¹¶éæ˜“äº‹ï¼Œä¸”åç»­ä¸ä¼šä½¿ç”¨ï¼Œå› æ­¤é…ç½®å¤±è´¥æ— éœ€æ‹…å¿ƒã€‚
ç‚¹å‡»Quickstart Ethereumï¼Œå³å¯ç”Ÿæˆå…¨æ–°åŒºå—é“¾ï¼ŒåŒ…å«å¸¦ä½™é¢çš„åœ°å€å’Œç§é’¥ã€‚
é…ç½®MetaMask
è‹¥éœ€éƒ¨ç½²åˆ°è‡ªå®šä¹‰ç½‘ç»œï¼ˆå¦‚æœ¬åœ°èŠ‚ç‚¹ï¼‰ï¼Œéœ€ä½¿ç”¨MetaMaskâ€”â€”è¿™æ˜¯ä¸€æ¬¾æµè¡Œçš„åŠ å¯†è´§å¸é’±åŒ…å’Œæµè§ˆå™¨æ‰©å±•ï¼Œæ”¯æŒä¸ä»¥å¤ªåŠåŒºå—é“¾åŠå…¶ç”Ÿæ€äº¤äº’ã€‚å°šæœªå®‰è£…è€…å¯ä» æ­¤å¤„ ä¸‹è½½ã€‚
é…ç½®æ­¥éª¤å¦‚ä¸‹ï¼š

æ‰“å¼€MetaMaskï¼Œç‚¹å‡»ä¸‰ç‚¹å›¾æ ‡å¹¶é€‰æ‹©Expand Viewï¼›
è¿›å…¥Settingsâ†’Networksï¼ŒæŸ¥çœ‹ç½‘ç»œåˆ—è¡¨åŠè¯¦æƒ…ï¼Œé‡ç‚¹å…³æ³¨RPC URLï¼›
RPC URLæœ¬è´¨ä¸Šæ˜¯å‘é€äº¤æ˜“æ—¶è°ƒç”¨APIçš„ç«¯ç‚¹ï¼Œæ¯æ¬¡æ‰§è¡ŒåŒºå—é“¾äº¤æ˜“éƒ½ä¼šå‘è¯¥åœ°å€å‘é€APIè¯·æ±‚ã€‚

æ·»åŠ è‡ªå®šä¹‰åŒºå—é“¾ç½‘ç»œçš„æ­¥éª¤ï¼š

ç‚¹å‡»Add a Networkï¼Œæ»šåŠ¨è‡³åˆ—è¡¨åº•éƒ¨ï¼›
é€‰æ‹©Add a Network manuallyï¼Œè¾“å…¥æœ¬åœ°ç½‘ç»œä¿¡æ¯ï¼š

ç½‘ç»œåç§°ï¼šLocalhost
æ–°RPC URLï¼šGanacheä¸ºhttp://127.0.0.1:7545ï¼ŒAnvilä¸ºhttp://127.0.0.1:8545ï¼ˆéœ€ç¡®ä¿æ·»åŠ http://ï¼Œå…·ä½“URLä»¥Ganacheç•Œé¢æˆ–Anvilç»ˆç«¯æ˜¾ç¤ºä¸ºå‡†ï¼‰
é“¾IDï¼šGanacheé€šå¸¸ä¸º5777ï¼ˆæˆ–1337ï¼‰ï¼ŒAnvilä¸º31337ï¼ˆå…·ä½“IDä»¥å·¥å…·æ˜¾ç¤ºä¸ºå‡†ï¼‰
è´§å¸ç¬¦å·ï¼šETH
åŒºå—æµè§ˆå™¨URLï¼šç•™ç©ºï¼ˆæœ¬åœ°åŒºå—é“¾æ— åŒºå—æµè§ˆå™¨ï¼Œå…³é—­VS Code/Ganacheåæ•°æ®é€šå¸¸ä¼šä¸¢å¤±ï¼‰



é…ç½®å®Œæœ¬åœ°ç½‘ç»œåï¼Œéœ€å°†Ganacheæˆ–Anvilä¸­çš„è´¦æˆ·å¯¼å…¥MetaMaskï¼Œæ­¥éª¤å¦‚ä¸‹ ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼š

ç‚¹å‡»é’±åŒ…é¡¶éƒ¨çš„è´¦æˆ·é€‰æ‹©å™¨ï¼Œç‚¹å‡»Add account or hardware walletï¼›
é€‰æ‹©Import accountï¼Œç²˜è´´Ganache/Anvilçš„ç§é’¥å¹¶ç‚¹å‡»Importã€‚

é‡è¦æç¤ºï¼šæ­¤è´¦æˆ·ä»…é™æœ¬åœ°æµ‹è¯•ä½¿ç”¨ï¼Œåˆ‡å‹¿åœ¨ä¸»ç½‘æˆ–å…¶ä»–çœŸå®åŒºå—é“¾ä¸­ä½¿ç”¨ï¼Œæ‰€æœ‰äººå‡å¯è®¿é—®è¯¥è´¦æˆ·ï¼
æ¥ä¸‹æ¥å°†è¿›ä¸€æ­¥è®²è§£åœ¨MetaMaskä¸­æ·»åŠ æ–°ç½‘ç»œçš„ç»†èŠ‚ã€‚
å‘½ä»¤è¡Œéƒ¨ç½²
forge create SimpleStorage --interactive

è„šæœ¬éƒ¨ç½²
é€šè¿‡è„šæœ¬éƒ¨ç½²æ™ºèƒ½åˆçº¦ç‰¹åˆ«å®ç”¨ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€è‡´ä¸”å¯é‡å¤çš„å¯é éƒ¨ç½²æ–¹å¼ï¼Œå…¶ç‰¹æ€§è¿˜èƒ½å¢å¼ºå¯¹éƒ¨ç½²æµç¨‹å’Œä»£ç æœ¬èº«çš„æµ‹è¯•ã€‚
ä½ å¯èƒ½å–œæ¬¢å‘½ä»¤è¡Œæ–¹å¼ï¼Œä½†è„šæœ¬ä¼šä¸°å¯Œæ•´ä¸ªéƒ¨ç½²æµç¨‹ï¼Œå¸¦æ¥æ— å¯æ¯”æ‹Ÿçš„åŠŸèƒ½æ‰©å±•å’Œæ˜“ç”¨æ€§ã€‚
FoundryåŸºäºSolidityå¼€å‘ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„éƒ¨ç½²è„šæœ¬ä¹Ÿå°†ä½¿ç”¨Solidityç¼–å†™ã€‚å¿…é¡»æ˜ç¡®åŒºåˆ†ä½œä¸ºåˆçº¦è¯­è¨€çš„Solidityå’Œä½œä¸ºè„šæœ¬è¯­è¨€çš„Solidityâ€”â€”Foundryè¿˜æ•´åˆäº†æ‰©å±•åŠŸèƒ½ï¼Œè®©Solidityçš„åº”ç”¨è¶…å‡ºæ™ºèƒ½åˆçº¦èŒƒç•´ã€‚ç°åœ¨å¼€å§‹åˆ›å»ºéƒ¨ç½²ç®€å•å­˜å‚¨åˆçº¦çš„è„šæœ¬ã€‚
åœ¨Foundryä¸­ï¼Œè„šæœ¬å­˜æ”¾åœ¨scriptæ–‡ä»¶å¤¹ä¸‹

åˆ›å»ºæ–°æ–‡ä»¶DeploySimpleStorage.s.sol

.s.solæ˜¯Foundryè„šæœ¬çš„å‘½åè§„èŒƒï¼Œåç»­ç¼–å†™æµ‹è¯•æ—¶ä¼šä½¿ç”¨.t.solåç¼€ã€‚
æ›´å¤šè„šæœ¬æœ€ä½³å®è·µå¯æŸ¥é˜… æ­¤å¤„ã€‚



ç¼–å†™Solidityéƒ¨ç½²è„šæœ¬


åˆå§‹ä»£ç æ¡†æ¶ï¼š
// SPDX-License-Identifier: MIT

pragma solidity 0.8.19;

contract DeploySimpleStorage &#123;
&#125;

å‰ä¸¤è¡Œåˆ†åˆ«å£°æ˜è®¸å¯è¯å’ŒSolidityç‰ˆæœ¬ã€‚



å¯¼å…¥ä¾èµ–å¹¶ç»§æ‰¿Scriptï¼š
// SPDX-License-Identifier: MIT

pragma solidity 0.8.19;

import &#123;Script&#125; from "forge-std/Script.sol";
import &#123;SimpleStorage&#125; from "../src/SimpleStorage.sol";

contract DeploySimpleStorage is Script &#123;
&#125;

æ³¨ï¼šforge-stdï¼ˆForgeæ ‡å‡†åº“ï¼‰åŒ…å«é¢„å†™çš„Solidityåˆçº¦ï¼Œç”¨äºç®€åŒ–å’Œå¢å¼ºFoundryä¸­çš„è„šæœ¬ä¸æµ‹è¯•ã€‚



æ·»åŠ runä¸»å‡½æ•°ï¼š
// SPDX-License-Identifier: MIT

pragma solidity 0.8.19;

import &#123;Script&#125; from "forge-std/Script.sol";
import &#123;SimpleStorage&#125; from "../src/SimpleStorage.sol";

contract DeploySimpleStorage is Script &#123;
    function run() external returns (SimpleStorage) &#123;
        vm.startBroadcast();

        SimpleStorage simpleStorage = new SimpleStorage();

        vm.stopBroadcast();
        return simpleStorage;
    &#125;
&#125;

vmæ˜¯Foundryçš„â€œä½œå¼Šç â€ï¼ˆcheat codesï¼‰ï¼Œä»…åœ¨Foundryç¯å¢ƒä¸­ç”Ÿæ•ˆï¼š

vm.startBroadcast()æ ‡è®°å‘é€åˆ°RPC URLçš„äº¤æ˜“å¼€å§‹ï¼›
vm.stopBroadcast()æ ‡è®°äº¤æ˜“ç»“æŸï¼›


new SimpleStorage()é€šè¿‡Solidityçš„newå…³é”®å­—åˆ›å»ºåˆçº¦å®ä¾‹ã€‚



æ‰§è¡Œéƒ¨ç½²è„šæœ¬


åœæ­¢æ­£åœ¨è¿è¡Œçš„Anvilï¼ˆæŒ‰CTRL(CMD) + Cï¼‰ï¼Œè¿è¡Œï¼š
forge script script/DeploySimpleStorage.s.sol

è‹¥é‡â€œæ–‡ä»¶ä¸­Solidityç‰ˆæœ¬ä¸å…¼å®¹â€é”™è¯¯ï¼Œç¡®ä¿SimpleStorage.solå’Œéƒ¨ç½²è„šæœ¬å‡ä½¿ç”¨pragma solidity 0.8.19;ã€‚



å…¸å‹è¾“å‡ºï¼š
[â †] Compiling...
[â ”] Compiling 2 files with 0.8.19
[â ’] Solc 0.8.19 finished in 1.08s
Compiler run successful!
Script ran successfully.
Gas used: 338569

== Return ==
0: contract SimpleStorage 0x90193C961A926261B756D1E5bb255e67ff9498A1

å…³é”®é—®é¢˜ï¼šæœªæŒ‡å®šRPC URLæ—¶ï¼ŒFoundryä¼šè‡ªåŠ¨å¯åŠ¨å¹¶ç»ˆæ­¢Anvilå®ä¾‹å®Œæˆéƒ¨ç½²ã€‚



æŒ‡å®šRPC URLæ¨¡æ‹Ÿéƒ¨ç½²ï¼š
# å…ˆå¯åŠ¨Anvil
anvil
# æ–°å¼€ç»ˆç«¯æ‰§è¡Œ
forge script script/DeploySimpleStorage.s.sol --rpc-url http://127.0.0.1:8545

è¾“å‡ºä¸­çš„SIMULATION COMPLETEè¡¨ç¤ºè¿™æ˜¯æ¨¡æ‹Ÿéƒ¨ç½²ï¼Œç”Ÿæˆçš„broadcastæ–‡ä»¶å¤¹è®°å½•è„šæœ¬è¿è¡Œä¿¡æ¯ã€‚



å¹¿æ’­éƒ¨ç½²ï¼ˆæ·»åŠ ç§é’¥ï¼‰ï¼š
forge script script/DeploySimpleStorage.s.sol --rpc-url http://127.0.0.1:8545 --broadcast --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

Anvilç»ˆç«¯å°†æ˜¾ç¤ºæˆåŠŸéƒ¨ç½²çš„äº¤æ˜“ä¿¡æ¯ï¼šTransaction: 0x73eb9fb4ef7b159e03c50d669c42e2ec4eeaa9358bea0a710cb07168e5192570
Contract created: 0x5fbdb2315678afecb367f032d93f642f64180aa3
Gas used: 357088




]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Foundry</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»0åˆ°1:ç”¨Git+CloudFlare+PicGo+Typora+Hexoæ­å»ºä¸ªäººåšå®¢å…¨æµç¨‹</title>
    <url>/2025/06/17/%E4%BB%8E0%E5%88%B01-%E7%94%A8Git-CloudFlare-PicGo-Typora-Hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%85%A8%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[ä» 0 åˆ° 1ï¼šç”¨ Gitã€CloudFlareã€PicGoã€Typoraã€Hexo æ­å»ºä¸ªäººåšå®¢å…¨æµç¨‹
ä¸€ã€å‰è¨€
22å¹´ï¼Œæˆ‘ç”¨ Hexo + Next ä¸»é¢˜æ­èµ·ç¬¬ä¸€ä¸ªä¸ªäººåšå®¢ã€‚ä¸‰å¹´åï¼Œéšç€å›¾åºŠéœ€æ±‚å‡çº§ã€å¯¹åšå®¢é£æ ¼æœ‰äº†æ–°æƒ³æ³•ï¼Œæˆ‘å†³å®šé‡æ„ â€”â€” æ›¿æ¢å›¾åºŠå·¥å…·ã€æ›´æ¢ä¸»é¢˜ï¼Œç”¨ Gitã€CloudFlareã€PicGoã€Typora é…åˆ Hexo é‡æ–°æ­å»ºã€‚è¿™ç¯‡æ–‡ç« å¤ç›˜ä»æ—§ç‰ˆè¿­ä»£åˆ°å…¨æ–°ä¸Šçº¿çš„å…¨è¿‡ç¨‹ï¼Œæ—¢æ˜¯å¯¹è‡ªå·±æŠ˜è…¾ç»å†çš„è®°å½•ï¼Œä¹Ÿå¸Œæœ›ç»™æƒ³ä¼˜åŒ–åšå®¢çš„æœ‹å‹ä¸€ä»½å®æ“å‚è€ƒã€‚
äºŒã€ç¯å¢ƒå‡†å¤‡ä¸å·¥å…·é€‰å‹
ï¼ˆä¸€ï¼‰æ ¸å¿ƒå·¥å…·ç®€ä»‹

Gitï¼šåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œè´Ÿè´£åšå®¢ä»£ç çš„ç‰ˆæœ¬ç®¡ç†ä¸è¿œç¨‹ä»“åº“åŒæ­¥ï¼Œè®©åšå®¢éƒ¨ç½²ã€å†…å®¹æ›´æ–°æ›´é«˜æ•ˆã€‚
CloudFlareï¼šæä¾› CDN åŠ é€Ÿã€DNS è§£æã€å®‰å…¨é˜²æŠ¤ç­‰åŠŸèƒ½ï¼Œè®©åšå®¢è®¿é—®æ›´å¿«ã€æ›´ç¨³å®šï¼Œè¿˜èƒ½éšè—çœŸå®æœåŠ¡å™¨ IP ã€‚
PicGoï¼šå›¾åºŠä¸Šä¼ å·¥å…·ï¼Œå†™åšå®¢æ—¶æœ¬åœ°å›¾ç‰‡èƒ½ä¸€é”®ä¸Šä¼ åˆ°å›¾åºŠï¼Œè§£å†³æ–‡ç« ä¸­å›¾ç‰‡å­˜å‚¨ä¸å¼•ç”¨é—®é¢˜ã€‚
Typoraï¼šç®€æ´é«˜æ•ˆçš„ Markdown ç¼–è¾‘å™¨ï¼Œå®æ—¶é¢„è§ˆã€è¯­æ³•ç®€æ´ï¼Œä¸“æ³¨å†…å®¹åˆ›ä½œã€‚
Hexoï¼šé™æ€åšå®¢ç”Ÿæˆæ¡†æ¶ï¼ŒåŸºäº Node.jsï¼Œæ”¯æŒ Markdown å†™ä½œï¼Œèƒ½å¿«é€Ÿç”Ÿæˆç¾è§‚åšå®¢ç«™ç‚¹ï¼Œéƒ¨ç½²çµæ´»ã€‚

ï¼ˆäºŒï¼‰ç¯å¢ƒå®‰è£…

Git å®‰è£…ï¼š
å®˜ç½‘ï¼ˆhttps://git-scm.com/ ï¼‰ä¸‹è½½å¯¹åº”ç³»ç»Ÿç‰ˆæœ¬ï¼Œå®‰è£…åé€šè¿‡ git --version éªŒè¯ï¼Œçœ‹åˆ°ç‰ˆæœ¬å·å³æˆåŠŸã€‚
é…ç½®ç”¨æˆ·ä¿¡æ¯ï¼šgit config --global user.name "ä½ çš„ç”¨æˆ·å"
git config --global user.email "ä½ çš„é‚®ç®±"

Node.js ä¸ Hexo å®‰è£…ï¼ˆHexo ä¾èµ– Node.js ï¼‰ï¼š
Node.js å®˜ç½‘ï¼ˆhttps://nodejs.org/ ï¼‰ä¸‹è½½ LTS ç‰ˆæœ¬ï¼Œå®‰è£…åç”¨ node -vã€npm -v éªŒè¯ã€‚
å…¨å±€å®‰è£… Hexoï¼šnpm install -g hexo-cli
éªŒè¯ Hexo å®‰è£…ï¼šhexo -v æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯åˆ™æˆåŠŸã€‚
Typora å®‰è£…ï¼šå®˜ç½‘ï¼ˆhttps://typora.io/ ï¼‰ä¸‹è½½å¯¹åº”ç³»ç»Ÿç‰ˆæœ¬ï¼ŒæŒ‰æç¤ºå®‰è£…å³å¯ï¼Œç®€æ´ç›´è§‚ã€‚
PicGo å®‰è£…ï¼šå®˜ç½‘ï¼ˆhttps://picgo.github.io/PicGo-Doc/ ï¼‰æˆ–åº”ç”¨å•†åº—ä¸‹è½½ï¼Œæ”¯æŒå¤šå¹³å°ï¼Œå®‰è£…åé…ç½®å›¾åºŠï¼ˆå¦‚ GitHub å›¾åºŠã€ä¸ƒç‰›äº‘ç­‰ï¼Œæˆ‘ç”¨ GitHub å›¾åºŠæ—¶éœ€é…ç½®ä»“åº“ã€Token ç­‰ ï¼‰ã€‚

ä¸‰ã€Hexo åˆå§‹åŒ–ä¸åšå®¢åŸºç¡€æ­å»º
ï¼ˆä¸€ï¼‰åˆå§‹åŒ– Hexo é¡¹ç›®

åˆ›å»ºåšå®¢ç›®å½•ï¼ˆå¦‚ my-blog ï¼‰ï¼Œè¿›å…¥ç›®å½•ï¼šmkdir my-blog &amp;&amp; cd my-blog

åˆå§‹åŒ– Hexoï¼šhexo init
npm install
æ‰§è¡Œåï¼Œç›®å½•ä¼šç”Ÿæˆ Hexo åŸºç¡€æ–‡ä»¶ç»“æ„ï¼ŒåŒ…å« _config.ymlï¼ˆé…ç½®æ–‡ä»¶ ï¼‰ã€sourceï¼ˆå­˜æ”¾æ–‡ç« ã€èµ„æº ï¼‰ã€themesï¼ˆä¸»é¢˜ç›®å½• ï¼‰ç­‰ã€‚

ï¼ˆäºŒï¼‰ä¸»é¢˜é€‰æ‹©ä¸é…ç½®

ä¸»é¢˜ä¸‹è½½ï¼šHexo å®˜ç½‘ï¼ˆhttps://hexo.io/themes/ ï¼‰é€‰å¿ƒä»ªä¸»é¢˜ï¼Œæ¯”å¦‚æˆ‘ç”¨çš„ anzhiyu ä¸»é¢˜ï¼Œå…‹éš†åˆ° themes ç›®å½•ï¼šgit clone https://github.com/Anzhiyu/hexo-theme-anzhiyu.git themes/anzhiyu

ä¸»é¢˜é…ç½®ï¼šå¤åˆ¶ä¸»é¢˜ç›®å½•ä¸‹çš„ _config.yml åˆ°åšå®¢æ ¹ç›®å½•ï¼Œé‡å‘½åä¸º _config.anzhiyu.yml ï¼Œä¿®æ”¹åŸºç¡€é…ç½®ï¼ˆå¦‚ç«™ç‚¹æ ‡é¢˜ã€æè¿°ã€å¤´åƒã€å¯¼èˆªèœå•ç­‰ ï¼‰ï¼Œè®©åšå®¢ç¬¦åˆéœ€æ±‚ã€‚

ï¼ˆä¸‰ï¼‰æœ¬åœ°é¢„è§ˆåšå®¢
æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼š
hexo clean &amp;&amp; hexo g &amp;&amp; hexo s

hexo cleanï¼šæ¸…ç†ä¹‹å‰ç”Ÿæˆçš„é™æ€æ–‡ä»¶ã€‚
hexo gï¼ˆhexo generate ï¼‰ï¼šç”Ÿæˆé™æ€åšå®¢æ–‡ä»¶åˆ° public ç›®å½•ã€‚
hexo sï¼ˆhexo server ï¼‰ï¼šå¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼Œæµè§ˆå™¨è®¿é—® http://localhost:4000 ï¼Œå°±èƒ½çœ‹åˆ°åˆå§‹åšå®¢é¡µé¢ã€‚

å››ã€å†…å®¹åˆ›ä½œä¸ç®¡ç†ï¼ˆTypora + PicGo [S3æ’ä»¶] + CloudFlareR2å­˜å‚¨æ¡¶ ï¼‰
ä¸€ã€Cloudflare R2 å­˜å‚¨æ¡¶åˆ›å»ºä¸åŸºç¡€é…ç½®
ï¼ˆä¸€ï¼‰ç™»å½• Cloudflare æ§åˆ¶å°

è®¿é—® Cloudflare Dashboard å¹¶ç™»å½•è´¦æˆ·ï¼ˆè‹¥æ— è´¦æˆ·éœ€å…ˆæ³¨å†Œï¼‰ã€‚
ç‚¹å‡»å·¦ä¾§èœå•ä¸­çš„ R2 é€‰é¡¹ï¼ˆè‹¥æœªæ˜¾ç¤ºï¼Œç‚¹å‡»â€œæ›´å¤šäº§å“â€æŸ¥æ‰¾ï¼‰ã€‚

ï¼ˆäºŒï¼‰åˆ›å»ºå­˜å‚¨æ¡¶


ç‚¹å‡» åˆ›å»ºå­˜å‚¨æ¡¶ æŒ‰é’®ï¼Œè¿›å…¥åˆ›å»ºæµç¨‹ï¼š

å­˜å‚¨æ¡¶åç§°ï¼šè‡ªå®šä¹‰ï¼ˆå¦‚ blog-imagesï¼‰ï¼Œéœ€å…¨å±€å”¯ä¸€ï¼ˆå»ºè®®åŒ…å«ä¸ªäººæ ‡è¯†ï¼‰ã€‚
åŒºåŸŸï¼šé€‰æ‹© è‡ªåŠ¨ï¼ˆAutoï¼‰ä»¥è·å¾—æœ€ä½³åˆ†å¸ƒï¼Œæˆ–æ‰‹åŠ¨æŒ‡å®šåŒºåŸŸï¼ˆå¦‚ äºšæ´² - æ–°åŠ å¡ï¼‰ã€‚
è®¿é—®æ§åˆ¶ï¼šå‹¾é€‰ å…¬å¼€è®¿é—®ï¼ˆPublic accessï¼‰ï¼Œå…è®¸åŒ¿åè¯»å–å›¾ç‰‡ï¼ˆè‹¥ä»…ä¸ªäººä½¿ç”¨å¯è·³è¿‡ï¼‰ã€‚
åŠ å¯†ï¼šé»˜è®¤å¯ç”¨æœåŠ¡å™¨ç«¯åŠ å¯†ï¼ˆSSEï¼‰ï¼Œæ— éœ€ä¿®æ”¹ã€‚



ç‚¹å‡» åˆ›å»ºå­˜å‚¨æ¡¶ï¼Œç­‰å¾…çº¦ 10 ç§’å®Œæˆåˆ›å»ºã€‚


ï¼ˆä¸‰ï¼‰è·å– API è®¿é—®å‡­è¯


è¿›å…¥ å­˜å‚¨æ¡¶è¯¦æƒ…é¡µ â†’ æƒé™ æ ‡ç­¾é¡µï¼š

ç‚¹å‡» åˆ›å»ºè®¿é—®å¯†é’¥ æŒ‰é’®ï¼ˆè‹¥æç¤ºéœ€è¦åˆ›å»ºå¯†é’¥å¯¹ï¼Œç‚¹å‡»â€œåˆ›å»ºâ€ï¼‰ã€‚
è®°å½•ç”Ÿæˆçš„ Access Key ID å’Œ Secret Access Keyï¼ˆä»…æ˜¾ç¤ºä¸€æ¬¡ï¼Œéœ€ç«‹å³ä¿å­˜åˆ°å®‰å…¨ä½ç½®ï¼‰ã€‚



å¤åˆ¶å­˜å‚¨æ¡¶ç«¯ç‚¹ï¼ˆEndpointï¼‰ï¼š

å­˜å‚¨æ¡¶è¯¦æƒ…é¡µ â†’ æ¦‚è¿° æ ‡ç­¾é¡µï¼Œæ‰¾åˆ° å¤–éƒ¨è®¿é—® ä¸­çš„ç«¯ç‚¹åœ°å€ï¼ˆæ ¼å¼ä¸º https://&lt;è´¦æˆ·ID&gt;.r2.cloudflarestorage.comï¼‰ã€‚



äºŒã€PicGo é…ç½® S3 æ’ä»¶å¯¹æ¥ R2
ï¼ˆä¸€ï¼‰å®‰è£… S3 æ’ä»¶

æ‰“å¼€ PicGo è½¯ä»¶ â†’ æ’ä»¶ç®¡ç† â†’ æœç´¢ s3 å¹¶å®‰è£… PicGo-S3-Pluginï¼ˆè‹¥å·²å®‰è£…å¯è·³è¿‡ï¼‰ã€‚

ï¼ˆäºŒï¼‰é…ç½®æ’ä»¶å‚æ•°


è¿›å…¥ PicGo å›¾åºŠè®¾ç½® â†’ é€‰æ‹© S3 æ’ä»¶ï¼š

Bucketï¼šå¡«å†™åˆ›å»ºçš„å­˜å‚¨æ¡¶åç§°ï¼ˆå¦‚ blog-imagesï¼‰ã€‚
Regionï¼šå¡« autoï¼ˆR2 ä¸åŒºåˆ†ä¼ ç»ŸåŒºåŸŸï¼‰ã€‚
Access Key IDï¼šç²˜è´´ Cloudflare ç”Ÿæˆçš„ Access Keyã€‚
Secret Access Keyï¼šç²˜è´´å¯¹åº”çš„ Secret Keyã€‚
Endpointï¼šç²˜è´´å­˜å‚¨æ¡¶ç«¯ç‚¹ï¼ˆå¦‚ https://abc123.r2.cloudflarestorage.comï¼‰ã€‚
Pathï¼šè‡ªå®šä¹‰å›¾ç‰‡å­˜å‚¨è·¯å¾„å‰ç¼€ï¼ˆå¦‚ blog/ï¼Œå¯ç•™ç©ºï¼‰ã€‚
Custom Domainï¼šå¡«å†™è‡ªå®šä¹‰åŸŸåï¼ˆå¦‚ img.soniachen.comï¼Œåç»­é…ç½®ï¼‰ã€‚
SSLï¼šå‹¾é€‰ï¼ˆå¯ç”¨ HTTPS è®¿é—®ï¼‰ã€‚



ç‚¹å‡» è®¾ä¸ºé»˜è®¤å›¾åºŠï¼Œå¹¶ç‚¹å‡» ç¡®å®š ä¿å­˜é…ç½®ã€‚


ï¼ˆä¸‰ï¼‰æµ‹è¯•ä¸Šä¼ 

åœ¨ PicGo ä¸»ç•Œé¢ç‚¹å‡» ä¸Šä¼ å›¾ç‰‡ï¼Œé€‰æ‹©æœ¬åœ°å›¾ç‰‡ï¼š

è‹¥ä¸Šä¼ æˆåŠŸï¼Œä¸‹æ–¹ä¼šæ˜¾ç¤ºå›¾ç‰‡ URLï¼ˆå¦‚ https://img.soniachen.com/blog/test.jpgï¼‰ã€‚



æœ‰è¯»è€…åé¦ˆé—®é¢˜ï¼Œä»¥ä¸‹æ˜¯æœ€æ–°è§£å†³æ–¹æ¡ˆï¼š

è®¾ç½®picgoå›¾åºŠï¼ˆä»¥ä¸‹æ˜¯picgo-coreçš„aws-s3å®‰è£…ï¼‰

https://github.com/wayjam/picgo-plugin-s3


è®¾ç½®typoraä¸Šä¼ 
&#x2F;usr&#x2F;local&#x2F;bin&#x2F;node &#x2F;opt&#x2F;homebrew&#x2F;bin&#x2F;picgo upload



ä¸‰ã€ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼ˆCDN åŠ é€Ÿï¼‰
ï¼ˆä¸€ï¼‰æ·»åŠ åŸŸååˆ° Cloudflare

ç™»å½• Cloudflare æ§åˆ¶å° â†’ åŸŸå â†’ æ·»åŠ åŸŸåï¼š

è¾“å…¥è‡ªå®šä¹‰åŸŸåï¼ˆå¦‚ img.soniachen.comï¼‰ï¼Œç‚¹å‡» ç»§ç»­ã€‚
ç­‰å¾… Cloudflare æ‰«æ DNS è®°å½•ï¼ˆçº¦ 1 - 5 åˆ†é’Ÿï¼‰ã€‚



ï¼ˆäºŒï¼‰é…ç½® DNS è§£æ

åœ¨åŸŸåç®¡ç†ç•Œé¢ â†’ DNS æ ‡ç­¾é¡µï¼š

æ·»åŠ ä¸€æ¡ CNAME è®°å½•ï¼š

åç§°ï¼šå¡« @ æˆ– imgï¼ˆæ ¹æ®åŸŸåç»“æ„ï¼‰ã€‚
ç›®æ ‡ï¼šå¡«å­˜å‚¨æ¡¶ç«¯ç‚¹ï¼ˆå¦‚ abc123.r2.cloudflarestorage.comï¼‰ã€‚
ä»£ç†çŠ¶æ€ï¼šé€‰æ‹© DNS Onlyï¼ˆä»…è§£æï¼Œä¸å¯ç”¨ CDNï¼‰æˆ– Proxiedï¼ˆå¯ç”¨ CDN åŠ é€Ÿï¼‰ã€‚





ï¼ˆä¸‰ï¼‰é…ç½® R2 è‡ªå®šä¹‰åŸŸå

å›åˆ° R2 å­˜å‚¨æ¡¶ â†’ åŸŸå æ ‡ç­¾é¡µï¼š

ç‚¹å‡» æ·»åŠ è‡ªå®šä¹‰åŸŸåï¼Œè¾“å…¥å·²æ·»åŠ åˆ° Cloudflare çš„åŸŸåï¼ˆå¦‚ img.soniachen.comï¼‰ã€‚
Cloudflare ä¼šè‡ªåŠ¨ç”Ÿæˆ SSL è¯ä¹¦ï¼ˆç­‰å¾…çº¦ 10 åˆ†é’Ÿç”Ÿæ•ˆï¼‰ã€‚



å››ã€Hexo é›†æˆ R2 å›¾åºŠï¼ˆå¯é€‰ï¼‰
ï¼ˆä¸€ï¼‰å®‰è£… Hexo æ’ä»¶

åœ¨ Hexo é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼šnpm install hexo-s3-image --save


ï¼ˆäºŒï¼‰é…ç½®æ’ä»¶

ä¿®æ”¹ _config.yml æ·»åŠ ä»¥ä¸‹é…ç½®ï¼šs3_image:
  bucket: blog-images          # å­˜å‚¨æ¡¶åç§°
  region: auto                 # åŒºåŸŸ
  accessKeyId: your-access-key # æ›¿æ¢ä¸ºå®é™… Access Key
  secretAccessKey: your-secret-key # æ›¿æ¢ä¸ºå®é™… Secret Key
  endpoint: https://abc123.r2.cloudflarestorage.com # ç«¯ç‚¹
  path: blog/                  # å­˜å‚¨è·¯å¾„
  customUrl: https://img.soniachen.com # è‡ªå®šä¹‰åŸŸå
  public: true                 # å…¬å¼€è®¿é—®


ï¼ˆä¸‰ï¼‰ä½¿ç”¨æ–¹å¼

åœ¨ Markdown ä¸­æ’å…¥å›¾ç‰‡æ—¶ï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°è·¯å¾„ï¼š![ç¤ºä¾‹å›¾ç‰‡](/img/test.jpg)

Hexo ç”Ÿæˆæ—¶ä¼šè‡ªåŠ¨ä¸Šä¼ å›¾ç‰‡åˆ° R2ï¼Œå¹¶æ›¿æ¢ä¸ºåœ¨çº¿é“¾æ¥ã€‚

äº”ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ
ï¼ˆä¸€ï¼‰403 Forbidden é”™è¯¯

åŸå› ï¼šå­˜å‚¨æ¡¶æœªå¯ç”¨å…¬å¼€è®¿é—®æˆ–è®¿é—®å¯†é’¥é”™è¯¯ã€‚
è§£å†³ï¼š

å­˜å‚¨æ¡¶ â†’ æƒé™ â†’ ç¡®ä¿ å…¬å¼€è®¿é—® å·²å¯ç”¨ã€‚
é‡æ–°æ ¸å¯¹ Access Key å’Œ Secret Key æ˜¯å¦æ­£ç¡®ã€‚



ï¼ˆäºŒï¼‰å›¾ç‰‡é“¾æ¥è¿”å› 404

åŸå› ï¼šåŸŸåè§£æé”™è¯¯æˆ–è·¯å¾„é…ç½®é”™è¯¯ã€‚
è§£å†³ï¼š

æ£€æŸ¥ DNS è§£ææ˜¯å¦ç”Ÿæ•ˆï¼ˆå¯é€šè¿‡ ping img.soniachen.com éªŒè¯ï¼‰ã€‚
ç¡®è®¤ PicGo ä¸­ Custom Domain ä¸ Cloudflare åŸŸåä¸€è‡´ã€‚



ï¼ˆä¸‰ï¼‰ä¸Šä¼ å¤±è´¥ï¼ˆç½‘ç»œé”™è¯¯ï¼‰

åŸå› ï¼šEndpoint å¡«å†™é”™è¯¯æˆ–ç½‘ç»œé˜»æ–­ã€‚
è§£å†³ï¼š

å­˜å‚¨æ¡¶è¯¦æƒ…é¡µå¤åˆ¶ç«¯ç‚¹ï¼Œç¡®ä¿æ— å¤šä½™å­—ç¬¦ï¼ˆå¦‚æœ«å°¾ç©ºæ ¼ï¼‰ã€‚
å°è¯•æ›´æ¢ç½‘ç»œç¯å¢ƒï¼ˆå¦‚å…³é—­ VPNï¼‰ã€‚



å…­ã€è¿›é˜¶ä¼˜åŒ–ï¼šç¼“å­˜ä¸å®‰å…¨
ï¼ˆä¸€ï¼‰è®¾ç½®ç¼“å­˜ç­–ç•¥

Cloudflare åŸŸå â†’ è§„åˆ™ â†’ é¡µé¢è§„åˆ™ï¼š

æ·»åŠ è§„åˆ™ https://img.soniachen.com/*ï¼Œè®¾ç½® ç¼“å­˜çº§åˆ« ä¸º ç¼“å­˜æ‰€æœ‰ï¼ŒTTL ä¸º 1 å¤©ï¼ˆæ ¹æ®éœ€æ±‚è°ƒæ•´ï¼‰ã€‚



ï¼ˆäºŒï¼‰å¯ç”¨é˜²ç›—é“¾

å­˜å‚¨æ¡¶ â†’ æƒé™ â†’ æ·»åŠ  Origin Accessï¼š

é…ç½®å…è®¸è®¿é—®çš„åŸŸåï¼ˆå¦‚ soniachen.comï¼‰ï¼Œæ‹’ç»å…¶ä»–åŸŸåç›—ç”¨å›¾ç‰‡ã€‚



/opt/homebrew/bin/node /opt/homebrew/bin/picgo upload

äº”ã€åšå®¢éƒ¨ç½²ï¼ˆGit + GitHub Pages + CloudFlare ï¼‰
ï¼ˆä¸€ï¼‰GitHub ä»“åº“å‡†å¤‡

GitHub æ–°å»ºä»“åº“ï¼Œå‘½åè§„åˆ™ï¼šè‹¥ä¸ºç”¨æˆ·/ç»„ç»‡é¡µï¼Œä»“åº“åå¡« ä½ çš„GitHubç”¨æˆ·å.github.ioï¼ˆå¦‚ soniachan33.github.io ï¼‰ï¼›è‹¥ä¸ºé¡¹ç›®é¡µï¼Œä»“åº“åè‡ªå®šä¹‰ï¼ˆåç»­éœ€é…ç½®è·¯å¾„ ï¼‰ã€‚
ä»“åº“åˆ›å»ºåï¼Œå¤åˆ¶ä»“åº“çš„ Git åœ°å€ï¼ˆSSH æˆ– HTTPS å½¢å¼ ï¼‰ã€‚

ï¼ˆäºŒï¼‰Hexo éƒ¨ç½²é…ç½®
ä¿®æ”¹åšå®¢æ ¹ç›®å½• _config.yml çš„ deploy é…ç½®ï¼š
deploy:
  type: git
  repo: git@github.com:ä½ çš„GitHubç”¨æˆ·å/ä½ çš„ä»“åº“å.git  # æ›¿æ¢ä¸ºå®é™…ä»“åº“åœ°å€
  branch: main  # éƒ¨ç½²åˆ†æ”¯ï¼ŒGitHub Pages å¸¸ç”¨ main æˆ– gh-pages
å®‰è£… hexo-deployer-git æ’ä»¶ï¼š
npm install hexo-deployer-git --save
ï¼ˆä¸‰ï¼‰éƒ¨ç½²åˆ° GitHub Pages
æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ï¼š
hexo clean &amp;&amp; hexo g &amp;&amp; hexo d
Hexo ä¼šæŠŠç”Ÿæˆçš„é™æ€æ–‡ä»¶ï¼ˆpublic ç›®å½•å†…å®¹ ï¼‰æ¨é€åˆ° GitHub ä»“åº“å¯¹åº”åˆ†æ”¯ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œè®¿é—® https://ä½ çš„GitHubç”¨æˆ·å.github.ioï¼ˆæˆ–é¡¹ç›®é¡µåœ°å€ ï¼‰ï¼Œèƒ½çœ‹åˆ°çº¿ä¸Šåšå®¢ã€‚
ï¼ˆå››ï¼‰CloudFlare åŠ é€Ÿä¸é…ç½®

æ·»åŠ ç«™ç‚¹ï¼šCloudFlare å®˜ç½‘ï¼ˆhttps://www.cloudflare.com/ ï¼‰æ³¨å†Œç™»å½•ï¼Œæ·»åŠ ç«™ç‚¹ï¼ˆè¾“å…¥åšå®¢åŸŸåï¼Œè‹¥ç”¨ GitHub Pages é»˜è®¤åŸŸåå¯è·³è¿‡ï¼Œè‹¥è‡ªå®šä¹‰åŸŸåéœ€æå‰å¤‡æ¡ˆã€è§£æ ï¼‰ã€‚
DNS è§£æè®¾ç½®ï¼šæ·»åŠ  DNS è®°å½•ï¼Œå°†åŸŸåè§£æåˆ° GitHub Pages å¯¹åº”çš„ IPï¼ˆæˆ–ç›´æ¥è§£æåˆ° ä½ çš„GitHubç”¨æˆ·å.github.io  ï¼‰ï¼Œè®© CloudFlare æ¥ç®¡ DNS è§£æã€‚
CDN ä¸å®‰å…¨é…ç½®ï¼šå¼€å¯ CDN åŠ é€Ÿï¼Œä¼˜åŒ–ç¼“å­˜ã€å‹ç¼©ç­‰è®¾ç½®ï¼›å¯ç”¨å®‰å…¨é˜²æŠ¤ï¼ˆå¦‚ DDoS é˜²æŠ¤ã€é˜²ç«å¢™è§„åˆ™ ï¼‰ï¼Œæå‡åšå®¢è®¿é—®é€Ÿåº¦ä¸å®‰å…¨æ€§ã€‚
è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰ï¼šè‹¥ç”¨è‡ªå®šä¹‰åŸŸåï¼ˆå¦‚ soniachen.com  ï¼‰ï¼Œåœ¨ GitHub Pages ä»“åº“è®¾ç½®ä¸­å¡«è‡ªå®šä¹‰åŸŸåï¼ŒåŒæ—¶åœ¨ CloudFlare é…ç½®åŸŸåè§£æã€SSL è¯ä¹¦ï¼ˆæ¨èå¼€å¯ Full æˆ– Strict æ¨¡å¼ ï¼‰ï¼Œç¡®ä¿ HTTPS è®¿é—®æ­£å¸¸ã€‚

å…­ã€åšå®¢ä¼˜åŒ–ä¸ç»´æŠ¤
ï¼ˆä¸€ï¼‰SEO ä¼˜åŒ–

ç«™ç‚¹åœ°å›¾ï¼ˆSitemap ï¼‰ï¼šå®‰è£… hexo-generator-sitemap æ’ä»¶ï¼Œç”Ÿæˆç«™ç‚¹åœ°å›¾ï¼šnpm install hexo-generator-sitemap --save
ä¿®æ”¹ _config.yml é…ç½®ï¼šsitemap:
  path: sitemap.xml
éƒ¨ç½²åï¼Œé€šè¿‡ https://ä½ çš„åŸŸå/sitemap.xml è®¿é—®ï¼Œæäº¤ç»™ç™¾åº¦ã€å¿…åº”ã€è°·æ­Œç­‰æœç´¢å¼•æ“ï¼ŒåŠ©åŠ›æ”¶å½•ã€‚
Meta æ ‡ç­¾ä¸å…³é”®è¯ï¼šåœ¨ä¸»é¢˜é…ç½®æˆ–æ–‡ç«  Front-matter ä¸­ï¼Œè®¾ç½®æ ‡é¢˜ã€æè¿°ã€å…³é”®è¯ï¼Œè®©æœç´¢å¼•æ“æ›´å¥½ç†è§£å†…å®¹ï¼Œæå‡æœç´¢æ’åã€‚

ï¼ˆäºŒï¼‰æŒç»­æ›´æ–°ä¸å¤‡ä»½

å†…å®¹æ›´æ–°ï¼šç”¨ Typora å†™æ–°æ–‡ç« ï¼Œå­˜åˆ° source/_posts ç›®å½•ï¼Œæ‰§è¡Œ hexo clean &amp;&amp; hexo g &amp;&amp; hexo d éƒ¨ç½²ï¼ŒæŒç»­è¾“å‡ºä¼˜è´¨å†…å®¹ã€‚
ç‰ˆæœ¬å¤‡ä»½ï¼šå€ŸåŠ© Gitï¼Œå®šæœŸæäº¤ä»£ç åˆ° GitHub ä»“åº“ï¼Œè®°å½•åšå®¢é…ç½®ã€æ–‡ç« ä¿®æ”¹å†å²ï¼Œæ–¹ä¾¿å›é€€ä¸ååŒã€‚

ä¸ƒã€é‡åˆ°çš„é—®é¢˜ä¸è§£å†³ï¼ˆç»“åˆä¹‹å‰çš„ç–‘é—®ï¼‰
ï¼ˆä¸€ï¼‰GitHub Pages éƒ¨ç½²å 404

åŸå› ï¼šéƒ¨ç½²åˆ†æ”¯ä¸ GitHub Pages è®¾ç½®ä¸ä¸€è‡´ã€root é…ç½®é”™è¯¯ã€CNAME æ–‡ä»¶ä¸¢å¤±ç­‰ã€‚
è§£å†³ï¼šç¡®ä¿ _config.yml ä¸­ deploy åˆ†æ”¯æ­£ç¡®ï¼Œç”¨æˆ·é¡µ root è®¾ä¸º / ï¼›åœ¨ Hexo é¡¹ç›® source ç›®å½•æ·»åŠ  CNAME æ–‡ä»¶ï¼ˆå¡«è‡ªå®šä¹‰åŸŸå ï¼‰ï¼Œé‡æ–°éƒ¨ç½²ã€‚

ï¼ˆäºŒï¼‰CloudFlare éƒ¨ç½²ååŸŸåé…ç½®æ¸…ç©º

åŸå› ï¼šHexo éƒ¨ç½²è¦†ç›– GitHub Pages åˆ†æ”¯å†…å®¹ï¼ŒCNAME æ–‡ä»¶æœªåŒæ­¥ã€‚
è§£å†³ï¼šåœ¨ Hexo é¡¹ç›® source ç›®å½•æ·»åŠ  CNAME æ–‡ä»¶ï¼Œå†…å®¹å¡«è‡ªå®šä¹‰åŸŸåï¼Œéƒ¨ç½²æ—¶åŒæ­¥åˆ° GitHub ä»“åº“ï¼ŒCloudFlare é…ç½®å°±ä¼šä¿ç•™ã€‚

ï¼ˆä¸‰ï¼‰å¿…åº”æ”¶å½•éªŒè¯é—®é¢˜

æ–¹æ³•ï¼šé€šè¿‡ XML æ–‡ä»¶ï¼ˆä¸‹è½½ BingSiteAuth.xml æ”¾ Hexo source ç›®å½•ï¼Œéƒ¨ç½²åéªŒè¯ ï¼‰ã€HTML Meta æ ‡è®°ï¼ˆæ·»åŠ åˆ°åšå®¢é¦–é¡µ &lt;head&gt;  ï¼‰ã€DNS CNAME è®°å½•ï¼ˆåŸŸåè§£æåå°æ·»åŠ  ï¼‰å®ŒæˆéªŒè¯ï¼Œæäº¤ç«™ç‚¹åœ°å›¾ï¼Œè®©åšå®¢åœ¨å¿…åº”æœç´¢å¯è§ã€‚

å…«ã€æ€»ç»“
ä»å·¥å…·å®‰è£…ã€Hexo åˆå§‹åŒ–ï¼Œåˆ°å†…å®¹åˆ›ä½œã€éƒ¨ç½²ä¸Šçº¿ï¼Œå†åˆ°ç”¨ CloudFlare åŠ é€Ÿã€ä¼˜åŒ– SEO ï¼Œæ•´ä¸ªæµç¨‹è™½æœ‰æ³¢æŠ˜ï¼Œä½†ä¸€æ­¥æ­¥æ­å»ºå‡ºä¸“å±åšå®¢ï¼Œæˆå°±æ„Ÿæ»¡æ»¡ã€‚è¿™äº”ä¸ªå·¥å…·ç›¸äº’é…åˆï¼Œè®©åšå®¢ä»æœ¬åœ°èµ°å‘å…¬ç½‘ï¼Œæˆä¸ºå±•ç¤ºè‡ªæˆ‘çš„çª—å£ã€‚æœªæ¥ï¼Œç»§ç»­ç”¨å®ƒä»¬æ›´æ–°å†…å®¹ã€ä¼˜åŒ–ä½“éªŒï¼Œè®©åšå®¢æŒç»­ç”Ÿé•¿ï½
é™„å½•ï¼šå…³é”®å‘½ä»¤ä¸é…ç½®æ±‡æ€»ï¼Œæ–¹ä¾¿é€ŸæŸ¥ï¼š

Hexo å¸¸ç”¨å‘½ä»¤ï¼šhexo cleanã€hexo gã€hexo sã€hexo d ã€‚
Git é…ç½®ä¸éƒ¨ç½²ï¼šgit configã€hexo-deployer-git æ’ä»¶é…ç½®ã€‚
CloudFlare æ ¸å¿ƒæ“ä½œï¼šDNS è§£æã€CDN åŠ é€Ÿã€SSL é…ç½®ã€‚
PicGo + Typora å›¾åºŠå†™ä½œï¼šTypora ä¸Šä¼ å›¾ç‰‡è®¾ç½®ã€PicGo å›¾åºŠé…ç½®ã€‚

å¸Œæœ›è¿™ç¯‡å¤ç›˜èƒ½å¸®åˆ°æƒ³æ­å»ºåšå®¢çš„ä½ ï¼Œä¸€èµ·ç”¨æŠ€æœ¯è®°å½•ç”Ÿæ´»ã€åˆ†äº«ä¸–ç•Œï½
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>CloudFlare</tag>
        <tag>Typora</tag>
        <tag>hexo</tag>
        <tag>PicGo</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ å¯†åŸºç¡€å·©å›º</title>
    <url>/2025/09/16/%E5%8A%A0%E5%AF%86%E5%9F%BA%E7%A1%80%E5%B7%A9%E5%9B%BA/</url>
    <content><![CDATA[åŠ å¯†åŸºç¡€å·©å›º1
å†å²å‘å±•æ€»ç»“
ä¸€ã€åº•å±‚åè®®ï¼šä»æ¯”ç‰¹å¸åˆ°ä»¥å¤ªåŠçš„èŒƒå¼è·ƒè¿


æ¯”ç‰¹å¸ï¼ˆ2009å¹´ï¼‰ï¼š

ä¸­æœ¬èªåœ¨ç™½çš®ä¹¦ä¸­æå‡ºâ€œç‚¹å¯¹ç‚¹ç”µå­ç°é‡‘ç³»ç»Ÿâ€ï¼Œé€šè¿‡å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰è§£å†³æ‹œå åº­å®¹é”™é—®é¢˜ï¼ŒåŒºå—å¥–åŠ±æ¯4å¹´å‡åŠï¼ˆ2009å¹´50 BTC/å—â†’2024å¹´3.125 BTC/å—ï¼‰ã€‚
æ—©æœŸä»…æ”¯æŒè½¬è´¦åŠŸèƒ½ï¼Œ2013å¹´é€šè¿‡â€œå¤šé‡ç­¾åâ€å®ç°ç®€å•æ™ºèƒ½åˆçº¦ï¼ˆå¦‚è”åè´¦æˆ·ï¼‰ï¼Œä½†è„šæœ¬è¯­è¨€éå›¾çµå®Œå¤‡ã€‚



ä»¥å¤ªåŠï¼ˆ2015å¹´ï¼‰ï¼š

Vitalik Buterinå—ã€Šé­”å…½ä¸–ç•Œã€‹é“å…·ä¸­å¿ƒåŒ–äº‹ä»¶å¯å‘ï¼Œæå‡ºâ€œä¸–ç•Œè®¡ç®—æœºâ€æ¦‚å¿µï¼Œé€šè¿‡**ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰**æ”¯æŒå›¾çµå®Œå¤‡çš„æ™ºèƒ½åˆçº¦ã€‚
2016å¹´å› â€œThe DAOäº‹ä»¶â€ç¡¬åˆ†å‰ä¸ºETHï¼ˆä»¥å¤ªåŠï¼‰å’ŒETCï¼ˆä»¥å¤ªåŠç»å…¸ï¼‰ï¼Œå‚¬ç”Ÿäº†â€œä»£ç å³æ³•å¾‹â€çš„äº‰è®®ä¸åæ€ã€‚



äºŒã€æ™ºèƒ½åˆçº¦ä¸æ ‡å‡†ï¼šERC-20/ERC-721å¼€å¯ç”Ÿæ€çˆ†å‘


æ™ºèƒ½åˆçº¦è¿›åŒ–ï¼š

2017å¹´ï¼ŒERC-20æ ‡å‡†ï¼ˆåŒè´¨åŒ–ä»£å¸ï¼‰ç”±Fabian Vogelstelleræå‡ºï¼Œå…è®¸ä»£å¸è·¨å¹³å°å…¼å®¹ï¼ˆå¦‚USDTã€UNIï¼‰ï¼Œç›´æ¥æ¨åŠ¨ICOçƒ­æ½®ï¼ˆEOSé€šè¿‡ICOèèµ„40äº¿ç¾å…ƒï¼‰ã€‚
2018å¹´ï¼ŒERC-721æ ‡å‡†ï¼ˆéåŒè´¨åŒ–ä»£å¸ï¼‰ç”±CryptoKittieså›¢é˜Ÿè½åœ°ï¼Œå®ç°æ•°å­—èµ„äº§å”¯ä¸€æ€§ï¼ˆå¦‚NFTå¤´åƒã€è™šæ‹ŸåœŸåœ°ï¼‰ï¼Œ2021å¹´OpenSeaäº¤æ˜“é¢çªç ´100äº¿ç¾å…ƒã€‚



æŠ€æœ¯ç—›ç‚¹ä¸å‡çº§ï¼š

ä»¥å¤ªåŠæ—©æœŸå› æ™ºèƒ½åˆçº¦æ¼æ´é¢‘å‘ï¼ˆå¦‚2022å¹´Nomad Bridgeè¢«ç›—1.9äº¿ç¾å…ƒï¼‰ï¼Œå‚¬ç”Ÿé™æ€åˆ†æå·¥å…·ï¼ˆå¦‚MythXï¼‰å’Œå½¢å¼åŒ–éªŒè¯æŠ€æœ¯ã€‚
2023å¹´ä¸Šæµ·å‡çº§ï¼ˆShapellaï¼‰å…è®¸ETHè´¨æŠ¼è§£é”ï¼Œæ¨åŠ¨LSDfiï¼ˆæµåŠ¨æ€§è´¨æŠ¼è¡ç”Ÿå“ï¼‰èµ›é“çˆ†å‘ï¼ŒTVLè¶…200äº¿ç¾å…ƒã€‚



ä¸‰ã€é«˜æ€§èƒ½å…¬é“¾ï¼šçªç ´â€œä¸å¯èƒ½ä¸‰è§’â€çš„æŠ€æœ¯ç«èµ›


Solanaï¼ˆ2020å¹´ä¸»ç½‘ï¼‰ï¼š

ç”±é«˜é€šå·¥ç¨‹å¸ˆAnatoly Yakovenkoåˆ›ç«‹ï¼Œé€šè¿‡**å†å²è¯æ˜ï¼ˆPoHï¼‰+æƒç›Šè¯æ˜ï¼ˆPoSï¼‰**å®ç°6500 TPSï¼ˆ Visaçº§åˆ«ï¼‰ï¼Œ2021å¹´å› FTXæŠ•èµ„çˆ†å‘ï¼Œ2022å¹´FTXå´©ç›˜åç”Ÿæ€å¤è‹ï¼Œ2024å¹´æ€»è´¹ç”¨è¶…ä»¥å¤ªåŠã€‚



BNB Chainï¼ˆ2019å¹´å¸å®‰é“¾â†’2020å¹´BSCï¼‰ï¼š

é‡‡ç”¨â€œè´¨æŠ¼+DPoSâ€å…±è¯†ï¼Œ2020å¹´å…¼å®¹EVMåæˆä¸ºDeFiç¬¬äºŒå¤§ç”Ÿæ€ï¼ˆTVLè¶…600äº¿ç¾å…ƒï¼‰ï¼Œ2023å¹´åˆå¹¶ä¿¡æ ‡é“¾ä¸æ™ºèƒ½é“¾ï¼Œæ¨å‡ºLayer2æ–¹æ¡ˆopBNBï¼ˆ4000 TPSï¼‰ã€‚



Avalancheï¼ˆ2020å¹´ä¸»ç½‘ï¼‰ï¼š

åº·å¥ˆå°”å¤§å­¦å›¢é˜Ÿå¼€å‘çš„â€œä¸‰é“¾æ¶æ„â€ï¼ˆX/P/Cé“¾ï¼‰ï¼Œé€šè¿‡é›ªå´©å…±è¯†å®ç°1ç§’ç¡®è®¤ï¼Œ2024å¹´ä¸é˜¿é‡Œäº‘åˆä½œæ¨å‡ºä¼ä¸šå…ƒå®‡å®™è§£å†³æ–¹æ¡ˆï¼Œ2025å¹´å› èŠ‚ç‚¹é—¨æ§›é«˜ï¼ˆè´¨æŠ¼2000 AVAXï¼‰å¼•å‘å»ä¸­å¿ƒåŒ–äº‰è®®ã€‚



EOSï¼ˆ2018å¹´ä¸»ç½‘ï¼‰ï¼š

ç”±Block.oneå¼€å‘ï¼Œé‡‡ç”¨â€œå§”æ‰˜PoSâ€ï¼ˆ21ä¸ªè¶…çº§èŠ‚ç‚¹ï¼‰ï¼Œæ›¾å› â€œCPUæˆ˜äº‰â€æš´éœ²èµ„æºåˆ†é…é—®é¢˜ï¼Œ2023å¹´é€šè¿‡EVMå…¼å®¹å±‚å’Œè·¨é“¾åè®®é‡ç”Ÿï¼Œæ—¥äº¤æ˜“é‡è¶…1äº¿ç¬”ã€‚



NEOï¼ˆ2016å¹´ä¸»ç½‘ï¼‰ï¼š

ä¸­å›½é¦–ä¸ªæ™ºèƒ½åˆçº¦å¹³å°ï¼Œæ—©æœŸé€šè¿‡â€œåŒé€šè¯æ¨¡å‹â€ï¼ˆNEO+GASï¼‰æ¿€åŠ±ç”Ÿæ€ï¼Œ2021å¹´N3å‡çº§æ”¯æŒåŸç”Ÿå­˜å‚¨å’Œé¢„è¨€æœºï¼Œæˆä¸ºäºšæ´²DeFié‡è¦åŸºç¡€è®¾æ–½ã€‚



å››ã€åº”ç”¨å±‚ï¼šä»é‡‘èåˆ°å®ä½“çš„åœºæ™¯é©å‘½
å›¾ä¸­â€œæ™ºèƒ½åˆçº¦â†’DeFi/NFT/GameFi/DePINâ€çš„åˆ†æ”¯ï¼Œä»£è¡¨åŒºå—é“¾ä»â€œä»£å¸æŠ•æœºâ€åˆ°â€œäº§ä¸šè½åœ°â€çš„è¿›åŒ–ï¼š


DeFiï¼ˆå»ä¸­å¿ƒåŒ–é‡‘èï¼‰ï¼š

2020å¹´â€œDeFi Summerâ€çˆ†å‘ï¼ŒUniswapï¼ˆAMMæ¨¡å¼ï¼‰ã€Aaveï¼ˆé—ªç”µè´·ï¼‰ã€Curveï¼ˆç¨³å®šå¸å…‘æ¢ï¼‰ç­‰åè®®TVLä»10äº¿å¢è‡³1000äº¿ç¾å…ƒã€‚
2023å¹´è½¬å‘â€œçœŸå®ä¸–ç•Œèµ„äº§ï¼ˆRWAï¼‰â€ï¼Œå¦‚æœ—æ–°ç§‘æŠ€å°†å……ç”µæ¡©èµ„äº§ä¸Šé“¾èèµ„1äº¿å…ƒï¼Œé«˜ç››å‘è¡Œ1äº¿æ¬§å…ƒæ•°å­—å€ºåˆ¸ã€‚



NFTä¸GameFiï¼š

2017å¹´CryptoKittiesï¼ˆNFTï¼‰å¯¼è‡´ä»¥å¤ªåŠæ‹¥å µï¼Œ2021å¹´Bored Ape Yacht Clubï¼ˆBAYCï¼‰å¼€å¯â€œå¤´åƒç»æµâ€ï¼Œåœ°æ¿ä»·è¶…100 ETHã€‚
GameFié€šè¿‡â€œPlay-to-Earnâ€æ¨¡å¼ï¼ˆå¦‚Axie Infinityï¼‰åœ¨ä¸œå—äºšæ™®åŠï¼Œ2022å¹´å› ä»£å¸é€šèƒ€ï¼ˆå¦‚DeFi Kingdomsä»£å¸è¶…å‘ï¼‰é™·å…¥ä½æ½®ï¼Œ2024å¹´è½¬å‘AI+å…ƒå®‡å®™èåˆï¼ˆå¦‚Decentralandçš„AIåœŸåœ°ç”Ÿæˆï¼‰ã€‚



DePINï¼ˆå»ä¸­å¿ƒåŒ–ç‰©ç†åŸºç¡€è®¾æ–½ï¼‰ï¼š

2023å¹´å…´èµ·çš„æ–°èµ›é“ï¼Œé€šè¿‡åŒºå—é“¾æ¿€åŠ±ç‰©ç†èµ„æºå…±äº«ï¼Œå¦‚Heliumï¼ˆå»ä¸­å¿ƒåŒ–5Gç½‘ç»œï¼ŒHNTä»£å¸ï¼‰ã€Filecoinï¼ˆåˆ†å¸ƒå¼å­˜å‚¨ï¼ŒFILä»£å¸ï¼‰ã€Power Ledgerï¼ˆP2Pèƒ½æºäº¤æ˜“ï¼‰ã€‚



äº”ã€å†å²é€»è¾‘ï¼šæŠ€æœ¯ã€å¸‚åœºä¸ç›‘ç®¡çš„ä¸‰é‡åšå¼ˆ

æŠ€æœ¯é©±åŠ¨ï¼šä»PoWï¼ˆæ¯”ç‰¹å¸ï¼‰åˆ°PoSï¼ˆä»¥å¤ªåŠ2.0ï¼‰ï¼Œä»å•é“¾åˆ°Layer2ï¼ˆå¦‚Optimismï¼‰ï¼Œä»EVMåˆ°å¤šé“¾äº’æ“ä½œï¼ˆå¦‚Cosmosï¼‰ï¼Œæ ¸å¿ƒæ˜¯è§£å†³â€œ scalabilityï¼ˆå¯æ‰©å±•æ€§ï¼‰ã€securityï¼ˆå®‰å…¨æ€§ï¼‰ã€decentralizationï¼ˆå»ä¸­å¿ƒåŒ–ï¼‰â€çš„ä¸å¯èƒ½ä¸‰è§’ã€‚
å¸‚åœºå‘¨æœŸï¼š2017å¹´ICOæ³¡æ²«â†’2020å¹´DeFi Summerâ†’2021å¹´NFTç‹‚æ½®â†’2022å¹´Lunaå´©ç›˜â†’2023å¹´RWAä¸AIèåˆï¼Œæ¯è½®å‘¨æœŸéƒ½ä¼´éšæ—§æ¨¡å¼æ·˜æ±°ä¸æ–°èŒƒå¼è¯ç”Ÿã€‚
ç›‘ç®¡å½±å“ï¼š2023å¹´ç¾å›½SECèµ·è¯‰Binanceå’ŒCoinbaseï¼ŒåŠ é€Ÿè¡Œä¸šåˆè§„åŒ–ï¼›2024å¹´é¦™æ¸¯å…è®¸é›¶å”®æŠ•èµ„è€…äº¤æ˜“ä»£å¸åŒ–è¯åˆ¸ï¼ˆå¦‚å¹¿å‘è¯åˆ¸â€œGF Tokenâ€ï¼‰ï¼Œæ¨åŠ¨ä¼ ç»Ÿé‡‘èä¸Web3èåˆã€‚

åŒºå—é“¾åº”ç”¨æŠ€æœ¯çš„ä¸‰å±‚æŠ€æœ¯å…³ç³»

L1/L2ï¼ˆåº•å±‚åŒºå—é“¾ï¼‰ï¼šç›¸å½“äº â€œåœ°åŸºâ€ã€‚

L1ï¼ˆLayer 1ï¼Œç¬¬ä¸€å±‚å…¬é“¾ï¼‰ï¼šæ¯”å¦‚æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠï¼Œæ˜¯åŒºå—é“¾çš„ â€œæ ¹â€ï¼Œè´Ÿè´£æœ€æ ¸å¿ƒçš„å®‰å…¨ï¼ˆå¦‚è®°è´¦ã€å…±è¯†ï¼‰ã€‚
L2ï¼ˆLayer 2ï¼Œç¬¬äºŒå±‚ç½‘ç»œï¼‰ï¼šæ¯”å¦‚ä»¥å¤ªåŠä¸Šçš„ Optimismã€Arbitrumï¼Œæ˜¯ â€œåœ°åŸºçš„å»¶ä¼¸â€ï¼Œç”¨æ¥è§£å†³ L1 é€Ÿåº¦æ…¢ã€æ‰‹ç»­è´¹é«˜çš„é—®é¢˜ï¼Œè®©åº”ç”¨è·‘å¾—æ›´å¿«æ›´ä¾¿å®œã€‚


Protocolï¼ˆåè®®ï¼‰ï¼šç›¸å½“äº â€œå»ºç­‘å›¾çº¸â€ã€‚
æ¯”å¦‚ DeFi é‡Œçš„ Uniswapï¼ˆäº¤æ˜“è§„åˆ™ï¼‰ã€Aaveï¼ˆå€Ÿè´·è§„åˆ™ï¼‰ï¼Œå®ƒå®šä¹‰äº† â€œå»ä¸­å¿ƒåŒ–ä¸šåŠ¡è¯¥æ€ä¹ˆè¿è¡Œâ€ï¼ˆæ¯”å¦‚æ€ä¹ˆå…‘æ¢ä»£å¸ã€æ€ä¹ˆå€Ÿè¿˜é’±ï¼‰ã€‚
dAppï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼‰ï¼šç›¸å½“äº â€œç”¨æˆ·ä½çš„æˆ¿å­â€ã€‚
æ¯”å¦‚ä½ ç”¨æ¥ä¹°å–ä»£å¸çš„ Uniswap Appã€ç©é“¾æ¸¸çš„ Axie Infinityï¼Œæ˜¯ç›´æ¥ç»™ç”¨æˆ·ç”¨çš„ç•Œé¢ã€‚ç”¨æˆ·é€šè¿‡ dAppï¼Œå°±èƒ½ä½¿ç”¨ protocol è§„å®šçš„åŠŸèƒ½ï¼Œè€Œ dApp çš„æ‰€æœ‰æ“ä½œï¼Œæœ€ç»ˆéƒ½é  L1/L2 æ¥è®°å½•å’Œä¿éšœå®‰å…¨ã€‚

ç®€å•è¯´ï¼šL1/L2 æ‰“åŸºç¡€ï¼Œprotocol å®šè§„åˆ™ï¼ŒdApp ç»™ç”¨æˆ·ç”¨ï¼Œä¸‰å±‚é…åˆè®©å»ä¸­å¿ƒåŒ–åº”ç”¨èƒ½è½åœ°
]]></content>
      <categories>
        <category>Web3</category>
      </categories>
  </entry>
  <entry>
    <title>æ·±åº¦è§£æï¼šAMM æµåŠ¨æ€§æ¨¡å‹çš„&quot;ä¸‰ä»£åŒå ‚&quot; (CPMM vs CLMM vs DLMM)</title>
    <url>/2025/10/09/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90-AMM-%E6%B5%81%E5%8A%A8%E6%80%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%22%E4%B8%89%E4%BB%A3%E5%90%8C%E5%A0%82%22-CPMM-vs-CLMM-vs-DLMM/</url>
    <content><![CDATA[æ·±åº¦è§£æï¼šAMM æµåŠ¨æ€§æ¨¡å‹çš„&quot;ä¸‰ä»£åŒå ‚&quot;
å¼•è¨€
åœ¨DeFiç”Ÿæ€ä¸­ï¼Œè‡ªåŠ¨åŒ–åšå¸‚å•†ï¼ˆAMMï¼‰æ˜¯æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œè€ŒæµåŠ¨æ€§æ¨¡å‹çš„æ¼”è¿›ç›´æ¥å†³å®šäº†èµ„æœ¬æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒã€‚ä»æœ€åˆçš„å¸¸æ•°ä¹˜ç§¯æ¨¡å‹ï¼ˆCPMMï¼‰åˆ°é›†ä¸­æµåŠ¨æ€§æ¨¡å‹ï¼ˆCLMMï¼‰ï¼Œå†åˆ°æ–°å…´çš„åŠ¨æ€æµåŠ¨æ€§æ¨¡å‹ï¼ˆDLMMï¼‰ï¼ŒAMMæŠ€æœ¯ç»å†äº†ä¸‰ä»£é©æ–°ã€‚æœ¬æ–‡å°†æ·±å…¥å¯¹æ¯”è¿™ä¸‰ç§æ¨¡å‹çš„è®¾è®¡ç†å¿µã€æŠ€æœ¯å®ç°å’Œå®é™…åº”ç”¨ã€‚
CPMMï¼šå¸¸æ•°ä¹˜ç§¯å¸‚åœºåšå¸‚å•†
æ ¸å¿ƒæœºåˆ¶
CPMMï¼ˆConstant Product Market Makerï¼‰æ˜¯æœ€ç»å…¸çš„AMMæ¨¡å‹ï¼Œä»¥Uniswap V2ä¸ºä»£è¡¨ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ•°å­¦å…¬å¼ç»´æŒäº¤æ˜“å¯¹çš„ä¹˜ç§¯æ’å®šï¼š
xÃ—y=kx \times y = k
xÃ—y=k
å…¶ä¸­ï¼š

x å’Œ y åˆ†åˆ«ä»£è¡¨ä¸¤ç§ä»£å¸çš„å‚¨å¤‡é‡
k æ˜¯æ’å®šå€¼

äº¤æ˜“æœºåˆ¶
å½“ç”¨æˆ·è¿›è¡Œä»£å¸äº¤æ¢æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®ä»¥ä¸‹å…¬å¼è®¡ç®—è¾“å‡ºé‡ï¼š
Î”y=yÃ—Î”xx+Î”x\Delta y = \frac{y \times \Delta x}{x + \Delta x}
Î”y=x+Î”xyÃ—Î”xâ€‹
ç¤ºä¾‹ä»£ç é€»è¾‘ï¼š
function getAmountOut(
    uint amountIn,
    uint reserveIn,
    uint reserveOut
) public pure returns (uint amountOut) &#123;
    uint amountInWithFee = amountIn * 997; // 0.3%æ‰‹ç»­è´¹
    uint numerator = amountInWithFee * reserveOut;
    uint denominator = (reserveIn * 1000) + amountInWithFee;
    amountOut = numerator / denominator;
&#125;
ä¼˜ç¼ºç‚¹åˆ†æ
ä¼˜åŠ¿ï¼š

å®ç°ç®€å•ï¼Œæ˜“äºç†è§£
æŠ—æ“çºµæ€§å¼º
æµåŠ¨æ€§åˆ†å¸ƒå‡åŒ€

åŠ£åŠ¿ï¼š

èµ„æœ¬æ•ˆç‡ä½ä¸‹ï¼Œå¤§é‡èµ„é‡‘é—²ç½®
æ— å¸¸æŸå¤±ä¸¥é‡
æ»‘ç‚¹éšäº¤æ˜“é‡å¢å¤§è€Œå¢åŠ 

CLMMï¼šé›†ä¸­æµåŠ¨æ€§å¸‚åœºåšå¸‚å•†
åˆ›æ–°çªç ´
CLMMï¼ˆConcentrated Liquidity Market Makerï¼‰æ˜¯Uniswap V3å¼•å…¥çš„é©å‘½æ€§åˆ›æ–°ï¼Œå°†æµåŠ¨æ€§é›†ä¸­åœ¨ç‰¹å®šä»·æ ¼åŒºé—´å†…ï¼Œå¤§å¹…æå‡èµ„æœ¬æ•ˆç‡ã€‚
Tickç³»ç»Ÿ
CLMMçš„æ ¸å¿ƒæ˜¯Tickç³»ç»Ÿï¼Œå°†ä»·æ ¼èŒƒå›´ç¦»æ•£åŒ–ä¸ºå¯ç®¡ç†çš„åŒºé—´ï¼š
// ä»·æ ¼è®¡ç®—å…¬å¼
pub fn tick_to_price(tick: i32) -> f64 &#123;
    1.0001_f64.powf(tick as f64 / 2.0)
&#125;

// æµåŠ¨æ€§é›†ä¸­åŒºé—´
pub struct Position &#123;
    pub tick_lower: i32,  // ä¸‹ç•Œtick
    pub tick_upper: i32,  // ä¸Šç•Œtick
    pub liquidity: u128,  // æµåŠ¨æ€§æ•°é‡
&#125;
æ•°å­¦ä¼˜åŒ–
ä»·æ ¼ä½¿ç”¨Q64.64å®šç‚¹æ•°è¡¨ç¤ºï¼Œç¡®ä¿è®¡ç®—ç²¾åº¦ï¼š
P=yxÃ—264\sqrt{P} = \sqrt{\frac{y}{x}} \times 2^{64}
Pâ€‹=xyâ€‹â€‹Ã—264
èµ„æœ¬æ•ˆç‡æå‡
ç›¸æ¯”CPMMï¼ŒCLMMåœ¨ç›¸åŒä»·æ ¼åŒºé—´å†…çš„èµ„æœ¬æ•ˆç‡å¯æå‡æ•°ç™¾å€ï¼š



ä»·æ ¼èŒƒå›´
CPMMèµ„é‡‘åˆ©ç”¨ç‡
CLMMèµ„é‡‘åˆ©ç”¨ç‡
æ•ˆç‡æå‡




Â±5%
21%
100%
4.8å€


Â±10%
11%
100%
9.1å€


Â±50%
4%
100%
25å€



DLMMï¼šåŠ¨æ€æµåŠ¨æ€§å¸‚åœºåšå¸‚å•†
åˆ›æ–°ç†å¿µ
DLMMï¼ˆDynamic Liquidity Market Makerï¼‰ä»£è¡¨äº†AMMçš„ç¬¬ä¸‰ä»£è¿›åŒ–ï¼Œé€šè¿‡æ™ºèƒ½åˆçº¦è‡ªåŠ¨è°ƒæ•´æµåŠ¨æ€§åˆ†å¸ƒï¼Œç»“åˆäº†CPMMçš„ç®€å•æ€§å’ŒCLMMçš„æ•ˆç‡ä¼˜åŠ¿ã€‚
åŠ¨æ€è°ƒæ•´æœºåˆ¶
DLMMçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯æµåŠ¨æ€§å¤´å¯¸èƒ½å¤Ÿæ ¹æ®å¸‚åœºæ¡ä»¶è‡ªåŠ¨è°ƒæ•´ï¼š
interface DLMM &#123;
    // åŠ¨æ€é‡æ–°å¹³è¡¡
    function rebalance(
        uint[] calldata targetRanges,
        uint[] calldata percentages
    ) external;

    // è‡ªåŠ¨åŒ–åšå¸‚ç­–ç•¥
    function executeStrategy(
        StrategyParams calldata params
    ) external returns (uint liquidityAdded);
&#125;
æ™ºèƒ½ç­–ç•¥
DLMMé›†æˆäº†å¤šç§è‡ªåŠ¨åŒ–ç­–ç•¥ï¼š

å‡å€¼å›å½’ç­–ç•¥ï¼šåœ¨ä»·æ ¼åç¦»å‡å€¼æ—¶è‡ªåŠ¨è°ƒæ•´å¤´å¯¸
æ³¢åŠ¨ç‡é€‚åº”ç­–ç•¥ï¼šæ ¹æ®å¸‚åœºæ³¢åŠ¨ç‡åŠ¨æ€è°ƒæ•´ä»·æ ¼åŒºé—´
æ”¶ç›Šä¼˜åŒ–ç­–ç•¥ï¼šè‡ªåŠ¨å°†èµšå–çš„æ‰‹ç»­è´¹è¿›è¡Œå¤æŠ•

Raydiumä¸èåˆåˆ›æ–°
Raydium CLMMå®ç°
Raydiumä½œä¸ºSolanaç”Ÿæ€çš„é‡è¦AMMï¼Œç‡å…ˆå®ç°äº†CLMMï¼š
// Raydium AMMæ ¸å¿ƒç»“æ„ä½“
#[account]
pub struct AmmInfo &#123;
    pub serum_program_id: Pubkey,
    pub serum_market: Pubkey,
    pub serum_coin_vault_account: Pubkey,
    pub serum_pc_vault_account: Pubkey,
    pub serum_withdraw_queue: Pubkey,
    pub serum_temp_lp_vault_account: Pubkey,
    pub amm_open_orders: Pubkey,
    pub amm_target_orders: Pubkey,
    pub amm_quantities: Pubkey,
    pub pool_coin_token_account: Pubkey,
    pub pool_pc_token_account: Pubkey,
    pub pool_withdraw_queue: Pubkey,
    pub pool_temp_lp_token_account: Pubkey,
    pub amm_owner: Pubkey,
    pub pool_lp_token_account: Pubkey,
&#125;
èåˆåˆ›æ–°æ–¹å‘
ç°ä»£AMMå¼€å§‹èåˆå¤šç§æ¨¡å‹çš„ä¼˜åŠ¿ï¼š

æ··åˆæµåŠ¨æ€§æ¨¡å‹ï¼šç»“åˆé›†ä¸­å’Œå…¨èŒƒå›´æµåŠ¨æ€§
è·¨é“¾AMMï¼šå¤šé“¾éƒ¨ç½²å’Œæ¡¥æ¥æ•´åˆ
æ„å›¾é©±åŠ¨AMMï¼šé›†æˆç”¨æˆ·äº¤æ˜“æ„å›¾ä¼˜åŒ–

å…¨é¢å¯¹æ¯”åˆ†æ
èµ„æœ¬æ•ˆç‡å¯¹æ¯”



æŒ‡æ ‡
CPMM
CLMM
DLMM




ç›¸åŒåŒºé—´èµ„æœ¬æ•ˆç‡
ä½
é«˜
æé«˜


èµ„é‡‘åˆ©ç”¨ç‡
5-20%
80-100%
90-100%


æµåŠ¨æ€§ç¢ç‰‡åŒ–
æ— 
ä¸­ç­‰
ä½


ç»´æŠ¤å¤æ‚åº¦
ä½
é«˜
ä¸­ç­‰



é£é™©è¯„ä¼°
æ— å¸¸æŸå¤±ï¼ˆILï¼‰
æ— å¸¸æŸå¤±æ˜¯LPé¢ä¸´çš„ä¸»è¦é£é™©ï¼š

CPMMï¼šå…¨ä»·æ ¼èŒƒå›´æš´éœ²ï¼ŒILé£é™©æœ€é«˜
CLMMï¼šåŒºé—´é›†ä¸­ï¼ŒILé£é™©å¯æ§ä½†éœ€ç²¾ç¡®é¢„æµ‹
DLMMï¼šåŠ¨æ€è°ƒæ•´ï¼ŒILé£é™©æœ€ä½

æ»‘ç‚¹é£é™©
æ»‘ç‚¹éšäº¤æ˜“è§„æ¨¡å’ŒæµåŠ¨æ€§åˆ†å¸ƒå˜åŒ–ï¼š
æ»‘ç‚¹ &#x3D; f(äº¤æ˜“é‡, æµåŠ¨æ€§æ·±åº¦, ä»·æ ¼åŒºé—´)
æ“çºµé£é™©
ä¸åŒæ¨¡å‹é¢å¯¹æ“çºµæ”»å‡»çš„è„†å¼±æ€§ï¼š

ä¸‰æ˜æ²»æ”»å‡»ï¼šCLMMæœ€æ˜“å—å½±å“
é¢„è¨€æœºæ“çºµï¼šCPMMç›¸å¯¹å®‰å…¨
æµåŠ¨æ€§æ“çºµï¼šDLMMé€šè¿‡åŠ¨æ€è°ƒæ•´ç¼“è§£

é€‚ç”¨åœºæ™¯åˆ†æ
CPMMé€‚ç”¨åœºæ™¯

æ–°å…´äº¤æ˜“å¯¹ï¼Œéœ€è¦å¹¿æ³›æµåŠ¨æ€§
å°é¢äº¤æ˜“ï¼Œç”¨æˆ·ä½“éªŒä¼˜å…ˆ
ç¨³å®šå¸äº¤æ˜“å¯¹ï¼Œä»·æ ¼ç¨³å®š

CLMMé€‚ç”¨åœºæ™¯

é«˜é¢‘äº¤æ˜“å¯¹ï¼Œéœ€è¦æé«˜èµ„æœ¬æ•ˆç‡
æˆç†Ÿäº¤æ˜“å¯¹ï¼Œæœ‰æ˜ç¡®ä»·æ ¼åŒºé—´
ä¸“ä¸šåšå¸‚å•†å’Œæœºæ„LP

DLMMé€‚ç”¨åœºæ™¯

æ³¢åŠ¨ç‡è¾ƒé«˜çš„äº¤æ˜“å¯¹
éœ€è¦è‡ªåŠ¨åŒ–ç®¡ç†çš„æµåŠ¨æ€§æ± 
å¯»æ±‚æœ€ä½³é£é™©æ”¶ç›Šæ¯”çš„LP

æœªæ¥å‘å±•è¶‹åŠ¿
æŠ€æœ¯æ¼”è¿›æ–¹å‘

AIé©±åŠ¨AMMï¼šæœºå™¨å­¦ä¹ ä¼˜åŒ–ä»·æ ¼åŒºé—´å’ŒæµåŠ¨æ€§åˆ†å¸ƒ
é›¶çŸ¥è¯†è¯æ˜é›†æˆï¼šéšç§ä¿æŠ¤çš„AMMäº¤æ˜“
æ„å›¾å¯¼å‘è®¾è®¡ï¼šç”¨æˆ·æ„å›¾é©±åŠ¨çš„æµåŠ¨æ€§é…ç½®
å¤šé“¾åŸç”ŸAMMï¼šè·¨é“¾åŸç”ŸæµåŠ¨æ€§åè®®

ç”Ÿæ€èåˆè¶‹åŠ¿
ç°ä»£DeFiç”Ÿæ€ä¸­ï¼Œä¸‰ç§æ¨¡å‹å°†é•¿æœŸå…±å­˜å¹¶ç›¸äº’èåˆï¼š

åè®®å±‚èåˆï¼šå•ä¸€åè®®æ”¯æŒå¤šç§æµåŠ¨æ€§æ¨¡å‹
è·¨åè®®åä½œï¼šä¸åŒAMMåè®®é—´çš„æµåŠ¨æ€§å…±äº«
ç”Ÿæ€çº§åˆ›æ–°ï¼šDeFiåè®®æ ˆçš„æ•´ä½“æµåŠ¨æ€§ä¼˜åŒ–

ç»“è®º
AMMæµåŠ¨æ€§æ¨¡å‹çš„ä¸‰ä»£æ¼”è¿›ä»£è¡¨äº†DeFiåŸºç¡€è®¾æ–½çš„æˆç†Ÿè¿‡ç¨‹ï¼š

CPMMå¥ å®šäº†AMMçš„åŸºç¡€ï¼Œè¯æ˜äº†å»ä¸­å¿ƒåŒ–äº¤æ˜“çš„å¯èƒ½æ€§
CLMMå¤§å¹…æå‡äº†èµ„æœ¬æ•ˆç‡ï¼Œæ¨åŠ¨äº†æœºæ„é‡‡ç”¨
DLMMé€šè¿‡è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–ï¼Œé™ä½äº†ç”¨æˆ·ä½¿ç”¨é—¨æ§›

æ¯ç§æ¨¡å‹éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä»·å€¼ä¸»å¼ ï¼Œé€‰æ‹©åˆé€‚çš„æ¨¡å‹éœ€è¦ç»¼åˆè€ƒè™‘èµ„æœ¬æ•ˆç‡ã€é£é™©åå¥½å’Œä½¿ç”¨åœºæ™¯ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥ï¼ŒAMMå°†ç»§ç»­æ¼”åŒ–ï¼Œä¸ºDeFiç”Ÿæ€æä¾›æ›´é«˜æ•ˆã€æ›´æ™ºèƒ½çš„æµåŠ¨æ€§è§£å†³æ–¹æ¡ˆã€‚

æœ¬æ–‡åŸºäºå…¬å¼€æŠ€æœ¯æ–‡æ¡£å’Œåè®®åˆ†æï¼Œæ—¨åœ¨æä¾›æ•™è‚²æ€§å†…å®¹ã€‚DeFiæŠ•èµ„é£é™©é«˜ï¼Œè¯·è°¨æ…å†³ç­–ã€‚
]]></content>
      <categories>
        <category>DeFi</category>
      </categories>
      <tags>
        <tag>Solana</tag>
        <tag>DeFi</tag>
        <tag>Meteora</tag>
        <tag>DLMM</tag>
        <tag>AMM</tag>
        <tag>CPMM</tag>
        <tag>CLMM</tag>
        <tag>Uniswap</tag>
        <tag>Raydium</tag>
      </tags>
  </entry>
  <entry>
    <title>Twikooè¯„è®ºç³»ç»Ÿçš„Cloudflareéƒ¨ç½²æ–¹æ¡ˆ</title>
    <url>/2025/06/17/Twikoo%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F%E7%9A%84Cloudflare%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[Twikooè¯„è®ºç³»ç»Ÿçš„Cloudflareéƒ¨ç½²æ–¹æ¡ˆ
Twikooæ˜¯ä¸€æ¬¾ç®€æ´ã€å®‰å…¨ä¸”å…è´¹çš„é™æ€ç½‘ç«™è¯„è®ºç³»ç»Ÿï¼Œåœ¨æå‡ç½‘ç«™äº’åŠ¨æ€§æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚é€šå¸¸ï¼ŒTwikooå¯éƒ¨ç½²åœ¨è¯¸å¦‚è…¾è®¯äº‘å¼€å‘ç¯å¢ƒã€Vercelç­‰å¹³å°ï¼Œä½†å€ŸåŠ©Cloudflareè¿›è¡Œéƒ¨ç½²ï¼Œèƒ½æå¤§æ”¹å–„å†·å¯åŠ¨å»¶è¿Ÿé—®é¢˜ï¼Œå®ç°å¿«é€ŸåŠ è½½ï¼Œä¸ºç”¨æˆ·å¸¦æ¥æ›´æµç•…çš„è¯„è®ºä½“éªŒï¼ŒåŒæ—¶åˆ©ç”¨Cloudflareå¼ºå¤§çš„å…¨çƒç½‘ç»œæå‡è®¿é—®é€Ÿåº¦ã€‚ä»¥ä¸‹ä¸ºè¯¦ç»†çš„Cloudflareéƒ¨ç½²Twikooè¯„è®ºç³»ç»Ÿçš„æ­¥éª¤ä¸è¦ç‚¹ã€‚
ä¸€ã€å‰æœŸå‡†å¤‡
åœ¨å¼€å§‹éƒ¨ç½²å‰ï¼Œéœ€æå‰å‡†å¤‡å¥½ç›¸å…³å·¥å…·ä¸èµ„æºï¼š

Cloudflareè´¦æˆ·ï¼šè‹¥å°šæœªæ³¨å†Œï¼Œå‰å¾€Cloudflareå®˜ç½‘å®Œæˆæ³¨å†Œæµç¨‹ã€‚
Node.jsç¯å¢ƒï¼šç¡®ä¿æœ¬åœ°å¼€å‘ç¯å¢ƒå®‰è£…äº†Node.jsï¼Œå¯é€šè¿‡Node.jså®˜ç½‘ä¸‹è½½å¹¶å®‰è£…å¯¹åº”ç³»ç»Ÿçš„æœ€æ–°ç‰ˆæœ¬ï¼Œå®‰è£…å®Œæˆåï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥node -véªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸåŠæŸ¥çœ‹ç‰ˆæœ¬å·ã€‚
æ–‡æœ¬ç¼–è¾‘å™¨ï¼šæ¨èä½¿ç”¨Visual Studio Codeã€Sublime Textç­‰ï¼Œæ–¹ä¾¿è¿›è¡Œä»£ç ç¼–è¾‘ä¸é…ç½®æ–‡ä»¶ä¿®æ”¹ã€‚

äºŒã€å®‰è£…ä¾èµ–åŒ…

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ç›®å½•ï¼Œç”¨äºå­˜æ”¾Twikooç›¸å…³ä»£ç ä¸é…ç½®æ–‡ä»¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¿›å…¥è¯¥ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…é¡¹ç›®ä¾èµ–ï¼š

npm install

ç”±äºCloudflare Workersçš„å…è´¹å¥—é¤å¯¹æ†ç»‘åŒ…å¤§å°æœ‰ä¸¥æ ¼çš„1MiBé™åˆ¶ï¼Œéƒ¨åˆ†ä¸Cloudflare Workersçš„Node.jså…¼å®¹æ€§å­˜åœ¨é—®é¢˜çš„åŒ…å³ä¾¿å®‰è£…äº†ä¹Ÿæ— æ³•ä½¿ç”¨ï¼Œä¸ºæ§åˆ¶æ†ç»‘åŒ…å¤§å°ï¼Œéœ€æ‰‹åŠ¨åˆ é™¤è¿™äº›åŒ…ï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä¾æ¬¡æ‰§è¡Œï¼š

echo "" > node_modules/jsdom/lib/api.js
echo "" > node_modules/tencentcloud-sdk-nodejs/tencentcloud/index.js
echo "" > node_modules/nodemailer/lib/nodemailer.js
ä¸Šè¿°å‘½ä»¤ä¼šæ¸…ç©ºjsdomã€tencentcloud-sdk-nodejsã€nodemailerè¿™ä¸‰ä¸ªåŒ…ä¸­ç‰¹å®šæ–‡ä»¶çš„å†…å®¹ï¼Œä½¿å…¶ä¸å ç”¨æ†ç»‘åŒ…ç©ºé—´ï¼ŒåŒæ—¶è§„é¿å…¼å®¹æ€§é—®é¢˜ã€‚
ä¸‰ã€ç™»å½•Cloudflareè´¦æˆ·
é€šè¿‡Wranglerå·¥å…·ç™»å½•Cloudflareè´¦æˆ·ï¼ŒWrangleræ˜¯Cloudflareæä¾›çš„ç”¨äºç®¡ç†Workersã€D1æ•°æ®åº“ç­‰èµ„æºçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œç™»å½•ï¼š
npx wrangler login
è¿è¡Œè¯¥å‘½ä»¤åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œè·³è½¬åˆ°Cloudflareçš„æˆæƒé¡µé¢ï¼ŒæŒ‰ç…§æç¤ºå®Œæˆæˆæƒæ“ä½œï¼ŒæˆæƒæˆåŠŸåï¼ŒWranglerä¾¿ä¸ä½ çš„Cloudflareè´¦æˆ·å»ºç«‹è¿æ¥ï¼Œåç»­å¯é€šè¿‡å®ƒå¯¹Cloudflareèµ„æºè¿›è¡Œæ“ä½œã€‚
å››ã€åˆ›å»ºCloudflare D1æ•°æ®åº“å¹¶è®¾ç½®æ¶æ„

ä½¿ç”¨Wrangleråˆ›å»ºåä¸ºtwikooçš„D1æ•°æ®åº“ï¼Œåœ¨å‘½ä»¤è¡Œæ‰§è¡Œï¼š

npx wrangler d1 create twikoo
æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œç»ˆç«¯ä¼šè¾“å‡ºæ•°æ®åº“çš„ç›¸å…³ä¿¡æ¯ï¼Œå…¶ä¸­database_nameå’Œdatabase_idè¿™ä¸¤è¡Œä¿¡æ¯è‡³å…³é‡è¦ï¼Œéœ€å°†å…¶å¤åˆ¶ä¸‹æ¥ï¼Œç”¨äºåç»­é…ç½®ã€‚

&#123;
  "d1_databases": [
    &#123;
      "binding": "DB",
      "database_name": "twikoo",
      "database_id": "56def18d-b46a-42c8-bc99-0214e58f9a54"
    &#125;
  ]
&#125;

æ‰“å¼€é¡¹ç›®ç›®å½•ä¸‹çš„wrangler.tomlæ–‡ä»¶ï¼ˆè‹¥ä¸å­˜åœ¨ï¼Œå¯æ‰‹åŠ¨åˆ›å»ºï¼‰ï¼Œå°†åˆšåˆšå¤åˆ¶çš„database_nameå’Œdatabase_idç²˜è´´è¿›å»ï¼Œæ›¿æ¢åŸæœ‰çš„å¯¹åº”å€¼ï¼Œä½¿é¡¹ç›®ä¸åˆ›å»ºçš„D1æ•°æ®åº“å»ºç«‹å…³è”ã€‚
ä¸ºD1æ•°æ®åº“è®¾ç½®æ¶æ„ï¼ŒTwikooé¡¹ç›®ä¸­åŒ…å«å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„å’Œåˆå§‹æ•°æ®çš„schema.sqlæ–‡ä»¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†è¯¥æ¶æ„åº”ç”¨åˆ°Cloudflare D1æ•°æ®åº“ï¼š

npx wrangler d1 execute twikoo --remote --file=./schema.sql
æ­¤å‘½ä»¤ä¼šè¿œç¨‹è¿æ¥åˆ°ä¹‹å‰åˆ›å»ºçš„twikooæ•°æ®åº“ï¼Œå¹¶ä¾æ®schema.sqlæ–‡ä»¶çš„å†…å®¹åˆ›å»ºç›¸åº”çš„è¡¨ç»“æ„åŠå¯èƒ½çš„åˆå§‹æ•°æ®ï¼Œç¡®ä¿æ•°æ®åº“æ»¡è¶³Twikooè¯„è®ºç³»ç»Ÿçš„å­˜å‚¨éœ€æ±‚ã€‚

äº”ã€åˆ›å»ºCloudflare R2å­˜å‚¨
Cloudflare R2å¯ç”¨äºå­˜å‚¨Twikooè¯„è®ºç³»ç»Ÿç›¸å…³çš„æ–‡ä»¶ï¼Œå¦‚ä¸Šä¼ çš„å›¾ç‰‡ç­‰ï¼ˆå°½ç®¡å½“å‰éƒ¨ç½²æ–¹æ¡ˆä¸­å¯¹R2çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé™åˆ¶ï¼Œä½†åˆ›å»ºæ­¥éª¤ä»éœ€å®Œæˆï¼‰ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ›å»ºåä¸ºtwikooçš„R2å­˜å‚¨æ¡¶ï¼š
npx wrangler r2 bucket create twikoo
åˆ›å»ºå®Œæˆåï¼Œæ‰¾åˆ°wrangler.tomlæ–‡ä»¶ä¸­r2_public_urlå­—æ®µï¼Œå°†å…¶å€¼æ›´æ–°ä¸ºæ–°åˆ›å»ºçš„R2å­˜å‚¨æ¡¶çš„åŸŸåï¼Œç¡®ä¿é¡¹ç›®èƒ½æ­£ç¡®è®¿é—®R2å­˜å‚¨èµ„æºã€‚
[vars]
R2_PUBLIC_URL = â€œhttps://twikoo.soniachen.comâ€

å…­ã€éƒ¨ç½²Cloudflare Worker
å®Œæˆä¸Šè¿°é…ç½®åï¼Œå³å¯å°†Twikooè¯„è®ºç³»ç»Ÿéƒ¨ç½²åˆ°Cloudflare Workersï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œéƒ¨ç½²ï¼š
npx wrangler deploy --minify
--minifyå‚æ•°ç”¨äºå¯¹ä»£ç è¿›è¡Œå‹ç¼©ï¼Œä»¥è¿›ä¸€æ­¥å‡å°æ†ç»‘åŒ…å¤§å°ï¼Œæå‡éƒ¨ç½²æ•ˆç‡ä¸æ€§èƒ½ã€‚éƒ¨ç½²è¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå®Œæˆåï¼Œå‘½ä»¤è¡Œä¸­ä¼šè¾“å‡ºç±»ä¼¼https://twikoo-cloudflare.&lt;your username&gt;.workers.devçš„è®¿é—®åœ°å€ã€‚è‹¥éƒ¨ç½²æˆåŠŸï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®è¯¥åœ°å€ï¼Œåº”èƒ½çœ‹åˆ°ç±»ä¼¼äº&#123;&quot;code&quot;: 100, &quot;message&quot;: &quot;twikooäº‘å‡½æ•°è¿è¡Œæ­£å¸¸ï¼Œè¯·å‚è€ƒhttps://twikoo.js.org/frontend.htmlå®Œæˆå‰ç«¯çš„é…ç½®&quot;, &quot;version&quot;: &quot;1.6.33&quot;&#125;çš„æç¤ºä¿¡æ¯ï¼Œè¿™è¡¨æ˜Twikooçš„åç«¯æœåŠ¡å·²åœ¨Cloudflareä¸ŠæˆåŠŸéƒ¨ç½²ã€‚
ä¸ƒã€å‰ç«¯é…ç½®

åœ¨åšå®¢æˆ–ç½‘ç«™çš„å‰ç«¯ä»£ç ä¸­ï¼Œæ‰¾åˆ°éœ€è¦æ·»åŠ è¯„è®ºåŠŸèƒ½çš„é¡µé¢ã€‚è‹¥ä½¿ç”¨Twikooå®˜æ–¹æä¾›çš„å‰ç«¯åˆå§‹åŒ–ä»£ç ï¼Œéœ€å°†å…¶ä¸­çš„envIdå­—æ®µå€¼è®¾ç½®ä¸ºç¬¬å…­æ­¥ä¸­å¾—åˆ°çš„Cloudflare Workerè®¿é—®åœ°å€ï¼ˆåŒ…å«https://å‰ç¼€ï¼‰ã€‚ä¾‹å¦‚ï¼š

twikoo.init(&#123;
    envId: "https://twikoo-cloudflare.&lt;your username>.workers.dev",
    el: "#tcomment",
    // region: 'ap-guangzhou', // ç¯å¢ƒåœ°åŸŸï¼Œé»˜è®¤ä¸ºap-shanghaiï¼Œå¦‚æœæ‚¨çš„ç¯å¢ƒåœ°åŸŸä¸æ˜¯ä¸Šæµ·ï¼Œéœ€ä¼ æ­¤å‚æ•°
    // path: 'window.location.pathname', // ç”¨äºåŒºåˆ†ä¸åŒæ–‡ç« çš„è‡ªå®šä¹‰jsè·¯å¾„ï¼Œå¦‚æœæ‚¨çš„æ–‡ç« è·¯å¾„ä¸æ˜¯location.pathnameï¼Œéœ€ä¼ æ­¤å‚æ•°
    // lang: 'zh-CN', // ç”¨äºæ‰‹åŠ¨è®¾å®šè¯„è®ºåŒºè¯­è¨€ï¼Œæ”¯æŒçš„è¯­è¨€åˆ—è¡¨https://github.com/imaegoo/twikoo/blob/dev/src/js/utils/i18n/index.js
    // onCommentLoaded: function () &#123;
    //     console.log("è¯„è®ºåŠ è½½æˆ–è¯„è®ºæˆåŠŸ");
    // &#125;
&#125;);

ç¡®ä¿å‰ç«¯é¡µé¢åŒ…å«ç”¨äºæ˜¾ç¤ºè¯„è®ºåŒºçš„HTMLå…ƒç´ ï¼Œå…¶idéœ€ä¸ä¸Šè¿°ä»£ç ä¸­elå­—æ®µæŒ‡å®šçš„å€¼ä¸€è‡´ï¼ˆå¦‚&lt;div id=&quot;tcomment&quot;&gt;&lt;/div&gt;ï¼‰ï¼Œè¿™æ ·Twikooå‰ç«¯è„šæœ¬æ‰èƒ½æ­£ç¡®æ¸²æŸ“è¯„è®ºåŒºã€‚


å…«ã€é…ç½®é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
Twikooæ”¯æŒåœ¨æœ‰æ–°è¯„è®ºæ—¶å‘é€é‚®ä»¶é€šçŸ¥ç®¡ç†å‘˜ï¼Œç”±äºnodemaileråŒ…çš„å…¼å®¹æ€§é—®é¢˜ï¼Œåœ¨Cloudflare Workersç¯å¢ƒä¸­ï¼Œæ— æ³•ç›´æ¥é€šè¿‡SMTPé›†æˆå‘é€é‚®ä»¶ï¼Œè€Œæ˜¯é€šè¿‡SendGridçš„HTTPS APIå®ç°é‚®ä»¶é€šçŸ¥åŠŸèƒ½ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

æ³¨å†Œä¸€ä¸ªå¯ç”¨çš„SendGridè´¦æˆ·ï¼ˆSendGridæä¾›å…è´¹å¥—é¤ï¼Œæ¯å¤©å¯å‘é€å¤šè¾¾100å°é‚®ä»¶ï¼‰æˆ–Mailchannelsè´¦æˆ·ï¼ˆæ¯æœˆå…è´¹3000å°é‚®ä»¶ï¼‰ï¼Œå¹¶åœ¨è´¦æˆ·è®¾ç½®ä¸­åˆ›å»ºä¸€ä¸ªAPI Keyï¼Œç”¨äºåç»­éªŒè¯èº«ä»½ã€‚
åœ¨Twikooçš„é…ç½®ä¸­è®¾ç½®ç›¸å…³é‚®ä»¶å‚æ•°ï¼Œæ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­ä¸é‚®ä»¶é€šçŸ¥ç›¸å…³çš„éƒ¨åˆ†ï¼Œè®¾ç½®ä»¥ä¸‹å­—æ®µï¼š

sender_email: "å‘ä»¶äººé‚®ç®±åœ°å€", // éœ€åœ¨SendGridä¸­è¿›è¡ŒéªŒè¯
sender_name: "æ˜¾ç¤ºçš„å‘ä»¶äººåç§°",
smtp_service: "sendgrid",
smtp_user: "æä¾›ä»»æ„éç©ºå€¼",
smtp_pass: "ä¹‹å‰åˆ›å»ºçš„SendGrid API Key",
æ­¤å¤–ï¼Œè¿˜å¯æ ¹æ®éœ€æ±‚è®¾ç½®å…¶ä»–é…ç½®å€¼ï¼Œä»¥è‡ªå®šä¹‰é€šçŸ¥é‚®ä»¶çš„å¤–è§‚å’Œå†…å®¹ã€‚å®Œæˆè®¾ç½®åï¼Œåœ¨é…ç½®é¡µé¢ç‚¹å‡»â€œå‘é€æµ‹è¯•é‚®ä»¶â€æŒ‰é’®ï¼Œæ£€æŸ¥é‚®ä»¶é€šçŸ¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒåŒæ—¶éœ€ç¡®ä¿é‚®ä»¶æä¾›å•†ä¸ä¼šå°†æ”¶åˆ°çš„é€šçŸ¥é‚®ä»¶å½’ç±»ä¸ºåƒåœ¾é‚®ä»¶ã€‚
ä¹ã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ³•

æ†ç»‘åŒ…å¤§å°è¶…é™ï¼šè‹¥åœ¨éƒ¨ç½²æ—¶é‡åˆ°æ†ç»‘åŒ…å¤§å°è¶…è¿‡Cloudflare Workerså…è´¹å¥—é¤1MiBé™åˆ¶çš„é—®é¢˜ï¼Œé™¤äº†å‰æ–‡æåˆ°çš„åˆ é™¤ç‰¹å®šåŒ…æ–‡ä»¶å†…å®¹å¤–ï¼Œè¿˜å¯æ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦å¼•å…¥äº†ä¸å¿…è¦çš„å¤§å‹ä¾èµ–ï¼Œç²¾ç®€ä»£ç ï¼Œå‡å°‘ä¸å¿…è¦çš„èµ„æºåŠ è½½ã€‚
æ•°æ®åº“è¿æ¥é—®é¢˜ï¼šè‹¥å‡ºç°æ— æ³•è¿æ¥åˆ°Cloudflare D1æ•°æ®åº“çš„æƒ…å†µï¼Œé¦–å…ˆç¡®è®¤wrangler.tomlæ–‡ä»¶ä¸­database_nameå’Œdatabase_idæ˜¯å¦å¡«å†™æ­£ç¡®ï¼Œå…¶æ¬¡æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œç¡®ä¿èƒ½è®¿é—®Cloudflareçš„æœåŠ¡ã€‚
å‰ç«¯è¯„è®ºåŒºæ— æ³•æ˜¾ç¤ºï¼šå‰ç«¯è¯„è®ºåŒºæ— æ³•æ­£å¸¸æ˜¾ç¤ºæ—¶ï¼Œæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯envIdé…ç½®é”™è¯¯ã€å‰ç«¯è„šæœ¬åŠ è½½å¤±è´¥æˆ–HTMLå…ƒç´ idä¸åŒ¹é…ç­‰åŸå› å¯¼è‡´ï¼Œæ ¹æ®å…·ä½“é”™è¯¯æç¤ºè¿›è¡Œæ’æŸ¥ä¿®å¤ã€‚

é€šè¿‡ä»¥ä¸Šè¯¦ç»†çš„Cloudflareéƒ¨ç½²æ–¹æ¡ˆï¼Œå¯å°†Twikooè¯„è®ºç³»ç»Ÿé«˜æ•ˆåœ°é›†æˆåˆ°ç½‘ç«™ä¸­ï¼Œåˆ©ç”¨Cloudflareçš„ä¼˜è´¨æœåŠ¡æå‡è¯„è®ºç³»ç»Ÿçš„æ€§èƒ½ä¸ç¨³å®šæ€§ï¼Œä¸ºç½‘ç«™è®¿å®¢æ‰“é€ è‰¯å¥½çš„äº’åŠ¨äº¤æµç¯å¢ƒã€‚
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>CloudFlare</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®—æ³•é«˜é¢‘é¢˜æ€»ç»“</title>
    <url>/2022/02/23/%E7%AE%97%E6%B3%95%E9%AB%98%E9%A2%91%E9%A2%98%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[é«˜é¢‘é¢˜
ä¸‰æ•°ä¹‹å’Œ
ä¸¤æ•°ä¹‹å’Œä¸ºåŸºç¡€

ç»™ä½ ä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ numsï¼Œåˆ¤æ–­ nums ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾— a + b + c = 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚
æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚

// 1 å…ˆå°†æ•°ç»„æ’åº
  // 2 ä»åå¾€å‰éå†æœ€åä¸€ä¸ªæ•° æ‰¾å¯¹åº”çš„äºŒå…ƒç»„ï¼šäºŒå…ƒç»„ + arr[i] = 0
  // 2.1 ä¿è¯ä¸é‡å¤
  // 2.2 æ‰¾å‡ºå‰é¢éƒ¨åˆ†æ»¡è¶³æ¡ä»¶çš„äºŒå…ƒç»„
  // 2.3 éå†å°†arr[i]æ·»åŠ åœ¨åé¢
  public static List&lt;List&lt;Integer>> threeSum(int[] nums) &#123;
      // 1
      Arrays.sort(nums);
      int N = nums.length;
      List&lt;List&lt;Integer>> ans = new ArrayList&lt;>();
      // 2
      for (int i = N - 1; i > 1; i--) &#123; // ä¸‰å…ƒç»„æœ€åä¸€ä¸ªæ•°ï¼Œæ˜¯arr[i]   ä¹‹å‰....äºŒå…ƒç»„ + arr[i]
          // 2.1
          if (i == N - 1 || nums[i] != nums[i + 1]) &#123;
              // 2.2
              List&lt;List&lt;Integer>> nexts = twoSum(nums, i - 1, -nums[i]);
              // 2.3
              for (List&lt;Integer> cur : nexts) &#123;
                  cur.add(nums[i]);
                  ans.add(cur);
              &#125;
          &#125;
      &#125;
      return ans;
  &#125;

  // nums[0...end]è¿™ä¸ªèŒƒå›´ä¸Šï¼Œæœ‰å¤šå°‘ä¸ªä¸åŒäºŒå…ƒç»„ï¼Œç›¸åŠ ==targetï¼Œå…¨è¿”å›
  // &#123;-1,5&#125;     K = 4
  // &#123;1, 3&#125;
  // 1 ä¸¤ä¸ªæŒ‡é’ˆ
  // 2 ä¸¤æ•°ç›¸åŠ å¤§äºç›®æ ‡å€¼å°±å³ç¼©;å°äºå°±å·¦ç¼©;ç­‰äºå°±æ·»åŠ åœ¨ç»“æœé›†é‡Œé¢ï¼ˆå…ˆåŠ å·¦å†åŠ å³ï¼‰
  public static List&lt;List&lt;Integer>> twoSum(int[] nums, int end, int target) &#123;
      int L = 0;
      int R = end;
      List&lt;List&lt;Integer>> ans = new ArrayList&lt;>();
      while (L &lt; R) &#123;
          if (nums[L] + nums[R] > target) &#123;
              R--;
          &#125; else if (nums[L] + nums[R] &lt; target) &#123;
              L++;
          &#125; else &#123; // nums[L] + nums[R] == target
              if (L == 0 || nums[L - 1] != nums[L]) &#123;
                  List&lt;Integer> cur = new ArrayList&lt;>();
                  cur.add(nums[L]);
                  cur.add(nums[R]);
                  ans.add(cur);
              &#125;
              L++;
          &#125;
      &#125;
      return ans;
  &#125;
ä¸¤æ•°ä¹‹å’Œ

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚

1 ä½¿ç”¨hashmap ç»“æ„ map.put(nums[i], i)
2 éå†ä¸€é å¦‚æœæŸ¥è¯¢åˆ°mapé‡Œé¢æœ‰ä¸è§£ å°±è¿”å›iå’Œmapgetçš„value
3 æœ€åå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±è¿”å›new int[0]
class Solution &#123;
    public int[] twoSum(int[] nums, int target) &#123;
        HashMap&lt;Integer, Integer> map = new HashMap&lt;>();
        for(int i = 0; i &lt; nums.length; i ++)&#123;
            if(map.containsKey(target - nums[i]))&#123;
                return new int[]&#123;i, map.get(target - nums[i])&#125;;
            &#125;
            map.put(nums[i], i);
        &#125;
        return new int[0];
    &#125;
&#125;
æœç´¢æ—‹è½¬æ’åºæ•°ç»„ï¼ˆé¢è¯•ï¼‰
ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾

æ•´æ•°æ•°ç»„numsæŒ‰å‡åºæ’åˆ—ï¼Œæ•°ç»„ä¸­çš„å€¼äº’ä¸ç›¸åŒã€‚
arrï¼ŒåŸæœ¬æ˜¯æœ‰åºæ•°ç»„ï¼Œæ—‹è½¬è¿‡ï¼Œè€Œä¸”å·¦éƒ¨åˆ†é•¿åº¦ä¸çŸ¥é“.(ä»¥æŸä¸€ä¸ªä¸‹æ ‡ä¸ºè½´æ—‹è½¬ ä¾‹å¦‚ï¼Œ [0,1,2,4,5,6,7] åœ¨ä¸‹æ ‡ 3 å¤„ç»æ—‹è½¬åå¯èƒ½å˜ä¸º [4,5,6,7,0,1,2] ã€‚)
é¢˜ç›®éœ€è¦åœ¨arré‡Œé¢æ‰¾åˆ°target

æ€è·¯ï¼š

L = M = R æ˜¯æœ€å·®çš„æƒ…å†µ ä¸çŸ¥é“æ–­ç‚¹
L != M == R/ L == M != R/ L != M != R åªè¦ä¸‰ä¸ªæ•°ä¸å…¨éƒ¨ä¸€æ ·å°±å¯ä»¥è¿›è¡ŒäºŒåˆ†


public int search(int[] nums, int target) &#123;
		int N = nums.length;
		int L = 0;
		int R = N - 1;
		while (L &lt;= R) &#123;
			int M = (L + R) / 2;
			if (nums[M] == target) &#123;
				return M;
			&#125;
			// nums[M] != target
			// 1 å·¦ ä¸­ å³ ç›¸ç­‰ -- ã€‹ä¸èƒ½äºŒåˆ†
			if (nums[L] == nums[M] &amp;&amp; nums[M] == nums[R]) &#123;
				// å·¦ä¸­ä¸€ç›´ç›¸ç­‰ L ++
				while (L != M &amp;&amp; nums[L] == nums[M]) &#123;
					L++;
				&#125;
				// 1.1 å·¦ä¸­ç›´åˆ°é‡åˆéƒ½ç›¸ç­‰
				if (L == M) &#123;
					L = M + 1;
					continue;// å›åˆ°å¾ªç¯å¼€å§‹é‡æ–°æ¥
				&#125;
				// 1.2 æˆ–è€…æ˜¯ åˆ°ä¸ç›¸ç­‰åœ°æ–¹ ç»§ç»­2

			&#125;
			// 2 å·¦ä¸­å³ä¸éƒ½ç›¸ç­‰ --> ä»£è¡¨å¯ä»¥äºŒåˆ†
			if (nums[L] != nums[M]) &#123; // 2.1 [L] != [M] ?= [R]
				if (nums[L] &lt; nums[M]) &#123;// 2.1.1 L &lt; M å·¦è¾¹ä¸€å®šæœ‰åº
					if (nums[L] &lt;= target &amp;&amp; target &lt; nums[M]) &#123;
						R = M - 1;
					&#125; else &#123;
						L = M + 1;
					&#125;
				&#125; else &#123; // 2.1.2 L > M å·¦è¾¹ä¸€å®šæœ‰æ–­ç‚¹ å³è¾¹æœ‰åº
					if (nums[M] &lt; target &amp;&amp; target &lt;= nums[R]) &#123;
						L = M + 1;
					&#125; else &#123;
						R = M - 1;
					&#125;
				&#125;
			&#125; else &#123;// 2.2 [L] ?= [M] != [R]
				if (nums[M] &lt; nums[R]) &#123;// 2.2.1 M &lt; R
					if (nums[M] &lt; target &amp;&amp; target &lt;= nums[R]) &#123;
						L = M + 1;
					&#125; else &#123;
						R = M - 1;
					&#125;
				&#125; else &#123; // 2.1.2 M > R
					if (nums[L] &lt;= target &amp;&amp; target &lt; nums[M]) &#123;
						R = M - 1;
					&#125; else &#123;
						L = M + 1;
					&#125;
				&#125;
			&#125;

		&#125;
		return -1;
	&#125;
åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„

ç»™ä½ ä¸¤ä¸ªæœ‰åºæ•°ç»„ nums1 å’Œ nums2ï¼Œå¦æœ‰ä¸¤ä¸ªæ•´æ•° m å’Œ n ï¼Œåˆ†åˆ«è¡¨ç¤º nums1 å’Œ nums2 ä¸­çš„å…ƒç´ æ•°ç›®ã€‚è¿›è¡Œåˆå¹¶ã€‚
æ³¨æ„ï¼šæœ€ç»ˆï¼Œåˆå¹¶åæ•°ç»„ä¸åº”ç”±å‡½æ•°è¿”å›ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨æ•°ç»„ nums1 ä¸­ã€‚nums1 çš„åˆå§‹é•¿åº¦ä¸º m + nï¼Œå…¶ä¸­å‰ m ä¸ªå…ƒç´ è¡¨ç¤ºåº”åˆå¹¶çš„å…ƒç´ ï¼Œå n ä¸ªå…ƒç´ ä¸º 0 ï¼Œåº”å¿½ç•¥ã€‚nums2 çš„é•¿åº¦ä¸º n ã€‚

public void merge(int[] nums1, int m, int[] nums2, int n) &#123;
        int index = nums1.length;
       while(m > 0 &amp;&amp; n > 0) &#123; // ç›¸ç­‰çš„æ—¶å€™å…ˆæ‹·è´é•¿æ•°ç»„çš„  å°½å¯èƒ½è®©ç©ºé—´æ—©é‡Šæ”¾
            if(nums1[m - 1] >= nums2[n -1])&#123;
                nums1[--index] = nums1[--m];
            &#125; else &#123;
                nums1[--index] = nums2[--n];
            &#125;
        &#125;   
        while(n > 0) &#123;// méƒ½è¢«å¡«å®Œ å°±æŠŠnums2å‰©ä¸‹çš„nå¡«è¿›nums1
            nums1[--index] = nums2[--n];
        &#125;
    &#125;
èºæ—‹çŸ©é˜µ

ç»™ä½ ä¸€ä¸ª m è¡Œ n åˆ—çš„çŸ©é˜µ matrix ï¼Œè¯·æŒ‰ç…§ é¡ºæ—¶é’ˆèºæ—‹é¡ºåº ï¼Œè¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚


public List&lt;Integer> spiralOrder(int[][] matrix) &#123;
	List&lt;Integer> order = new ArrayList&lt;>();
	if (matrix == null || matrix.length == 0 || matrix[0].length == 0) &#123;
		return order;
	&#125;
	int left = 0;
	int top = 0;
	// æ˜“é”™ç‚¹ä¸€ï¼šæ³¨æ„rightå’Œbottomåˆ«å†™åäº†ã€‚
	int right = matrix[0].length - 1;
	int bottom = matrix.length - 1;
	while (left &lt;= right &amp;&amp; top &lt;= bottom) &#123;
		// ä¸Šå±‚ï¼šä»å·¦åˆ°å³ï¼Œè¡Œä¸å˜ï¼Œåˆ—å˜ã€‚
		for (int i = left; i &lt;= right; i++) &#123;
			order.add(matrix[top][i]);
		&#125;
		// å³å±‚ï¼šä»ä¸Šåˆ°ä¸‹ï¼Œè¡Œå˜ï¼Œåˆ—ä¸å˜ã€‚
		for (int i = top + 1; i &lt;= bottom; i++) &#123;
			order.add(matrix[i][right]);
		&#125;
		// æ˜“é”™ç‚¹äºŒï¼šæ³¨æ„é’ˆå¯¹è¡Œåˆ—ä¸ç›¸ç­‰æ—¶ï¼Œä¸‹é¢ä¸¤ä¸ªå¾ªç¯è¦æ»¡è¶³right > left &amp;&amp; bottom > topæ¡ä»¶ âš ï¸
		if (right > left &amp;&amp; bottom > top) &#123;
			// ä¸‹å±‚ï¼šä»å³å‘å·¦ï¼Œè¡Œä¸å˜ï¼Œåˆ—å˜ã€‚
			for (int i = right - 1; i >= left; i--) &#123;
				order.add(matrix[bottom][i]);
			&#125;
			// å·¦å±‚ï¼šä»ä¸‹åˆ°ä¸Šï¼Œè¡Œå˜ï¼Œåˆ—ä¸å˜ã€‚
			// æ˜“é”™ç‚¹ä¸‰ï¼šæ­¤å¤„åªéœ€è¦ i>top, iä¸èƒ½=top
			for (int i = bottom - 1; i > top; i--) &#123;
				order.add(matrix[i][left]);
			&#125;
		&#125;

		left++;
		top++;
		right--;
		bottom--;
	&#125;
	return order;
&#125;
å­—ç¬¦ä¸²ç›¸åŠ 

ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„éè´Ÿæ•´æ•° num1 å’Œnum2 ï¼Œè®¡ç®—å®ƒä»¬çš„å’Œå¹¶åŒæ ·ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ã€‚
ä½ ä¸èƒ½ä½¿ç”¨ä»»ä½•å…§å»ºçš„ç”¨äºå¤„ç†å¤§æ•´æ•°çš„åº“ï¼ˆæ¯”å¦‚ BigIntegerï¼‰ï¼Œ ä¹Ÿä¸èƒ½ç›´æ¥å°†è¾“å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°å½¢å¼ã€‚

public String addStrings2(String num1, String num2) &#123;
	int i = num1.length() - 1, j = num2.length() - 1, add = 0;
	StringBuffer ans = new StringBuffer();
	while (i >= 0 || j >= 0 || add != 0) &#123;
		int x = i >= 0 ? num1.charAt(i) - '0' : 0;
		int y = j >= 0 ? num2.charAt(j) - '0' : 0;
		int result = x + y + add;
		ans.append(result % 10);
		add = result / 10;
		i--;
		j--;
	&#125;
	// è®¡ç®—å®Œä»¥åçš„ç­”æ¡ˆéœ€è¦ç¿»è½¬è¿‡æ¥
	ans.reverse();
	return ans.toString();
&#125;
äºŒåˆ†æŸ¥æ‰¾
public int search(int[] nums, int target) &#123;
        int L = 0;
        int R = nums.length - 1;
        while(L &lt; R)&#123; // âš ï¸ æ²¡æœ‰ç›¸ç­‰
            int mid = (L + R) >> 1;
            if(target &lt; nums[mid])&#123;
                R = mid - 1;
            &#125; else if(target > nums[mid])&#123;
                L = mid + 1;
            &#125; else&#123;
                return mid;
            &#125; 
        &#125;
        return (nums[L] == target) ? L : -1;
    &#125;
åœ¨æ’åºæ•°ç»„ä¸­æ‰¾åˆ°å…ƒç´ ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®
/**
 * åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®
 * @author chs
 *
 */
public class Fre_044_FindFirstAndLastPositionOfElementInSortedArray &#123;
	// å€ŸåŠ©äºŒåˆ† ã€Šæ‰¾åˆ°æ•°ç»„ä¸­æ¯”å®ƒå°çš„æœ€å³çš„æ•° (lessMostRight
	// å¦‚æœè¯¥ä½ç½®å³è¾¹!=targetè¯´æ˜æ•°ç»„æ²¡æœ‰è¿™ä¸ªæ•°
	// å¦‚æœæ˜¯ é‚£ä¹ˆå·¦è¾¹ç•Œæ‰¾åˆ° å³è¾¹ç•Œå°±æ˜¯ã€Šæ‰¾åˆ°æ¯”ta+1å°çš„æœ€å³çš„æ•°ã€‹ (lessMostRight
	public static int[] searchRange(int[] nums, int target) &#123;
		if (nums == null || nums.length == 0) &#123;
			return new int[] &#123; -1, -1 &#125;;
		&#125;
		int L = lessMostRight(nums, target) + 1;
		if (L == nums.length || nums[L] != target) &#123;
			return new int[] &#123; -1, -1 &#125;;
		&#125;
		return new int[] &#123; L, lessMostRight(nums, target + 1) &#125;;
	&#125;

	// åˆ©ç”¨äºŒåˆ† 
	// 1 ä¸€ä¸ªæŒ‡é’ˆ M
	// 2 anså­˜æ”¾ç»“æœ
	// 3 arr[M] å°äºå°±å»å³è¾¹æ‰¾ å¤§äºå°±å»å·¦è¾¹æ‰¾
	public static int lessMostRight(int[] arr, int num) &#123;
		int L = 0;
		int R = arr.length - 1;
		// 1
		int M = 0;
		// 2 
		int ans = -1;
		// 3
		while (L &lt;= R) &#123;
			M = L + ((R - L) >> 1);
			if (arr[M] &lt; num) &#123;
				ans = M;
				L = M + 1;
			&#125; else &#123;
				R = M - 1;
			&#125;
		&#125;
		return ans;
	&#125;
&#125;

å­—ç¬¦ä¸²è½¬åŒ–æ•´æ•°
æ³¨æ„æœ‰å¾ˆå¤šç‰¹æ®Šæƒ…å†µ

1.éœ€è¦åˆ é™¤æ— ç”¨çš„å‰å¯¼ç©ºæ ¼
2.æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸ºæ­£è¿˜æ˜¯è´Ÿ
3.åªè¯»ä¸€å¼€å§‹æ˜¯æ•°å­—çš„éƒ¨åˆ†


4.è¶…å‡ºèŒƒå›´çš„æ•°å­—è¿”å›è¾¹ç•Œ

1. ä¸»å‡½æ•°myAtoi():
     1 é™¤å»ç©ºæ ¼å’Œåé¢éæ•°å­—çš„éƒ¨åˆ†( å‰åéƒ½è¦åˆ¤ç©º)ã€removeHeadZero()ã€‘
     2 åˆ¤æ–­è¯¥éƒ¨åˆ†æ˜¯å¦æ˜¯æœ‰æ•ˆæ•°å­—ã€isValid()ã€‘
     3 è½¬ä¸ºè´Ÿæ•°å½¢å¼ï¼ˆè½¬å›ä¸ä¼šæº¢å‡ºï¼Œè´Ÿæ•°èŒƒå›´å¤§äº›ï¼‰ posi(æ ‡å¿—æ­£è´Ÿ)
     4 resæ˜¯æœ€è´Ÿçš„æƒ…å†µ (ç”¨äº†è´Ÿæ•°å°±åªç”¨å¯ä»¥è£…ä¸‹ï¼Œå¦‚æœç”¨æ•´æ•°è½¬ï¼Œæœ€å°å°±æ²¡æ³•è£…)
2. removeHeadZero():
     1 æ˜¯å¦æœ‰ç¬¦å·
     2 sæ ‡å¿—ç¬¬ä¸€ä¸ªä¸æ˜¯é›¶çš„ä½ç½®
     3 eæ ‡å¿—æ•°å­—éƒ¨åˆ†åé¢çš„éæ•°å­—éƒ¨åˆ†çš„å¼€å¤´
     4 è¿”å›æˆªå–çš„å¸¦ç¬¦å·æ•´æ•°éƒ¨åˆ†
3. isVaild():    åˆ¤æ–­å¸¦ç¬¦å·æ•´æ•°éƒ¨åˆ†æ˜¯å¦æœ‰æ•ˆ
     1 å¼€å¤´åœ¨removeéƒ¨åˆ†æ²¡æœ‰åˆ¤æ–­ï¼Œåªè¦å¼€å¤´ä¸æ˜¯æ•°å­—å’Œç¬¦å·éƒ½è¿”å›æ— æ•ˆ
     2 åªæœ‰ç¬¦å·ä¹Ÿæ— æ•ˆ
     3 å¤¹æ‚ç€éæ•°å­—å­—ç¬¦ä¹Ÿæ— æ•ˆ
public class Fre_072_StringToInteger &#123;
  public int myAtoi(String s) &#123;
        // 1 é™¤å»ç©ºæ ¼å’Œåé¢ä¸æ˜¯æ•°å­—çš„éƒ¨åˆ†
        if(s == null || s.equals(""))&#123;// âš ï¸
            return 0;
        &#125;
        s = removeHeadZero(s.trim());
        if(s == null || s.equals(""))&#123;
            return 0;
        &#125;

        // 2 åˆ¤æ–­è¿™éƒ¨åˆ†æ˜¯ä¸æ˜¯æœ‰æ•ˆæ•°å­—
        char[] str = s.toCharArray();
        if(!isValid(str))&#123;
            return 0;
        &#125;

        // 3 è½¬ä¸ºè´Ÿæ•°å½¢å¼ ä¸ºäº†é˜²æ­¢æº¢å‡º posi(æ ‡å¿—æ­£è´Ÿ) âš ï¸ä¸è¦æåäº†
        boolean posi = str[0] == '-' ? false : true;
        // åé¢ä¼šæœ‰*10çš„æ“ä½œ éœ€è¦å…ˆåˆ¤æ–­ä¼šä¸ä¼šæº¢å‡º
        int minq = Integer.MIN_VALUE / 10;
        int minp = Integer.MIN_VALUE % 10;
        int res = 0;
        int cur = 0;
        for(int i = (str[0] == '-' || str[0] == '+') ? 1 : 0; i &lt; str.length; i++)&#123;
            cur = '0' - str[i]; // è½¬ä¸ºè´Ÿæ•°
            // åœ¨ä¹˜åä¹‹å‰åˆ¤æ–­æ˜¯å¦ä¼šæº¢å‡º
            if(res &lt; minq || (res == minq &amp;&amp; cur &lt; minp))&#123;
                	return posi ? Integer.MAX_VALUE : Integer.MIN_VALUE; 
            &#125;
            res = res * 10 + cur;

        &#125;

        // 4 resæ˜¯æœ€è´Ÿæƒ…å†µï¼ˆä¹Ÿå°±æ˜¯æœ¬æ¥æ˜¯æœ€å¤§çš„+1ï¼‰
        if(posi &amp;&amp; (res == Integer.MIN_VALUE))&#123;
            return Integer.MAX_VALUE; // è¿”å›è¾¹ç•Œ
        &#125;

        return posi ? -res : res;
    &#125;

    public static String removeHeadZero(String s)&#123;
        // 1 æ˜¯å¦æœ‰ç¬¦å·
        boolean r = (s.startsWith("+") || s.startsWith("-")); // âš ï¸ ä¸èƒ½ç”¨charat

        // 2 æ ‡å¿—ç¬¬ä¸€ä¸ªä¸æ˜¯é›¶çš„ä½ç½®
        int start = r ? 1 : 0;
        for(; start&lt; s.length(); start++)&#123;
            if(s.charAt(start) != '0')&#123;
                break;
            &#125;
        &#125;

        // 3 æ‰¾åˆ°æ•°å­—éƒ¨åˆ†åé¢çš„éæ•°ç»„éƒ¨åˆ†å¼€å¤´ å€’ç€éå†
        int e = -1;
        for(int i = s.length() - 1; i >= (r ? 1 : 0); i--)&#123;
            if(s.charAt(i) &lt; '0'  || s.charAt(i) > '9') &#123;
                e = i;
            &#125;
        &#125;

        // 4 è¿”å›æˆªå–çš„å¸¦ç¬¦å·çš„æ•´æ•°éƒ¨åˆ†
        return (r ? String.valueOf(s.charAt(0)): "") + s.substring(start, e == -1 ? s.length() : e);
    &#125;

    // åˆ¤æ–­æ˜¯å¦æ˜¯æœ‰æ•ˆçš„æ•°å­—
    public static boolean isValid(char[] str) &#123;
        // 1 å¦‚æœå¼€å¤´ä¸æ˜¯æ•°ç»„
        if(str[0] != '-' &amp;&amp; str[0] != '+' &amp;&amp; (str[0] &lt; '0' || str[0] > '9'))&#123;
            return false;
        &#125;
        // 2 åªæœ‰ç¬¦å·ä¹Ÿæ— æ•ˆ
        if((str[0] == '-' || str[0] == '+') &amp;&amp; str.length == 1)&#123;
            return false;
        &#125;
        // 3 å¤¹æ‚ç€éæ•°å­—å­—ç¬¦ æ— æ•ˆ
        for(int i = 1; i &lt; str.length; i++)&#123;
            if(str[i] &lt;'0' || str[i] > '9')&#123;
                return false;
            &#125;
        &#125;
        return true;

    &#125;

	&#125;
ä¸‹ä¸€ä¸ªæ’åˆ—

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡º nums çš„å­—å…¸åºä¸­çš„ä¸‹ä¸€ä¸ªæ’åˆ—ã€‚
ä¾‹å¦‚ï¼Œarr = [1,2,3] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [1,3,2] ã€‚
ç±»ä¼¼åœ°ï¼Œarr = [2,3,1] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [3,1,2] ã€‚
è€Œ arr = [3,2,1] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [1,2,3] ï¼Œå› ä¸º [3,2,1] ä¸å­˜åœ¨ä¸€ä¸ªå­—å…¸åºæ›´å¤§çš„æ’åˆ—ã€‚
å¿…é¡» åŸåœ° ä¿®æ”¹ï¼Œåªå…è®¸ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´ã€‚

public void nextPermutation(int[] nums) &#123;
       int i = nums.length - 2;
       // 1 å€’ç€æ‰¾å‡åºå¯¹ [ i , i+ 1]
       while(i >= 0 &amp;&amp; nums[i] >= nums[i + 1]) &#123;
           i--;
       &#125;
       // 2 ä»end -> i+1 å€’ç€æ‰¾æ¯”iå¤§çš„æ•°
       if(i >= 0)&#123;
           int j = nums.length - 1;
           while(nums[i] >= nums[j])&#123;
               j--;
           &#125;
           swap(nums, i, j);
       &#125;
       // 3 å°†æ•°ç»„i+1ä»¥åçš„åè½¬
       // å› ä¸ºæœ‰ä¸¤ç§æƒ…å†µï¼š1ï¼‰ i&lt; 0 è¯´æ˜æœ¬èº«å°±æ˜¯å­—å…¸åºæœ€å¤§ï¼Œç›´æ¥ç¿»è½¬ 2ï¼‰[i+1, end]æ˜¯é™åºéœ€è¦ç¿»è½¬
       reverse(nums, i + 1);
   &#125;
   public static void reverse(int[] nums, int i)&#123;
       int left = i;
       int right =  nums.length - 1;
       while(left &lt; right)&#123;
           swap(nums, left, right);
           left++;
           right--;
       &#125;
   &#125;

   public static void swap(int[] nums, int i, int j)&#123;
       int tmp = nums[i];
       nums[i] = nums[j];
       nums[j] = tmp;
   &#125;
åˆå¹¶åŒºé—´

ä»¥æ•°ç»„ intervals è¡¨ç¤ºè‹¥å¹²ä¸ªåŒºé—´çš„é›†åˆï¼Œå…¶ä¸­å•ä¸ªåŒºé—´ä¸º intervals[i] = [starti, endi] ã€‚è¯·ä½ åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ï¼Œå¹¶è¿”å› ä¸€ä¸ªä¸é‡å çš„åŒºé—´æ•°ç»„ï¼Œè¯¥æ•°ç»„éœ€æ°å¥½è¦†ç›–è¾“å…¥ä¸­çš„æ‰€æœ‰åŒºé—´ ã€‚


s å’Œ e è®°å½•ä¸Šä¸€ä¸ªåŒºé—´çš„è¾¹ç•Œ
ç„¶åå¤ç”¨intervalæ•°ç»„æ¥å­˜å‚¨ï¼Œæœ€åå¤åˆ¶æ•°ç»„sizeéƒ¨åˆ†

class Solution &#123;
    public int[][] merge(int[][] intervals) &#123;
        	if (intervals.length == 0) &#123;
			return new int[0][0];
		&#125;
    // å…ˆæŒ‰ç…§åŒºé—´çš„å·¦è¾¹ç•Œæ¥æ’åº
		Arrays.sort(intervals, (a, b) -> a[0] - b[0]);
		int s = intervals[0][0];
		int e = intervals[0][1];// 
		int size = 0;
    // ç„¶åå¤ç”¨intervalæ•°ç»„æ¥å­˜å‚¨ï¼Œæœ€åå¤åˆ¶æ•°ç»„sizeéƒ¨åˆ†
		for (int i = 1; i &lt; intervals.length; i++) &#123;
			if (intervals[i][0] > e) &#123;// å¦‚æœå½“å‰å·¦è¾¹ç•Œå¤§äºe è¯´æ˜æ²¡æœ‰è¦†ç›– 
				intervals[size][0] = s;// å¯ä»¥æ›´æ–°sizeéƒ¨åˆ†çš„så’Œe ç„¶åsize++
				intervals[size++][1] = e;
				s = intervals[i][0];
				e = intervals[i][1];// s e æ›´æ–°ä¸ºå½“å‰çš„å·¦å³è¾¹ç•Œ
			&#125; else &#123;
				e = Math.max(e, intervals[i][1]); // å¦‚æœå½“å‰å·¦è¾¹ç•Œå°äºæˆ–è€…ç­‰äº è¯´æ˜ä¸¤ä¸ªåŒºé—´å¯ä»¥è¦†ç›– å…ˆå°†eæ›´æ–°ä¸ºè¿™ä¸¤ä¸ªåŒºé—´çš„æœ€å¤§å³åŒºé—´
			&#125;
		&#125;
		intervals[size][0] = s; // æœ€åè¿˜æœ‰ä¸€æ¬¡sizeå¤„çš„æ›´æ–°
		intervals[size++][1] = e;
		return Arrays.copyOf(intervals, size);
    &#125;
&#125;
xçš„å¹³æ–¹æ ¹
==äºŒåˆ†æŸ¥æ‰¾==

ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•° x ï¼Œè®¡ç®—å¹¶è¿”å› x çš„ ç®—æœ¯å¹³æ–¹æ ¹ ã€‚
ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œç»“æœåªä¿ç•™ æ•´æ•°éƒ¨åˆ† ï¼Œå°æ•°éƒ¨åˆ†å°†è¢« èˆå» ã€‚
æ³¨æ„ï¼šä¸å…è®¸ä½¿ç”¨ä»»ä½•å†…ç½®æŒ‡æ•°å‡½æ•°å’Œç®—ç¬¦ï¼Œä¾‹å¦‚ pow(x, 0.5) æˆ–è€… x ** 0.5 ã€‚

1. ä½¿ç”¨ äºŒåˆ† &lt;&#x3D;å°±æ›´æ–°anså’ŒL åˆ°å³è¾¹å°±æ›´æ–°R
2. æ³¨æ„æ•°æ®ç±»å‹æ—¶longä¸»è¦æ˜¯ä¸ºäº†ä¸¤ä¸ªæ•´å‹ç›¸ä¹˜ä¸ä¼šæº¢å‡º
// xä¸€å®šéè´Ÿï¼Œè¾“å…¥å¯ä»¥ä¿è¯
    public static int mySqrt(int x) &#123;
        if (x == 0) &#123;
            return 0;
        &#125;
        if (x &lt; 3) &#123;
            return 1;
        &#125;
        // x >= 3
        long ans = 1;
        long L = 1;
        long R = x;
        long M = 0;
        while (L &lt;= R) &#123;
            M = (L + R) / 2;
            // å› ä¸ºä¸¤ä¸ªæ•´æ•°ç›¸ä¹˜å¯èƒ½ä¼šæº¢å‡º
            if (M * M &lt;= x) &#123;
                ans = M;
                L = M + 1;
            &#125; else &#123;
                R = M - 1;
            &#125;
        &#125;
        return (int) ans;
    &#125;
æ‰©å±•ï¼šæ±‚å‡ºå°æ•°ç‚¹åkä½ å…¶å®æ€è·¯ä¸ä¸€æ · åªæ˜¯æ¢æˆdoubleç±»å‹å¹¶ä¸”éœ€è¦è½¬æ¢æ•°æ ¼å¼
ç¼ºå¤±çš„æ­£æ•°

ç»™ä½ ä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ï¼Œè¯·ä½ æ‰¾å‡ºæ²¡æœ‰å‡ºç°çš„æœ€å°çš„æ­£æ•´æ•° æ—¶é—´å¤æ‚åº¦o(n)

é™¤äº†æ‰“æ ‡è®°ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç½®æ¢çš„æ–¹æ³•ï¼Œå°†ç»™å®šçš„æ•°ç»„ã€Œæ¢å¤ã€æˆä¸‹é¢çš„å½¢å¼ï¼š
å¦‚æœæ•°ç»„ä¸­åŒ…å« xâˆˆ[1,N]x \in [1, N]xâˆˆ[1,N]ï¼Œé‚£ä¹ˆæ¢å¤åï¼Œæ•°ç»„çš„ç¬¬ xâˆ’1x - 1xâˆ’1 ä¸ªå…ƒç´ ä¸º xxxã€‚

åœ¨æ¢å¤åï¼Œæ•°ç»„åº”å½“æœ‰ [1, 2, â€¦, N] çš„å½¢å¼ï¼Œä½†å…¶ä¸­æœ‰è‹¥å¹²ä¸ªä½ç½®ä¸Šçš„æ•°æ˜¯é”™è¯¯çš„ï¼Œæ¯ä¸€ä¸ªé”™è¯¯çš„ä½ç½®å°±ä»£è¡¨äº†ä¸€ä¸ªç¼ºå¤±çš„æ­£æ•°ã€‚ä»¥é¢˜ç›®ä¸­çš„ç¤ºä¾‹äºŒ [3, 4, -1, 1] ä¸ºä¾‹ï¼Œæ¢å¤åçš„æ•°ç»„åº”å½“ä¸º [1, -1, 3, 4]ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ç¼ºå¤±çš„æ•°ä¸º 2ã€‚
public int firstMissingPositive(int[] nums) &#123;
        int n = nums.length;
        for (int i = 0; i &lt; n; ++i) &#123;
            while (nums[i] > 0 &amp;&amp; nums[i] &lt;= n &amp;&amp; nums[nums[i] - 1] != nums[i]) &#123; 
              // âš ï¸äº¤æ¢çš„æ¡ä»¶---nums[i]âˆˆ[1,N] ä¸” nums[i]å’Œæœ¬æ¥åº”è¯¥åœ¨çš„ä½ç½®çš„å€¼nums[nums[i]-1]ä¸ç›¸ç­‰
                int temp = nums[nums[i] - 1];
                nums[nums[i] - 1] = nums[i];
                nums[i] = temp;
            &#125;
        &#125;
        for (int i = 0; i &lt; n; ++i) &#123;
            if (nums[i] != i + 1) &#123;
                return i + 1;
            &#125;
        &#125;
        return n + 1;
    &#125;
ç”¨rand7()ç”Ÿæˆrand10()

ç”¨ä¸€ä¸ªä¸ç­‰æ¦‚ç‡è¿”å›0å’Œ1çš„å‡½æ•°, æ€ä¹ˆåŠ å·¥ä¸€ä¸ªå‡½æ•°0å’Œ1ç­‰æ¦‚ç‡è¿”å›

public int rand10() &#123;
       int ans= 0;
       do&#123;
           ans = f2();
       &#125;while(ans >9);
       return ans + 1 ;
   &#125;
   public int f() &#123;
       int ans= 0;
       do&#123;
           ans = rand7();
       &#125;while(ans == 4);
       return ans &lt; 4? 0:1;
   &#125;

   // 0000~1111 0~15
   public int f2() &#123;
       return (f() &lt;&lt; 3) + (f() &lt;&lt; 2) + (f() &lt;&lt; 1 )+ f();
   &#125;
æ‰¾åˆ°ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°(âš ï¸)/ä¸¤ä¸ªæœ‰åºæ•°ç»„ç¬¬kå°
public double findMedianSortedArrays(int[] nums1, int[] nums2) &#123;
        //è¿™é‡Œå°±ä¸»è¦å¤„ç† ä¸¤ä¸ªä¸ºç©º ä¸€ä¸ªä¸ºç©º å…¨ä¸ä¸ºç©ºçš„ä¸‰ä¸ªæƒ…å†µ
        int size = nums1.length + nums2.length;
        boolean e = (size &amp; 1) == 0;
        if(nums1.length == 0 &amp;&amp; nums2.length == 0) &#123;
            return 0;
        &#125;else if(nums1.length == 0)&#123;
            if(!e)&#123;
                return nums2[size/ 2];                   
            &#125;else&#123;
                return (double)(nums2[ size / 2- 1] + nums2[size / 2 ])/2;
            &#125;
        &#125;else if(nums2.length == 0)&#123;
            if(!e)&#123;
                return nums1[size/ 2];
            &#125;else&#123;
                return (double)(nums1[size / 2 - 1] + nums1[size / 2])/2;
            &#125;
        &#125;else&#123;
            if(!e)&#123;
                return findKthNum(nums1, nums2, size / 2 + 1);
            &#125;else&#123;
                return (double)(findKthNum(nums1, nums2, size/2)+findKthNum(nums1, nums2, size/2 +1))/2D;
            &#125;
        &#125;

    //åŸå‹
    public static int getUpMedian(int[] arr1, int s1,int e1,int[] arr2, int s2, int e2)&#123;
        int mid1 = 0;
        int mid2 = 0;
        while(s1 &lt; e1)&#123;
            //mid
            mid1 = (e1 + s1) >> 1;
            mid2 = (e2 + s2) >> 1;
            if(arr1[mid1] == arr2[mid2] ) return arr1[mid1];
            //å¥‡æ•°
            if(((e1 - s1 + 1) &amp; 1) == 1)&#123;
                if(arr1[mid1] &lt; arr2[mid2])&#123;
                    if(arr1[mid1] >= arr2[mid2 - 1]) return arr1[mid1];
                    s1 = mid1 + 1;
                    e2 = mid2 - 1;
                &#125;else&#123;
                    if(arr2[mid2] >= arr1[mid1 - 1]) return arr2[mid2];
                    s2 = mid2 + 1;
                    e1 = mid1 - 1;
                &#125;
            &#125;
            //å¶æ•°
            else&#123;
                if(arr1[mid1] > arr2[mid2])&#123;
                    e1 = mid1;
                    s2 = mid2 + 1;
                &#125;else&#123;
                    e2 = mid2;
                    s1 = mid1 + 1;
                &#125;
            &#125;
        &#125;
        //æœ€åè·³å‡ºå¾ªç¯ éƒ½åªå‰©ä¸€ä¸ªæ•°
        return Math.min(arr1[s1], arr2[s2]);
    &#125;



    //å¤„ç†é•¿åº¦ä¸åŒ è¿”å›Kthçš„æƒ…å†µ
    public static int findKthNum(int[] arr1, int[] arr2, int k)&#123;
        int[] longs = arr1.length >= arr2.length ? arr1 : arr2;
        int[] shorts = arr1.length &lt; arr2.length ? arr1 : arr2;
        int l = longs.length;
        int s = shorts.length;
        //1
        if(k &lt;= s)&#123;
            return getUpMedian(longs, 0, k - 1, shorts, 0, k - 1);
        &#125;
        //2
        if(k > l)&#123;
            if(longs[k - s - 1] >= shorts[s - 1])&#123;
                return longs[k - s -1];
            &#125;
            if(shorts[k - l - 1] >= longs[l - 1])&#123;
                return shorts[k - l - 1];
            &#125;
            return getUpMedian(longs, k - s, l - 1, shorts, k - l, s - 1);
        &#125;
        //3
        if(longs[k - s - 1] >= shorts[s - 1])&#123;
            return longs[k - s - 1];
        &#125;
        return getUpMedian(longs, k - s, k - 1,shorts, 0 ,s - 1);
    &#125;


ç¿»è½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯

ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œé€ä¸ªç¿»è½¬å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ å•è¯ ã€‚
å•è¯ æ˜¯ç”±éç©ºæ ¼å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚s ä¸­ä½¿ç”¨è‡³å°‘ä¸€ä¸ªç©ºæ ¼å°†å­—ç¬¦ä¸²ä¸­çš„ å•è¯ åˆ†éš”å¼€ã€‚
è¯·ä½ è¿”å›ä¸€ä¸ªç¿»è½¬ s ä¸­å•è¯é¡ºåºå¹¶ç”¨å•ä¸ªç©ºæ ¼ç›¸è¿çš„å­—ç¬¦ä¸²ã€‚
è¯´æ˜ï¼š
è¾“å…¥å­—ç¬¦ä¸² s å¯ä»¥åœ¨å‰é¢ã€åé¢æˆ–è€…å•è¯é—´åŒ…å«å¤šä½™çš„ç©ºæ ¼ã€‚
ç¿»è½¬åå•è¯é—´åº”å½“ä»…ç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”ã€‚
ç¿»è½¬åçš„å­—ç¬¦ä¸²ä¸­ä¸åº”åŒ…å«é¢å¤–çš„ç©ºæ ¼ã€‚
ç¤ºä¾‹ 1ï¼š
è¾“å…¥ï¼šs = â€œthe sky is blueâ€
è¾“å‡ºï¼šâ€œblue is sky theâ€
ç¤ºä¾‹ 2ï¼š
è¾“å…¥ï¼šs = &quot;  hello world  &quot;
è¾“å‡ºï¼šâ€œworld helloâ€
è§£é‡Šï¼šè¾“å…¥å­—ç¬¦ä¸²å¯ä»¥åœ¨å‰é¢æˆ–è€…åé¢åŒ…å«å¤šä½™çš„ç©ºæ ¼ï¼Œä½†æ˜¯ç¿»è½¬åçš„å­—ç¬¦ä¸èƒ½åŒ…æ‹¬ã€‚

æ€è·¯:

å»é™¤å¤šä½™çš„ç©ºç™½ï¼š
(1å»æ‰å­—ç¬¦ä¸²å¼€å¤´çš„ç©ºç™½å­—ç¬¦
(2å»æ‰å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºç™½å­—ç¬¦
(3å°†å­—ç¬¦ä¸²é—´å¤šä½™çš„ç©ºç™½å­—ç¬¦å»é™¤
ç¿»è½¬å­—ç¬¦ä¸²ï¼š
ç¿»è½¬æ¯ä¸€ä¸ªå•è¯ï¼š
(1 éå†sb ä½¿ç”¨start å’Œ endæ¥æŠ“å•è¯
(2 ç¿»è½¬å•è¯
(3 æ›´æ–°startï¼Œå»æ‰¾ä¸‹ä¸€ä¸ªå•è¯

// 1 å»é™¤å¤šä½™çš„ç©ºç™½
    // 2 ç¿»è½¬å­—ç¬¦ä¸²
    // 3 ç¿»è½¬æ¯ä¸€ä¸ªå•è¯
    public String reverseWords(String s) &#123;
        // 1
        StringBuilder sb = trimSpaces(s);

        // 2
        reverse(sb, 0, sb.length() - 1);

        // 3
        reverseEachWord(sb);

        return sb.toString();
    &#125;

    // 1 å»æ‰å­—ç¬¦ä¸²å¼€å¤´çš„ç©ºç™½å­—ç¬¦
    // 2 å»æ‰å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºç™½å­—ç¬¦
    // 3 å°†å­—ç¬¦ä¸²é—´å¤šä½™çš„ç©ºç™½å­—ç¬¦å»é™¤
    public StringBuilder trimSpaces(String s) &#123;
        int left = 0, right = s.length() - 1;
        // 1 
        while (left &lt;= right &amp;&amp; s.charAt(left) == ' ') &#123;
            ++left;
        &#125;

        // 2
        while (left &lt;= right &amp;&amp; s.charAt(right) == ' ') &#123;
            --right;
        &#125;

        // 3
        StringBuilder sb = new StringBuilder();
        while (left &lt;= right) &#123;
            char c = s.charAt(left);

            if (c != ' ') &#123;
                sb.append(c);
            &#125; else if (sb.charAt(sb.length() - 1) != ' ') &#123;
                sb.append(c);
            &#125;

            ++left;
        &#125;
        return sb;
    &#125;

    // ç¿»è½¬ä»»æ„å­—ç¬¦
    public void reverse(StringBuilder sb, int left, int right) &#123;
        while (left &lt; right) &#123;
            char tmp = sb.charAt(left);
            sb.setCharAt(left++, sb.charAt(right));
            sb.setCharAt(right--, tmp);
        &#125;
    &#125;


    public void reverseEachWord(StringBuilder sb) &#123;
        int n = sb.length();
        int start = 0, end = 0;

        // 1 éå†sb ä½¿ç”¨start å’Œ endæ¥æŠ“å•è¯
        // 2 ç¿»è½¬å•è¯
        // 3 æ›´æ–°startï¼Œå»æ‰¾ä¸‹ä¸€ä¸ªå•è¯
        while (start &lt; n) &#123;
            // 1
            while (end &lt; n &amp;&amp; sb.charAt(end) != ' ') &#123;
                ++end;
            &#125;
            // 2
            reverse(sb, start, end - 1);
            // 3
            start = end + 1;
            ++end;
        &#125;
    &#125;
å­—ç¬¦ä¸²ç›¸ä¹˜

ç»™å®šä¸¤ä¸ªä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºçš„éè´Ÿæ•´æ•° num1 å’Œ num2ï¼Œè¿”å› num1 å’Œ num2 çš„ä¹˜ç§¯ï¼Œå®ƒä»¬çš„ä¹˜ç§¯ä¹Ÿè¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å½¢å¼ã€‚
æ³¨æ„ï¼šä¸èƒ½ä½¿ç”¨ä»»ä½•å†…ç½®çš„ BigInteger åº“æˆ–ç›´æ¥å°†è¾“å…¥è½¬æ¢ä¸ºæ•´æ•°ã€‚
ç¤ºä¾‹ 1:
è¾“å…¥: num1 = â€œ2â€, num2 = â€œ3â€
è¾“å‡º: â€œ6â€
ç¤ºä¾‹ 2:
è¾“å…¥: num1 = â€œ123â€, num2 = â€œ456â€
è¾“å‡º: â€œ56088â€

public String multiply(String num1, String num2) &#123;
        if (num1.equals("0") || num2.equals("0")) &#123;
            return "0";
        &#125;
        int m = num1.length(), n = num2.length();
        int[] ansArr = new int[m + n];
        for (int i = m - 1; i >= 0; i--) &#123;
            int x = num1.charAt(i) - '0';
            for (int j = n - 1; j >= 0; j--) &#123;
                int y = num2.charAt(j) - '0';
                ansArr[i + j + 1] += x * y;
            &#125;
        &#125;
        for (int i = m + n - 1; i > 0; i--) &#123;
            ansArr[i - 1] += ansArr[i] /10;
            ansArr[i] %= 10;
        &#125;
        int index = ansArr[0] == 0 ? 1 : 0;
        StringBuffer ans = new StringBuffer();
        while (index &lt; m + n) &#123;
            ans.append(ansArr[index]);
            index++;
        &#125;
        return ans.toString();
    &#125;
åˆ é™¤æ•°ç»„ä¸­çš„é‡å¤é¡¹
ä»»ä½•åˆ é™¤é‡å¤çš„éƒ½å¯ä»¥ç”¨å¿«æ…¢æŒ‡é’ˆ
/**
 * åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹
 * @author chs
 * ä»»ä½•åˆ é™¤é‡å¤çš„éƒ½å¯ä»¥ç”¨å¿«æ…¢æŒ‡é’ˆ
 */
public class Fre_017_RemoveDuplicatesFromSortedArray &#123;
	public static int removeDuplicates(int[] nums) &#123;
		if (nums == null) &#123;
			return 0;
		&#125;
		
		if (nums.length &lt; 2) &#123;
			return nums.length;
		&#125;
		int done = 0;
		for (int i = 1; i &lt; nums.length; i++) &#123;
			if (nums[i] != nums[done]) &#123;
				nums[++done] = nums[i];
			&#125;
		&#125;
		return done + 1;
	&#125;
&#125;
å»é™¤é‡å¤å­—æ¯
è´ªå¿ƒâ•å•è°ƒæ ˆï¼Ÿ

ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œè¯·ä½ å»é™¤å­—ç¬¦ä¸²ä¸­é‡å¤çš„å­—æ¯ï¼Œä½¿å¾—æ¯ä¸ªå­—æ¯åªå‡ºç°ä¸€æ¬¡ã€‚éœ€ä¿è¯ è¿”å›ç»“æœçš„å­—å…¸åºæœ€å°ï¼ˆè¦æ±‚ä¸èƒ½æ‰“ä¹±å…¶ä»–å­—ç¬¦çš„ç›¸å¯¹ä½ç½®ï¼‰ã€‚
ç¤ºä¾‹ 1ï¼š
è¾“å…¥ï¼šs = â€œbcabcâ€
è¾“å‡ºï¼šâ€œabcâ€
ç¤ºä¾‹ 2ï¼š
è¾“å…¥ï¼šs = â€œcbacdcbcâ€
è¾“å‡ºï¼šâ€œacdbâ€

public String removeDuplicateLetters(String s) &#123;
       boolean[] vis = new boolean[26];
       int[] num = new int[26];
       for (int i = 0; i &lt; s.length(); i++) &#123;
           num[s.charAt(i) - 'a']++;
       &#125;

       StringBuffer sb = new StringBuffer();
       for (int i = 0; i &lt; s.length(); i++) &#123;
           char ch = s.charAt(i);
           if (!vis[ch - 'a']) &#123;
               while (sb.length() > 0 &amp;&amp; sb.charAt(sb.length() - 1) > ch) &#123;
                   if (num[sb.charAt(sb.length() - 1) - 'a'] > 0) &#123;
                       vis[sb.charAt(sb.length() - 1) - 'a'] = false;
                       sb.deleteCharAt(sb.length() - 1);
                   &#125; else &#123;
                       break;
                   &#125;
               &#125;
               vis[ch - 'a'] = true;
               sb.append(ch);
           &#125;
           num[ch - 'a'] -= 1;
       &#125;
       return sb.toString();
   &#125;
å•è¯æœç´¢

ç»™å®šä¸€ä¸ª n Ã— n çš„äºŒç»´çŸ©é˜µ matrix è¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚è¯·ä½ å°†å›¾åƒé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚
ä½ å¿…é¡»åœ¨ åŸåœ° æ—‹è½¬å›¾åƒï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦ç›´æ¥ä¿®æ”¹è¾“å…¥çš„äºŒç»´çŸ©é˜µã€‚è¯·ä¸è¦ ä½¿ç”¨å¦ä¸€ä¸ªçŸ©é˜µæ¥æ—‹è½¬å›¾åƒã€‚


public void rotate(int[][] matrix) &#123;
        int a = 0;
        int b = 0;
        int c = matrix.length - 1;
        int d = matrix[0].length - 1;
        while(a &lt; c) &#123;
            rotateEdge(matrix, a++, b++, c--, d--);
        &#125;
    &#125;

    public static void rotateEdge(int[][] m, int a, int b, int c, int d) &#123;
        int tmp = 0;
        for (int i = 0; i &lt; d - b; i++) &#123;
            tmp = m[a][b + i];
            m[a][b + i] = m[c - i][b];
            m[c - i][b] = m[c][d - i];
            m[c][d - i] = m[a + i][d];
            m[a + i][d] = tmp;
        &#125;
    &#125;
å¤šæ•°å…ƒç´ 

ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•° å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚
ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚
æ˜¯ä¸€ä¸ªè¶…çº§æ°´ç‹é—®é¢˜
1éå† ä½¿ç”¨ candidateå’ŒHP æ¥ä¸€æ¬¡åˆ é™¤ä¸¤ä¸ªä¸åŒçš„æ•°
2åˆ°æœ€å HP ä¸ä¸º0 åˆ™è¯´æ˜å¯èƒ½æœ‰æ°´ç‹ æ˜¯å½“å‰çš„candidate
3å†éå†ä¸€æ¬¡æ‰¾candi å¦‚æœ HP&gt; n&#x2F;2 è¯´æ˜å°±æ˜¯æ°´ç‹ 


public int majorityElement(int[] nums) &#123;

        if(nums == null) &#123;
            return -1;
        &#125;
        int n = nums.length;
        int candi = 0;
        int HP = 0;
        for(int i  = 0; i &lt; n; i++) &#123;
            if(HP == 0) &#123;
                candi = nums[i];
                HP++;
            &#125;else if( nums[i] != candi) &#123;
                HP--;
            &#125;else &#123;
                HP++;
            &#125;
        &#125;
        if(HP == 0) &#123;
            return -1;
        &#125;
        HP = 0;
        for(int i = 0; i &lt; n ; i++) &#123;
            if(nums[i] == candi) &#123;
                HP++;
            &#125;
        &#125;
        if(HP > n / 2) &#123;
            return candi;
        &#125; else &#123;
            return -1;
        &#125;
    &#125;
&#125;
1 é“¾è¡¨
1 åè½¬é“¾è¡¨
public ListNode reverseList(ListNode head) &#123;
      ListNode pre = null;
      ListNode cur = head;
      while(cur != null) &#123;
          ListNode next = cur.next;
          cur.next = pre;
          pre = cur;
          cur = next;
      &#125;
      return pre;// ï¼è¿”å›çš„æ˜¯pre
  &#125;
åè½¬é“¾è¡¨äºŒ

å°±æ˜¯åè½¬é“¾è¡¨ä¸­é—´ä¸€æˆª

// ç¬¬ 1 æ­¥ï¼šä»è™šæ‹Ÿå¤´èŠ‚ç‚¹èµ° left - 1 æ­¥ï¼Œæ¥åˆ° left èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹
// ç¬¬ 2 æ­¥ï¼šä» pre å†èµ° right - left + 1 æ­¥ï¼Œæ¥åˆ° right èŠ‚ç‚¹
// ç¬¬ 3 æ­¥ï¼šåˆ‡æ–­å‡ºä¸€ä¸ªå­é“¾è¡¨ï¼ˆæˆªå–é“¾è¡¨ï¼‰å…ˆæ ‡è®°å†åˆ‡æ–­
// ç¬¬ 4 æ­¥ï¼š[åŒåè½¬é“¾è¡¨](##1 åè½¬é“¾è¡¨##)ï¼Œåè½¬é“¾è¡¨çš„å­åŒºé—´
// ç¬¬ 5 æ­¥ï¼šæ¥å›åˆ°åŸæ¥çš„é“¾è¡¨ä¸­
public ListNode reverseBetween(ListNode head, int left, int right) &#123;
        //1 éœ€è¦ä¸€ä¸ªè™šæ‹Ÿå¤´
        ListNode dummyNode = new ListNode(-1);
        dummyNode.next = head;

        //2 å…ˆæ‰¾åˆ°åè½¬éƒ¨åˆ†çš„leftå‰é¢pre
        ListNode pre = dummyNode;
        for(int i = 0; i &lt; left - 1;i++) &#123;
            pre = pre.next;
        &#125;

        //2 ä»preå†èµ°right - left + 1æ­¥ æ¥åˆ°rightèŠ‚ç‚¹
        ListNode rNode = pre;
        for(int i = 0; i &lt; right - left + 1;i++) &#123;
            rNode = rNode.next;
        &#125;

        //3 åˆ‡æ–­è¿™éƒ¨åˆ†çš„é“¾è¡¨
        ListNode lNode = pre.next;
        ListNode end = rNode.next;
        pre.next = null;
        rNode.next = null;

        //4 åè½¬åŒºé—´å†…çš„é“¾è¡¨
        reverseLinkedList(lNode);

        //5 æ¥å›å»
        pre.next = rNode;// âš ï¸æ¥å›å»çš„æ—¶å€™å·²ç»æ˜¯åè¿‡æ¥äº†
        lNode.next = end;
        return dummyNode.next;
    &#125;

    private void reverseLinkedList(ListNode head) &#123;
        ListNode pre = null;
        ListNode cur = head;

        while (cur != null) &#123;
            ListNode next = cur.next;
            cur.next = pre;
            pre = cur;
            cur = next;
        &#125;
    &#125;

2 LRUç¼“å­˜æœºåˆ¶

è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³  LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜ çº¦æŸçš„æ•°æ®ç»“æ„ã€‚
å®ç° LRUCache ç±»ï¼š
LRUCache(int capacity) ä»¥ æ­£æ•´æ•° ä½œä¸ºå®¹é‡ capacity åˆå§‹åŒ– LRU ç¼“å­˜
int get(int key) å¦‚æœå…³é”®å­— key å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› -1 ã€‚
void put(int key, int value) å¦‚æœå…³é”®å­— key å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ value ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„ key-value ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡ capacity ï¼Œåˆ™åº”è¯¥ é€å‡º æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚
å‡½æ•° get å’Œ put å¿…0é¡»ä»¥ O(1) çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚

			
1) æ€»çš„ç¼“å­˜ç»“æ„ å’Œæ–¹æ³•è°ƒç”¨
æ„é€ æ–¹æ³•
private MyCache&lt;Integer, Integer> cache;
	public Fre_278_LRUCache(int capacity)&#123;
		cache = new MyCache&lt;>(capacity);
	&#125;
	
1 get()
public int get(int key) &#123;
		Integer ans = cache.get(key);
		return ans == null ? -1 : ans;
	&#125;
2 put()
public void put(int key, int value) &#123;
		cache.set(key, value);
	&#125;
2ï¼‰MyCache
æ„é€ æ–¹æ³•
public static class MyCache&lt;K, V> &#123;
	private HashMap&lt;K, Node&lt;K, V>> keyNodeMap;
	private NodeDoubleLinkedList&lt;K, V> nodeList;
	private final int capacity;
	
	public MyCache(int cap) &#123;
		keyNodeMap = new HashMap&lt;K, Node&lt;K, V>>();
		nodeList = new NodeDoubleLinkedList&lt;K, V>();
		capacity = cap;
	&#125;
1 V get(K key) é€šè¿‡keyè¿”å›value éœ€è¦å°†nodeæ”¾åˆ°å°¾éƒ¨
public V get(K key) &#123;
		if(keyNodeMap.containsKey(key)) &#123;
			Node&lt;K, V> res = keyNodeMap.get(key);
			nodeList.moveNodeToTail(res);
			return res.value;
		&#125;
		return null;
	&#125;
2  void set(K key, V value) æ›´æ–°ä¸æ–°å¢ï¼šæ”¾åˆ°å°¾éƒ¨ï¼Œè¶…å‡ºå†…å­˜å°±åˆ é™¤æœ€é•¿æ—¶é—´æ²¡æœ‰æ“ä½œçš„
public void set(K key, V value) &#123;
		if (keyNodeMap.containsKey(key)) &#123;
			Node&lt;K, V> node = keyNodeMap.get(key);
			node.value = value;
			nodeList.moveNodeToTail(node);
		&#125; else &#123;
			Node&lt;K, V> newNode = new Node&lt;K, V>(key, value);
			keyNodeMap.put(key, newNode);
			nodeList.addNode(newNode);
			if (keyNodeMap.size() == capacity + 1) &#123;
				removeMostUnusedCache();
			&#125;
		&#125;
	&#125;
3 void removeMostUnusedCache() åˆ å»æœ€é•¿æ—¶é—´æ²¡æœ‰æ“ä½œçš„ç¼“å­˜ ï¼›åœ¨ä¸¤ä¸ªç»“æ„é‡Œé¢éƒ½åˆ é™¤
private void removeMostUnusedCache() &#123;
			Node&lt;K, V> removeNode = nodeList.removeHead();
			keyNodeMap.remove(removeNode.key);
		&#125;
3) åŒå‘é“¾è¡¨ç»“æ„
åŸºäºLRUæœºåˆ¶çš„åŒå‘é“¾è¡¨ç»“æ„
private Node&lt;K, V&gt; head;
private Node&lt;K, V&gt; tail;
æ„é€ æ–¹æ³•ï¼šå°†å¤´å°¾ç½®ä¸ºç©º
public NodeDoubleLinkedList()&#123;
	head &#x3D; null;
	tail &#x3D; null;
&#125;
1 addNode() : æ¥æ–°èŠ‚ç‚¹ï¼ŒæŒ‚åˆ°å°¾å·´ä¸Š
public void addNode(Node&lt;K, V> newNode)&#123;
			if(newNode == null) &#123;
				return;
			&#125;
			if(head ==  null) &#123;
				head = newNode;
				tail = newNode;
			&#125; else &#123;
				tail.next = newNode;
				newNode.last = tail;
				tail = newNode;
			&#125;
		&#125;
2 moveToTail() : ï¼ˆä¿®æ”¹è¿‡çš„èŠ‚ç‚¹ï¼Œè¦ä¿è¯nodeåœ¨è¡¨ä¸­ï¼‰æ›´æ–°åˆ°å°¾éƒ¨
public void moveNodeToTail(Node&lt;K, V> node) &#123;
		 
		&#125;
3 removeHead() : å°†å¤´èŠ‚ç‚¹ç§»èµ°ï¼Œè¿”å›æ–°çš„å¤´èŠ‚ç‚¹
public static class NodeDoubleLinkedList&lt;K, V> &#123;
	
	public Node&lt;K, V> removeHead() &#123;
		if (head == null) &#123;
			return null;
		&#125;
		Node&lt;K, V> res = head;
		if (head == tail) &#123;
			head = null;
			tail = null;
		&#125; else &#123;
			head = res.next;
			res.next = null;
			head.last = null;
		&#125;
		return res;
	&#125;
&#125;
3 Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨
1 å…ˆå°†ç¬¬ä¸€ç»„kå‡‘é½ å¹¶ä¸”åè½¬
2 å†è®°å½•ä¸Šä¸€ç»„çš„ç»“å°¾èŠ‚ç‚¹
3 å¾ªç¯ï¼ˆå½“ç»“å°¾.next != null)
(1)æ›´æ–°start   (2)æ›´æ–°end æ³¨æ„åˆ¤ç©ºï¼ï¼
ï¼ˆ3ï¼‰ åè½¬ ï¼šend å˜å¤´
(4ï¼‰ ä¸Šä¸€ç»„ç»“å°¾è¿æ¥åˆ°ç°åœ¨çš„å¼€å¤´end (5)æ›´æ–°lastEnd

public ListNode reverseKGroup(ListNode head, int k) &#123;
       // 1
       ListNode start = head;
       ListNode end = getKEnd(start, k);
       if (end == null) &#123;
           return head;
       &#125;
       head = end;
       reverse(start, end);
       // 2
       ListNode lastEnd = start;
       // 3
       while (lastEnd.next != null) &#123;
           // 1)
           start = lastEnd.next;
           // 2)
           end = getKEnd(start, k);
           if (end == null) &#123;// âš ï¸(æ³¨æ„åˆ¤ç©ºï¼ï¼ï¼)
               return head;
           &#125;
           // 3)
           reverse(start, end);
           // 4)
           lastEnd.next = end;
           // 5)
           lastEnd = start;
       &#125;
       return head;
   &#125;

   private ListNode getKEnd(ListNode start, int k) &#123;
       while (--k != 0 &amp;&amp; start != null) &#123;
           start = start.next;
       &#125;
       return start;
   &#125;

   // åè½¬ 
   // 1 end å¾€åç§»
   // 2 ä¸‰ä¸ªæŒ‡é’ˆè¿›è¡Œåè½¬
   // 3 startåè½¬åæ˜¯ç»“å°¾è¦è¿æ¥åˆ°end
   private void reverse(ListNode start, ListNode end) &#123;
       // TODO Auto-generated method stub
       end = end.next;//âš ï¸(æ³¨æ„è¦ç§»åŠ¨endæŒ‡é’ˆ)
       ListNode pre = null;
       ListNode cur = start;
       ListNode next = null;
       while (cur != end) &#123;
           next = cur.next;
           cur.next = pre;
           pre = cur;
           cur = next;
       &#125;
       start.next = end;
   &#125;
4 åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨

å…ˆæŠ“å°å¤´head
cur2æŠ“å¤§å¤´ cur1 = head.next pre = head
æ¯”è¾ƒ c1 c2 è°å°preçš„nextå°±æŒ‡å‘è° å¹¶ä¸”cur pre åç§»

public static ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123;
        if(l1 == null || l2 ==null)&#123;
            return l1 == null ? l2 : l1;
        &#125;
        //æŠ“å¤§å¤´
        ListNode head = l1.val &lt;= l2.val ? l1 : l2;
        ListNode cur1 = head.next;
        //æŠ“å°å¤´
        ListNode cur2 = head == l1 ? l2 : l1;
        ListNode pre = head;
        while(cur1 != null &amp;&amp; cur2 != null)&#123;
            if(cur1.val &lt;= cur2.val)&#123;
                pre.next = cur1;
                cur1 = cur1.next;
            &#125;else&#123;
                pre.next = cur2;
                cur2 = cur2.next;
            &#125;
            pre = pre.next;
        &#125;
        pre.next = cur1 != null ? cur1 :cur2;
        return head;
&#125;
åˆå¹¶kä¸ªé“¾è¡¨

ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚
è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚


public class LianBiao_MergeMoreList &#123;

  //å¯¹æ•°å™¨ âš ï¸
	public static class ListNodeComparator implements Comparator&lt;ListNode> &#123;
		@Override
		public int compare(ListNode arg0, ListNode arg1) &#123;
			// TODO Auto-generated method stub
			return arg0.val - arg1.val;
		&#125;
	&#125;
  
	public ListNode mergeKLists(ListNode[] lists) &#123;
		if (lists == null) &#123;
			return null;
		&#125;
		// 1 å®šä¹‰ä¸€ä¸ªå¯¹æ•°å™¨çš„å°æ ¹å †
		PriorityQueue&lt;ListNode> heap = new PriorityQueue&lt;>(
				new ListNodeComparator());

   
		// 2 å°†æ¯ä¸€æ¡çš„headæ”¾åœ¨å †ä¸­
		for (int i = 0; i &lt; lists.length; i++) &#123;
			if (lists[i] != null) &#123;// !!! 
				heap.add(lists[i]);
			&#125;
		&#125;
    if(heap.isEmpty())&#123; // âš ï¸
            return null;
    &#125;
		// 3 æŠ“å‡ºhead å°†è¯¥æ¡åé¢ä¸€ä¸ªèŠ‚ç‚¹æ”¾å…¥å †
		ListNode head = heap.poll();
		if (head.next != null) &#123;// !!!
			heap.add(head.next);
		&#125;
		ListNode pre = head;// æŒ‡é’ˆ

		// 4 é‡å¤å¼¹å‡ºè¿æ¥ç»“æœè¡¨ å†è§å¼¹å‡ºçš„ä¸‹ä¸€ä¸ªæ”¾å…¥å †ä¸­
		while (!heap.isEmpty()) &#123;
			ListNode cur = heap.poll();
			pre.next = cur;
			pre = cur;
			if (cur.next != null) &#123;// !!!
				heap.add(cur.next);
			&#125;
		&#125;

		return head;

	&#125;
&#125;

5 ç›¸äº¤é“¾è¡¨
éœ€è¦åˆ†æœ‰ç¯å’Œæ— ç¯ä¸¤ç§æƒ…å†µ [å¦‚ä½•è¾¨åˆ«æœ‰æ— ç¯](##6 ç¯å½¢é“¾è¡¨##)
æ— ç¯é“¾è¡¨ç›¸äº¤


ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ headA å’Œ headB ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸å­˜åœ¨ç›¸äº¤èŠ‚ç‚¹ï¼Œè¿”å› null ã€‚


éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼›
å…ˆç”¨nè®°å½•ä¸¤ä¸ªé“¾è¡¨é•¿åº¦å¤§å°ä»¥ä¾¿åˆ†æ¸…æ¥šè°é•¿è°çŸ­ï¼Œné•¿åº¦å·®è®°å¾—å–ç»å¯¹å€¼ï¼›
é•¿çš„èµ°næ­¥åˆ°å’ŒçŸ­çš„ä¸€æ ·é•¿çš„èµ·ç‚¹ï¼›
ä¸¤ä¸ªæŒ‡é’ˆä¸€èµ·èµ°åˆ°ç›¸ç­‰çš„åœ°æ–¹ å°±æ˜¯äº¤ç‚¹ è¿”å›ï¼›

public static ListNode getNoLoop(ListNode headA, ListNode headB) &#123;
	  if(headA == null || headB == null)&#123;
	      return null;
	  &#125;
	  ListNode cur1 = headA;
	  ListNode cur2 = headB;
	  int n = 0;
	  while(cur1 != null)&#123;
		  n++;
		  cur1 = cur1.next;
	  &#125;
	  while(cur2 != null)&#123;
		  n--;
		  cur2 = cur2.next;
	  &#125;
	   if(cur1 != cur2)&#123;
		  return null;
	  &#125;
	  cur1 = n > 0 ? headA : headB;//cur1æŒ‡å‘é•¿çš„å¤´
	  cur2 = (cur1 == headA) ? headB : headA;//cur2æŒ‡å‘çŸ­å¤´
	  //å°†ä¸¤ä¸ªé“¾è¡¨é•¿åº¦å·®å–ç»å¯¹å€¼
	  n = Math.abs(n);
	  
	  //å°†æŒ‡å‘é•¿é“¾è¡¨çš„æŒ‡é’ˆcur1å¾€ä¸‹ç§»åŠ¨n,åˆ°è¾¾å’ŒçŸ­é“¾è¡¨cur2æŒ‡é’ˆä¸ç›¸äº¤ç‚¹ç›¸åŒè·ç¦»çš„ä½ç½®
	  while(n != 0)&#123;
		  n--;
		  cur1 = cur1.next;
	  &#125;
	  //ä¸¤ä¸ªæŒ‡é’ˆå‘ä¸‹ ç›¸é‡ç‚¹ä¾¿æ˜¯ç›¸äº¤ç‚¹
	  while(cur1 != cur2)&#123;
		  cur1 = cur1.next;
		  cur2 = cur2.next;
	  &#125;
	  return cur1;
         
  &#125;	
æœ‰ç¯é“¾è¡¨ç›¸äº¤
æœ‰ç¯çš„é“¾è¡¨æ¯”è¾ƒå¤æ‚ æœ‰ä¸‰ç§æƒ…å†µ
1 ä¸¤ä¸ªå…¥ç¯èŠ‚ç‚¹ç›¸åŒ å³ç›¸äº¤åœ¨å…¥ç¯å‰ (loop1 =loop2)
2 ä¸¤ä¸ªç›¸äº¤åœ¨ç¯å†…ç›¸äº¤ æœ‰ä¸¤ä¸ªç›¸äº¤ç‚¹
3 ä¸¤ä¸ªä¸ç›¸äº¤

public static ListNode bothLoop(ListNode headA,ListNode loop1,ListNode headB, ListNode loop2)&#123;
		ListNode cur1 = null;
		ListNode cur2 = null;
		if(loop1 == loop2)&#123;//2 
			//æ–¹æ³•ä¸ä¸¤ä¸ªæ— ç¯é“¾è¡¨æ–¹æ³•ä¸€æ ·åªä¸è¿‡æŠŠloop1/2çœ‹ä½œç»“å°¾
			cur1 = headA;
			cur2 = headB;
			int n = 0;
			while(cur1 != loop1)&#123;
				  n++;
				  cur1 = cur1.next;
			  &#125;
			  while(cur2 != loop2)&#123;
				  n--;
				  cur2 = cur2.next;
			  &#125;
			  if(cur1 != cur2)&#123;
				  return null;
			  &#125;
			  cur1 = n > 0 ? headA : headB;
			  cur2 = (cur1 == headA) ? headB : headA;
			  n = Math.abs(n);
			  while(n != 0)&#123;
				  n--;
				  cur1 = cur1.next;
			  &#125;
			  while(cur1 != cur2)&#123;
				  cur1 = cur1.next;
				  cur2 = cur2.next;
			  &#125;
			  return cur1;
		&#125;else&#123;
			//loop1å¾€åç§»åŠ¨ å¦‚æœåœ¨é‡åˆ°è‡ªå·±ä¹‹å‰é‡åˆ°äº†loop2å°±æ˜¯æƒ…å†µ3
			cur1 = loop1.next;
			while(cur1 != loop1)&#123;
				if(cur1 == loop2)&#123;
					return loop1;//3
					&#125;
				&#125;
				return null;//1
			&#125;
&#125;
6 ç¯å½¢é“¾è¡¨

è¿”å›å…¥ç¯èŠ‚ç‚¹ï¼Œæ²¡æœ‰ç¯å°±è¿”å›nullï¼›

1.å…ˆå°†ä»å¤´èŠ‚ç‚¹å¿«æ…¢æŒ‡é’ˆå¼€å§‹å¾€åï¼Œå¦‚æœä¸¤ä¸ªæŒ‡é’ˆç›¸é‡é‚£ä¸€å®šæœ‰ç¯ï¼ŒæœŸé—´å¦‚æœå¿«æŒ‡é’ˆåˆ°nullï¼Œå¯ä»¥ç›´æ¥åˆ¤æ–­æ— ç¯ã€‚
2.å¦‚æœè¦æ‰¾åˆ°å…¥ç¯èŠ‚ç‚¹ï¼Œå°±å°†fastæŒ‡é’ˆæŒ‡å‘headï¼Œslowä¸åŠ¨ï¼Œç„¶åè®©ä¸¤ä¸ªæŒ‡é’ˆéƒ½åªç§»åŠ¨ä¸€æ­¥ï¼Œæœ€åä¸€å®šä¼šåœ¨å…¥ç¯å¤„ç›¸é‡ã€‚
public static ListNode hasCycle(ListNode head) &#123;
        if(head == null || head.next == null || head.next.next == null)&#123;
            return null;
        &#125;
        ListNode slow = head.next;
        ListNode fast = head.next.next;
        while(slow != fast)&#123;
            if(fast.next ==  null || fast.next.next == null)&#123;
                return null;
            &#125;
            fast = fast.next.next;
            slow = slow.next;
        &#125;
        fast = head;
        while(slow != fast)&#123;
            fast = fast.next;
            slow = slow.next;
        &#125;
        return slow;
    &#125;
7 é‡æ’é“¾è¡¨

ç»™å®šä¸€ä¸ªå•é“¾è¡¨ L çš„å¤´èŠ‚ç‚¹ head ï¼Œå•é“¾è¡¨ L è¡¨ç¤ºä¸ºï¼š
L0 â†’ L1 â†’ â€¦ â†’ Ln - 1 â†’ Ln
è¯·å°†å…¶é‡æ–°æ’åˆ—åå˜ä¸ºï¼š
L0 â†’ Ln â†’ L1 â†’ Ln - 1 â†’ L2 â†’ Ln - 2 â†’ â€¦
ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚


æ‰¾åˆ°åŸè¡¨çš„ä¸­ç‚¹

å¿«æ…¢æŒ‡é’ˆä»headå¼€èµ°
fast.next == null || fast.next.next = null è¿”å›æ…¢æŒ‡é’ˆ


å°†å³åŠç«¯åè½¬ï¼š[åè½¬é“¾è¡¨](##1 åè½¬é“¾è¡¨##)
å°†å·¦å³ç«¯åˆå¹¶

public void reorderList(ListNode head) &#123;
		 public void reorderList(ListNode head) &#123;
        if(head == null) &#123; // âš ï¸åˆ¤ç©º
            return;
        &#125;
        ListNode mid = middleNode(head);
        ListNode l1 = head;
        ListNode l2 = mid.next;
        mid.next =null; // âš ï¸åˆ†ç¦»
        l2 = reverse(l2);
        mergeList(l1, l2);
    &#125;

    public ListNode middleNode(ListNode head) &#123;
        ListNode fast = head;
        ListNode slow = head;
        while(fast.next != null &amp;&amp; fast.next.next != null) &#123;
            fast = fast.next.next;
            slow = slow.next;
        &#125;
        return slow;
    &#125;

    public ListNode reverse(ListNode head) &#123;
        ListNode pre = null;
        ListNode cur = head;
        while(cur != null) &#123;
            ListNode next = cur.next;
            cur.next = pre;
            pre = cur;
            cur = next;
        &#125;
        return pre; // âš ï¸è¿”å›çš„æ˜¯pre
    &#125;

    // åˆå¹¶è¿‡ç¨‹å°±æ˜¯ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆæ¥æ ‡å¿—ä¸¤ä¸ªçš„ä¸‹ä¸€ä¸ª
    public void mergeList(ListNode l1, ListNode l2) &#123;
        ListNode l1_next;
        ListNode l2_next;
        while(l1 != null &amp;&amp; l2 != null) &#123;
            l1_next = l1.next;
            l2_next = l2.next;

            l1.next = l2;
            l1 = l1_next;

            l2.next = l1;
            l2 = l2_next;
        &#125;
    &#125;
	&#125;
8 åˆ é™¤é“¾è¡¨é‡å¤èŠ‚ç‚¹
è®¾ç½®è™šæ‹ŸèŠ‚ç‚¹
å¾€åéå†  ï¼ˆæ¡ä»¶ï¼šcurçš„ä¸‹ä¸€ä¸ªå’Œä¸‹ä¸‹ä¸ªéƒ½æ˜¯ç©ºï¼‰
2.1å¦‚æœå½“å‰ä¸¤ä¸ªèŠ‚ç‚¹å€¼ç›¸ç­‰å°±å°†å½“å‰cur.nextçš„å€¼ä¿å­˜åœ¨x;
â€‹	å¾ªç¯ï¼ˆç¬¬ä¸€ä¸ªèŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹æ˜¯å¦æœ‰é‡å¤çš„ï¼‰cur.nextæŒ‡å‘ä¸ç­‰äºè¯¥xå€¼çš„èŠ‚ç‚¹
â€‹    2.2 ä¸ç›¸ç­‰å°±ç›´æ¥next
public ListNode deleteDuplicates(ListNode head) &#123;
		 if(head == null) &#123;
            return head;
        &#125;
        ListNode dummy = new ListNode(0, head);

        ListNode cur = dummy;
        while(cur.next != null &amp;&amp; cur.next.next != null)&#123; // å½“å‰èŠ‚ç‚¹ä¸‹ä¸€ä¸ªå’Œä¸‹ä¸‹ä¸ªä¸ä¸ºç©º
            if(cur.next.val == cur.next.next.val)&#123; // ä¸¤ä¸ªèŠ‚ç‚¹ç›¸ç­‰
                int x = cur.next.val; 
                while(cur.next != null &amp;&amp; cur.next.val == x)&#123; // éå†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹æ˜¯å¦æœ‰é‡å¤çš„ 
                    cur.next = cur.next.next;// æœ‰å°±ç›´æ¥è®²æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸‹ä¸ª
                &#125;
            &#125; else &#123; // ä¸¤ä¸ªèŠ‚ç‚¹ä¸ç›¸ç­‰ æŒ‡é’ˆåç§»
                cur = cur.next;
            &#125;
        &#125;
        return dummy.next;
&#125;
9 æ’åºé“¾è¡¨

å°±æ˜¯ç»™é“¾è¡¨æ’åº

public static ListNode sortList(ListNode head) &#123;
		// 1 éå†ä¸€éé“¾è¡¨çš„é•¿åº¦
		int N = 0;
		ListNode cur = head;
		while (cur != null) &#123;
			N++;
			cur = cur.next;
		&#125;
		// 2 lenæ˜¯æ¯æ¬¡åˆ†ç»„èŠ‚ç‚¹æ•° ä¸€ç›´ä¹˜äºŒ
		ListNode h = head;
		ListNode teamFirst = head;
		ListNode pre = null;
		for (int len = 1; len &lt; N; len &lt;&lt;= 1) &#123;
			while (teamFirst != null) &#123;
				// 3 Få°±æ˜¯å°†äº”ä¸ªå‚æ•°å¤„ç†è¿”å›æ–¹ä¾¿åˆ©ç”¨
				// å·¦ç»„ä»å“ªåˆ°å“ª   ls le
				// å³ç»„ä»å“ªåˆ°å“ª   rs re
				// å·¦ å³  next
				ListNode[] f1 = f(teamFirst, len);
				// ls...le  rs...re -> mergeå»
				// æ•´ä½“çš„å¤´ã€æ•´ä½“çš„å°¾
				ListNode[] f2 = merge(f1[0], f1[1], f1[2], f1[3]);
				if (h == teamFirst) &#123;
					h = f2[0];
					pre = f2[1];
				&#125; else &#123;
					pre.next = f2[0];
					pre = f2[1];
				&#125;
				teamFirst = f1[4];// next
			&#125;
			teamFirst = h;
			pre = null;
		&#125;
		return h;
	&#125;

	public static ListNode[] f(ListNode teamFirst, int len) &#123;
		// è¿”å›äº”ä¸ªå‚æ•°
		ListNode ls = teamFirst;
		ListNode le = teamFirst;
		ListNode rs = null;
		ListNode re = null;
		ListNode next = null;
		int pass = 0;
		while (teamFirst != null) &#123;
			pass++;
			if (pass &lt;= len) &#123;
				le = teamFirst;
			&#125;
			if (pass == len + 1) &#123;
				rs = teamFirst;
			&#125;
			if (pass > len) &#123;
				re = teamFirst;
			&#125;
			if (pass == (len &lt;&lt; 1)) &#123;
				break;
			&#125;
			teamFirst = teamFirst.next;
		&#125;
		// å·¦è¾¹ç»“å°¾æ–­å¼€
		le.next = null;
		// è®°å½•å³è¾¹ç»“å°¾çš„nextå¹¶æ–­å¼€ç»“å°¾æ–­å¼€ 
		if (re != null) &#123;
			next = re.next;
			re.next = null;
		&#125;
		return new ListNode[] &#123; ls, le, rs, re, next &#125;;
	&#125;

	public static ListNode[] merge(ListNode ls, ListNode le, ListNode rs, ListNode re) &#123;
		if (rs == null) &#123;
			return new ListNode[] &#123; ls, le &#125;;
		&#125;
		ListNode head = null;
		ListNode pre = null;
		ListNode cur = null;
		ListNode tail = null;
		while (ls != le.next &amp;&amp; rs != re.next) &#123;
			if (ls.val &lt;= rs.val) &#123;
				cur = ls;
				ls = ls.next;
			&#125; else &#123;
				cur = rs;
				rs = rs.next;
			&#125;
			if (pre == null) &#123;
				head = cur;
				pre = cur;
			&#125; else &#123;
				pre.next = cur;
				pre = cur;
			&#125;
		&#125;
		if (ls != le.next) &#123;
			while (ls != le.next) &#123;
				pre.next = ls;
				pre = ls;
				tail = ls;
				ls = ls.next;
			&#125;
		&#125; else &#123;
			while (rs != re.next) &#123;
				pre.next = rs;
				pre = rs;
				tail = rs;
				rs = rs.next;
			&#125;
		&#125;
		return new ListNode[] &#123; head, tail &#125;;
	&#125;

10 ä¸¤æ•°ç›¸åŠ 

ç»™ä½ ä¸¤ä¸ª éç©º çš„é“¾è¡¨ï¼Œè¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å®ƒä»¬æ¯ä½æ•°å­—éƒ½æ˜¯æŒ‰ç…§ é€†åº çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ ä¸€ä½ æ•°å­—ã€‚
è¯·ä½ å°†ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œå¹¶ä»¥ç›¸åŒå½¢å¼è¿”å›ä¸€ä¸ªè¡¨ç¤ºå’Œçš„é“¾è¡¨ã€‚
ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚

public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123;
		//ä¸¤ä¸ªé“¾è¡¨åˆ†é•¿çŸ­
		//åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ ï¼š1 é•¿çŸ­éƒ½è¿˜æœ‰èŠ‚ç‚¹ 2 çŸ­æ²¡æœ‰èŠ‚ç‚¹ é•¿æœ‰èŠ‚ç‚¹ 3 é•¿ä¹Ÿèµ°åˆ°æ²¡èŠ‚ç‚¹
		ListNode l = listLength(l1) > listLength(l2) ? l1 : l2;
		ListNode s = (l == l1) ? l2 : l1;
		ListNode curl = l;
		ListNode curs = s;
		
		int carry = 0;
		int curNum = 0;
		ListNode last = curl;
		
		
		//1 
		while(curs != null)&#123;
			curNum = curs.val + curl.val + carry;
			carry = curNum / 10;
			curl.val = curNum % 10;
			last = curl;//lastä¸€ç›´åœ¨æŠ“ä½æœ€åä¸€ä¸ªèŠ‚ç‚¹
			curl = curl.next;
			curs = curs.next;
		&#125;
		
		//2 
		while(curl != null)&#123;
			curNum =  curl.val + carry;
			carry = curNum / 10;
			curl.val = curNum % 10;
			last = curl;//lastä¸€ç›´åœ¨æŠ“ä½æœ€åä¸€ä¸ªèŠ‚ç‚¹
			curl = curl.next;
		&#125;
		
		//3 åˆ°
		if(carry != 0)&#123;
			last.next = new ListNode(1);
		&#125;
		return l;
	&#125;
	
	
	
	public static int listLength(ListNode l)&#123;
		int length = 0;
		while(l != null)&#123;
			length++;
			l = l.next;
		&#125;
		return length;
	&#125;
11 é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹

è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼Œè¾“å‡ºè¯¥é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹ã€‚ä¸ºäº†ç¬¦åˆå¤§å¤šæ•°äººçš„ä¹ æƒ¯ï¼Œæœ¬é¢˜ä»1å¼€å§‹è®¡æ•°ï¼Œå³é“¾è¡¨çš„å°¾èŠ‚ç‚¹æ˜¯å€’æ•°ç¬¬1ä¸ªèŠ‚ç‚¹ã€‚
ä¾‹å¦‚ï¼Œä¸€ä¸ªé“¾è¡¨æœ‰ 6 ä¸ªèŠ‚ç‚¹ï¼Œä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼Œå®ƒä»¬çš„å€¼ä¾æ¬¡æ˜¯ 1ã€2ã€3ã€4ã€5ã€6ã€‚è¿™ä¸ªé“¾è¡¨çš„å€’æ•°ç¬¬ 3 ä¸ªèŠ‚ç‚¹æ˜¯å€¼ä¸º 4 çš„èŠ‚ç‚¹ã€‚

public class Fre_070_removeNthFromEnd &#123;
 public ListNode getKthFromEnd(ListNode head, int k) &#123;
        ListNode slow = head;
        ListNode fast = head;
        while(k - 1 != 0)&#123;
            fast = fast.next;
            k--;
        &#125;

        while(fast.next != null) &#123;
            slow = slow.next;
            fast = fast.next;
        &#125;
        return slow;
    &#125;
12 åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹
public ListNode removeNthFromEnd(ListNode head, int n) &#123;
       ListNode dummy = new ListNode(-1);
       dummy.next = head;
  			// 1 ç”¨ä¸¤ä¸ªæŒ‡é’ˆæˆªå‡ºn+1é•¿åº¦
       ListNode slow = dummy;
       ListNode fast = head;
       for(;n>0;n--)&#123;
           fast=fast.next;
       &#125;
  			// 2 ä¸¤ä¸ªæŒ‡é’ˆä¸€ç›´å¾€åç›´åˆ°faståˆ°ç»“å°¾
       while(fast != null)&#123;
           fast = fast.next;
           slow = slow.next;
       &#125;
  			// 3 slowåœ¨ç›®æ ‡çš„å‰é¢ä¸€ä½ ç›´æ¥å°†nextæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸‹ä½ 
       slow.next = slow.next.next;
       return dummy.next;// ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹ä»¥é˜²åˆ é™¤çš„æ˜¯å¤´èŠ‚ç‚¹
   &#125;
13 å›æ–‡é“¾è¡¨
éœ€è¦convert å’Œ ç„¶ååˆ¤æ–­å¯¹ç§° ç„¶åå†convertæ¢å¤å›å»
public boolean isPalindrome(ListNode head) &#123;
        ListNode slow = head;
        ListNode fast = head;
        while(fast.next != null &amp;&amp; fast.next.next != null)&#123;
            slow = slow.next;
            fast = fast.next.next;
        &#125;
        // 1 ç°åœ¨slowå°±èµ°åˆ°äº†ä¸­é—´ï¼ˆå¶æ•°æ˜¯ä¸Šä¸­ï¼‰
        // 2 å°†ååŠéƒ¨åˆ†convert
        ListNode l1 = null; //pre
        ListNode l2 = slow.next;
        ListNode l3 = null;
        while(l2 != null)&#123;
            l3 = l2.next;
            l2.next = l1;
            l1 = l2;
            l2 = l3;
        &#125;

        // 3 åé¢éƒ¨åˆ†å·²ç»ç¿»è½¬ ç°åœ¨å¯¹æ¯”ä¸¤éƒ¨åˆ†æ˜¯å¦å¯¹ç§°
        boolean ans = true;
        l2 = head;
        l3 = l1;
        while(l3 != null)&#123;
            if(l2.val != l3.val)&#123; // âš ï¸æ¯”è¾ƒval
                ans = false;
                break;
            &#125;
            l2 = l2.next;
            l3 = l3.next;
        &#125;

        // 4 æŠŠååŠéƒ¨åˆ†åˆæ¢å¤åŸæ ·
        l2 = null;// pre
        l3 = null;// next
        while(l1 != null)&#123;
            l3 = l1.next;
            l1.next = l2;
            l2 = l1;
            l1 = l3;
        &#125;
        slow.next = l2;

        return ans;
    &#125;
14 åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ 

ç»™å®šä¸€ä¸ªå·²æ’åºçš„é“¾è¡¨çš„å¤´ head ï¼Œ åˆ é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ ã€‚è¿”å› å·²æ’åºçš„é“¾è¡¨ ã€‚

åˆ é™¤é‡å¤å…ƒç´  ç•™ä¸‹ä¸€ä¸ª
ç›´æ¥å¿«æ…¢æŒ‡é’ˆ
public ListNode deleteDuplicates(ListNode head) &#123;
       if(head == null)&#123;
           return null;
       &#125;
       ListNode ans = head;
       ListNode left = head;
       ListNode right = head.next;

       while( right != null) &#123;
           ListNode next = right.next;
           if(left.val == right.val) &#123;
               left.next = next;
               right.next = null;
           &#125; else&#123;
               left =  right;
           &#125;

           right = next;
       &#125;
       return ans;
   &#125;


15 å¤åˆ¶å¸¦æœ‰éšæœºæŒ‡é’ˆçš„é“¾è¡¨
/*
 * æ·±åº¦å¤åˆ¶å¸¦æœ‰randçš„é“¾è¡¨
 */
public class LiaoBiao_copyListWithRandom &#123;
	public static class Node &#123;
		public int value;
		public Node next;
		public Node rand;

		public Node(int data) &#123;
			value = data;
		&#125;
	&#125;
	
	/*
	 * æœ€ä¼˜è§£ï¼šäººå·¥æ„é€ å…³ç³»
	 * 1 æ¯ä¸€ä¸ªèŠ‚ç‚¹åé¢åŠ ä¸€ä¸ªå…‹éš†èŠ‚ç‚¹
	 * 2 éå†å…³ç³» ï¼ˆåŒæ—¶å¤åˆ¶rand
	 * 3 éå†åˆ†ç¦»ï¼ˆåŒæ—¶å¤åˆ¶next
	 */
    public static Node copyListWithRandom(Node head)&#123;
    	if(head == null)&#123; return null; &#125;
    	Node cur = head;
    	Node next = null;
    	// 1
    	while(cur != null)&#123;
    		next = cur.next;
    		cur.next = new Node(cur.value);
    		cur.next.next = next;
    		cur = next;
    	&#125;
    	
    	cur = head;
    	Node curCopy = null;
    	// 2
    	while(cur != null)&#123;
    		next = cur.next.next;
    		curCopy = cur.next;
    		curCopy.rand = cur.rand != null ? cur.rand.next : null;
    		cur = next;
    	&#125;
    	
    	cur = head;
    	Node res = head.next;
    	// 3
    	while(cur != null)&#123;
    		next = cur.next.next;
    		curCopy = cur.next;
    		curCopy.next = cur.next != null ? cur.next.next : null;
    		cur = next;
    	&#125;
    	return res;
	&#125;
	
    /**
     * ä½¿ç”¨hashMapä¸€ä¸€å¯¹åº”å…³ç³»
     * 1 éå†ç¬¬ä¸€éä¸€ä¸€å¯¹åº”
     * 2 éå†ç¬¬äºŒéå¤åˆ¶å…³ç³»
     * @param head
     * @return
     */
	public static Node copyListWithRandom2(Node head)&#123;
		HashMap&lt;Node, Node> map = new HashMap&lt;>();
		Node cur = head;
		// 1 
		while(cur != null)&#123;
			map.put(cur, new Node(cur.value));
			cur = cur.next;
		&#125;
		
		cur = head;
		// 2
		while(cur != null)&#123;
			map.get(cur).next = map.get(cur.next);
			map.get(cur).rand = map.get(cur.rand);
			cur = cur.next;
		&#125;
		
		return map.get(head);
		
	&#125;
&#125;

2 åŠ¨æ€è§„åˆ’
å…·ä½“æ­¥éª¤ å¯ä»¥å‚è€ƒ[é›¶é’±å…‘æ¢](###2 è¿”å›å‡‘é½çš„æ‰€æœ‰æ–¹æ³•æ•°)
åŸºç¡€é—®é¢˜ èƒŒåŒ…é—®é¢˜
/**
 * ä¼ å…¥è´§ç‰©çš„é‡é‡å’Œä»·å€¼ ä¸èƒ½è¶…è¿‡bagèƒŒåŒ…å®¹é‡ï¼Œè¿”å›æœ€å¤§ä»·å€¼
 * 
 * @author chs
 *
 */
public class DP2_knapsack &#123;
	/**
	 * æš´åŠ›é€’å½’
	 */
	public static int maxValue(int[] w, int[] v, int bag) &#123;
		if (w == null || v == null || w.length == 0) &#123;
			return 0;
		&#125;
		return process(w, v, 0, bag);
	&#125;

	public static int process(int[] w, int[] v, int i, int rest) &#123;
		if (rest &lt; 0) &#123;
			return -1;
		&#125;
		if (i == w.length) &#123;
			return 0;
		&#125;
		// åŠ ä¸Ši
		int p1 = process(w, v, i + 1, rest - w[i]);
		// æ²¡åŠ 
		int p2 = process(w, v, i + 1, rest);

		if (p1 != -1) &#123;
			p1 += v[i];
		&#125;
		return Math.max(p1, p2);
	&#125;
   
	/**
	 * åŠ¨æ€è§„åˆ’ç‰ˆ
	 */
	public static int dp(int[] w, int[] v, int bag) &#123;
		if (w == null || v == null || w.length != v.length || w.length == 0) &#123;
			return 0;
		&#125;
		int N = w.length;
		int[][] dp = new int[N + 1][bag + 1];
		for(int i = N - 1; i >= 0; i --)&#123;
			for(int j = 0; j &lt;= bag; j ++)&#123;
				int ans = 0;
				if(j - w[i] >= 0)&#123;
					ans = dp[i + 1][j - w[i]] + v[i];
				&#125;else&#123;
					ans = dp[i + 1][j];
				&#125;
				dp[i][j] = Math.max(dp[i+1][j], ans);
			&#125;
		&#125;
		return dp[0][bag];

	&#125;
	
	
1. æœ€å¤§å­æ•°ç»„å’Œ
ç”¨è´ªå¿ƒ
åªéœ€è¦ä¸€ä¸ªpreåå¤æ›´æ–°è®°å½•ä»¥iä¸ºåº•çš„æœ€å¤§ç´¯åŠ å’Œï¼Œç„¶åmaxå­˜æœ€å¤§çš„
//ç”¨ä¸¤ä¸ªå˜é‡å­˜
	public static int maxSubArray4(int[] nums)&#123;
		if (nums.length == 0 || nums == null) &#123;
			return 0;
		&#125;
        int max = nums[0];
        int pre = 0;
		for(int i = 0; i &lt; nums.length; i++)&#123;
			pre = Math.max(pre + nums[i], nums[i]);
			max = Math.max(pre, max);
        &#125;
		return max;
	&#125;
å¦‚æœéœ€è¦è¿”å›è¯¥å­æ•°ç»„
int res = nums[0], l = 0, r = 0;
for (int i = 0; i &lt; nums.size(); i++) &#123;
	if (nums[i - 1] &lt; 0) &#123;
		l = i;
	&#125;
	nums[i] += max(0, nums[i - 1]);
	if (res &lt; nums[i]) &#123;
		r = i;
		res = nums[i];
	&#125;
&#125;
2. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº maxProfit
(1) ä»å¤´è‡³å°¾ä¹°ä¸€æ¬¡ä¸€è‚¡ è¿”å›æœ€å¤§åˆ©æ¶¦:
éå†ä¸€é minæ ‡è®°ï¼Œ maxæœ€å¤§åˆ©æ¶¦æ›´æ–° å°±æ˜¯æ‰¾åˆ°æœ€ä½ç‚¹å’Œæœ€é«˜ç‚¹
class Solution &#123;
    public int maxProfit(int prices[]) &#123;
        int minprice = Integer.MAX_VALUE;
        int maxprofit = 0;
        for (int i = 0; i &lt; prices.length; i++) &#123;
            if (prices[i] &lt; minprice) &#123;
                minprice = prices[i];
            &#125; else if (prices[i] - minprice > maxprofit) &#123;
                maxprofit = prices[i] - minprice;
            &#125;
        &#125;
        return maxprofit;
    &#125;
&#125;
(2) ä¹°ä¸€è‚¡ä½†æ˜¯å¯ä»¥ä¹°æ— é™æ¬¡
éå†ç´¯åŠ æ‰€æœ‰çš„çˆ¬å¡
// ä¸€è‚¡éšä¾¿ä¹°
	// ç›¸å½“äºåœ¨æ¯æ¬¡çˆ¬å¡å‰åä¹°å– å°†æ‰€æœ‰çˆ¬å¡ç´¯åŠ å°±è¡Œ
	public static int maxProfit2(int[] prices) &#123;
		if (prices == null || prices.length == 0) &#123;
			return 0;
		&#125;
		int ans = 0;
		for(int i = 1; i &lt; prices.length; i++)&#123;
			ans += prices[i] - prices[i - 1] >= 0 ? prices[i] - prices[i - 1] : 0;
		&#125;
		return ans;
	&#125;
3. æœ€é•¿å›æ–‡å­ä¸²
(1) åŠ¨æ€è§„åˆ’O(N^2)


/**
    * è‡ªå·±æ”¹åŠ¨æ€è§„åˆ’
    * @param s
    * @return
    */
   public String longestPalindrome33(String s) &#123;
       if (s.length() &lt; 2) &#123;
           return s;
       &#125;
       char[] str = s.toCharArray();
       int N = str.length;
       boolean[][] dp = new boolean[N][N];
       for(int i = 0; i &lt; N; i++) &#123;
           dp[i][i] = true;
       &#125;
       //è¾¹å¡«dp è¾¹æŠ“æœ€é•¿å’Œè¯¥æœ€é•¿å¼€å§‹èŠ‚ç‚¹
       int max = 1;
       int index = 0;

      //æŒ‰å¯¹è§’çº¿éå† 
      // æœ€å¤–å¾ªç¯ä¸æ˜¯dpçš„åæ ‡
      // iä»£è¡¨äº†n - len æ¯ä¸ªå¾ªç¯è¡Œæ˜¯ä¸å˜çš„ 
      // jæ˜¯æ¨ªåæ ‡L
       for(int i = N - 1; i > 0; i--)&#123;
           for(int L = 0; L &lt; i; L++)&#123;
               int R = L + N - i;
               if(str[L] == str[R])&#123;
                   if(R - L &lt; 3)&#123;
                       dp[L][R] = true;
                   &#125;else&#123;
                       dp[L][R] = dp[L + 1][R - 1];
                   &#125;
               &#125;
               if(dp[L][R] &amp;&amp; R - L + 1 > max)&#123;
                   max = R - L + 1;
                   index = L;	
               &#125;
           &#125;
       &#125;
       return s.substring(index, index + max);
   &#125;
(2) Manacher!
é¢è¯•è®²ä¸€è®²
å‡è®¾å­—ç¬¦ä¸²stré•¿åº¦ä¸ºNï¼Œæƒ³è¿”å›æœ€é•¿å›æ–‡å­ä¸²çš„é•¿åº¦
æ—¶é—´å¤æ‚åº¦O(N)
Manacherç®—æ³•æ ¸å¿ƒ
1ï¼‰ç†è§£å›æ–‡åŠå¾„æ•°ç»„
2ï¼‰ç†è§£æ‰€æœ‰ä¸­å¿ƒçš„å›æ–‡æœ€å³è¾¹ç•ŒRï¼Œå’Œå–å¾—Ræ—¶çš„ä¸­å¿ƒç‚¹C
3ï¼‰ç†è§£ Lâ€¦(iâ€™)â€¦Câ€¦(i)â€¦R çš„ç»“æ„ï¼Œä»¥åŠæ ¹æ®iâ€™å›æ–‡é•¿åº¦è¿›è¡Œçš„çŠ¶å†µåˆ’åˆ†
4ï¼‰æ¯ä¸€ç§æƒ…å†µåˆ’åˆ†ï¼Œéƒ½å¯ä»¥åŠ é€Ÿæ±‚è§£iå›æ–‡åŠå¾„çš„è¿‡ç¨‹
æœ€é•¿å›æ–‡å­ä¸²å°±æ˜¯æˆ‘çŸ¥é“å¯ä»¥è¿›è¡Œã€‚
æœ€é•¿å›æ–‡å­åºåˆ—
å­åºåˆ—å°±æ˜¯ä¸‰ç§æƒ…å†µ L+1 ~R å’Œ L ~ R-1 å’Œ L +1 ~ R - 1
public int longestPalindromeSubseq(String s) &#123;
      public int longestPalindromeSubseq(String s) &#123;
       if(s.length() == 0 || s == "")&#123;
           return 0;
       &#125;

       char[] str = s.toCharArray();
       int N = str.length;
       int[][] dp = new int[N][N];

       for(int i = 0; i &lt; N; i++)&#123;
           dp[i][i] = 1;
       &#125;
       //å¯¹è§’çº¿éå†
       for(int i = N - 1; i >= 0; i--)&#123;
         for(int L = 0; L &lt; i; L++)&#123;
           int R = L + N - i;
           dp[L][R] = Math.max(dp[L + 1][R],dp[L][R - 1]);
           if(str[L] == str[R])&#123;
             dp[L][R] = Math.max(dp[L + 1][R - 1] + 2, dp[L][R]);
           &#125;
				&#125;
       &#125;
       return dp[0][N - 1];
      &#125;
   
4. æœ€é•¿é€’å¢å­åºåˆ—
DPç‰ˆ  O(n^2)
public int lengthOfLIS(int[] nums) &#123;
      if (nums.length == 0) &#123; 
          return 0;
      &#125;
      int[] dp = new int[nums.length];
      dp[0] = 1;
      int maxans = 1;
      for (int i = 1; i &lt; nums.length; i++) &#123;
          dp[i] = 1;
          for (int j = 0; j &lt; i; j++) &#123;
              if (nums[i] > nums[j]) &#123;
                  dp[i] = Math.max(dp[i], dp[j] + 1);
              &#125;
          &#125;
          maxans = Math.max(maxans, dp[i]);
      &#125;
      return maxans;
  &#125;
äºŒåˆ†æŸ¥æ‰¾+è´ªå¿ƒ  O(nlogn)
ç»´æŠ¤ä¸€ä¸ªendæ•°ç»„å­˜å‚¨


end[i] ä»£è¡¨  i+1 é•¿åº¦ä¸‹å­åºåˆ—çš„æœ€åä¸‹æ ‡


len = é€’å¢å­åºåˆ—çš„é•¿ åº¦ - 1ï¼ˆendæ•°ç»„çš„ä¸‹æ ‡ ï¼‰


è®¾å½“å‰å·²æ±‚å‡ºçš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ä¸º lenï¼ˆåˆå§‹æ—¶ä¸º1ï¼‰ï¼Œä»å‰å¾€åéå†æ•°ç»„numsï¼Œåœ¨éå†åˆ° nums[i] æ—¶ï¼š

å¦‚æœ nums[i] &gt;[len] ï¼Œåˆ™[++len] = nums[i]ï¼›
å¦åˆ™ï¼Œåœ¨endæ•°ç»„ä¸­[0 ~ len-1]äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯” nums[i] å°çš„æ•° end[k] ï¼Œå¹¶æ›´æ–° end[k+1]=nums[i]ã€‚

ä»£ç 
public static int lengthOfLIS(int[] nums) &#123;
	if (nums.length == 0 || nums == null) &#123;
		return 0;
	&#125;

	// end[i]å­˜å‚¨ ç¬¬i+1é•¿åº¦ä¸‹å­åºåˆ—çš„æœ€åä¸‹æ ‡
	int[] end = new int[nums.length];
	end[0] = nums[0];//!!!
	// endæ•°ç»„çš„ä¸‹æ ‡ = é€’å¢å­åºåˆ—çš„é•¿åº¦ - 1
	int len = 0;

	// äºŒåˆ†æŸ¥æ‰¾çš„ä¸‹æ ‡

	for (int i = 1; i &lt; nums.length; i++) &#123;
		//
		if (nums[i] > end[len]) &#123;
			end[++len] = nums[i];
		&#125; else &#123;// åœ¨endé‡Œé¢äºŒåˆ†æŸ¥æ‰¾ &lt; num[i] çš„æ•°
			int L = 0;
			int R = len - 1;
			int pos = 0;//å› ä¸ºå¦‚æœæ²¡æœ‰æ¯”ä»–å°çš„ è¯´æ˜éƒ½æ¯”ä»–å¤§ å°±æ›´æ–°çš„æ˜¯end[0]
			while (L &lt;= R) &#123;
				int mid = (R + L) >> 1;
				if(end[mid] &lt; nums[i])&#123;
					pos = mid + 1;//æŠ“ä½å½“å‰å°äºnumiçš„æ•°çš„åé¢ä¸€ä½ åé¢ä¼šæ›´æ–°
					L = mid + 1;
				&#125;else&#123;
					R = mid - 1;
				&#125;
			&#125;
			end[pos] = nums[i];//æ›´æ–°
		&#125;
	&#125;
	return len + 1;
&#125;

5. æ¥é›¨æ°´

å·¦å³ä¸¤ä¸ªæŒ‡é’ˆ left right
å·¦å³ä¸¤ä¸ªå˜é‡å­˜å‚¨å·¦å³æœ€å¤§çš„å€¼
æ¯æ¬¡æ›´æ–°å·¦å³ä»»æ„ä¸€è¾¹é ç€lmaxæˆ–è€…rmaxçš„æŒ‡é’ˆçš„é›¨æ°´å¤§å°
ç›¸å½“äºæ˜¯æŠŠæ¯ä¸€ä¸‹æ ‡ç§¯çš„æ°´ç´¯åŠ ã€‚

ç›¸å½“äºæ˜¯ä»å·¦å³ä¸¤è¾¹æ¥è¿›è¡Œæ›´æ–° å“ªè¾¹çš„maxæœ€å¤§å°±æ¯”è¾ƒé‚£ä¸€è¾¹çš„L/Rä¸maxå¤§å° ç´¯åŠ å¹¶ä¸”æ›´æ–°æœ€å¤§å€¼
æœ€åè¿”å›ç´¯åŠ å’Œ
public int trap(int[] arr) &#123;
	int ans = 0;
	int L = 1;
	int R = arr.length - 2;
	int leftMax = arr[0];
	int rightMax = arr[arr.length - 1];z
	while(L &lt;= R) &#123; // ï¼ï¼ï¼ï¼ &lt;=
		if(leftMax &lt;= rightMax) &#123;
			ans += Math.max(0, leftMax - arr[L]);
			leftMax = Math.max(leftMax, arr[L++]);
		&#125;else &#123;
			ans += Math.max(0, rightMax - arr[R]);
			rightMax = Math.max(rightMax, arr[R--]);
		&#125;
	&#125;
	
	return ans;
&#125;
6. æœ€é•¿ä¸Šå‡å­åºåˆ—
è®¾å½“å‰å·²æ±‚å‡ºçš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ä¸º lenï¼ˆåˆå§‹æ—¶ä¸º1ï¼‰ï¼Œä»å‰å¾€åéå†æ•°ç»„numsï¼Œåœ¨éå†åˆ° nums[i] æ—¶ï¼š

å¦‚æœ nums[i] d[len] ï¼Œåˆ™ç›´æ¥åŠ å…¥åˆ° ddd æ•°ç»„æœ«å°¾ï¼Œå¹¶æ›´æ–° len= len+1ï¼›
å¦åˆ™ï¼Œåœ¨ dæ•°ç»„ä¸­äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯” nums[i] å°çš„æ•° d[k] ï¼Œå¹¶æ›´æ–° d[k+1]=nums[i].

/**
	 * è¿™é“é¢˜è¦ç”¨ äºŒåˆ†æŸ¥æ‰¾å’Œè´ªå¿ƒ
	 * æš´åŠ›é€’å½’XXXä¸ç”¨äº†è€å­ 
	 * @param nums
	 * @return
	 */
	public static int lengthOfLIS(int[] nums) &#123;
		if (nums.length == 0 || nums == null) &#123;
			return 0;
		&#125;

		// end[i]å­˜å‚¨ ç¬¬i+1é•¿åº¦ä¸‹å­åºåˆ—çš„æœ€åä¸‹æ ‡
		int[] end = new int[nums.length];
		end[0] = nums[0];
		// endæ•°ç»„çš„ä¸‹æ ‡ = é€’å¢å­åºåˆ—çš„é•¿åº¦ - 1
		int len = 0;

		// äºŒåˆ†æŸ¥æ‰¾çš„ä¸‹æ ‡
		for (int i = 1; i &lt; nums.length; i++) &#123;
			//
			if (nums[i] > end[len]) &#123;
				end[++len] = nums[i];
			&#125; else &#123;// åœ¨endé‡Œé¢äºŒåˆ†æŸ¥æ‰¾ &lt; num[i] çš„æ•°
				int L = 0;
				int R = len - 1;
				int pos = 0;//å› ä¸ºå¦‚æœæ²¡æœ‰æ¯”ä»–å°çš„ è¯´æ˜éƒ½æ¯”ä»–å¤§ å°±æ›´æ–°çš„æ˜¯end[0]
				while (L &lt;= R) &#123;
					int mid = (R + L) >> 1;
					if(end[mid] &lt; nums[i])&#123;
						pos = mid + 1;//æŠ“ä½å½“å‰å°äºnumiçš„æ•°çš„åé¢ä¸€ä½ åé¢ä¼šæ›´æ–°
						L = mid + 1;
					&#125;else&#123;
						R = mid - 1;
					&#125;
				&#125;
				end[pos] = nums[i];//æ›´æ–°
			&#125;
		&#125;
		return len + 1;
	&#125;

7. çˆ¬æ¥¼æ¢¯
é€’å½’ ç¬”è¯•
çŠ¶æ€è½¬ç§»æ–¹ç¨‹ f(n) = f(n - 1) + f(n - 2); ----&gt; å¯ä»¥çœ‹å‡ºå°±æ˜¯æ–æ³¢æ‹‰å¥‘æ•°åˆ—
ç”¨ä¸‰ä¸ªå¸¸é‡æ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸ºO(1)
class Solution &#123;
    public int climbStairs(int n) &#123;
        int p = 0, q = 0, r = 1;
        for (int i = 1; i &lt;= n; ++i) &#123;
            p = q; 
            q = r; 
            r = p + q;
        &#125;
        return r;
    &#125;+
&#125;

çŸ©é˜µå¿«é€Ÿå¹‚ o(logn)

public class Code4_ClimbStairs &#123;
	public static int climbStairs(int n) &#123;
		if (n == 0) &#123;
			return 0;
		&#125;
		// [ 1 ,1 ]
		// [ 1, 0 ]
		int[][] base = &#123; &#123; 1, 1 &#125;, &#123; 1, 0 &#125; &#125;;
		int[][] res = matrixPower(base, n);
		return res[0][0]; 
    // å¦‚æœæ˜¯æ–æ³¢æ‹‰å¥‘æ•°åˆ— å°±è¦ä»1 1 2 3 5 
    // è¿”å›çš„å°±æ˜¯res[0][0]+res[0][1]
	&#125;

  /*
  å¿«é€Ÿå¹‚ æ–¹æ³•å°±æ˜¯å°†æŒ‡æ•°å¾ªç¯ æ¯æ¬¡å¾ªç¯å†…çŸ©é˜µå¹³æ–¹ ç„¶åæŒ‡æ•°å³ç§»ä¸€ä½
  */
	public static int[][] matrixPower(int[][] m, int p) &#123;
    // resåˆå§‹åŒ–ä¸ºå•ä½1
		int[][] res = &#123;&#123;1, 0 &#125;, &#123;0,1&#125;&#125;;
    // m ---> ä¸€æ¬¡æ–¹
		int[][] tmp = m;
		for (; p != 0; p >>= 1) &#123;
			if ((p &amp; 1) != 0) &#123; // ï¼ï¼ï¼å…ˆä¹˜ä¸€æ¬¡æ–¹ æ³¨æ„æ˜¯ä¸ç­‰äº0 
				res = muliMatrix(res, tmp);
			&#125;
			tmp = muliMatrix(tmp, tmp);
		&#125;
		return res;
	&#125;
	public static int[][] muliMatrix(int[][] m1, int[][] m2) &#123;
		int[][] res = new int[m1.length][m2[0].length];
		for (int i = 0; i &lt; m1.length; i++) &#123;
			for (int j = 0; j &lt; m2[0].length; j++) &#123;
				for (int k = 0; k &lt; m2.length; k++) &#123;
					res[i][j] += m1[i][k] * m2[k][j]; // k = m1çš„åˆ— = m2çš„è¡Œ
				&#125;
			&#125;
		&#125;
		return res;
	&#125;
ä¸»è¦å°±æ˜¯æ³¨æ„å¿«é€Ÿå¹‚é‡Œé¢è¦å…ˆè¿›è¡Œ ä¸€æ¬¡æ–¹çš„åˆ¤æ–­
8. ç¼–è¾‘è·ç¦»(dp3)
DP æ ·æœ¬å¯¹åº”æ¨¡å‹ï¼šå¾€å¾€ç”¨æœ€åçš„ä½ç½®æ¥åˆ¤æ–­å¯èƒ½æ€§
ç»™ä¸¤ä¸ªå•è¯ï¼Œè¿”å›ç¬¬ä¸€ä¸ªå•è¯è½¬æ¢ä¸ºç¬¬äºŒä¸ªå•è¯æœ€å°‘çš„æ“ä½œæ•°ï¼Œ æœ‰å¢åˆ æ”¹ä¸‰ç§æ“ä½œ
ï¼ˆæ‰©å±•ï¼šå¯ä»¥å¢åŠ a d cåˆ†åˆ«ä»£è¡¨å¢åˆ æ”¹çš„ä»£ä»·ï¼‰
æ ¹æ®æœ€åä¸€ä¸ªä½ç½®æœ‰å››ç§å¯èƒ½
public class DP3_EditDistance &#123;
		public int minDistance(String word1, String word2) &#123;
      	if(word1 == null || word2 == null) &#123;
          return 0;
        &#125;
       char[] str1 = word1.toCharArray();
        char[] str2 = word2.toCharArray();
        int N = str1.length; 
        int M = str2.length;
        int[][] dp = new int[N+1][M+1];
        // 1 å¤„ç†è¾¹ç•Œï¼šå…¶ä¸­æœ‰å­—ç¬¦ä¸²æ˜¯ç©ºçš„æƒ…å†µ å…¨æ˜¯å¢åŠ æ“ä½œ
        for(int i = 0; i &lt;= N; i++) &#123;
            dp[i][0] = i;
        &#125; 
        for(int i = 0; i &lt;= M; i++) &#123;
            dp[0][i] = i;
        &#125;

        // 2 æ™®é€šæƒ…å†µ ä»æœ€åä½ç½®æ¯”è¾ƒword1è¯¥å¦‚ä½•å¤„ç†
        for(int i = 1; i &lt;= N; i++) &#123;
            for(int j = 1; j &lt;= M; j++) &#123;
                // 2.1 æœ€åä¸€ä¸ªä½ç½®ä¿®æ”¹æˆ–è€…ä¿ç•™
                if(str1[i- 1] == str2[j - 1]) &#123;// ï¼ï¼ï¼ æ³¨æ„
                    dp[i][j] = dp[i - 1][j - 1];
                &#125; else &#123;
                    dp[i][j] = dp[i - 1][j - 1] + 1;
                &#125;
                // 2.2 æœ€åä¸€ä¸ªä½ç½®åˆ é™¤
                dp[i][j] = Math.min(dp[i- 1][j] + 1, dp[i][j]);
                // 2.3 æœ€åä¸€ä¸ªä½ç½®å¢åŠ  
                dp[i][j] = Math.min(dp[i][j - 1] + 1, dp[i][j]);
            &#125;
        &#125;
        return dp[N][M];
&#125;
âš ï¸ å› ä¸ºæœ‰ä¸º0çš„æƒ…å†µ æ‰€ä»¥æ€»çš„å°±æ˜¯[0, N] æ‰€ä»¥å¾ªç¯èŒƒå›´éœ€è¦æ˜¯[0,N]  å¹¶ä¸”strä¸‹æ ‡ å¯¹åº” dpä¸‹æ ‡å‡ä¸€

9. æœ€é•¿å…¬å…±å­åºåˆ—(dp3)

âš ï¸å¡«è¾¹ç•Œçš„æ—¶å€™å…ˆå°†dp[0][0]å¡«äº† é˜²æ­¢ i - 1 è¶Šç•Œ
public int longestCommonSubsequence(String text1, String text2) &#123;
        if(text1 == null || text2 == null) &#123;
            return 0;
        &#125;
        char[] str1 = text1.toCharArray();
        char[] str2 = text2.toCharArray();
        int[][] dp = new int[str1.length][str2.length];
        // 1 å¡«å®Œç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—
        dp[0][0] = str1[0] == str2[0] ? 1 : 0; // !!!
        for(int i = 1; i &lt; str2.length; i++) &#123;
           dp[0][i] = str1[0] == str2[i] ? 1 : dp[0][i - 1];
        &#125; 
        for(int i = 1; i &lt; str1.length; i++) &#123;
           dp[i][0] = str1[i] == str2[0] ? 1 : dp[i - 1][0];

        &#125;

        // 2 æŒ‰æ¯è¡Œæ²¡åˆ—å¡«
        for(int i = 1; i &lt; str1.length; i++) &#123;
            for(int j = 1; j &lt; str2.length; j++) &#123;
              // 1 ä¸çœ‹å½“å‰çš„æƒ…å†µ æ¯”è¾ƒ[i - 1]å’Œ[j ]æˆ–è€…[ i]å’Œ[j - 1]
                int p1 = dp[i - 1][j];
                int p2 = dp[i][j - 1];
              // 2 å°†è¿™ä¸ªä½ç½®çš„æƒ…å†µçº³å…¥ æ¯”è¾ƒ [i]å’Œ [j]
                int p3 = str1[i] == str2[j] ? dp[i - 1][j - 1] + 1 : dp[i - 1][j - 1];
                dp[i][j] = Math.max(p1, Math.max(p2, p3));
            &#125;
        &#125;
        return dp[str1.length - 1][str2.length - 1];


    &#125;
10 æœ€å°è·¯å¾„å’Œ

m âœ–ï¸n çš„ç½‘æ ¼ ä»å·¦ä¸‹è§’èµ°åˆ°å³ä¸‹è§’ æ€ä¹ˆèµ°è·¯å¾„æœ€çŸ­

âš ï¸[1, 1] å¼€å§‹å¡«è¡¨
public int minPathSum2(int[][] grid) &#123;
        if (grid == null || grid.length == 0) &#123;
            return 0;
        &#125;

        int m = grid.length;
        int n = grid[0].length;
        int[][] dp = new int[m][n];
        dp[0][0] = grid[0][0];

        for (int i = 1; i &lt; m; i++) &#123; // !!! æ³¨æ„åˆ«å†™åäº†
            dp[i][0] = dp[i - 1][0] + grid[i][0];
        &#125;
        for (int j = 1; j &lt; n; j++) &#123;
            dp[0][j] = dp[0][j - 1] + grid[0][j];
        &#125;
        for (int i = 1; i &lt; m; i++) &#123;
            for (int j = 1; j &lt; n; j++) &#123;
                dp[i][j] = Math.min(dp[i - 1][j], dp[i][j - 1]) + grid[i][j];
            &#125;
        &#125;
        return dp[m - 1][n - 1];
    &#125;

æ‰©å±•
è®°å½•è·¯å¾„ä¹Ÿå¯ä»¥å¼€ä¸€ä¸ªå­—å…¸ï¼Œåº”è¯¥çŸ¥é“äº†æ¯ä¸ª [i,j] ä¸Šä¸€ä¸ªæ¥æºåæ ‡ lastï¼Œ path[(i,j)] = (lasti,lastj)ï¼Œæœ€åç”¨ä¸€ä¸ªæ­»å¾ªç¯è¾“å‡ºæ‰€æœ‰pathï¼Œå½“ (i,j) == (0,0 ) æ—¶å€™é€€å‡º ç„¶åæœ€åè¿›è¡Œä¸€ä¸ªæ­»å¾ªç¯ å°±å¯ä»¥å°†å¾ªç¯æ‰“å‡ºæ¥äº†
ä¸åŒè·¯å¾„

m âœ–ï¸n çš„ç½‘æ ¼ ä»å·¦ä¸‹è§’èµ°åˆ°å³ä¸‹è§’ æœ‰å¤šå°‘ç§èµ°æ³• ï¼ˆæ–¹æ³•æ•°ï¼‰

public int uniquePaths(int m, int n) &#123;
        int[][] dp = new int[m][n];

        for(int i = 0; i &lt; m; i++) &#123;
            dp[i][0] = 1;

        &#125;
        for(int i = 0; i &lt; n; i++) &#123;
            dp[0][i] = 1;

        &#125;

        for(int i = 1; i &lt; m; i++) &#123;
            for(int j = 1; j &lt; n; j++) &#123;
                dp[i][j] = dp[i - 1][j]+ dp[i][j - 1];
            &#125;
        &#125;
        return dp[m-1][n-1];
    &#125;
11  æœ€é•¿å…¬å…±å­æ•°ç»„(æœ€é•¿é‡å¤å­æ•°ç»„)

æ³¨æ„çš„è¿˜æ˜¯è¾¹ç•Œï¼› åº”ä¸ºéœ€è¦æœ€å¼€å§‹çš„çŠ¶æ€æ¥ä¾èµ– æ‰€ä»¥è¦ä¸é€‰æ‹©dpå¤–å›´åŠ ä¸€åœˆ è¦ä¸å°±æ˜¯dpå†…å›´å¾ªç¯ä»1å¼€å§‹


public int findLength(int[] A, int[] B) &#123;
		int n = A.length, m = B.length;
		int[][] dp = new int[n + 1][m + 1];
		int ans = 0;
		for (int i = n - 1; i >= 0; i--) &#123;
			for (int j = m - 1; j >= 0; j--) &#123;
				dp[i][j] = A[i] == B[j] ? dp[i + 1][j + 1] + 1 : 0;
				ans = Math.max(ans, dp[i][j]);
			&#125;
		&#125;
		return ans;
	&#125;

public int findLength(int[] nums1, int[] nums2) &#123;
       int[][] dp = new int[nums1.length+1][nums2.length+1];
       int ans = 0;
       for(int i = 1; i &lt;= nums1.length;i++) &#123;
           for(int j = 1; j &lt;= nums2.length; j++) &#123;
               dp[i][j] = nums1[i-1] == nums2[j-1] ? dp[i - 1][j - 1] + 1 : 0; //ï¼ï¼ï¼
               ans = Math.max(dp[i][j], ans);
           &#125;
       &#125;
       return ans;
   &#125;
12 é›¶é’±å…‘æ¢é—®é¢˜ &lt;å®Œå…¨èƒŒåŒ…&gt;(dp4) éš¾
å…³äºèƒŒåŒ…é—®é¢˜ åƒé€èƒŒåŒ…æ‰€æœ‰é—®é¢˜
ä»å·¦å‘å³çš„å°è¯•æ¨¡å‹

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ coins ï¼Œè¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼›ä»¥åŠä¸€ä¸ªæ•´æ•° amount ï¼Œè¡¨ç¤ºæ€»é‡‘é¢ã€‚

1 è¿”å›éœ€è¦æœ€å°‘çš„ç¡¬å¸ä¸ªæ•°

è®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„ æœ€å°‘ç¡¬å¸ä¸ªæ•° ã€‚
æ¯ä¸ªç¡¬å¸éƒ½å¯ä»¥è¯´ä½¿ç”¨æ— é™æ¬¡ã€‚

åŠ¨æ€è§„åˆ’
public int coinChange(int[] arr, int aim) &#123;
        if (aim == 0) &#123;
			return 0;
		&#125;
		int N = arr.length;
		int[][] dp = new int[N + 1][aim + 1];
		dp[N][0] = 0;
		for (int j = 1; j &lt;= aim; j++) &#123;
			dp[N][j] = Integer.MAX_VALUE;
		&#125;
		for (int index = N - 1; index >= 0; index--) &#123;
			for (int rest = 0; rest &lt;= aim; rest++) &#123;
				dp[index][rest] = dp[index + 1][rest];// ä¸‹è¾¹
				if (rest - arr[index] >= 0 
						&amp;&amp; dp[index][rest - arr[index]] != Integer.MAX_VALUE) &#123;
          // æœ€å°å€¼ ç›¸å½“äºï¼ˆ å·¦è¾¹+1ï¼‰ä¸ï¼ˆä¸‹è¾¹ ï¼‰è¿›è¡Œæ¯”è¾ƒ
					dp[index][rest] = Math.min(dp[index][rest], dp[index][rest - arr[index]] + 1);
				&#125;
			&#125;
		&#125;
		return dp[0][aim] == Integer.MAX_VALUE ? -1 : dp[0][aim];// æ— è§£æƒ…å†µè¿”å›-1
    &#125;
2 è¿”å›å‡‘é½çš„æ‰€æœ‰æ–¹æ³•æ•°

è¿”å›ç¡¬å¸æˆ–è€…è´§å¸å¯ä»¥å‡‘é½é’±çš„æ‰€æœ‰æ–¹æ³•æ•°

æš´åŠ›é€’å½’çš„å°è¯•

public static int coinsWay(int[] arr, int aim) &#123;
		if (arr == null || arr.length == 0 || aim &lt; 0) &#123;
			return 0;
		&#125;
		return process(arr, 0, aim);
	&#125;

	// arr[index....] æ‰€æœ‰çš„é¢å€¼ï¼Œæ¯ä¸€ä¸ªé¢å€¼éƒ½å¯ä»¥ä»»æ„é€‰æ‹©å¼ æ•°ï¼Œç»„æˆæ­£å¥½restè¿™ä¹ˆå¤šé’±ï¼Œæ–¹æ³•æ•°å¤šå°‘ï¼Ÿ
	public static int process(int[] arr, int index, int rest) &#123;
		if (index == arr.length) &#123; // æ²¡é’±äº†
			return rest == 0 ? 1 : 0;
		&#125;
		int ways = 0;
		for (int zhang = 0; zhang * arr[index] &lt;= rest; zhang++) &#123; 
			ways += process(arr, index + 1, rest - (zhang * arr[index]));
		&#125;
		return ways;
	&#125;


è¯´æ˜æ˜¯æœ‰é‡å¤è§£çš„,æ‰€ä»¥å¯ä»¥è¿›ä¸€æ­¥è¿›è¡Œè®°å¿†åŒ–æœç´¢
è®°å¿†åŒ–æœç´¢
å°±æ˜¯ç”¨ä¸€ä¸ªç»“æ„å­˜å‚¨f(i, rest)ç»“æœ åé¢å°±ä¸ä¼šé‡å¤è§£

å¦‚æœè¯¥é¢˜æ²¡æœ‰æšä¸¾è¡Œä¸ºé‚£ä¹ˆå‚»ç¼“å­˜çš„æ–¹æ³•å’Œä¸¥æ ¼è¡¨ç»“æ„ï¼ˆåŠ¨æ€è§„åˆ’ï¼‰çš„æ–¹æ³•å°±æ˜¯ä¸€æ ·çš„ã€‚
ä¸¥æ ¼çš„è¡¨ç»“æ„ï¼š å°±æ˜¯åœ¨è®°å¿†åŒ–æœç´¢çš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥æ¢³ç†äº†ä¾èµ–å…³ç³»ï¼Œä»ç®€å•ä½ç½®ç®—å‡ºå¤æ‚ä½ç½®ï¼Œä¸¥æ ¼è§„å®šå¥½äº†è®¡ç®—é¡ºåº
æœ‰æšä¸¾è¡Œä¸ºï¼šéœ€è¦æå‡ºä¸¥æ ¼çš„è¡¨ç»“æ„è¿›è¡Œç»§ç»­ä¼˜åŒ–ã€‚
åŠ¨æ€è§„åˆ’
ç¬¬ä¸€ç‰ˆdp:æœ‰æšä¸¾è¡Œä¸ºï¼Œå’Œä¸Šé¢è®°å¿†åŒ–æœç´¢çš„æ–¹æ³•æ˜¯ç­‰æ•ˆçš„
public static int dp1(int[] arr, int aim) &#123;
		if (arr == null || arr.length == 0 || aim &lt; 0) &#123;
			return 0;
		&#125;
		int N = arr.length;
		int[][] dp = new int[N + 1][aim + 1];
		dp[N][0] = 1;
		for (int index = N - 1; index >= 0; index--) &#123;
			for (int rest = 0; rest &lt;= aim; rest++) &#123;
				int ways = 0;
				for (int zhang = 0; zhang * arr[index] &lt;= rest; zhang++) &#123;
					ways += dp[index + 1][rest - (zhang * arr[index])];
				&#125;
				dp[index][rest] = ways;
			&#125;
		&#125;
		return dp[0][aim];
	&#125;
ç¬¬äºŒç‰ˆï¼šå°†æšä¸¾è¡Œä¸ºçš„è§„å¾‹æ‰¾å‡ºæ¥ï¼Œåˆ©ç”¨ä¸¥æ ¼çš„è¡¨ç»“æ„


public int coinChange(int[] coins, int amount) &#123;
		if (coins == null || coins.length == 0 || amount &lt; 0) &#123;
			return 0;
		&#125;
		int N = coins.length;
		int[][] dp = new int[N + 1][amount + 1];
		dp[N][0] = 1;
		for (int index = N - 1; index >= 0; index--) &#123;
			for (int rest = 0; rest &lt;= amount; rest++) &#123;
				dp[index][rest] = dp[index + 1][rest];
				if (rest - coins[index] >= 0) &#123;
					dp[index][rest] += dp[index][rest - coins[index]];
				&#125;
			&#125;
		&#125;
		return dp[0][amount];
	&#125;
	
3 æœ€ç»ˆä»£ç 
é›¶é’±å…‘æ¢1
public int coinChange(int[] arr, int aim) &#123;
        if (aim == 0) &#123;
			return 0;
		&#125;
		int N = arr.length;
		int[][] dp = new int[N + 1][aim + 1];
		dp[N][0] = 0;
		for (int j = 1; j &lt;= aim; j++) &#123;
			dp[N][j] = Integer.MAX_VALUE;
		&#125;
		for (int index = N - 1; index >= 0; index--) &#123;
			for (int rest = 0; rest &lt;= aim; rest++) &#123;
				dp[index][rest] = dp[index + 1][rest];
				if (rest - arr[index] >= 0 
						&amp;&amp; dp[index][rest - arr[index]] != Integer.MAX_VALUE) &#123;
          // æœ€å°å€¼åˆ¤æ–­
					dp[index][rest] = Math.min(dp[index][rest], dp[index][rest - arr[index]] + 1);
				&#125;
			&#125;
		&#125;
		return dp[0][aim] == Integer.MAX_VALUE ? -1 : dp[0][aim];// æ— è§£æƒ…å†µè¿”å›-1
    &#125;

/*
* ä¸€ç»´ éš¾ç†è§£
*/
public int coinChange(int[] coins, int amount) &#123;
        int max = amount + 1;
        int[] dp = new int[amount + 1];
        Arrays.fill(dp, max);
        dp[0] = 0;
        for (int i = 1; i &lt;= amount; i++) &#123;
            for (int j = 0; j &lt; coins.length; j++) &#123;
                if (coins[j] &lt;= i) &#123;
                    dp[i] = Math.min(dp[i], dp[i - coins[j]] + 1);
                &#125;
            &#125;
        &#125;
        return dp[amount] > amount ? -1 : dp[amount];

    &#125;
é›¶é’±å…‘æ¢2
public int coinChange(int[] coins, int amount) &#123;
		if (coins == null || coins.length == 0 || amount &lt; 0) &#123;
			return 0;
		&#125;
		int N = coins.length;
		int[][] dp = new int[N + 1][amount + 1];
		dp[N][0] = 1;
		for (int index = N - 1; index >= 0; index--) &#123;
			for (int rest = 0; rest &lt;= amount; rest++) &#123;
				dp[index][rest] = dp[index + 1][rest];
				if (rest - coins[index] >= 0) &#123;
					dp[index][rest] += dp[index][rest - coins[index]];
				&#125;
			&#125;
		&#125;
		return dp[0][amount];
	&#125;
/*
* ä¸€ç»´ ä¸æ˜¯å¾ˆå¥½ç†è§£æ€•å†™é”™
*/
public int change(int amount, int[] coins) &#123;
        int[] dp = new int[amount + 1];
        dp[0] = 1;
        for (int coin : coins) &#123;
            for (int i = coin; i &lt;= amount; i++) &#123;
                dp[i] += dp[i - coin];
            &#125;
        &#125;
        return dp[amount];
    &#125;
13 æœ€é•¿æœ‰æ•ˆæ‹¬å·

ç»™ä½ ä¸€ä¸ªåªåŒ…å« '(' å’Œ ')' çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºæœ€é•¿æœ‰æ•ˆï¼ˆæ ¼å¼æ­£ç¡®ä¸”è¿ç»­ï¼‰æ‹¬å·å­ä¸²çš„é•¿åº¦ã€‚

æ€è·¯ï¼š
    æ˜¯å­ä¸²ç±»å‹ï¼Œçœ‹ä»¥iç»“å°¾
1 å¦‚æœå½“å‰æ˜¯â€˜ï¼‰â€™ å°±æ‰¾å¯ä»¥å’Œä»–é…å¯¹çš„æœ€å‰å·¦æ‹¬å·preä¸‹æ ‡
   pre = i - dp[i - 1] - 1; 
           ï¼ˆdp[i - 1] å‰ä¸€ä¸ªå·²ç»é…å¥½å¯¹çš„é•¿åº¦ 
2 å¦‚æœpreæ˜¯å·¦æ‹¬å·(æ³¨æ„pre>= 0 é˜²æ­¢è¶Šç•Œ) 
     æ›´æ–°dp[i] == 2 + dp [i - 1]+ (pre > 0? dp [pre - 1] : 0);
public int longestValidParentheses(String s) &#123;
        if(s == null || s.length()== 0) &#123;
            return 0;
        &#125;
        char[] str= s.toCharArray();
        int[] dp = new int[s.length()];
        int max = 0;
        for(int i = 1; i &lt; str.length; i++) &#123;
            if( str[i] == ')') &#123; 
                int pre = i - dp[i - 1] - 1;
                if( pre >= 0 &amp;&amp; str[pre] == '(' ) &#123; // !! pre >= 0åœ¨å‰ pre 
                    dp[i] = 2 + dp[i - 1] + (pre > 0? dp[pre - 1] : 0);  //!!! pre -1 
                &#125;
            &#125;
            max = Math.max(dp[i], max);

        &#125;
        return max;
    &#125;
14 æ‰“å®¶åŠ«èˆ

ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚
ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½  ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä¸€å¤œä¹‹å†…èƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚
é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/house-robber

public int rob(int[] nums) &#123;
       if (nums == null || nums.length == 0) &#123;
           return 0;
       &#125;
       if (nums.length == 1) &#123; // ï¼ï¼ï¼ 
           return nums[0];
       &#125;
       int n = nums.length;
       int[] dp = new int[n];
       dp[0] = nums[0];
       dp[1] = Math.max(dp[0], nums[1]); // ï¼ï¼!æ³¨æ„è¦å°†[0][1] å…ˆå¡« iä»2å¼€å§‹
       for(int i = 2; i &lt; n; i++) &#123;
           int p1 = nums[i];
           int p2 = dp[i - 1];
           int p3 = nums[i] + dp[i - 2];
           dp[i] = Math.max(p1, Math.max(p2, p3));
       &#125;
       return dp[n - 1];
   &#125;
æ‰“å®¶åŠ«èˆâ…¡

è¿™ä¸ªåœ°æ–¹æ‰€æœ‰çš„æˆ¿å±‹éƒ½ å›´æˆä¸€åœˆ ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªæˆ¿å±‹å’Œæœ€åä¸€ä¸ªæˆ¿å±‹æ˜¯ç´§æŒ¨ç€çš„ã€‚

æ˜¯æ»šåŠ¨æ•°ç»„ï¼Œå¯ä»¥åˆ†æˆä¸¤ä¸ªæ•°ç»„æ¥åˆ¤æ–­[0]-[N-2] å’Œ [1]-[N-1]
public int rob(int[] nums) &#123;
        if (nums == null || nums.length == 0) &#123;
        return 0;
    &#125;
    if (nums.length == 1) &#123;
        return nums[0];
    &#125;
    if (nums.length == 2) &#123;
        return Math.max(nums[0], nums[1]);
    &#125;
        int[] dp = new int[nums.length];
        dp[0] = nums[0];
        dp[1] = Math.max(nums[0], nums[1]);
        for(int i = 2; i &lt; nums.length-1; i++) &#123;
            int p1 = nums[i];
            int p2 = dp[i - 1];
            int p3 = dp[i - 2] + nums[i];
            dp[i] = Math.max(p1, Math.max(p2, p3));
        &#125;
        int ans1 = dp[nums.length - 2];

        dp[1] = nums[1];
        dp[2] = Math.max(nums[1], nums[2]);
        for(int i = 3; i &lt; nums.length; i++) &#123;
            int p1 = nums[i];
            int p2 = dp[i - 1];
            int p3 = dp[i - 2] + nums[i];
            dp[i] = Math.max(p1, Math.max(p2, p3));
        &#125;
        int ans2 = dp[nums.length - 1];
        return Math.max(ans1, ans2);
        
    &#125;

15 çŸ©é˜µçš„é€’å¢è·¯å¾„

ç»™å®šä¸€ä¸ª m x n æ•´æ•°çŸ©é˜µ matrix ï¼Œæ‰¾å‡ºå…¶ä¸­ æœ€é•¿é€’å¢è·¯å¾„ çš„é•¿åº¦ã€‚
å¯¹äºæ¯ä¸ªå•å…ƒæ ¼ï¼Œä½ å¯ä»¥å¾€ä¸Šï¼Œä¸‹ï¼Œå·¦ï¼Œå³å››ä¸ªæ–¹å‘ç§»åŠ¨ã€‚ ä½  ä¸èƒ½ åœ¨ å¯¹è§’çº¿ æ–¹å‘ä¸Šç§»åŠ¨æˆ–ç§»åŠ¨åˆ° è¾¹ç•Œå¤–ï¼ˆå³ä¸å…è®¸ç¯ç»•ï¼‰ã€‚


public static int longestIncreasingPath(int[][] matrix) &#123;
	int ans = 0;
	int N = matrix.length;
	int M = matrix[0].length;
	int[][] dp = new int[N][M];
	for (int i = 0; i &lt; N; i++) &#123;
		for (int j = 0; j &lt; M; j++) &#123;
			ans = Math.max(ans, process1(matrix, i, j, dp));
		&#125;
	&#125;
	return ans;
&#125;
private static int process1(int[][] m, int i, int j,int[][] dp) &#123;
	if(dp[i][j] != 0)&#123;//å­˜äº†æ•°å°±ä¸ç”¨å†ç®—äº†
		return dp[i][j];
	&#125;
	// ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘
	int up = i > 0 &amp;&amp; m[i][j] &lt; m[i - 1][j] ? process1(m, i - 1, j, dp) : 0;
	int down = i &lt; (m.length - 1) &amp;&amp; m[i][j] &lt; m[i + 1][j] ? process1(m,
			i + 1, j, dp) : 0;
	int left = j > 0 &amp;&amp; m[i][j] &lt; m[i][j - 1] ? process1(m, i, j - 1,dp) : 0;
	int right = j &lt; (m[0].length - 1) &amp;&amp; m[i][j] &lt; m[i][j + 1] ? process1(
			m, i, j + 1, dp) : 0;
	int ans = Math.max(Math.max(up, down), Math.max(left, right)) + 1;
	dp[i][j] = ans;
	return ans;
&#125;
16 æœºå™¨äººwalk
/*
 * æœºå™¨äººåœ¨né•¿åº¦çš„æ•°ç»„ä¸­ï¼Œä½ç½®åœ¨Mï¼Œè¦èµ°kæ­¥åˆ°pï¼Œæœ‰å¤šå°‘ç§æ–¹æ³•
 */
public class DP_RobortWalk &#123;
	/* 1
	 * æš´åŠ›é€’å½’å°è¯•
	 * æ¯æ¬¡èµ°ä¸€æ­¥ï¼š 1. rest - 1 ï¼›2. ä½ç½®curæ›´æ–°
	 */
	public static int way1(int N, int M, int K, int P)&#123;
		if (N &lt; 2 || M &lt; 1 || M > N || P &lt; 1 || P > N || K &lt; 1) &#123;
			return -1;
		&#125;
		return process1(N, M, K, P);
	&#125; 
	
	// 1 å½“å‰©ä¸‹0æ­¥ ï¼šåˆ°äº†aim è¿”å›1;æ²¡åˆ° è¿”å›0
	// 2 ä¸¤ä¸ªè¾¹ç•Œæ¡ä»¶
	// 3 è¿”å›é€’å½’ç»“æœ
	public static int process1(int n, int cur, int rest, int aim)&#123;
		// 1 
		if(rest == 0 )&#123;// base case
			return cur == aim ? 1 : 0;
		&#125;
		// 2
		if(cur == 1)&#123;
			return process1(n, 2, rest - 1, aim);
		&#125;
		if(cur == n)&#123;
			return process1(n, n - 1, rest - 1, aim);
		&#125;
		// 3
		return process1(n, cur - 1, rest - 1, aim) +  process1(n, cur + 1, rest - 1, aim);
	&#125;

	
	/*
	 * DP:ç›´æ¥ä½¿ç”¨çŸ©é˜µæ¥æ›¿ä»£é€’å½’çš„è¿‡ç¨‹
	 */
	public static int way3(int N,int M, int K, int P)&#123;
		if (N &lt; 2 || M &lt; 1 || M > N || P &lt; 1 || P > N || K &lt; 1) &#123;
			return -1;
		&#125;
		int[][] dp = new int[N + 1][K + 1];
		// 1
		dp[P][0] = 1;//base case 
		for (int rest = 1; rest &lt;= K; rest++) &#123;
			// 2
			dp[1][rest] = dp[2][rest - 1];
			dp[N][rest] = dp[N - 1][rest - 1];
			// 3
			for (int cur = 2; cur &lt; N; cur++) &#123;
				dp[cur][rest] = dp[cur - 1][rest - 1] + dp[cur + 1][rest - 1];
			&#125;
			
		&#125;
		return dp[M][K];
	&#125;
	
	public static void main(String[] args) &#123;
		System.out.println(way1(4, 2, 3, 3));
		System.out.println(way3(4, 2, 3, 3));
	&#125;
&#125;

17 çº¸ç‰Œåšå¼ˆ
/* çº¸ç‰Œåšå¼ˆé—®é¢˜
 * ä¸¤ä¸ªä¼šé¢„åˆ¤çš„äºº ä»å·¦å³é€‰å¡ç‰‡ è¿”å›èƒœåˆ©çš„äººçš„åˆ†æ•°
 */
public class DP1_TwoSmartManPeekCard &#123;

	
    public static int win1(int[] arr)&#123;
        if(arr==null||arr.length==0)&#123;
            return 0;
        &#125;
        return Math.max(f(arr,0,arr.length-1), s(arr,0,arr.length-1)) ;
    &#125;
    // f() åœ¨i~jèŒƒå›´ å…ˆæ‹¿
    public static int f(int[] arr,int i,int j)&#123;
        //çº¸ç‰Œè¢«èªæ˜äººå…ˆæ‹¿ï¼Œè·å¾—çš„åˆ†æ•°
        if(i==j)&#123;
            return arr[i];
        &#125;
        //æ‹¿èµ°ä¸€å¼ ï¼ˆiæˆ–è€…jï¼‰åï¼Œèªæ˜äººæˆäº†åæ‹¿çš„äººï¼Œåœ¨ä¸¤ç§å†³ç­–ä¸­é€‰æœ€ä¼˜
        return Math.max(arr[i]+s(arr,i+1,j),arr[j]+s(arr,i,j-1));
    &#125;

    // g() åœ¨i~jèŒƒå›´ åæ‹¿
    public static int s(int[] arr,int i,int j)&#123;
        //çº¸ç‰Œè¢«èªæ˜äººåæ‹¿ï¼Œè·å¾—çš„åˆ†æ•°
        if(i==j)&#123;
            return 0;
        &#125;
        //å¯¹æ–¹æ‹¿èµ°ä¸€å¼ ï¼ˆiæˆ–è€…jï¼‰åï¼Œèªæ˜äººæˆäº†å…ˆæ‹¿çš„äººï¼Œå¯¹æ–¹ä¹Ÿæ˜¯èªæ˜äººï¼Œä¼šç•™ä¸‹æœ€å·®çš„æƒ…å†µ
        return Math.min(f(arr,i+1,j),f(arr,i,j-1));
    &#125;

    /*
     * DP
     */
    public static int win2(int[] arr)&#123;
    	int N = arr.length;
		int[][] fmap = new int[N][N];
		int[][] gmap = new int[N][N];
		
		
		//å…ˆå¤„ç†L == R ï¼ˆgmapåœ¨åˆå§‹åŒ–å°±æ˜¯0ï¼Œä¸ç”¨ç®¡
		for(int i = 0; i &lt;= N - 1; i++)&#123;
			fmap[i][i] = arr[i];
		&#125;
		//æŒ‰ç€å¯¹è§’çº¿æ¥ä¸€æ­¥æ­¥æ±‚ï¼ï¼ï¼
		for (int startCol = 1; startCol &lt; N; startCol++) &#123;
			int L = 0;
			int R = startCol;
			while (R &lt; N) &#123;
				fmap[L][R] = Math.max(arr[L] + gmap[L + 1][R], arr[R] + gmap[L][R - 1]);
				gmap[L][R] = Math.min(fmap[L + 1][R], fmap[L][R - 1]);
				L++;
				R++;
			&#125;
		&#125;
		return Math.max(fmap[0][N - 1], gmap[0][N-1]);
    &#125;
&#125;

3 æ’åº
-å¿«é€Ÿæ’åº-
1.0 partition

partition ä»¥arr[R] ä¸ºç•Œåˆ†ä¸º &lt;=arr[R]   arr[R]    &gt;arr[R] ä¸‰ä¸ªéƒ¨åˆ†
æ¯æ¬¡å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªä½ç½®çš„æ•°

public static int partition(int[] arr, int L, int R) &#123;
    if (L > R) &#123;
        return -1;
    &#125;
    if (L == R) &#123;
        return L;
    &#125;
    int lessEqual = L - 1;
    int index = L;
    while (index &lt; R) &#123;
        if (arr[index] &lt;= arr[R]) &#123;
            swap(arr, index, ++lessEqual);
        &#125;
        index++;
    &#125;
    swap(arr, ++lessEqual, R);
    return lessEqual;
&#125;

public static void quickSort1(int[] arr) &#123;
    if (arr == null || arr.length &lt; 2) &#123;
        return;
    &#125;
    process1(arr, 0, arr.length - 1);
&#125;

public static void process1(int[] arr, int L, int R) &#123;
    if (L >= R) &#123;
        return;
    &#125;
    // L..R partition arr[R]  [   &lt;=arr[R]   arr[R]    >arr[R]  ]
    int M = partition(arr, L, R);
    process1(arr, L, M - 1);
    process1(arr, M + 1, R);
&#125;
2.0 è·å…°å›½æ——

åœ¨[l, r]ä¸Šä»¥arr[R]ä¸ºç•Œ å°†æ•°ç»„åˆ†ä¸º&lt; = &gt; ä¸‰ä¸ªéƒ¨åˆ†
æ¯æ¬¡å¯ä»¥æ‰¾åˆ°ä¸­é—´ç­‰ç­‰äºé‚£éƒ¨åˆ†çš„æ•°

public static int[] netherlandsFlag(int[] arr, int L, int R) &#123;
  if(L > R) &#123;return new int[]&#123;-1, -1&#125;;&#125;
  if(L == R) &#123;return new int[]&#123;L, R&#125;;&#125;
  int less = L - 1;
  int index = L;
  int more = R;
 	while(index &lt; more) &#123; // !!! index &lt; more
    if(arr[index] == arr[R]) &#123;// 1 == æƒ…å†µ index++
      index++;
    &#125; else if(arr[index] &lt; arr[R]) &#123; // 2 &lt; æƒ…å†µ äº¤æ¢indexå’Œlessçš„å³è¾¹ ç„¶åindex++
      swap(arr, index, ++less);
      index++;
    &#125; else&#123; // 3 > æƒ…å†µ äº¤æ¢indexå’Œmoreå·¦è¾¹  ä¸ç”¨index++ï¼
      swap(arr, index, --more);
    &#125;
  &#125;
  swap(arr, R, more);
  return new int[]&#123;	less+1, more&#125;; // ï¼ï¼ï¼
&#125;
éšæœºå¿«æ’

åœ¨è·å…°å›½æ——åŸºç¡€ä¸Š å°†æ•°ç»„çš„arr[R]è¿›è¡Œéšæœºäº¤æ¢ ç„¶åé€’å½’å°†æ•°ç»„æ‰€æœ‰éƒ¨åˆ†éƒ½æ’å®Œ
æœ€ç»ˆæœŸæœ›æ±‚å‡ºæ¥çš„å¤æ‚åº¦å°±æ˜¯O(logN*N)

public static void quickSort(int[] arr) &#123;
  if(arr == null || arr.length == 0) &#123;
    return;
  &#125;
  process(arr, 0, arr.length - 1);
&#125;

public static void proces(int[] arr, int L, int R) &#123;
  if(L > R) &#123;return;&#125;
  // éšæœºäº¤æ¢
  int random = L + Math.random() * (R - L + 1);
  swap(arr, R, random);
  int[] area = netherlandsFlag(arr, L, R);
  process(arr, L, area[0] - 1);
  process(arr, area[1] + 1, R);
&#125;

é€’å½’ç‰ˆæœ¬

è¿­ä»£ï¼Œè‡ªå·±å‹æ ˆï¼ŒæŠŠä»»åŠ¡åšäº†ç„¶åå†æ”¾å‡ºæ¥
æœ€å¼€å§‹åšä¸€æ¬¡é€’å½’é‡Œåšçš„ ç„¶ååœ¨è¿­ä»£è¿‡ç¨‹ä¸­å†åšé€’å½’é‡Œåšçš„

// å®šä¹‰ä»»åŠ¡
public static class Op&#123;
  public int L;
  public int R;
  public Op(int left, int right) &#123;
    L = left;
    R = right;
  &#125;
&#125;

// å‹æ ˆï¼šå¼€å§‹æ˜¯ä»[0,N - 1]
public static void quickSort2(int[] arr) &#123;
  if(...) &#123;return;&#125;
  int N = arr.length;
  // éšæœºäº¤æ¢ åˆ†ç•Œ
  int random = (int)(Math.random() * N);
  swap(arr, N - 1, random);
  int[] area = netherlandsFlag(arr, 0, N - 1);
  
  Stack&lt;Op> stack = new Stack&lt;>();
  stack.push(new Op(0, area[0]-1));
  stack.push(new Op(area[1]+1, N - 1));
  
  while(!stack.isEmpty()) &#123;
    Op op = stack.pop();
    if(op.L &lt; op.R) &#123;
      // éšæœºäº¤æ¢å’Œåˆ†ç•Œ
      random = op.L + (int)(Math.random() * (op.R - op.L + 1));
      swap(arr, op.R, random);
      area = netherlandsFlag(arr, op.L, op.R);
      
      stack.push(new Op(op.L, area[0]-1));
  		stack.push(new Op(area[1]+1, op.R));
      
    &#125;
  &#125;
    
&#125;
&lt;éšæœºå¿«æ’çš„æ—¶é—´å¤æ‚åº¦åˆ†æ&gt;
1ï¼‰é€šè¿‡åˆ†æçŸ¥é“ï¼Œåˆ’åˆ†å€¼è¶Šé è¿‘ä¸­é—´ï¼Œæ€§èƒ½è¶Šå¥½ï¼›è¶Šé è¿‘ä¸¤è¾¹ï¼Œæ€§èƒ½è¶Šå·®
2ï¼‰éšæœºé€‰ä¸€ä¸ªæ•°è¿›è¡Œåˆ’åˆ†çš„ç›®çš„å°±æ˜¯è®©å¥½æƒ…å†µå’Œå·®æƒ…å†µéƒ½å˜æˆæ¦‚ç‡äº‹ä»¶
3ï¼‰æŠŠæ¯ä¸€ç§æƒ…å†µéƒ½åˆ—å‡ºæ¥ï¼Œä¼šæœ‰æ¯ç§æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†æ¦‚ç‡éƒ½æ˜¯1/N
4ï¼‰é‚£ä¹ˆæ‰€æœ‰æƒ…å†µéƒ½è€ƒè™‘ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯è¿™ç§æ¦‚ç‡æ¨¡å‹ä¸‹çš„é•¿æœŸæœŸæœ›ï¼
æ—¶é—´å¤æ‚åº¦O(N logN)ï¼Œé¢å¤–ç©ºé—´å¤æ‚åº¦O(logN)éƒ½æ˜¯è¿™ä¹ˆæ¥çš„ã€‚*
!!! ==æ‰¾åˆ°æ•°ç»„ä¸­çš„ç¬¬kä¸ªæœ€å¤§å…ƒç´ ==
âš ï¸æ˜¯kå¤§è¿˜æ˜¯kå°
æ”¹å†™å¿«é€Ÿæ’åº
æ—¶é—´å¤æ‚åº¦O(N)
1 åŸå…ˆæ•°ç»„ä¸èƒ½æ”¹å˜ å¤åˆ¶ä¸€ä¸ªæ–°æ•°ç»„
2 éšæœºé€‰ä¸€ä¸ªæ•°æ¥åˆ†åŒº
3 åˆ†åŒº: è¿”å›ä¸¤ä¸ªè¾¹ç•Œ partition
4 å¦‚æœåˆ†åŒºä¸­é—´=éƒ¨åˆ†åŒ…å«k å°±æ‰¾åˆ°äº†
æ²¡æœ‰å°±æ ¹æ®kä¸è¾¹ç•Œå¤§å°æ¯”è¾ƒå¤§å°å»å…¶ä¸­ä¸€éƒ¨åˆ†å»æ‰¾
public int findKthLargest(int[] array, int k) &#123;
       // 1 åŸæ¥çš„æ•°ç»„ä¸å¥½æ›´æ”¹
       int[] arr = copyArray(array);
       return process2(arr, 0, arr.length - 1, arr.length - k);// k å°çš„è¯å°± k - 1
   &#125;   
   // 2 partitionåˆ†åŒºè¿”å›ä¸¤ä¸ªè¾¹ç•Œ åˆ†åŒºä¸­é—´ç­‰äºéƒ¨åˆ†åŒ…å«k å°±æ˜¯æ‰¾åˆ°äº†
   public static int process2(int[] arr, int L, int R, int index) &#123;
       if(L == R) &#123;
           return arr[L];
       &#125;
       int random = L + (int)(Math.random() * (R - L + 1));
       int[] area = partition(arr, L, R, arr[random]);
       
     	
       if(index >= area[0] &amp;&amp; index &lt;= area[1]) &#123;
           return arr[index];
       &#125; else if(index &lt; area[0]) &#123;// æ²¡æœ‰æ‰¾åˆ°å°±åˆ°å¦å¤–ä¸¤ä¸ªéƒ¨åˆ†ç»§ç»­æ‰¾
           return process2(arr, L, area[0] - 1, index);
       &#125; else &#123;
           return process2(arr, area[1] + 1, R, index);
       &#125;
   &#125;
æ³¨æ„è¿™é‡Œçš„partition

å› ä¸ºæ˜¯ä½¿ç”¨numæ¥åˆ†åŒº æ‰€ä»¥è¾¹ç•Œæ³¨æ„âš ï¸å¯¹æ¯”å¿«æ’ç”¨arr[R]æ¥åˆ†åŒº

public static int[] partition(int[] arr, int L , int R, int num) &#123;
    int less = L - 1;
    int more = R + 1; //ï¼ï¼
    int index = L;
    while(index &lt; more) &#123;
        if(arr[index] &lt; num) &#123;
            swap(arr, index, ++less);
            index++;
        &#125;else if(arr[index] > num) &#123;
            swap(arr, index, --more);
        &#125;else&#123;
            index++;
        &#125;
    &#125;
  // å¿«æ’è¿˜éœ€è¦äº¤æ¢moreå’ŒR
    return new int[]&#123;less + 1, more - 1&#125;; //ï¼ï¼ï¼ è¿”å›çš„å³è¾¹ç•Œæ˜¯more - 1 å¿«æ’æ˜¯more
&#125;

BFPRT(é¢è¯•èŠ)
ä¿—ç§°&quot;ä¸­ä½æ•°ä¹‹ä¸­ä½æ•°ç®—æ³•&quot;ã€‚ä¾é ä¸€ç§ç²¾å¿ƒè®¾è®¡çš„ pivot é€‰å–æ–¹æ³•ï¼Œè¯¥ç®—æ³•ä»ç†è®ºä¸Šä¿è¯äº†æœ€åæƒ…å½¢ä¸‹çš„çº¿æ€§æ—¶é—´å¤æ‚åº¦ï¼Œæ‰“è´¥äº†å¹³å‡çº¿æ€§ã€æœ€å O(n^2) å¤æ‚åº¦çš„ä¼ ç»Ÿç®—æ³•

bfprtç®—æ³•


æ”¹è¿›éƒ¨åˆ†å°±æ˜¯å°†å¿«æ’ä¸­éšæœºé€‰æ•°çš„è¿‡ç¨‹æ”¹ä¸ºäº”ä¸ªä¸€ç»„ åˆ†ç»„ç»„ä¸­æ’å¥½åº


æ‰¾å‡ºæ¯ä¸€æ®µçš„ä¸­ä½æ•° ç»„æˆm[]


æ‰¾åˆ°mçš„ä¸­ä½æ•°è¿”å›


medianOfMedian():
// 1 arr[Lâ€¦R] äº”ä¸ªæ•°ä¸€ç»„
// 2 æ¯ä¸ªå°ç»„å†…éƒ¨æ’åºï¼Œæ‰¾åˆ°ä¸­ä½æ•°é¢†å‡ºæ¥ï¼Œç»„æˆm
// 3 m[]ä¸­ï¼Œæ‰¾åˆ°ä¸­ä½æ•° åè°ƒbfprt



public static int process(int[] arr, int L, int R, int index)&#123;
    if(L == R)&#123;
        return arr[L];
    &#125;
    // æ”¹è¿›éƒ¨åˆ†ï¼šéšæœºéƒ¨åˆ†æ”¹æˆä¸€ä¸ªæ–¹æ³•
    int r = medianOfMedian(arr, L ,R);
  
    int[] range = partition(arr, L, R, r);

    if(index >= range[0] &amp;&amp; index &lt;= range[1])&#123;
        return arr[index];
    &#125; else if (index &lt; range[0])&#123;
        return process(arr, L , range[0] - 1, index);
    &#125; else &#123;
        return process(arr, range[1] + 1, R, index);
    &#125;
&#125;

// 1 arr[L...R] äº”ä¸ªæ•°ä¸€ç»„ 
// 2 æ¯ä¸ªå°ç»„å†…éƒ¨æ’åºï¼Œæ‰¾åˆ°ä¸­ä½æ•°é¢†å‡ºæ¥ï¼Œç»„æˆm 
// 3 m[]ä¸­ï¼Œæ‰¾åˆ°ä¸­ä½æ•° åè°ƒbfprt
private static int medianOfMedian(int[] arr, int L, int R) &#123;
    int size = R - L + 1;
    // 1
    int offset = size % 5 == 0 ? 0 : 1;
    int[] m = new int[size/5 + offset];
    // 2
    for(int i = 0; i &lt; m.length - 1; i++)&#123;
        int first = L + i * 5;
        m[i] = sortAndMedian(arr, first, Math.min(R, first + 4));
    &#125;
    // 3
    return process(m, 0, m.length - 1, m.length / 2);
&#125;

public static int sortAndMedian(int[] arr, int L, int R) &#123;
    // SORT
    for (int i = L + 1; i &lt;= R; i++) &#123;
        for (int j = i - 1; j >= L &amp;&amp; arr[j] > arr[j + 1]; j--) &#123;
            swap(arr, j, j + 1);
        &#125;
    &#125;
    // MEDIAN
    return arr[(L + R) / 2];
&#125;
-å †æ’åº-
/**
     * 1 ä»ä¸‹è‡³ä¸Šè®©æ•´ä¸ªæ•°ç»„å˜ä¸ºå¤§æ ¹å † å¹¶å°†å †é¡¶(max)ä¸ç»“å°¾äº¤æ¢ å†å»é‡æ–°è°ƒæ•´
     * 2 éå†è°ƒæ•´ ç›´åˆ°heapSize = 0
     * @param arr
     */
public static void heapSort(int[] arr) &#123;
        if (arr.length &lt; 2 || arr == null) &#123;
            return;
        &#125;
        int heapSize = arr.length;

        // 1
        for (int i = arr.length - 1; i >= 0; i--) &#123;
            heapify(arr, i, arr.length);
        &#125;
        swap(arr, 0, --heapSize);

        // 2
        while(heapSize > 0)&#123;
            heapify(arr, 0, heapSize);
            swap(arr, 0, --heapSize);
        &#125;
    &#125;

    // ä»ä¸‹åˆ°ä¸Šå°†æ•´ä¸ªæ•°ç»„å˜ä¸ºå¤§æ ¹å †ç»“æ„
    private static void heapify(int[] arr, int i, int heapSize) &#123;
        //å…ˆæ‰¾åˆ°å·¦å­©å­ å¦‚æœæœ‰å­©å­ å°†æœ€å¤§çš„æ‰¾åˆ°å¹¶ä¸æ ¹æ¯”è¾ƒ è°å¤§æ”¾åœ¨ä¸Šé¢
        int left = 2 * i + 1;
        while(left &lt; heapSize)&#123;
            int largest = left + 1 &lt; heapSize &amp;&amp; arr[left + 1] > arr[left] ? left + 1 : left;
            largest = arr[largest] > arr[i] ? largest : i;
            if(largest == i)&#123;
                break;
            &#125;
            swap(arr, largest, i);
            i = largest;
            left = 432 * i + 1;
        &#125;

    &#125;

    private static void swap(int[] arr, int largest, int i) &#123;
        // TODO Auto-generated method stub
        int temp = arr[i];
        arr[i] = arr[largest];
        arr[largest] = temp;
    &#125;


-å½’å¹¶æ’åº-

1ï¼‰æ•´ä½“æ˜¯é€’å½’ï¼Œå·¦è¾¹æ’å¥½åº+å³è¾¹æ’å¥½åº+mergeè®©æ•´ä½“æœ‰åº
2ï¼‰è®©å…¶æ•´ä½“æœ‰åºçš„è¿‡ç¨‹é‡Œç”¨äº†æ’å¤–åºæ–¹æ³•
3ï¼‰åˆ©ç”¨masterå…¬å¼æ¥æ±‚è§£æ—¶é—´å¤æ‚åº¦
4ï¼‰å½“ç„¶å¯ä»¥ç”¨éé€’å½’å®ç°

é€’å½’ç‰ˆæœ¬
// é€’å½’æ–¹æ³•å®ç°
public static void mergeSort1(int[] arr) &#123;
    if (arr == null || arr.length &lt; 2) &#123;
        return;
    &#125;
    process(arr, 0, arr.length - 1);
&#125;

// arr[L...R]èŒƒå›´ä¸Šï¼Œå˜æˆæœ‰åºçš„
// L...R    N    T(N) = 2*T(N/2) + O(N)  ->
public static void process(int[] arr, int L, int R) &#123;
    if (L == R) &#123; // base case
        return;
    &#125;
    int mid = L + ((R - L) >> 1);
    process(arr, L, mid);
    process(arr, mid + 1, R);
    merge(arr, L, mid, R);
&#125;

public static void merge(int[] arr, int L, int M, int R) &#123;
    int[] help = new int[R - L + 1];
    int i = 0;
    int p1 = L;
    int p2 = M + 1;
    while (p1 &lt;= M &amp;&amp; p2 &lt;= R) &#123;
        help[i++] = arr[p1] &lt;= arr[p2] ? arr[p1++] : arr[p2++];
    &#125;
    // è¦ä¹ˆp1è¶Šç•Œäº†ï¼Œè¦ä¹ˆp2è¶Šç•Œäº†
    while (p1 &lt;= M) &#123;
        help[i++] = arr[p1++];
    &#125;
    while (p2 &lt;= R) &#123;
        help[i++] = arr[p2++];
    &#125;
    for (i = 0; i &lt; help.length; i++) &#123;
        arr[L + i] = help[i];
    &#125;
&#125;
éé€’å½’ç‰ˆæœ¬
æµç¨‹å°±åœ¨äºæŠ˜è…¾  æ­¥é•¿ è¿™ä¸ªæ¦‚å¿µ
æ­¥é•¿ = 1 å¼€å§‹, æ­¥é•¿çš„å˜åŒ–ä¸€å®šæ˜¯2çš„æŸæ¬¡æ–¹
æœ€åä¸€ç»„: å‡‘ä¸é½å·¦ç»„å°±ä¸ç®¡äº†, å³ç»„æœ‰å¤šå°‘ç®—å¤šå°‘
æ­¥é•¿ä¸€æ—¦è¶…è¿‡æ€»é•¿åº¦, è¯´æ˜æå®Œäº†, åœæ­¢å°±è¡Œäº†
public static void mergeSort3(int[] arr) &#123;
    if (arr == null || arr.length &lt; 2) &#123;
        return;
    &#125;
    int N = arr.length;
    int step = 1;
    while (step &lt; N) &#123;
        int L = 0;
        while (L &lt; N) &#123;
            int M = 0;
            if ( N - L >= step) &#123;
                M = L + step - 1;
            &#125; else &#123;
                M = N - 1;
            &#125;
            if (M == N -1) break;

            int R = 0;
            if (N -1 - M >= step) &#123;
                R = M + step;
            &#125; else &#123;
                R = N - 1;
            &#125;
            merge(arr, L, M, R);
            if (R == N - 1) &#123;
                break;
            &#125; else &#123;
                L = R + 1;
            &#125;
        &#125;
        if (step > N / 2) &#123;
            break;
        &#125;
        step &lt;&lt;= 1;
    &#125;
&#125;
æ³¨æ„æœ€åä¸€ç»„å·¦ç»„: L + step - 1 å¯èƒ½è¶Šç•Œ
ä»å³å¾€å·¦åˆå¹¶å°±ä¸ç”¨è€ƒè™‘è¶Šç•Œé—®é¢˜äº†
if (step &gt; N &#x2F; 2) &#123;
    break;
&#125;
æ­¤å¤„ä¸ç”¨ç­‰å·çš„åŸå› :
å¦‚æœ17ä¸ªæ•°, æœ€åä¸€ä¸ªè°ƒæ•´æ˜¯æ­¥é•¿ä¸º16çš„æ—¶å€™çš„è°ƒæ•´:
å‰16ä¸ªæ•°åšå·¦ç»„, åä¸€ä¸ªæ•°åšå³ç»„
è€Œ N/2 æ˜¯å‘ä¸‹å–æ•´çš„, 17/2 =8 , æ‰€ä»¥ mergeSize &gt;= N / 2,
åœ¨ç­‰äºçš„æ—¶å€™å°±åœæ­¢çš„è¯, æœ€åä¸€ä¸ªæ­¥é•¿æ˜¯8, ä¸ä¼šæœ‰æœ€åä¸€ä¸ªæ­¥é•¿ä¸º16çš„æ—¶å€™, å¯¼è‡´ä½ å‡ºé”™äº†
ä¼˜åŒ–åçš„æœ€ç»ˆç‰ˆæœ¬
// éé€’å½’æ–¹æ³•å®ç°
public static void mergeSort2(int[] arr) &#123;
    if (arr == null || arr.length &lt; 2) &#123;
        return;
    &#125;
    int N = arr.length;
    int mergeSize = 1;// å½“å‰æœ‰åºçš„ï¼Œå·¦ç»„é•¿åº¦
    // ä¸€ç»„æ˜¯2å€çš„mergeSize
    while (mergeSize &lt; N) &#123; // log N
        int L = 0;
        // 0.... 
        while (L &lt; N) &#123;
            // L...M  å·¦ç»„ï¼ˆmergeSizeï¼‰
            int M = L + mergeSize - 1;
            if (M >= N) &#123; // å½“å‰ç»„å‡‘ä¸é½,åªæœ‰å·¦è¾¹, è‚¯å®šæœ‰åº
                break;    // é¢„é˜²è¶Šç•Œé£é™©
            &#125;
            //  L...M   M+1...R(mergeSize)
            // æœ‰å¯èƒ½æœ€åä¸€ç»„å³ç»„æ•°ç›®ä¸å¤Ÿ
            int R = Math.min(M + mergeSize, N - 1);
            merge(arr, L, M, R);
            L = R + 1; // ä¸‹ä¸€æ¬¡å·¦ç»„
        &#125;
        // é˜²æ­¢æº¢å‡º, INT_MAX
        if (mergeSize > N / 2) &#123;
            break;
        &#125;
        mergeSize &lt;&lt;= 1;
    &#125;
&#125;
å¤æ‚åº¦
ä¸€å…±æ‰§è¡Œæ¬¡æ•°  log2Nlog_2Nlog2â€‹N, merge ä¸€æ¬¡çš„å¤æ‚åº¦ O(N)
æ€»çš„å¤æ‚åº¦: O(Nâˆ—logN)O(N*logN)O(Nâˆ—logN)
-å‰ç¼€æ ‘-
1ï¼‰å•ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œå­—ç¬¦ä»å‰åˆ°åçš„åŠ åˆ°ä¸€æ£µå¤šå‰æ ‘ä¸Š
2ï¼‰å­—ç¬¦æ”¾åœ¨è·¯ä¸Šï¼ŒèŠ‚ç‚¹ä¸Šæœ‰ä¸“å±çš„æ•°æ®é¡¹ï¼ˆå¸¸è§çš„æ˜¯passå’Œendå€¼ï¼‰
3ï¼‰æ‰€æœ‰æ ·æœ¬éƒ½è¿™æ ·æ·»åŠ ï¼Œå¦‚æœæ²¡æœ‰è·¯å°±æ–°å»ºï¼Œå¦‚æœ‰è·¯å°±å¤ç”¨
4ï¼‰æ²¿é€”èŠ‚ç‚¹çš„passå€¼å¢åŠ 1ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²ç»“æŸæ—¶æ¥-åˆ°çš„èŠ‚ç‚¹endå€¼å¢åŠ 1
å¯ä»¥å®Œæˆå‰ç¼€ç›¸å…³çš„æŸ¥è¯¢
ä¾‹å­
è®¾è®¡ä¸€ç§ç»“æ„ã€‚ç”¨æˆ·å¯ä»¥ï¼š
1ï¼‰void insert(String str)            æ·»åŠ æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥é‡å¤æ·»åŠ ï¼Œæ¯æ¬¡ç®—1ä¸ª
2ï¼‰int search(String str)             æŸ¥è¯¢æŸä¸ªå­—ç¬¦ä¸²åœ¨ç»“æ„ä¸­è¿˜æœ‰å‡ ä¸ª
3) void delete(String str)           åˆ æ‰æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥é‡å¤åˆ é™¤ï¼Œæ¯æ¬¡ç®—1ä¸ª
4ï¼‰int prefixNumber(String str)       æŸ¥è¯¢æœ‰å¤šå°‘ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯ä»¥stråšå‰ç¼€çš„
å‰ç¼€æ ‘çš„å®ç°æ–¹å¼
public static class Node &#123;
        public int pass;// ç»è¿‡å‡ æ¬¡
        public int end;// ä½œä¸ºendå‡ æ¬¡
        public Node[] nexts; // åé¢çš„æ•°ç»„

        public Node()&#123;
            pass = 0;
            end = 0;
            nexts = new Node[26];// ä¸€æ¡æœ€é•¿å°±26 æ‰€ä»¥è¿™ä¸ªæ–¹å¼ä¸é€‚åˆå¾ˆå¤šç±»å‹çš„èŠ‚ç‚¹
        &#125;

    &#125;

    public static class Trie1&#123;
        private Node root;// å¤´èŠ‚ç‚¹

        // æ„é€ æ–¹æ³•
        public Trie1()&#123;
            root = new Node();
        &#125;

        /*
         * insert()
         */
        // 1 å…ˆæŠ“ä½å¤´èŠ‚ç‚¹  pass ++ 
        // 2 ä»å·¦å‘å³éå†å­—ç¬¦ï¼Œnext[path]== nullåˆ™æ–°å»ºèŠ‚ç‚¹ pass++
        // 3 æœ€åend++
        public void insert(String word)&#123;
            if(word == null)&#123;
                return;
            &#125;
            char[] str = word.toCharArray();
            Node node = root;
            node.pass++;
            int path = 0;

            for(int i = 0; i &lt; str.length; i++)&#123;
                path = str[i] - 'a';
                if(node.nexts[path] == null)&#123;
                    node.nexts[path] = new Node();
                &#125;
                node = node.nexts[path];
                node.pass++;
            &#125;
            node.end++;
        &#125;

        /*
         * search():æŸ¥æ‰¾wordå‡ºç°äº†å‡ æ¬¡
         */
        public int search(String word)&#123;
            if(word ==  null)&#123;
                return 0;
            &#125;
            char[] str = word.toCharArray();
            Node node = root;
            int path = 0;
            for(int i = 0; i &lt; str.length; i++)&#123;
                path = str[i] - 'a';
                if(node.nexts[path] == null)&#123;
                    return 0;
                &#125;
                node = node.nexts[path];
            &#125;
            return node.end;
        &#125;

        /*
         * delete() å†…å­˜æ³„æ¼é—®é¢˜jvmå¯ä»¥è§£å†³çš„
         */
        // 1 å…ˆsearchæ˜¯å¦å­˜åœ¨
        // 2 éå†ç»è¿‡è¦æŠŠpass-- ä¸”å½“pass==0æ—¶å°†next[path]ç½®ç©ºï¼Œåé¢çš„èŠ‚ç‚¹JVMè‡ªåŠ¨ä¼šæ¸…é™¤
        // 3 end --
        public void delete(String word)&#123;
            if(this.search(word) != 0)&#123;
                char[] str = word.toCharArray();
                Node node = root;
                node.pass--;
                int path = 0;
                for(int i = 0; i &lt; str.length; i++)&#123;
                    path = str[i] - 'a';
                    if(--node.nexts[path].pass == 0)&#123;
                        node.nexts[path] = null;
                        return;
                    &#125;
                    node = node.nexts[path];
                &#125;
                node.end--;

            &#125;
        &#125;

        /*
         * prefixNode:æœ‰å‡ ä¸ªæ˜¯ä»¥preä½œä¸ºå‰ç¼€çš„å­—ç¬¦
         * 
         */
        //å’Œsearchæ­¥éª¤å·®ä¸å¤š æœ€åreturnçš„æ˜¯pass
        public int prefixNode(String pre)&#123;
            Node node = root;
            int path = 0;
            char[] str = pre.toCharArray();
            for(int i = 0; i &lt; str.length;i++)&#123;
                path = str[i] - 'a';
                if(node.nexts[path] == null)&#123;
                    return 0;
                &#125;
                node = node.nexts[path];
            &#125;
            return node.pass;
        &#125;

    &#125;
-ï¼ˆæ¡¶æ’åºï¼‰ä¸åŸºäºæ¯”è¾ƒçš„-
æ¡¶æ’åºæ€æƒ³ä¸‹çš„æ’åºï¼šè®¡æ•°æ’åº &amp; åŸºæ•°æ’åº
1)æ¡¶æ’åºæ€æƒ³ä¸‹çš„æ’åºéƒ½æ˜¯ä¸åŸºäºæ¯”è¾ƒçš„æ’åº
2)æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ï¼Œé¢å¤–ç©ºé—´è´Ÿè½½åº¦O(M)
3)åº”ç”¨èŒƒå›´æœ‰é™ï¼Œéœ€è¦æ ·æœ¬çš„æ•°æ®çŠ¶å†µæ»¡è¶³æ¡¶çš„åˆ’åˆ†
è®¡æ•°æ’åºå’ŒåŸºæ•°æ’åº
é¢˜ç›®3: è®¡æ•°æ’åº
è®¡æ•°æ’åºè¦æ±‚ï¼Œæ ·æœ¬æ˜¯æ•´æ•°ï¼Œä¸”èŒƒå›´æ¯”è¾ƒçª„
// only for 0~200 value
public static void countSort(int[] arr) &#123;
    if (arr == null || arr.length &lt; 2) &#123;
        return;
    &#125;
    int max = Integer.MIN_VALUE;
    for (int i = 0; i &lt; arr.length; i++) &#123;
        max = Math.max(max, arr[i]);
    &#125;
    int[] bucket = new int[max + 1];
    for (int i = 0; i &lt; arr.length; i++) &#123;
        bucket[arr[i]]++;
    &#125;
    int i = 0;
    for (int j = 0; j &lt; bucket.length; j++) &#123;
        while (bucket[j]-- > 0) &#123;
            arr[i++] = j;
        &#125;
    &#125;
&#125;
é¢˜ç›®4: åŸºæ•°æ’åºä»£ç 
ä¸€èˆ¬æ¥è®²ï¼ŒåŸºæ•°æ’åºè¦æ±‚ï¼Œæ ·æœ¬æ˜¯10è¿›åˆ¶çš„æ­£æ•´æ•°
// only for no-negative value
public static void radixSort(int[] arr) &#123;
    if (arr == null || arr.length &lt; 2) &#123;
        return;
    &#125;
    radixSort(arr, 0, arr.length - 1, maxbits(arr));
&#125;

public static int maxbits(int[] arr) &#123;
    int max = Integer.MIN_VALUE;
    for (int i = 0; i &lt; arr.length; i++) &#123;
        max = Math.max(max, arr[i]);
    &#125;
    int res = 0;
    while (max != 0) &#123;
        res++;
        max /= 10;
    &#125;
    return res;
&#125;

// arr[l..r]æ’åº  ,  digit
// l..r    3 56 17 100    3
public static void radixSort(int[] arr, int L, int R, int digit) &#123;
    final int radix = 10;
    int i = 0, j = 0;
    // æœ‰å¤šå°‘ä¸ªæ•°å‡†å¤‡å¤šå°‘ä¸ªè¾…åŠ©ç©ºé—´
    int[] help = new int[R - L + 1];
    for (int d = 1; d &lt;= digit; d++) &#123; // æœ‰å¤šå°‘ä½å°±è¿›å‡ºå‡ æ¬¡
        // 10ä¸ªç©ºé—´
        // count[0] å½“å‰ä½(dä½)æ˜¯0çš„æ•°å­—æœ‰å¤šå°‘ä¸ª
        // count[1] å½“å‰ä½(dä½)æ˜¯(0å’Œ1)çš„æ•°å­—æœ‰å¤šå°‘ä¸ª
        // count[2] å½“å‰ä½(dä½)æ˜¯(0ã€1å’Œ2)çš„æ•°å­—æœ‰å¤šå°‘ä¸ª
        // count[i] å½“å‰ä½(dä½)æ˜¯(0~i)çš„æ•°å­—æœ‰å¤šå°‘ä¸ª
        int[] count = new int[radix]; // count[0..9]
        for (i = L; i &lt;= R; i++) &#123;
            // 103  1   3
            // 209  1   9
            j = getDigit(arr[i], d);
            count[j]++;
        &#125;
        for (i = 1; i &lt; radix; i++) &#123;
            count[i] = count[i] + count[i - 1];
        &#125;
        for (i = R; i >= L; i--) &#123;
            j = getDigit(arr[i], d);
            help[count[j] - 1] = arr[i];
            count[j]--;
        &#125;
        for (i = L, j = 0; i &lt;= R; i++, j++) &#123;
            arr[i] = help[j];
        &#125;
    &#125;
&#125;

public static int getDigit(int x, int d) &#123;
    return ((x / ((int) Math.pow(10, d - 1))) % 10);
&#125;
1ï¼‰ä¸€èˆ¬æ¥è®²ï¼Œè®¡æ•°æ’åºè¦æ±‚ï¼Œæ ·æœ¬æ˜¯æ•´æ•°ï¼Œä¸”èŒƒå›´æ¯”è¾ƒçª„
2ï¼‰ä¸€èˆ¬æ¥è®²ï¼ŒåŸºæ•°æ’åºè¦æ±‚ï¼Œæ ·æœ¬æ˜¯10è¿›åˆ¶çš„æ­£æ•´æ•°
ä¸€æ—¦è¦æ±‚ç¨æœ‰å‡çº§ï¼Œæ”¹å†™ä»£ä»·å¢åŠ æ˜¯æ˜¾è€Œæ˜“è§çš„
æ’åºç®—æ³•çš„ç¨³å®šæ€§
ç¨³å®šæ€§æ˜¯æŒ‡åŒæ ·å¤§å°çš„æ ·æœ¬å†æ’åºä¹‹åä¸ä¼šæ”¹å˜ç›¸å¯¹æ¬¡åº
å¯¹åŸºç¡€ç±»å‹æ¥è¯´ï¼Œç¨³å®šæ€§æ¯«æ— æ„ä¹‰
å¯¹éåŸºç¡€ç±»å‹æ¥è¯´ï¼Œç¨³å®šæ€§æœ‰é‡è¦æ„ä¹‰
æœ‰äº›æ’åºç®—æ³•å¯ä»¥å®ç°æˆç¨³å®šçš„ï¼Œè€Œæœ‰äº›æ’åºç®—æ³•æ— è®ºå¦‚ä½•éƒ½å®ç°ä¸æˆç¨³å®šçš„
æ’åºç®—æ³•æ€»ç»“




æ—¶é—´å¤æ‚åº¦
é¢å¤–ç©ºé—´å¤æ‚åº¦
ç¨³å®šæ€§




é€‰æ‹©æ’åº
O(N^2)
O(1)
æ— 


å†’æ³¡æ’åº
O(N^2)
O(1)
æœ‰


æ’å…¥æ’åº
O(N^2)
O(1)
æœ‰


å½’å¹¶æ’åº
O(N* logN)
O(N)
æœ‰


éšæœºå¿«æ’
O(N* logN)
O(logN)
æ— 


å †æ’åº
O(N* logN)
O(1)
æ— 








è®¡æ•°æ’åº
O(N)
O(M)
æœ‰


åŸºæ•°æ’åº
O(N)
O(N)
æœ‰



1ï¼‰ä¸åŸºäºæ¯”è¾ƒçš„æ’åºï¼Œå¯¹æ ·æœ¬æ•°æ®æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œä¸æ˜“æ”¹å†™
2ï¼‰åŸºäºæ¯”è¾ƒçš„æ’åºï¼Œåªè¦è§„å®šå¥½ä¸¤ä¸ªæ ·æœ¬æ€ä¹ˆæ¯”å¤§å°å°±å¯ä»¥ç›´æ¥å¤ç”¨
3ï¼‰åŸºäºæ¯”è¾ƒçš„æ’åºï¼Œæ—¶é—´å¤æ‚åº¦çš„æé™æ˜¯O(Nâˆ—logN)
4ï¼‰æ—¶é—´å¤æ‚åº¦O(Nâˆ—logN)ã€é¢å¤–ç©ºé—´å¤æ‚åº¦ä½äºO(N)ã€ä¸”ç¨³å®šçš„åŸºäºæ¯”è¾ƒçš„æ’åºæ˜¯ä¸å­˜ åœ¨çš„ã€‚
5ï¼‰ä¸ºäº†ç»å¯¹çš„é€Ÿåº¦é€‰å¿«æ’ã€ä¸ºäº†çœç©ºé—´é€‰å †æ’ã€ä¸ºäº†ç¨³å®šæ€§é€‰å½’å¹¶
4 æ»‘åŠ¨çª—å£
æ»‘åŠ¨çª—å£æ›´æ–°ç»“æ„
1 æ— é‡å¤æ•°ç»„çš„æœ€é•¿å­ä¸²

ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² æ‰¾å‡ºé‡Œé¢æ²¡æœ‰é‡å¤çš„æœ€é•¿å­ä¸²

// 1 ä½¿ç”¨çª—å£ å› ä¸ºä¸é‡å¤ å¯ä»¥ç”¨hashsetæ¥å­˜å‚¨ ç»“æœé›†æ˜¯char[] str
// 2 éå†æ•°ç»„ L å‘å³
// 2.1 Rå‘å³éå†:æ›´æ–°è¡¨
// 2.2 æ›´æ–°maxã€æ›´æ–°set:åˆ é™¤å¤´
public static int lengthOfLongestSubstring(String s) &#123;
	if(s.length() == 0 || s ==  "")&#123;
		return 0;
	&#125;
	// 1
	HashSet&lt;Character> set = new HashSet&lt;Character>();
	char[] str = s.toCharArray();
	int ans = 0;
	int L = 0;
	int R = 0;
	// 2
	while(L &lt; str.length)&#123;
		// 2.1
		while(R &lt; str.length &amp;&amp; !set.contains(str[R]))&#123; // !!! æ³¨æ„æ˜¯ä¸åŒ…å«
			set.add(str[R]);
			R++;
		&#125;
		
		// 2.2
		ans = Math.max(ans, R - L );
		set.remove(str[L]);
		L++;
	&#125;
	return ans;		
	
&#125;

åŠ¨æ€è§„åˆ’ç‰ˆ
ä½¿ç”¨256æ•°ç»„è¿›è¡Œå­˜å‚¨ å…ˆéƒ½åˆå§‹åŒ–ä¸º-1 ä¸‹æ ‡æ˜¯å­—ç¬¦ä¸²å€¼
public static int lengthOfLongestSubstring2(String s) &#123;
	if (s.length() == 0 || s == "") &#123;
		return 0;
	&#125;
	
	char[] str = s.toCharArray();
	int[] map = new int[256];
	for (int i = 0; i &lt; 256; i++) &#123;
		map[i] = -1;
	&#125;
	map[str[0]] = 0;
	int N = str.length;
	int ans = 1;
	int pre = 1;
	for (int i = 1; i &lt; N; i++) &#123;
		pre = Math.min(i - map[str[i]], pre + 1);
		ans = Math.max(ans, pre);
		map[str[i]] = i;	&#125;
	return ans;

&#125;
2 æœ€å°è¦†ç›–å­ä¸²

ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ã€ä¸€ä¸ªå­—ç¬¦ä¸² t ã€‚è¿”å› s ä¸­æ¶µç›– t æ‰€æœ‰å­—ç¬¦çš„æœ€å°å­ä¸²ã€‚å¦‚æœ s ä¸­ä¸å­˜åœ¨æ¶µç›– t æ‰€æœ‰å­—ç¬¦çš„å­ä¸²ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² &quot;&quot; ã€‚

  // 1 ä½¿ç”¨map[256]æ¥è®°å½• tä¸­éœ€è¦çš„æ¯ç§å­—ç¬¦çš„æ•°é‡;
	//allæ¥è®°å½•æ‰€æœ‰å­—ç¬¦å‰©ä¸‹æ²¡æ‰¾åˆ°çš„æ•°é‡ï¼›startè®°å½•æœ€å°å­ä¸²å¼€å¤´ä¸‹æ ‡
	// 2 éå†å­—ç¬¦é›†  L = 0 éå† R å‘å³ 
	// 2.1 å³è¾¹ç•Œæ‰©å¤§ åŒæ—¶mapç›¸åº”-- å¹¶ä¸”æ²¡æœ‰å‡åˆ°0çš„è¯all--
	// 2.2 å½“allè¿˜å®Œä¹‹å è¦å°†å·¦è¾¹ç•Œç¼©å° 
	// 2.2.1 mapå¯¹åº”çš„str[L] å·¦è¾¹ç•Œæœ‰å¯èƒ½æœ‰é‡å¤å€¼ å¯¹åº”mapå°äº0 è¦ç¼©åˆ°ä¸èƒ½ç¼©çš„åœ°æ–¹
	// 2.2.2 æ›´æ–°minLen å’Œå¼€å¤´start 
	// 2.2.3 å·¦è¾¹ç•ŒL++ã€mapå¯¹åº”++ã€ all++	
public static String minLength2(String s1, String s2) &#123;
		if (s1 == null || s2 == null || s1.length() &lt; s2.length()) &#123;
			return "";
		&#125;
		char[] str1 = s1.toCharArray();
		char[] str2 = s2.toCharArray();
		// 1
		int[] map = new int[256]; // map[37] = 4  37  4æ¬¡
		for (int i = 0; i != str2.length; i++) &#123;
			map[str2[i]]++;
		&#125;
		int all = str2.length;
		
		int L = 0;
		int R = 0;// [L,R)  -> [0,0)
		int minLen = Integer.MAX_VALUE;
		int start = 0;// è®°å½•æœ€å°å­ä¸²å¼€å¤´ä¸‹æ ‡ 
		// 2
		while (R != str1.length) &#123;
			// 2.1
			map[str1[R]]--;
			if (map[str1[R]] >= 0) &#123;
				all--;
			&#125;
			// 2.2
			if (all == 0) &#123; // è¿˜å®Œäº† å°±æ˜¯ä¸€ä¸ªè§£
				// 2.2.1
				while (map[str1[L]] &lt; 0) &#123;// ï¼ï¼ï¼å·¦è¾¹ç•Œæœ‰å¯èƒ½æœ‰é‡å¤å€¼ å¯¹åº”çš„mapå°±æ˜¯å°äº0çš„ æˆ‘ä»¬è¦é¿å… æ‰€ä»¥ç¼©åˆ°æ²¡æœ‰é‡å¤çš„åœ°æ–¹æ‰å¼€å§‹è®°å½•minlen
					map[str1[L]]++;
         	L++;
				&#125;
				// 2.2.2
				if(minLen > R - L + 1)&#123; 
					minLen = R - L + 1;
					start = L;
				&#125;
				// 2.2.3
				all++;
				map[str1[L++]]++;
			&#125;
			R++;
		&#125;
		return minLen == Integer.MAX_VALUE ? "" : s1.substring(start, start + minLen);
	&#125;
å°±æ˜¯allè¿˜å®Œä¹‹å‰r++å¾€å³å±•å¼€ all==0 å°±è¦l++ å¾€å·¦è¾¹ç¼©

3 æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼

å‡è®¾ä¸€ä¸ªå›ºå®šå¤§å°ä¸ºWçš„çª—å£;ä¾æ¬¡åˆ’è¿‡arr è¿”å›æ¯ä¸€æ¬¡æ»‘å‡ºçŠ¶å†µçš„æœ€å¤§å€¼

å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—æ¥ä½œä¸ºçª—å£ï¼Œé‡Œé¢æ”¾çš„æ˜¯ä¸‹æ ‡
å¾ªç¯éå†æ•°ç»„ï¼š L Rè¾¹ç•Œ
\1) å½“çª—å£ä¸ä¸ºç©º&amp;çª—å£ç»“å°¾å°äºå½“å‰R ç»“å°¾å¼¹å‡ºï¼ˆwindowæ˜¯å•è°ƒé€’å‡ï¼‰
\2) æ·»åŠ arr[R]
\3) å½“é˜Ÿé¦–å…ƒç´ å·²ç»ä¸å†æ»‘åŠ¨çª—å£å†…ï¼Œå°†å…¶ä»é˜Ÿé¦–ç§»é™¤
\4) å½“çª—å£å³è¾¹ç•Œright+1å¤§äºç­‰äºçª—å£å¤§å°kæ—¶çª—å£å½¢æˆã€‚æ­¤æ—¶ï¼Œé˜Ÿé¦–å…ƒç´ å°±æ˜¯è¯¥çª—å£å†…çš„æœ€å¤§å€¼ã€‚
if( arr == null || w &lt; 1 || arr.length == 0 )&#123;
        return null;
    &#125;

    // 1
    LinkedList&lt;Integer> window = new LinkedList&lt;>();
    int[] res = new int[arr.length - w + 1];

    // 2
    for(int R = 0; R &lt; arr.length; R++)&#123;
        // 1)
        while(!window.isEmpty() &amp;&amp; arr[window.peekLast()] &lt; arr[R])&#123;
            window.pollLast();
        &#125;
        // 2)
        window.addLast(R);
        int L = R - w + 1;
        // 3)
        if(window.peekFirst() &lt; L)&#123;
            window.pollFirst();
        &#125;
        // 4)
        if(R >= w - 1)&#123;
            res[L] = arr[window.peekFirst()];
        &#125;
    &#125;
    return res;
4 æ»¡è¶³ç»å¯¹å€¼å·®è¾¾æ ‡çš„å­æ•°ç»„æ•°é‡

ç»™å®šä¸€ä¸ªæ•´å‹æ•°ç»„arr, å’Œä¸€ä¸ªæ•´æ•°num æŸä¸€ä¸ªarrä¸­çš„å­æ•°ç»„sub å¦‚æœæƒ³è¾¾æ ‡å¿…é¡»æ»¡è¶³ subä¸­æœ€å¤§å€¼ - subä¸­å›½æœ€å°å€¼ &lt;= num è¿”å›arrä¸­è¾¾æ ‡å­æ•°ç»„çš„æ•°é‡

public class SW_AllLessNumSubArray &#123;
	// 1 éœ€è¦ä¸¤ä¸ªåŒç«¯é˜Ÿåˆ—æ¥å­˜å‚¨maxå’Œmin
	// 2 éå†æ•°ç»„æ¯ä¸€ä¸ªæ•°éƒ½åšä¸€æ¬¡Lå¼€å¤´
	// 2.1 å¾€å³Rç›´åˆ°å½“å‰çª—å£å†…å­æ•°ç»„ä¸è¾¾æ ‡
	// 2.1.1 æ»‘åŠ¨çª—å£æ¯”è¾ƒå¼¹å‡ºæœ«å°¾æ·»åŠ å½“å‰å€¼
	// 2.1.2 ä¸è¾¾æ ‡è¦break
	// 2.2 åˆ°è¾¾äº†ä¸è¾¾æ ‡çš„ä½ç½® å°±å¯ä»¥ç»“æŸå½“å‰Lå¼€å¤´çš„æ”¶é›† å¹¶å¼¹å‡ºå¼€å¤´
	// 2.2.1 æ›´æ–°res:å¯¹æ”¶é›†è¾¾æ ‡çš„æ•°ç»„ä¸ªæ•° è¿›è¡Œç´¯åŠ 
	// 2.2.2 æ›´æ–°çª—å£:å¼¹å‡ºLå¼€å¤´
	public static int allLessNumSubArray(int[] arr, int num) &#123;
		if (arr.length == 0 || arr == null) &#123;
			return 0;
		&#125;
		// 1 
		LinkedList&lt;Integer> qmin = new LinkedList&lt;>();
		LinkedList&lt;Integer> qmax = new LinkedList&lt;>();
		int L = 0;
		int R = 0;
		int res = 0;

		// 2 
		while (L &lt; arr.length) &#123;
			// 2.1
			while (R &lt; arr.length) &#123;
				// 2.1.1
				while (!qmax.isEmpty() &amp;&amp; arr[qmax.peekLast()] &lt;= arr[R]) &#123;
					qmax.pollLast();
				&#125;
				qmax.addLast(R);
				while (!qmin.isEmpty() &amp;&amp; arr[qmin.peekLast()] >= arr[R]) &#123;
					qmin.pollLast();
				&#125;
				qmin.addLast(R);
				// 2.1.2
				if (arr[qmax.getFirst()] - arr[qmin.getFirst()] > num) &#123;
					break;
				&#125;
				R++;
			&#125;

			// 2.2
			// 2.2.1
			res += R - L;
			// 2.2.2
			if (qmax.peekFirst() == L) &#123;
				qmax.pollFirst();
			&#125;
			if (qmin.peekFirst() == L) &#123;
				qmin.pollFirst();
			&#125;
			L++;
		&#125;
		return res;
	&#125;
&#125;
5 äºŒå‰æ ‘
public class TreeNode&#123;
  private int val;
  private TreeNode left;
  private TreeNode right;
  public TreeNode(int val, int left, int right) &#123;
    this.val = val;
    this.left = left;
    this.right = right;
  &#125;
&#125;
1 äºŒå‰æ ‘å…ˆã€ä¸­ã€ååºéå†(DFS)
é€’å½’
public void process(TreeNode head)&#123;
  // å‰
  process(head.left);
  // ä¸­
  process(head.right);
  // å
&#125;
éé€’å½’(å‹æ ˆ)

å…ˆï¼š å…ˆå‹å³å†å‹å·¦ è¾“å‡ºâ€”ã€‹å¤´å·¦å³

public void front(TreeNode head) &#123;
  if(head == null) &#123;
    return;
  &#125;
  Stack&lt;TreeNode> stack = new Stack&lt;>();
  stack.push(head);
  while(!stack.isEmpty()) &#123;
    TreeNode cur = stack.pop();
    // æ‰“å° 
    sysout();
    if(cur.right != null) &#123; // !!! åˆ¤ç©º
      stack.push(cur.right);
    &#125;
    if(cur.left != null) &#123; // !!! åˆ¤ç©º
      stack.push(cur.left);
    &#125;
  &#125;
  return;
&#125;

åï¼šç”¨ä¸¤ä¸ªæ ˆ 1ï¼‰å…ˆå‹å·¦å†å‹å³ åŒæ—¶ç­”åº”å¼¹å‡ºæ”¹ä¸ºå‹å…¥å¦ä¸€ä¸ªæ ˆ è¾“å‡ºâ€”ã€‹ å¤´å³å·¦ 2ï¼‰æœ€åè¾“å‡ºçš„æ—¶å€™å°±æ˜¯å·¦å³å¤´  å¤´å·¦å³

public void process(TreeNode head) &#123;
  if(head == null) &#123;return;&#125;
  Stack&lt;TreeNode> stack = new Stack&lt;>();
  Stack&lt;TreeNode> stack2 = new Stack&lt;>();
  while(!stack.isEmpty()) &#123;
    TreeNode cur = stack.pop();
    // å‰åºæ‰“å°è¡Œä¸ºæ”¹æˆå‹æ ˆ
    stack2.push(cur.val);
    if(cur.left != null) &#123; // å·¦
      stack.push(cur.left);
    &#125;
    if(cur.right != null) &#123;// å³
      stack.push(cur.right);
    &#125;
  &#125;
  // æ ˆ2 å¼¹å‡ºæ‰“å°
  while(!stack2.isEmpty()) &#123;
    TreeNode cur = stack.pop();
    // æ‰“å°
    sysout();
  &#125;
  return;
&#125;


ä¸­ï¼š 1ï¼‰å…ˆå°†å·¦è¾¹ç•Œå‹å…¥æ ˆ 2ï¼‰ç›´åˆ°nullï¼Œå¼¹å‡ºå¹¶æ‰“å°è¿›å…¥å³æ ‘



public void process(TreeNode head) &#123;
  if(head != null) &#123;
    Stack&lt;TreeNode> stack = new Stack&lt;>();// âš ï¸ä¸€å¼€å§‹ä¸ç”¨å¡head
    while(!stack.isEmpty() || head != null) &#123;
      if(head != null) &#123;
        stack.push(head);
        head = head.left;
      &#125; else&#123; // ç©ºäº† å°±å¼¹å‡ºæ‰“å° è¿›å…¥å³è¾¹
        head = stack.pop();
        sysout(head.val);
        head = head.right;
      &#125;
    &#125;
  &#125;
  return;
&#125;
äºŒå‰æœç´¢æ ‘ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ª
2 äºŒå‰æ ‘çš„å±‚åºéå†(BFSï¼‰
ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¯·ä½ è¿”å›å…¶æŒ‰ å±‚åºéå† å¾—åˆ°çš„èŠ‚ç‚¹å€¼ã€‚ ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰
 
1) æ‰“å°æ¯ä¸€å±‚

ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹rootï¼Œ è¿”å›å…¶èŠ‚ç‚¹å€¼çš„å±‚åºéå†ï¼Œå°±æ˜¯é€å±‚æ‰“å°

1.å…ˆå®šä¹‰ç»“æœé›†res å’Œåˆ¤ç©ºæ“ä½œ
2.å®šä¹‰é˜Ÿåˆ—å®¹å™¨ï¼Œheadæ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚
3.å®šä¹‰ç»“æœé›†å…ƒç´ list å³æ¯ä¸€å±‚ã€‚
public static List&lt;List&lt;Integer>> levelOrder(TreeNode head) &#123;
		// 1
		List&lt;List&lt;Integer>> res = new ArrayList&lt;>();
		if (head == null) &#123;
			return res;
		&#125;

		// 2
		Queue&lt;TreeNode> q = new LinkedList&lt;>();
		q.add(head);

		// 3
		while (!q.isEmpty()) &#123;
			int size = q.size();
			List&lt;Integer> list = new ArrayList&lt;>();
			for (int i = 0; i &lt; size; i++) &#123; // size !!!
				TreeNode cur = q.poll();
				list.add(cur.val);
				if (cur.left != null) &#123;
					q.add(cur.left);
				&#125;
				if (cur.right != null) &#123;
					q.add(cur.right);
				&#125;
			&#125;
			res.add(list);
		&#125;
		return res;
	&#125;
äºŒå‰æ ‘çš„é”¯é½¿å½¢éå†

å°±æ˜¯åœ¨å±‚åºéå†åŸºç¡€ä¸Š ä½¿ç”¨flagæ¥åˆ¤æ–­æ‰“å°çš„é¡ºåº âš ï¸list.add(0, root.val) å°±æ˜¯æ·»åŠ åˆ°å¼€å¤´

public List&lt;List&lt;Integer>> zigzagLevelOrder(TreeNode root) &#123;
     List&lt;List&lt;Integer>> res = new ArrayList&lt;List&lt;Integer>>();
     if(root == null)&#123;
         return res;
     &#125;
     Queue&lt;TreeNode> queue = new LinkedList&lt;TreeNode>();
     queue.add(root);
     boolean flag = true;
     while(! queue.isEmpty())&#123;
         List&lt;Integer> list = new ArrayList&lt;Integer>();
         int size = queue.size();
         for(int i = 0; i &lt; size; ++i)&#123;
             root =  queue.poll();
             if(flag)&#123;//é€šè¿‡flagåˆ¤æ–­æ‰“å°é¡ºåº
                 list.add(root.val);
             &#125;else&#123;
                 list.add(0, root.val);// ï¼ï¼ï¼
             &#125;
             if(root.left != null)&#123;
                 queue.add(root.left);
             &#125;
             if(root.right != null)&#123;
                 queue.add(root.right);
             &#125;

         &#125;
         flag = !flag;//è¿™é‡Œæ˜“é”™
         res.add(list);
     &#125;
     return res;
 &#125;
2ï¼‰è¿”å›èŠ‚ç‚¹æœ€å¤šçš„é‚£ä¸€å±‚

éœ€è¦curEndè®°å½•æ˜¯å¦å½“å‰åˆ°å±‚çš„ç»“å°¾ éœ€è¦nextEndè®°å½•ä¸‹ä¸€å±‚çš„æœ€åèŠ‚ç‚¹
å°†ä¸Šé¢å±‚åºéå†æ·»åŠ æ¯å±‚å…ƒç´ çš„è¿‡ç¨‹æ”¹ä¸ºè®°å½•å±‚çš„curSize
å½“cur == curEnd æ—¶ æ›´æ–° ans (maxWidth

public static int maxWidth(TreeNode head) &#123;
  int ans = 0;
  if(head == null) &#123;
    return ans;
  &#125;
 int curSize = 0;
  
&#125;
3ï¼‰äºŒå‰æ ‘çš„å³è§†å›¾

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„ æ ¹èŠ‚ç‚¹ rootï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚


éœ€è¦curEndè®°å½•æ˜¯å¦å½“å‰åˆ°å±‚çš„ç»“å°¾ éœ€è¦nextEndè®°å½•ä¸‹ä¸€å±‚çš„æœ€åèŠ‚ç‚¹
List&lt;Integer> res = new ArrayList&lt;>();
		if (head == null) &#123;
			return res;
		&#125;

		// 1
		TreeNode curEnd = head;
		TreeNode nextEnd = null;

		Queue&lt;TreeNode> q = new LinkedList&lt;>();
		q.add(head);

		while (!q.isEmpty()) &#123;
			TreeNode cur = q.poll();
			// 2 ç”¨nextEndè®°å½•æœ€åä¸€ä¸ªèŠ‚ç‚¹
			if (cur.left != null) &#123;
				q.add(cur.left);
				nextEnd = cur.left;
			&#125;
			if (cur.right != null) &#123;
				q.add(cur.right);
				nextEnd = cur.right;
			&#125;

			// 3 æ›´æ–°å½“å‰æœ€åçš„èŠ‚ç‚¹
			if (cur == curEnd) &#123;
				res.add(cur.val);
				curEnd = nextEnd;
			&#125;
		&#125;
		return res;
4ï¼‰æœ€å¤§å®½åº¦ï¼ˆå·¦å³èŠ‚ç‚¹çš„è·ç¦»ï¼‰

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è·å–è¿™ä¸ªæ ‘çš„æœ€å¤§å®½åº¦ã€‚æ ‘çš„å®½åº¦æ˜¯æ‰€æœ‰å±‚ä¸­çš„æœ€å¤§å®½åº¦ã€‚è¿™ä¸ªäºŒå‰æ ‘ä¸æ»¡äºŒå‰æ ‘ï¼ˆfull binary treeï¼‰ç»“æ„ç›¸åŒï¼Œä½†ä¸€äº›èŠ‚ç‚¹ä¸ºç©ºã€‚
æ¯ä¸€å±‚çš„å®½åº¦è¢«å®šä¹‰ä¸ºä¸¤ä¸ªç«¯ç‚¹ï¼ˆè¯¥å±‚æœ€å·¦å’Œæœ€å³çš„éç©ºèŠ‚ç‚¹ï¼Œä¸¤ç«¯ç‚¹é—´çš„nullèŠ‚ç‚¹ä¹Ÿè®¡å…¥é•¿åº¦ï¼‰ä¹‹é—´çš„é•¿åº¦ã€‚
é¿å…ä¸äº†è¦è®°å½•æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„index æ‰€ä»¥éœ€è¦ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ç»“æ„

newnode&#123;

â€‹	treenode node;

â€‹	int level;

â€‹	int pos;

&#125;



åœ¨å±‚åºéå†åŸºç¡€ä¸Š é˜Ÿåˆ—æ·»åŠ çš„æ˜¯ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ç»“æ„æ¥å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„å±‚æ•°å’Œpositionè¿›è¡Œè®°å½• ä¸éœ€è¦


æ¯æ¬¡é˜Ÿåˆ—è¿›è¡Œä¸€æ¬¡pollå¾ªç¯éƒ½è¦æ£€æŸ¥ å¦‚æœcurlever != cur.level è¯´æ˜åˆ°äº†ä¸‹ä¸€å±‚ï¼Œå°†curlevelæ›´æ–°ï¼Œç”¨firstæŠ“ä½ç¬¬ä¸€ä¸ªçš„pos


æ›´æ–°max


public int widthOfBinaryTree(TreeNode root) &#123;
        Queue&lt;NewNode> q = new LinkedList&lt;>();
        q.add(new NewNode(root, 0, 0)); // âš ï¸ä¸€å¼€å§‹æ·»åŠ çš„å°±æ˜¯newnode

        int ans = 0; 
        int curlevel = 0; // è®°å½•å½“å‰å±‚
        int firstpos = 0; // è®°å½•æ¯å±‚æœ€å‰
        
        while(!q.isEmpty())&#123;
            NewNode cur = q.poll();
            if(cur.node.left != null)&#123;
                q.add(new NewNode(cur.node.left, cur.level + 1, cur.pos * 2)); // âš ï¸ç»“æ„ä¸èƒ½æé”™ å‚æ•°ä¸è¦ç©¿é”™
            &#125;
            if(cur.node.right != null)&#123;
                q.add(new NewNode(cur.node.right, cur.level + 1 , cur.pos * 2 + 1)); // âš ï¸
            &#125;
            
            if(curlevel != cur.level)&#123;
                curlevel = cur.level;
                firstpos = cur.pos;
            &#125;

            ans = Math.max(ans, cur.pos - firstpos + 1);            
        &#125;
        return ans;
    &#125;

    public class NewNode&#123;
        private TreeNode node;
        private int level;
        private int pos;
        public NewNode(TreeNode node, int level, int pos)&#123;
            this.node = node;
            this.level = level;
            this.pos = pos;
        &#125;
    &#125;
3 äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚
ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€

Info&#123;boolean findP, boolean findQ, treenode ans&#125;
public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123;
       return process(root,p,q).ans;
   &#125;

public static class Info&#123;
	public boolean findP;// æ˜¯å¦åŒ…å«p
	public boolean findQ;// æ˜¯å¦åŒ…å«q
	public TreeNode ans;// ä¿å­˜ç»“æœ
	public Info(boolean findP, boolean findQ, TreeNode ans)&#123;
		this.findP = findP;
		this.findQ = findQ;
		this.ans = ans;
	&#125;
&#125;
private Info process(TreeNode root, TreeNode p, TreeNode q) &#123;
	
	if(root == null)&#123;
		return new Info(false, false, null);
	&#125;
	
	Info leftInfo = process(root.left, p, q);
	Info rightInfo = process(root.right, p, q);
	
   // å¡«å……å½“å‰info
	boolean findP = leftInfo.findP || rightInfo.findP || (root == p);
	boolean findQ = leftInfo.findQ || rightInfo.findQ || (root == q);
	
	TreeNode ans = null;
	if(leftInfo.ans != null)&#123;// leftInfo.findP &amp;&amp; leftInfo.findQ
		ans = leftInfo.ans;
	&#125;else if(rightInfo.ans != null)&#123; // rightInfo.findP &amp;&amp; rightInfo.findQ
		ans = rightInfo.ans;
	&#125;else if(findP &amp;&amp; findQ)&#123;
		ans = root;
	&#125;
	return new Info(findP, findQ, ans);
&#125;
4 äºŒå‰æ ‘æœ€å¤§è·¯å¾„å’Œ

public int maxPathSum(TreeNode root) &#123;
       if(root == null)&#123;
           return 0;
       &#125;
       return process(root).maxSum;
   &#125;
   public static class Info&#123; // z
	public int maxGain;//å¦‚æœè¿ä¸Šçˆ¶èŠ‚ç‚¹çš„è´¡çŒ®å€¼
	public int maxSum ;
	public Info(int m1, int m2)&#123;
		maxGain = m1;
		maxSum = m2;
	&#125;
&#125;

public static Info process(TreeNode head)&#123;
	if(head == null)&#123;
		return new Info(0, Integer.MIN_VALUE); // âš ï¸ maxsumè¿”å›minvalue
	&#125;
	Info leftInfo = process(head.left);
	Info rightInfo = process(head.right);
	
	int leftGain = Math.max(leftInfo.maxGain, 0); // âš ï¸ >0
	int rightGain = Math.max(rightInfo.maxGain, 0);
	
	int maxGain = Math.max(leftGain,rightGain) + head.val;
	
	int maxSum = Math.max(
			Math.max(leftInfo.maxSum,rightInfo.maxSum),
			leftGain + rightGain + head.val);
	
	return new Info(maxGain, maxSum);
&#125;
5 å¯¹ç§°äºŒå‰æ ‘

ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œ æ£€æŸ¥å®ƒæ˜¯å¦è½´å¯¹ç§°ã€‚

public boolean isSymmetric(TreeNode root) &#123;
      return isMirror(root, root); // å¤åˆ¶ä¸€ä¸ªè‡ªå·±çš„æ ‘
      &#125;
  public static boolean isMirror(TreeNode h1, TreeNode h2) &#123;
      if(h1 == null &amp;&amp; h2 == null)&#123; //ä¸¤ä¸ªæ ‘éƒ½æ˜¯ç©º
          return true;
      &#125;
      if(h1 != null &amp;&amp; h2 != null)&#123;// ä¸¤ä¸ªæ ‘éƒ½ä¸æ˜¯ç©º å°±è¿”å›ï¼š1.å½“å‰èŠ‚ç‚¹å€¼è¦ç›¸ç­‰ 2.å·¦è¾¹å’Œå³è¾¹ä¹Ÿæ˜¯mirror
          return (h1.val == h2.val) &amp;&amp; isMirror(h1.left, h2.right) &amp;&amp; isMirror(h1.right, h2.left); // 
      &#125;
      return false; //ä¸€ä¸ªæ˜¯ç©ºä¸€ä¸ªä¸æ˜¯ç©º

  &#125;
6 ä»å‰åºå’Œä¸­åºåºåˆ—æ„é€ äºŒå‰æ ‘

ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ preorder å’Œ inorder ï¼Œå…¶ä¸­ preorder æ˜¯äºŒå‰æ ‘çš„å…ˆåºéå†ï¼Œ inorder æ˜¯åŒä¸€æ£µæ ‘çš„ä¸­åºéå†ï¼Œè¯·æ„é€ äºŒå‰æ ‘å¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹ã€‚

/**
	 * åˆ©ç”¨äºŒå‰æ ‘å‰åº å¤´å·¦å³ æ‰¾åˆ°å¤´ å†åˆ©ç”¨ä¸­åºå·¦å³å¤´è¿›è¡Œå·¦å³æ ‘åˆ†ç¦»
	 */
    public TreeNode buildTree(int[] pre, int[] in) &#123;
        if(pre == null || in == null || pre.length != in.length)&#123;
            return null;
        &#125;
        return f(pre, 0, pre.length- 1, in, 0, in.length - 1);
    &#125;

    private TreeNode f(int[] pre, int L1, int R1, int[] in, int L2, int R2)&#123;
        // è¶Šç•Œæƒ…å†µ
        if(L1 > R1)&#123;
            return null;
        &#125;
      	// åˆ©ç”¨å‰åºæ‰¾åˆ°å¤´
        TreeNode head = new TreeNode(pre[L1]);
        if(L1 == R1)&#123;
            return head;
        &#125;

       //ä¸­åºå¯¹åº”æ‰¾åˆ°å¤´çš„ä¸‹æ ‡find
        int find = L2;
        while(in[find] != pre[L1])&#123;
            find++;
        &#125;
				// ï¼ˆfind - L2)å°±æ˜¯å·¦æ ‘çš„é•¿åº¦
        head.left = f(pre, L1 + 1, L1 + (find - L2), in, L2, find - 1);
        head.right = f(pre,  L1 + (find - L2) + 1, R1, in, find + 1, R2);
        return head;
    &#125;
&#125;
	
7 éªŒè¯äºŒå‰æœç´¢æ ‘

ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚
æœ‰æ•ˆ äºŒå‰æœç´¢æ ‘å®šä¹‰å¦‚ä¸‹ï¼š
èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å« å°äº å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚
èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å« å¤§äº å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚
æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚

/*
* ç”¨ä¸­åºéå†
*/
public static boolean isValidBST(TreeNode head)&#123;
		if(head != null)&#123;
			Stack&lt;TreeNode> stack = new Stack&lt;TreeNode>();
			double last = -Double.MAX_VALUE;// âš ï¸
			while(!stack.isEmpty() || head != null)&#123;
				// 1 
				if(head != null)&#123;
					stack.push(head);
					head = head.left;
				&#125;else&#123;// 2
					head = stack.pop();
					if(head.val &lt;= last)&#123;
						return false;
					&#125;
					last = head.val;
					head = head.right;
				&#125;
			&#125;
		&#125;
		return true;
	&#125;
8 å¹³è¡¡äºŒå‰æ ‘
ä½¿ç”¨é€’å½’å¥—è·¯
INFO &#123;
	é«˜åº¦ï¼›
	æ˜¯å¦æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼›
&#125;
public boolean isBalanced(TreeNode root) &#123;
      return process(root).isBt;
  &#125;

  //éœ€è¦çš„ä¿¡æ¯
  public static class Info&#123;
      private int height;
      private boolean isBt;
      public Info(int h, boolean ib)&#123;
          height = h;
          isBt = ib;
      &#125;
  &#125;
  //æ‰¾ä¿¡æ¯çš„è¿‡ç¨‹
  public static Info process(TreeNode head)&#123;
      if(head == null)&#123;
          return new Info(0, true);
      &#125;
      Info leftInfo = process(head.left);
      Info rightInfo = process(head.right);


      //è§£å†³å½“å‰çš„Infoçš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯æ‰€æœ‰é€’å½’éƒ½ä¼šç”¨åˆ°çš„æ–¹æ³•ï¼‰
      int height = Math.max(leftInfo.height, rightInfo.height) + 1; // âš ï¸ 
      boolean isBalanced = false;
      if(leftInfo.isBt &amp;&amp; rightInfo.isBt &amp;&amp; Math.abs(leftInfo.height - rightInfo.height) &lt;= 1)&#123;
          isBalanced = true;
      &#125;
      return new Info(height, isBalanced);
  &#125;
9 äºŒå‰æ ‘çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–

æ€è·¯
åºåˆ—åŒ–ï¼š å‡†å¤‡ä¸€ä¸ªstringçš„é˜Ÿåˆ— ç„¶åæŒ‰ç…§å…ˆåºé¡ºåºå°†ç»“ç‚¹è½¬ä¸ºStringç±»å‹ç„¶ååŠ å…¥é˜Ÿåˆ—ï¼Œå·¦è¾¹å’Œå³è¾¹ç»“ç‚¹æŒ‰ç…§é¡ºåºé€’å½’æ‰§è¡Œè¯¥æ–¹æ³•
ååºåˆ—åŒ–ï¼š å°†è¦è½¬åŒ–ä¸ºäºŒå‰æ ‘çš„é˜Ÿåˆ—ä¼ å…¥ï¼Œç„¶åå¼¹å‡ºç»“ç‚¹ä¸ºheadï¼ˆæ³¨æ„è½¬æ¢å›ä¸ºIntç±»å‹ï¼‰ï¼Œheadå·¦è¾¹é€’å½’æ‰§è¡Œprebï¼ˆprelistï¼‰ï¼Œå³è¾¹é€’å½’æ‰§è¡Œprebï¼ˆprelistï¼‰
é”™è¯¯
åˆ¤æ–­nullå€¼æ³¨æ„åˆ¤æ–­å“ˆ ç‰¹åˆ«æ˜¯é€’å½’é‡Œé¢ å°±ç®—æ˜¯æ–¹æ³•å‰é¢åˆ¤æ–­äº† å½“æ—¶ä¸ä»£è¡¨é€’å½’ä»¥åä¸ä¼šå†æ¬¡å‡ºç°ï¼Œæ‰€ä»¥æ–¹æ³•å†…è¿˜è¦å†åˆ¤æ–­ä¸€æ¬¡

/*
 * äºŒå‰æ ‘çš„å‰ä¸­ååºåˆ—åŒ–
 */
public class BT_09_preSerial &#123;
	
	/**
	 * åºåˆ—åŒ– ä½¿ç”¨é˜Ÿåˆ—
	 * @param head
	 * @return
	 */
	public static Queue&lt;String> preSerial(TreeNode head)&#123;
		Queue&lt;String> ans = new LinkedList&lt;>();
		pre(head, ans);
		return ans;
	&#125;

	private static void pre(TreeNode head, Queue&lt;String> ans) &#123;
		
		if(head == null)&#123;
			ans.add(null);// ç”¨æ¥è§„å®šç”¨ä»€ä¹ˆæ¥å ä½
		&#125;else&#123;
			ans.add(String.valueOf(head.val));
			pre(head.left, ans);
			pre(head.right, ans);
		&#125;
	&#125;
	
	
	/**
	 * ååºåˆ—åŒ–
	 * @param head
	 * @return
	 */
	public static TreeNode buildByPreQueue(Queue&lt;String> prelist)&#123;
		if(prelist == null || prelist.size() == 0)&#123;
			return null;
		&#125;
		return preb(prelist);
	&#125;

	private static TreeNode preb(Queue&lt;String> prelist) &#123;
		String value = prelist.poll();
		if(value == null)&#123;
			return null;
		&#125;
		TreeNode head = new TreeNode(Integer.valueOf(value));
		head.left = preb(prelist);
		head.right = preb(prelist);
		return head;
	&#125;

&#125;

10 äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚
äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚
è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚
ç¤ºä¾‹ï¼š
ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ
3
/ 
9  20
/  
15   7
è¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚

class Solution &#123;
    public int maxDepth(TreeNode root) &#123;
        return findDepth(root).height;
    &#125;

    public static class Info&#123;
        public int height;
        public Info(int h)&#123;
            height = h;
        &#125;
    &#125;

    public static Info findDepth(TreeNode head)&#123;
        if(head == null)&#123;
            return new Info(0);
        &#125;

        Info leftInfo = findDepth(head.left);
        Info rightInfo = findDepth(head.right);

        int height = Math.max(leftInfo.height, rightInfo.height) + 1;
        return new Info(height);
    &#125;
&#125;
11 æœ€å¤§ç›´å¾„

ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œä½ éœ€è¦è®¡ç®—å®ƒçš„ç›´å¾„é•¿åº¦ã€‚ä¸€æ£µäºŒå‰æ ‘çš„ç›´å¾„é•¿åº¦æ˜¯ä»»æ„ä¸¤ä¸ªç»“ç‚¹è·¯å¾„é•¿åº¦ä¸­çš„æœ€å¤§å€¼ã€‚è¿™æ¡è·¯å¾„å¯èƒ½ç©¿è¿‡ä¹Ÿå¯èƒ½ä¸ç©¿è¿‡æ ¹ç»“ç‚¹ã€‚
ç¤ºä¾‹ :
ç»™å®šäºŒå‰æ ‘
   1
  / \
 2   3
/ \     

4   5
è¿”å› 3, å®ƒçš„é•¿åº¦æ˜¯è·¯å¾„ [4,2,1,3] æˆ–è€… [5,2,1,3]ã€‚

/*
 * äºŒå‰æ ‘æœ€å¤§ç›´å¾„
 */
public class BT_05_ZhiJing &#123;
	static int ans = 1;
	public int max(TreeNode head)&#123;
		
		return process(head) - 1;
	&#125;
	
	public static int process(TreeNode head)&#123;
		if(head == null)&#123;
			return 0;
		&#125;
		
		int lM = process(head.left);
		int rM = process(head.right);
		ans = Math.max(lM + rM + 1, ans);
		
		return Math.max(lM, rM) + 1;
	&#125;
	
	/**
	 * é€’å½’å¥—è·¯
	 * @param root
	 * @return
	 */
	public int max2(TreeNode root) &#123;
        if(root == null)&#123;
            return 0;
        &#125;
        return process2(root).max;
    &#125;

	public static class Info&#123;
		public Integer height;
		public Integer max;
		public Info(Integer h, Integer m)&#123;
			height = h;
			max = m;
		&#125;
	&#125;
	private Info process2(TreeNode root) &#123;
		if(root == null)&#123;
			return new Info(0, 0);
		&#125;
		
		Info leftInfo = process2(root.left);
		Info rightInfo = process2(root.right);
	
		int height = Math.max(leftInfo.height, rightInfo.height) + 1;
		
		int max = Math.max(Math.max(leftInfo.max, rightInfo.max),
				leftInfo.height + rightInfo.height);
		
		return new Info(height, max);
	&#125;
&#125;
12 è·¯å¾„æ€»å’Œ
/**
	 * è·¯å¾„æ€»å’Œ â… 
	 * @return è¦æ±‚è¿”å›æ˜¯å¦å­˜åœ¨æ€»å’Œä¸ºtargetçš„ä»æ ¹åˆ°èŠ‚ç‚¹çš„è·¯å¾„
	 */
	public static boolean isSum;

	
	public boolean hasPathSum(TreeNode root, int targetSum) &#123;
		if (root == null) &#123;
			return false;
		&#125;
		isSum = false;
		process(root, 0, targetSum);
		return isSum;
	&#125;

	public void process(TreeNode head, int preSum, int sum) &#123;
		// æ˜¯å¶å­èŠ‚ç‚¹
		if (head.left == null &amp;&amp; head.right == null) &#123;
			if (preSum + head.val == sum) &#123;
				isSum = true;
			&#125;
			return;
		&#125;

		// ä¸æ˜¯å¶å­èŠ‚ç‚¹
		preSum += head.val;
		if (head.left != null) &#123;
			process(head.left, preSum, sum);
		&#125;
		if (head.right != null) &#123;
			process(head.right, preSum, sum);
		&#125;

	&#125;

	/**
	 * è·¯å¾„æ€»å’Œâ…¡
	 * @return è¦æ±‚è¿”å›æ‰€æœ‰æ»¡è¶³targetçš„è·¯å¾„
	 */
	// 1 
	// 2 æ³¨æ„ç°åœºè¦æ¢å¤ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªpathæ¥å­˜è·¯ å¦‚æœæ²¡æœ‰æ¸…ç©ºï¼Œåé¢æ ¹æœ¬è£…ä¸ä¸‹
	public List&lt;List&lt;Integer>> pathSum(TreeNode root, int targetSum) &#123;
		List&lt;List&lt;Integer>> ans = new ArrayList&lt;>();
		if (root == null) &#123;
			return ans;
		&#125;

		List&lt;Integer> path = new ArrayList&lt;>();
		process(root, path, 0, targetSum, ans);
		return ans;
	&#125;

	public void process(TreeNode head, List&lt;Integer> path, int preSum, int sum,
			List&lt;List&lt;Integer>> ans) &#123;

		// å¶å­èŠ‚ç‚¹
		if (head.left == null &amp;&amp; head.right == null) &#123;
			if (head.val + preSum == sum) &#123;
				path.add(head.val);
				ans.add(new ArrayList&lt;>(path));// ä¼ é€’æ˜¯å¼•ç”¨ä¸èƒ½ç›´æ¥ä¼ path
				path.remove(path.size() - 1);
			&#125;
		&#125;

		preSum += head.val;
		path.add(head.val);

		// ä¸æ˜¯å¶å­èŠ‚ç‚¹
		if (head.left != null) &#123;
			process(head.left, path, preSum, sum, ans);
		&#125;

		if (head.right != null) &#123;
			process(head.right, path, preSum, sum, ans);
		&#125;

		// æ¢å¤ç°åœº
		path.remove(path.size() - 1);

	&#125;

13 ç¿»è½¬äºŒå‰æ ‘

ç»™ä½ ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œç¿»è½¬è¿™æ£µäºŒå‰æ ‘ï¼Œå¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹ã€‚

ç¿»è½¬äºŒå‰æ ‘

 // æœ‰ç‚¹åƒæ•°ç»„swap
    public TreeNode invertTree(TreeNode root) &#123;
        if(root == null) &#123;
            return null;
        &#125;
        TreeNode left = root.left;
        root.left = invertTree(root.right);
        root.right = invertTree(left);
        return root;

    &#125;
6 æ ˆ
1 æœ‰æ•ˆæ‹¬å·

ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ '('ï¼Œ')'ï¼Œ'&#123;'ï¼Œ'&#125;'ï¼Œ'['ï¼Œ']' çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚


éå†æ‰€æœ‰å·¦è¾¹çš„æ‹¬å·å˜æˆå¯¹åº”çš„å³æ‹¬å·å‹å…¥æ ˆ
é‡åˆ°çš„å³è¾¹çš„æ‹¬å·

å¦‚æœstackæ˜¯ç©ºçš„ï¼Œåˆ™false
å¼¹å‡ºæ ˆé¡¶æ¯”è¾ƒä¸ç›¸ç­‰ false


æœ€åstack å¿…é¡»æ˜¯ç©ºçš„æ‰èƒ½æ»¡è¶³

public boolean isValid(String s) &#123;
	 	char[] str = s.toCharArray();
        Stack&lt;Character> stack = new Stack&lt;>();
        for(int i = 0; i &lt; str.length; i++) &#123;
            if(str[i] == '(' || str[i] == '[' || str[i] == '&#123;') &#123;
                stack.push(str[i]);
            &#125; else&#123;
                if(stack.isEmpty()) &#123;
                    return false;
                &#125; 
                char cur = stack.pop();
                if((str[i] == ')' &amp;&amp; cur != '(') || (str[i] 
                == '&#125;' &amp;&amp; cur != '&#123;') || (str[i] == ']' &amp;&amp; cur != '[')) &#123;
                    return false;
                &#125;
            &#125;
        &#125;
        return stack.isEmpty();
&#125;
2 ç”¨æ ˆå®ç°é˜Ÿåˆ—
class MyQueue &#123;
		private Stack&lt;Integer> sPop;
    private Stack&lt;Integer> sPush;
    public MyQueue() &#123;
        sPop = new Stack&lt;Integer>();
        sPush = new Stack&lt;Integer>();
    &#125;
    
    public void push(int x) &#123;
        sPush.push(x);
    &#125;
    
    public int pop() &#123;
        if(sPop.isEmpty())&#123;
            while(!sPush.isEmpty())&#123;
                sPop.push(sPush.pop());
            &#125;
        &#125;
        return sPop.pop();
        
    &#125;
    
    public int peek() &#123;
        if(sPop.isEmpty())&#123;
            while(!sPush.isEmpty())&#123;
                sPop.push(sPush.pop());
            &#125;
        &#125;
        return sPop.peek();
    &#125;
    
    public boolean empty() &#123;
        if(sPop.isEmpty() &amp;&amp; sPush.isEmpty())&#123;
            return true;
        &#125; else&#123;
            return false;
        &#125;
    &#125;
&#125;
3 æœ€å°æ ˆ

è®¾è®¡ä¸€ä¸ªæ”¯æŒ push ï¼Œpop ï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚

push(x) â€”â€” å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚
pop() â€”â€” åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚
top() â€”â€” è·å–æ ˆé¡¶å…ƒç´ ã€‚
getMin() â€”â€” æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚


public class MinStack &#123;
	public Stack&lt;Integer> data;
	public Stack&lt;Integer> min;
	
	public MinStack() &#123;
		this.data = new Stack&lt;Integer>();
		this.min = new Stack&lt;Integer>();
		
    &#125;
    
    public void push(int val) &#123;
    	if(this.min.isEmpty())&#123;
    		this.min.push(val);
    	&#125;else if(val &lt; this.getMin())&#123;
    		this.min.push(val);
    	&#125;else&#123;
    		this.min.push(this.getMin());
    	&#125;
    	this.data.push(val);
    	

    &#125;
    
    public void pop() &#123;
    	this.data.pop();
    	this.min.pop();
    &#125;
    
    public int top() &#123;
    	return this.data.peek();
    &#125;
    
    public int getMin() &#123;
    	return this.min.peek();
    &#125;
&#125;

4 ä¸¤ä¸ªé˜Ÿåˆ—å®ç°æ ˆ
åœ¨pushæ“ä½œé‡Œè¿›è¡Œæ”¹è¿›å°±å¯ä»¥ï¼š
é€šè¿‡
class MyStack &#123;
           public Queue&lt;Integer> q1;
        public Queue&lt;Integer> q2;
        /** Initialize your data structure here. */
        public MyStack()&#123;
            q1 = new LinkedList&lt;Integer>();
            q2 = new LinkedList&lt;Integer>();
        &#125;


        /** Push element x onto stack. */
        public void push(int x) &#123;
            q2.offer(x);
            while(!q1.isEmpty())&#123;
                q2.offer(q1.poll());
            &#125;
            Queue&lt;Integer> tmp = q1;
            q1 = q2;
            q2 = tmp;
        &#125;

        /** Removes the element on top of the stack and returns that element. */
        public int pop() &#123;
            return q1.poll();
        &#125;

        /** Get the top element. */
        public int top() &#123;
            return q1.peek();

        &#125;

        /** Returns whether the stack is empty. */
        public boolean empty() &#123;
            return q1.isEmpty();
        &#125;
&#125;
ç”¨ä¸€ä¸ªé˜Ÿåˆ—ä¹Ÿå¯ä»¥
public void push(int x) &#123;
       int n = queue.size();
       queue.offer(x);
       for (int i = 0; i &lt; n; i++) &#123;
           queue.offer(queue.poll());
       &#125;
   &#125;
5 å•è°ƒæ ˆ
ä¸ºäº†è§£å†³ç»™å®šçš„ä¸€ä¸ªå¯èƒ½å«æœ‰é‡å¤å€¼çš„arrï¼Œiä½ç½®ä¸€å®šæœ‰ä»¥ä¸‹ä¿¡æ¯
1ï¼‰arr[i] å·¦è¾¹æœ‰ç¦»å®ƒæœ€è¿‘æ¯”å®ƒå°çš„ï¼ˆå¤§ï¼‰çš„æ•°
2ï¼‰arr[i] å³è¾¹æœ‰ç¦»å®ƒæœ€è¿‘æ¯”å®ƒå°çš„ï¼ˆå¤§ï¼‰çš„æ•°
æ‰¾åˆ°å·¦è¾¹å’Œå³è¾¹ç¦»iæœ€è¿‘æ¯”å…¶å°çš„ä¸‹è¡¨å¯¹ res[n][2]
public class Code1_MonotonousStack &#123;
	public static int[][] getNearLessNoRepeat(int[] arr)&#123;
		int[][] res = new int[arr.length][2];
		Stack&lt;Integer> stack = new Stack&lt;>();
		
		for(int i = 0; i &lt; arr.length; i++)&#123;
			//æ–°çš„æ•°å‹æ ˆ å¦‚æœæ¯”æ ˆåº•å° æ ˆåº•å¼¹å‡º å¹¶è®°å½•
			while(!stack.isEmpty() &amp;&amp; arr[stack.peek()] > arr[i])&#123;
				int popIndex = stack.pop();
				int leftLessIndex = stack.isEmpty() ? -1 : stack.peek();
				res[popIndex][0] = leftLessIndex;
				res[popIndex][1] = i;
			&#125;
			stack.push(i);
		&#125;
		while(!stack.isEmpty())&#123;
			int popIndex = stack.pop();
			int leftLessIndex = stack.isEmpty() ? -1 : stack.peek();
			res[popIndex][0] = leftLessIndex;
			res[popIndex][1] = -1;
			
		&#125;
		return res;
	&#125;
	
	
	//æ•°ç»„ä¸­æœ‰é‡å¤çš„æƒ…å†µ
	public static int[][] getNearLess(int[] arr)&#123;
		int[][] res = new int[arr.length][2];
		
		// List&lt;Integer> -> æ”¾çš„æ˜¯ä½ç½®ï¼ŒåŒæ ·å€¼çš„ä¸œè¥¿ï¼Œä½ç½®å‹åœ¨ä¸€èµ·
		// ä»£è¡¨å€¼    åº•  ->  é¡¶   å°  -> å¤§
		Stack&lt;List&lt;Integer>> stack = new Stack&lt;>();
		
		for(int i = 0; i &lt; arr.length; i++)&#123;
			//æ–°çš„æ•°å‹æ ˆ å¦‚æœæ¯”æ ˆåº•å° æ ˆåº•å¼¹å‡º å¹¶è®°å½•
			while(!stack.isEmpty() &amp;&amp; arr[stack.peek().get(0)] > arr[i])&#123;
				List&lt;Integer> popIndex = stack.pop();
				int leftLessIndex = stack.isEmpty() ? -1 : stack.peek().get(stack.peek().size() - 1);
				for(Integer popi : popIndex)&#123;
					res[popi][0] = leftLessIndex;
					res[popi][1] = i;
				&#125;
			&#125;
			//ç›¸ç­‰çš„æ¯”ä½ å°çš„ éƒ½è¦æŠŠå­˜å…¥æ ˆçš„æ ¼å¼æ”¹ä¸ºå­˜å‚¨äº†ä½ç½®çš„listæ•°ç»„
			if(!stack.isEmpty() &amp;&amp; arr[stack.peek().get(0)] == arr[i])&#123;
				stack.peek().add(Integer.valueOf(i));
				
			&#125;else&#123;
				List&lt;Integer> pushIndex = new ArrayList&lt;>();
				pushIndex.add(Integer.valueOf(i));
				stack.push(pushIndex);
			&#125;
			
		&#125;
		
		while(!stack.isEmpty())&#123;
			List&lt;Integer> popIndex = stack.pop();
			//å–å†³äºæœ€æ™šåŠ å…¥çš„é‚£ä¸ª
			int leftLessIndex = stack.isEmpty() ? -1 : stack.peek().get(stack.peek().size() - 1);
			for(Integer popi : popIndex)&#123;
				res[popi][0] = leftLessIndex;
				res[popi][1] = -1;
			&#125;
		&#125;
		return res;
	&#125;

&#125;

æ­£æ•°æ•°ç»„arrä¸­ï¼ˆsubçš„ç´¯åŠ å’Œ*minï¼‰çš„æœ€å¤§å€¼

ç»™å®šä¸€ä¸ªåªåŒ…å«æ­£æ•°çš„æ•°ç»„arrï¼Œarrä¸­ä»»ä½•ä¸€ä¸ªå­æ•°ç»„subï¼Œä¸€å®šéƒ½å¯ä»¥ç®—å‡º(subç´¯åŠ å’Œ )* (subä¸­çš„æœ€å°å€¼)æ˜¯ä»€ä¹ˆï¼Œ
é‚£ä¹ˆæ‰€æœ‰å­æ•°ç»„ä¸­ï¼Œè¿™ä¸ªå€¼æœ€å¤§æ˜¯å¤šå°‘ï¼Ÿ

ç›´æ¥æ‰¾æ¯ä¸ªæ•°ä¸¤è¾¹æœ€è¿‘æ¯”å®ƒå°ä¸­é—´éƒ¨åˆ†ç´¯åŠ å’Œï¼ˆè¿™éƒ¨åˆ†è¯¥æ•°ä¸€å®šæœ€å°ï¼‰
1 å»ºç«‹å‰ç¼€å’Œæ•°ç»„sums[i](è¿™æ ·æ±‚ç´¯åŠ å’Œå°±å¯ä»¥[0~R] -[0~L-1])
2 å’Œä¸Šé¢å•è°ƒæ ˆæ€è·¯å·®ä¸å¤š
â€‹	1ï¼‰æ ˆé¡¶å¼¹å‡º[j]åæ›´æ–°max
â€‹	2ï¼‰å†éå†æ ˆé‡Œçš„å…ƒç´  å³è¾¹æ²¡æœ‰æ¯”å®ƒæœ€å°æ‰€ä»¥ç´¯åŠ ç›´æ¥ç”¨sums[N-1]æ¥å‡

7 é€’å½’
1 å…¨æ’åˆ—

ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆ


public static List&lt;List&lt;Integer>> permute(int[] nums) &#123;
        List&lt;List&lt;Integer>> ans = new ArrayList&lt;>();
        List&lt;Integer> path = new ArrayList&lt;Integer>();//é€‰æ‹©çš„è·¯
        if(nums.length == 0 || nums == null)&#123;
        	return ans;
        &#125;
        for (int num : nums) &#123;
            path.add(num);
        &#125;
        process(path, 0, ans);
        return ans;
    &#125;
	
	//  DFS
	// 1 foræ˜¯åœ¨æ ‘å½¢ç»“æ„é‡Œå¹³è¡Œè¿›è¡Œ  - - ->
	// 2 å…ˆäº¤æ¢æˆä¸ºä¸€ç§æƒ…å†µ
	// 3 å¾€ä¸‹|é€’å½’å°†å‰©ä½™éƒ¨åˆ†çš„æƒ…å†µæå®š
	//      |
	//      v
	// 4 æ¢å¤åŸæ¥çŠ¶æ€ å› ä¸ºå¹³è¡Œçš„åˆ†æ”¯éœ€è¦åŒæ ·çš„çŠ¶æ€
	public static void process(List&lt;Integer> path, int i, List&lt;List&lt;Integer>> ans)&#123;
		if(i == path.size())&#123;
			ans.add(new ArrayList&lt;Integer>(path));
		&#125;
		boolean[] vis = new boolean[256];
		
		// 1
		for(int j = i; j &lt; path.size(); j++)&#123;
			if(!vis[path.get(j) + 128])&#123; // å‰ªæ
				vis[path.get(j) + 128] = true;
				// 2
				Collections.swap(path, i, j);
				// 3
				process(path, i + 1, ans);
				// 4
				Collections.swap(path, i, j);
			&#125;
			
		&#125;
	&#125;

å…¨æ’åˆ—2âƒ£ï¸ ä¸é‡å¤
/*
 * å…¨æ’åˆ—
 * å°†ç»™å®šæ•°ç»„è¿›è¡Œæ’åˆ—ç»„åˆ 
 */
public class Recursionå›æº¯_Permutation &#123;
    public static List&lt;List&lt;Integer>> permute(int[] nums) &#123;
        List&lt;List&lt;Integer>> ans = new ArrayList&lt;>();
        List&lt;Integer> path = new ArrayList&lt;>();// ä¸åŒæ‰“å°ç»“æœå­˜å‚¨
        for(int num : nums)&#123;
            path.add(num);
        &#125;
        process(path, 0, ans);
        return ans;

    &#125;

    //  DFS
    // 1 foræ˜¯åœ¨æ ‘å½¢ç»“æ„é‡Œå¹³è¡Œè¿›è¡Œ  - - ->
    // 2 å…ˆäº¤æ¢æˆä¸ºä¸€ç§æƒ…å†µ
    // 3 å¾€ä¸‹|é€’å½’å°†å‰©ä½™éƒ¨åˆ†çš„æƒ…å†µæå®š
    //      |
    //      v
    // 4 æ¢å¤åŸæ¥çŠ¶æ€ å› ä¸ºå¹³è¡Œçš„åˆ†æ”¯éœ€è¦åŒæ ·çš„çŠ¶æ€
    public static void process(List&lt;Integer> path, int i, List&lt;List&lt;Integer>> ans)&#123;
        if(i == path.size())&#123;
            ans.add(new ArrayList&lt;Integer>(path));
        &#125;
        boolean[] vis = new boolean[256];

        // 1
        for(int j = i; j &lt; path.size(); j++)&#123;
            if(!vis[path.get(j)]+128)&#123; // å‰ªæ æ•°ç»„æœ‰è´Ÿæ•°è¦åŠ ä¸Š128
                vis[path.get(j)+128] = true;
                // 2
                Collections.swap(path, i, j);
                // 3
                process(path, i + 1, ans);
                // 4
                Collections.swap(path, i, j);
            &#125;

        &#125;
    &#125;

&#125;


2 æ‹¬å·ç”Ÿæˆ

æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸” æœ‰æ•ˆçš„ æ‹¬å·ç»„åˆã€‚

åˆ©ç”¨ä¸€ä¸ªåŸç†æ˜¯ å½“å‰é¢å·²ç»åšäº†é€‰æ‹©çš„å·¦æ‹¬å·æ¯”å³æ‹¬å·å¤šçš„æ—¶å€™
å°±æ·»åŠ å³æ‹¬å· 
éœ€è¦å‰ªæ åœ¨å¾€pathé‡Œé¢æ·»åŠ æ‹¬å·çš„æ—¶å€™
è¿›è¡Œæ¡ä»¶å‰ªæ
public List&lt;String> generateParenthesis(int n) &#123;
        char[] path = new char[n &lt;&lt; 1];
        List&lt;String> ans = new ArrayList&lt;>();
        process(path,0, n, 0, ans); // âš ï¸ä¼ è¿›å»çš„å‚æ•°ï¼
        return ans;
    &#125;
// å‰ªæ å·¦è¾¹æ‹¬å·è¿˜æœ‰ å’Œå·¦è¾¹-å³è¾¹ã€‹0
    public static void process(char[] path, int i,int leftRest, int leftMinusRight, List&lt;String> ans )&#123;
        if(i == path.length)&#123; // åˆ°ç»“å°¾
            ans.add(String.valueOf(path)); // ä¸€ç§å¯èƒ½
        &#125; else &#123;
            if(leftRest > 0)&#123; // å·¦è¾¹çš„æ‹¬å·è¿˜æœ‰ å°†å½“å‰çš„ä½ç½®è®¾ä¸ºå·¦ï¼Œ å‰©ä¸‹çš„å»é€’å½’
                path[i] = '(';
                process(path, i + 1, leftRest - 1, leftMinusRight + 1, ans);
            &#125;
            if(leftMinusRight > 0)&#123;// å·¦è¾¹çš„æ‹¬å·å¤§äºå³è¾¹çš„æ‹¬å·
                path[i] = ')';
                process(path, i + 1, leftRest, leftMinusRight - 1, ans);
            &#125;
        &#125;
    &#125;
3 å¤åŸipåœ°å€

æœ‰æ•ˆ IP åœ°å€ æ­£å¥½ç”±å››ä¸ªæ•´æ•°ï¼ˆæ¯ä¸ªæ•´æ•°ä½äº 0 åˆ° 255 ä¹‹é—´ç»„æˆï¼Œä¸”ä¸èƒ½å«æœ‰å‰å¯¼ 0ï¼‰ï¼Œæ•´æ•°ä¹‹é—´ç”¨ â€˜.â€™ åˆ†éš”ã€‚
ä¾‹å¦‚ï¼šâ€œ0.1.2.201â€ å’Œ â€œ192.168.1.1â€ æ˜¯ æœ‰æ•ˆ IP åœ°å€ï¼Œä½†æ˜¯ â€œ0.011.255.245â€ã€â€œ192.168.1.312â€ å’Œ â€œ192.168@1.1â€ æ˜¯ æ— æ•ˆ IP åœ°å€ã€‚
ç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„å­—ç¬¦ä¸² s ï¼Œç”¨ä»¥è¡¨ç¤ºä¸€ä¸ª IP åœ°å€ï¼Œè¿”å›æ‰€æœ‰å¯èƒ½çš„æœ‰æ•ˆ IP åœ°å€ï¼Œè¿™äº›åœ°å€å¯ä»¥é€šè¿‡åœ¨ s ä¸­æ’å…¥ â€˜.â€™ æ¥å½¢æˆã€‚ä½  ä¸èƒ½ é‡æ–°æ’åºæˆ–åˆ é™¤ s ä¸­çš„ä»»ä½•æ•°å­—ã€‚ä½ å¯ä»¥æŒ‰ ä»»ä½• é¡ºåºè¿”å›ç­”æ¡ˆã€‚

 static final int COUNT = 4;
int[] segment; // segment[i]å­˜å‚¨ç¬¬iæ®µ
List&lt;String> ans = new ArrayList&lt;>();

public List&lt;String> restoreIpAddresses(String s) &#123;
	segment = new int[COUNT];
	dfs(s, 0, 0);// s å­—ç¬¦ä¸² id æ®µæ•° segstart
	return ans;
&#125;

public void dfs(String s, int id, int segStart) &#123;
	// 1 å·²ç»é€’å½’åˆ°ç¬¬å››æ®µ
	if (id == COUNT) &#123;
		if (segStart == s.length()) &#123;// å¹¶ä¸” æ‰€æœ‰æ•°å­—éƒ½å®Œæˆ
			StringBuffer str = new StringBuffer();
			for (int i = 0; i &lt; COUNT; i++) &#123;
				str.append(segment[i]);
				if (i != COUNT - 1) &#123;
					str.append('.');
				&#125;
			&#125;
			ans.add(str.toString());
		&#125;
		return; // è®°å¾—å‘ä¸Šè¿”å›ï¼ï¼ï¼

	&#125;
	// 2 å››æ®µæ²¡ç©ä½†æ˜¯å·²ç»åˆ°ç»“å°¾
	if (segStart == s.length()) &#123;
		return;
	&#125;

	// 3 æœ‰0çš„æƒ…å†µ
	if (s.charAt(segStart) == '0') &#123; // æœ‰é›¶
		segment[id] = 0;
		dfs(s, id + 1, segStart + 1);
	&#125;

	// 4 ä¸€èˆ¬æƒ…å†µ
	int ans = 0;
	for (int segEnd = segStart; segEnd &lt; s.length(); segEnd++) &#123;
		ans = ans * 10 + (s.charAt(segEnd) - '0');
		if (ans > 0 &amp;&amp; ans &lt;= 0xFF) &#123;// anså±äº[0, 255]
			segment[id] = ans;
			dfs(s, id + 1, segEnd + 1);
		&#125; else &#123;
			break;
		&#125;
	&#125;
&#125;
4 å•è¯æœç´¢
dfs+å›æº¯
class Solution &#123;
    public boolean exist(char[][] board, String word) &#123;
        int h = board.length, w = board[0].length;
        boolean[][] visited = new boolean[h][w];
        for (int i = 0; i &lt; h; i++) &#123;
            for (int j = 0; j &lt; w; j++) &#123;
                boolean flag = check(board, visited, i, j, word, 0);
                if (flag) &#123;
                    return true;
                &#125;
            &#125;
        &#125;
        return false;
    &#125;

    public boolean check(char[][] board, boolean[][] visited, int i, int j, String s, int k) &#123;
        if (board[i][j] != s.charAt(k)) &#123;
            return false;
        &#125; else if (k == s.length() - 1) &#123;
            return true;
        &#125;
        visited[i][j] = true;
        int[][] directions = &#123;&#123;0, 1&#125;, &#123;0, -1&#125;, &#123;1, 0&#125;, &#123;-1, 0&#125;&#125;;
        boolean result = false;
        for (int[] dir : directions) &#123;
            int newi = i + dir[0], newj = j + dir[1];
            if (newi >= 0 &amp;&amp; newi &lt; board.length &amp;&amp; newj >= 0 &amp;&amp; newj &lt; board[0].length) &#123;
                if (!visited[newi][newj]) &#123;
                    boolean flag = check(board, visited, newi, newj, s, k + 1);
                    if (flag) &#123;
                        result = true;
                        break;
                    &#125;
                &#125;
            &#125;
        &#125;
        visited[i][j] = false;
        return result;
    &#125;
&#125;

5 å­é›†

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ•°ç»„ä¸­çš„å…ƒç´  äº’ä¸ç›¸åŒ ã€‚è¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚
è§£é›† ä¸èƒ½ åŒ…å«é‡å¤çš„å­é›†ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›è§£é›†ã€‚
ç¤ºä¾‹ 1ï¼š
è¾“å…¥ï¼šnums = [1,2,3]
è¾“å‡ºï¼š[[],[1],[2],[1,2],[3],[1,3],[2,3],[1,2,3]]
ç¤ºä¾‹ 2ï¼š
è¾“å…¥ï¼šnums = [0]
è¾“å‡ºï¼š[[],[0]]

public static List&lt;List&lt;Integer>> subsets(int[] nums)&#123;
		List&lt;List&lt;Integer>> res = new ArrayList&lt;>();
		List&lt;Integer> path = new ArrayList&lt;>();//ç”¨æ¥å­˜æ”¾ä¹‹å‰å†³å®š
		if(nums.length == 0 || nums == null)&#123;
			return res;
		&#125;
		process2(nums, 0, res, path);
		return res;
		
	&#125;

	private static void process2(int[] nums, int i, List&lt;List&lt;Integer>> res, List&lt;Integer> path) &#123;
		if(i == nums.length)&#123;
			res.add(new ArrayList&lt;>(path));
			return;
		&#125;
		// ä¸¤ç§å¯èƒ½
		process2(nums, i + 1, res, path);
		List&lt;Integer> path2 = new ArrayList&lt;>(path);
		path2.add(nums[i]);
		process2(nums, i + 1, res, path2);
	&#125;
8 å¹¶æŸ¥é›†
å¹¶æŸ¥é›†
ç”¨æ¥è§£å†³å›¾çš„è¿é€šæ€§å’Œç¯çš„æ•°é‡
ç»“æ„ï¼ˆhashè¡¨ï¼‰
public class Code01_UnionFind &#123;
	public static class Node&lt;V> &#123;
		V value;
		public Node(V v) &#123;
			value = v;
		&#125;
	&#125;
	
	/**
	 * å¹¶æŸ¥é›† 
	 */
	// 1 æ„é€ æ–¹æ³•
	// 2 Node&lt;V> findFather(Node&lt;V> cur)
	// 3 boolean isSameSet(V a, V b)
	// 4 void union(V a, V b)
	// 5 int sets()
	public static class UnionFind&lt;V> &#123;
		public HashMap&lt;V, Node&lt;V>> nodes;// ç‚¹
		public HashMap&lt;Node&lt;V>, Node&lt;V>> parents;// æœ€é«˜çˆ¶äº²
		public HashMap&lt;Node&lt;V>, Integer> sizeMap;// æ‰€åœ¨é›†åˆå¤§å°
		
		public UnionFind(List&lt;V> values) &#123;
      //1 åˆå§‹åŒ–å‚æ•°
			nodes = new HashMap&lt;>();
			parents = new HashMap&lt;>();
			sizeMap = new HashMap&lt;>();
      //2 éå†ï¼šå…ˆnewä¸€ä¸ªnode ç„¶åæ›´æ–°ç‚¹é›†ï¼Œæ›´æ–°çˆ¶äº²è¡¨ï¼ˆè‡ªå·±æ˜¯è‡ªå·±çˆ¹ï¼‰ï¼Œæœ€åæ›´æ–°sizemap
			for (V cur : values) &#123;
				Node&lt;V> node = new Node&lt;>(cur);
				nodes.put(cur, node);
				parents.put(node, node);
				sizeMap.put(node, 1);
			&#125;
		&#125;
		
    // æ‰¾çˆ¹
		public Node&lt;V> findFather(Node&lt;V> cur) &#123; 
      //1 new ä¸€ä¸ª æ ˆ
			Stack&lt;Node&lt;V>> path = new Stack&lt;>();
      //2 å¦‚æœå½“å‰curä¸æ˜¯è‡ªå·±çˆ¹ ï¼š1ï¼‰å‹æ ˆ 2ï¼‰curæ›´æ–°ä¸ºè‡ªå·±çˆ¹
			while (cur != parents.get(cur)) &#123;
				path.push(cur);
				cur = parents.get(cur);
			&#125;
      //3 å¦‚æœæ ˆä¸ç©º curå°±æ˜¯å½“å‰æœ€çˆ¹ æ‰€ä»¥å¾ªç¯å¼¹å‡º å°†curè®¾ä¸ºä»–ä»¬çˆ¹
			while (!path.isEmpty()) &#123;
				parents.put(path.pop(), cur);
			&#125;
			return cur;
		&#125;
		
    // è¿”å›ä¸¤çˆ¹æ˜¯å¦ç›¸ç­‰
		public boolean isSameSet(V a, V b) &#123;
			return findFather(nodes.get(a)) == findFather(nodes.get(b));
		&#125;
    
		// å¹¶
		public void union(V a, V b) &#123;
			Node&lt;V> aHead = findFather(nodes.get(a));
			Node&lt;V> bHead = findFather(nodes.get(b));
			// å¦‚æœä¸¤çˆ¹ä¸åŒ
			if(aHead != bHead) &#123;
        // 1 æŠ“ä½sizeå¤§å°
				int aSize = sizeMap.get(aHead);
				int bSize = sizeMap.get(bHead);
        
        // 2 å°çš„é‚£ä¸ªæ¥åœ¨å¤§çš„ä¸‹é¢ï¼ˆbigæ˜¯smallçš„çˆ¶
				Node&lt;V> small = aSize &lt; bSize ? aHead : bHead;
				Node&lt;V> big = small == aHead ? bHead : aHead;
				parents.put(small, big);
        
        // 3 æ›´æ–°å¤§é›†çš„size å¹¶è½¬ç§»å°é›†çš„sizemap
				sizeMap.put(big, aSize + bSize);
				sizeMap.remove(small);
			&#125;
			
		&#125;
		
		public int sets() &#123;
			return sizeMap.size();
		&#125;
	&#125;
&#125;

1 å²›å±¿æ•°é‡

ç»™ä½ ä¸€ä¸ªç”± â€˜1â€™ï¼ˆé™†åœ°ï¼‰å’Œ â€˜0â€™ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚
å²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚
æ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚

public static int numIslands(char[][] board) &#123;
		int islands = 0;
		for (int i = 0; i &lt; board.length; i++) &#123;
			for (int j = 0; j &lt; board[0].length; j++) &#123;
				if (board[i][j] == '1') &#123;
					islands++;
					infect(board, i, j);
				&#125;
			&#125;
		&#125;
		return islands;
	&#125;

	// ä»(i,j)è¿™ä¸ªä½ç½®å‡ºå‘ï¼ŒæŠŠæ‰€æœ‰ç»ƒæˆä¸€ç‰‡çš„'1'å­—ç¬¦ï¼Œå˜æˆ0
	// DFS
	public static void infect(char[][] board, int a, int b) &#123;
		if (i &lt; 0 || j &lt; 0 || i >= board.length || j >= board[0].length
				|| board[i][j] != '1') &#123;
			return;
		&#125;
		board[i][j] = 0;
		infect1(board, i, j - 1);
		infect1(board, i, j + 1);
		infect1(board, i + 1, j);
		infect1(board, i - 1, j);

		&#125;
	&#125;
	/*
	 * BFS
	 */
	public static void infect2(char[][] board, int a, int b) &#123;
		Queue&lt;int[]> list = new LinkedList&lt;>();
		list.add(new int[] &#123; a, b &#125;);
		while(!list.isEmpty()) &#123;
			int[] cur = list.poll();
			int i = cur[0];
			int j = cur[1];
			if (i >= 0 &amp;&amp; j >= 0 &amp;&amp; i &lt; board.length &amp;&amp; j &lt; board[0].length
					&amp;&amp; board[i][j] == '1') &#123;
				board[i][j] = 0;
				list.add(new int[] &#123; i - 1, j &#125;);
				list.add(new int[] &#123; i + 1, j &#125;);
				list.add(new int[] &#123; i, j - 1 &#125;);
				list.add(new int[] &#123; i, j + 1 &#125;);
			&#125;
    &#125;
	
ä½¿ç”¨å¹¶æŸ¥é›†ï¼ˆé¢è¯•ï¼‰
ä¸ºä»€ä¹ˆè¦å¹¶æŸ¥é›†ï¼Ÿ å¦‚æœæœ‰å¤šå°cpu å¤§å²›å˜æˆå°å²›å°±ä¼šå¾ˆå®¹æ˜“
é¢è¯•å°±è®²ä¸€ä¸‹æ€ä¹ˆé€šè¿‡å¹¶æŸ¥é›†æ¥è¿›è¡Œunion ï¼š å¹¶æŸ¥é›†å°±æ˜¯å¯ä»¥å°†a, bæ‰€åœ¨çš„é›†åˆè¿›è¡Œåˆå¹¶ï¼›éœ€è¦æ¯ä¸ªå²›çš„ä½ç½® æ‰€ä»¥éœ€è¦ä¸€ä¸ªindexæ–¹æ³•æ¥è¿”å›æ¯æ ¼å­çš„ä½ç½®å°±æ˜¯è¡Œæ•°ä¹˜ä»¥çŸ©é˜µå®½åº¦å†åŠ ä¸Šåˆ—æ•°ï¼Œ ç„¶åè¦è¿›è¡Œunionï¼ˆï¼‰ å…·ä½“è¿‡ç¨‹å°±æ˜¯å…ˆæ‰¾åˆ°ä¸¤ä¸ªè¦åˆå¹¶çš„ç‚¹çš„çˆ¶äº²ï¼Œå¦‚æœä¸ç›¸åŒå°±å†è°ƒå‡ºä¸¤ä¸ªæ‰€åœ¨é›†åˆçš„å¤§å°sizemapï¼Œç„¶åå°†å°çš„é›†åˆæ¥åœ¨å¤§çš„é›†åˆä¸‹é¢ï¼Œ æ›´æ–°sizemapã€‚ è¿™é‡Œæ‰¾çˆ¶äº²çš„æ“ä½œå¯ä»¥ç”¨ä¸€ä¸ªhelpæ•°ç»„å€’åºéå†æ¥ä»£æ›¿æ ˆ
/**
	 * ä½¿ç”¨å¹¶æŸ¥é›†
	 * @param board
	 * @return
	 */
	public static int numIslands2(char[][] board) &#123;
		int row = board.length;
		int col = board[0].length;
		UnionFind2 uf = new UnionFind2(board);
		// æŠŠç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—å…ˆå¤„ç† å°±ä¸éœ€è¦åé¢è€ƒè™‘è¾¹ç•Œ
		for (int j = 1; j &lt; col; j++) &#123;
			if (board[0][j - 1] == '1' &amp;&amp; board[0][j] == '1') &#123;
				uf.union(0, j - 1, 0, j);
			&#125;
		&#125;
		for (int i = 1; i &lt; row; i++) &#123;
			if (board[i - 1][0] == '1' &amp;&amp; board[i][0] == '1') &#123;
				uf.union(i - 1, 0, i, 0);
			&#125;
		&#125;
		// é™¤äº†ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„éƒ¨åˆ†
		for (int i = 1; i &lt; row; i++) &#123;
			for (int j = 1; j &lt; col; j++) &#123;
				if (board[i][j] == '1')  // çœ‹ä¸Šé¢å’Œå·¦è¾¹
					if (board[i][j - 1] == '1') &#123;
						uf.union(i, j - 1, i, j);
					&#125;
					if (board[i - 1][j] == '1') &#123;
						uf.union(i - 1, j, i, j);
					&#125;
				&#125;
			&#125;
		&#125;
		return uf.sets();
	&#125;
	
	public static class UnionFind2 &#123;
		private int[] parent;
		private int[] size;
		private int[] help;
		private int col;// ç”¨æ¥è®¡ç®—çŸ©é˜µæ•°r*col + c
		private int sets;

		public UnionFind2(char[][] board) &#123;
			col = board[0].length;
			sets = 0;
			int row = board.length;
			int len = row * col;
			parent = new int[len];
			size = new int[len];
			help = new int[len];
			for (int r = 0; r &lt; row; r++) &#123;
				for (int c = 0; c &lt; col; c++) &#123;
					if (board[r][c] == '1') &#123;
						int i = index(r, c);
						parent[i] = i;
						size[i] = 1;
						sets++;
					&#125;
				&#125;
			&#125;
		&#125;

		// (r,c) -> i
		private int index(int r, int c) &#123;
			return r * col + c;
		&#125;

		// åŸå§‹ä½ç½® -> ä¸‹æ ‡
		private int find(int i) &#123;
			int hi = 0;
			while (i != parent[i]) &#123;
				help[hi++] = i;
				i = parent[i];
			&#125;
			for (hi--; hi >= 0; hi--) &#123;
				parent[help[hi]] = i;
			&#125;
			return i;
		&#125;

		public void union(int r1, int c1, int r2, int c2) &#123;
			int i1 = index(r1, c1);
			int i2 = index(r2, c2);
			int f1 = find(i1);
			int f2 = find(i2);
			if (f1 != f2) &#123;
				if (size[f1] >= size[f2]) &#123;
					size[f1] += size[f2];
					parent[f2] = f1;
				&#125; else &#123;
					size[f2] += size[f1];
					parent[f1] = f2;
				&#125;
				sets--;
			&#125;
		&#125;

		public int sets() &#123;
			return sets;
		&#125;

	&#125;
2 çœä»½æ•°é‡ï¼ˆæœ‹å‹åœˆï¼‰

æœ‰ n ä¸ªåŸå¸‚ï¼Œå…¶ä¸­ä¸€äº›å½¼æ­¤ç›¸è¿ï¼Œå¦ä¸€äº›æ²¡æœ‰ç›¸è¿ã€‚å¦‚æœåŸå¸‚ a ä¸åŸå¸‚ b ç›´æ¥ç›¸è¿ï¼Œä¸”åŸå¸‚ b ä¸åŸå¸‚ c ç›´æ¥ç›¸è¿ï¼Œé‚£ä¹ˆåŸå¸‚ a ä¸åŸå¸‚ c é—´æ¥ç›¸è¿ã€‚
çœä»½ æ˜¯ä¸€ç»„ç›´æ¥æˆ–é—´æ¥ç›¸è¿çš„åŸå¸‚ï¼Œç»„å†…ä¸å«å…¶ä»–æ²¡æœ‰ç›¸è¿çš„åŸå¸‚ã€‚

public int findCircleNum(int[][] M) &#123;
        int N = M.length;
        UnionFind unionFind = new UnionFind(N);
        for(int i = 0; i &lt; N; i++) &#123;
            for(int j = i+1; j &lt; N; j++) &#123;
                if(M[i][j] == 1) &#123;
                    unionFind.union(i, j);
                &#125;
            &#125;
        &#125;

        return unionFind.sets();
    &#125;

    // ä½¿ç”¨æ•°ç»„ç»“æ„çš„å¹¶æŸ¥é›†
    public static class UnionFind &#123;
        private int[] parents;
        private int[] size;
        private int[] help;
        private int sets;

        public UnionFind(int N) &#123;
            parents = new int[N];
            size = new int[N];
            help = new int[N];
            sets = N;

            for(int i = 0; i &lt; N; i++) &#123;
                parents[i] = i;
                size[i] = 1;
            &#125;
        &#125;

        // 1 å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆ
        // 2 while(iä¸æ˜¯è‡ªå·±çˆ¹ï¼‰&#123;
        // 2.1 å‹helpæ ˆï¼ˆè™šæ‹Ÿçš„
        // 2.2 iæŒ‡å‘è‡ªå·±çš„çˆ¹    &#125;
        // 3 foréå†helpï¼šæ¨¡æ‹Ÿæ ˆå¼¹å‡º &#123;æ‰€æœ‰äººçˆ¹è®¾ä¸ºi&#125;
        // 4 è¿”å›i:æ­¤æ—¶iæŒ‡å‘æœ€çˆ¹
        public int findFather(int i) &#123;
            int hi = 0;
            while( i != parents[i]) &#123;
                help[hi++] = i;
                i = parents[i];
            &#125;
            for(hi--; hi >=0; hi--)&#123;
                parents[help[hi]] = i;
            &#125;
            return i;
        &#125;

        public void union(int i, int j) &#123;
            int iF = findFather(i);
            int jF = findFather(j);

            if(iF != jF) &#123;
                if(size[iF] &lt; size[jF]) &#123;
                    size[jF] += size[iF];
                    parents[iF] = jF;
                &#125;else &#123;
                    size[iF] += size[jF];
                    parents[jF] = iF;
                &#125;
                sets--;
            &#125;

        &#125;

        public int sets() &#123;
            return sets;
        &#125;

    &#125;


7 å›¾
å°†çŸ©é˜µè½¬åŒ–ä¸ºè‡ªå·±çš„ç»“æ„(creatGraph)

newä¸€ä¸ªè‡ªå·±çš„graph
éå†çŸ©é˜µæ¯ä¸€è¡Œ for(matrix.length)

weight:matrix[i][0] from[i][1] to:[i][2]
åˆ¤æ–­æ˜¯å¦contanskey(fromå’Œto) åˆ†åˆ«æ”¾å…¥ç‚¹é›†
edgeåˆå§‹åŒ– å¹¶èµ‹å€¼ (weight,fromNode,toNode)
æ›´æ–°å‡ºå…¥åº¦ã€ç›´æ¥ç‚¹ã€ç›´æ¥è¾¹
è¾¹æ”¾å…¥è¾¹é›†



1 å›¾çš„bfs
public class Code01_BFS &#123;

	// ä»nodeå‡ºå‘ï¼Œè¿›è¡Œå®½åº¦ä¼˜å…ˆéå†
	public static void bfs(Node start) &#123;
		if (start == null) &#123;
			return;
		&#125;
		Queue&lt;Node> queue = new LinkedList&lt;>();
		HashSet&lt;Node> set = new HashSet&lt;>();
		queue.add(start);
		set.add(start);
		while (!queue.isEmpty()) &#123;
			Node cur = queue.poll();
			System.out.println(cur.value);
			for (Node next : cur.nexts) &#123;
				if (!set.contains(next)) &#123;
					set.add(next);
					queue.add(next);
				&#125;
			&#125;
		&#125;
	&#125;

&#125;

2 DFS
package all.Graph;

import java.util.HashSet;
import java.util.Stack;

public class Code02_DFS &#123;

	public static void dfs(Node node) &#123;
		if (node == null) &#123;
			return;
		&#125;
		Stack&lt;Node> stack = new Stack&lt;>();
		HashSet&lt;Node> set = new HashSet&lt;>();
		stack.add(node);
		set.add(node);
		System.out.println(node.value);
		while (!stack.isEmpty()) &#123;
			Node cur = stack.pop();
			for (Node next : cur.nexts) &#123;
				if (!set.contains(next)) &#123;
					stack.push(cur);
					stack.push(next);
					set.add(next);
					System.out.println(next.value);
					break;
				&#125;
			&#125;
		&#125;
	&#125;
&#125;

3 æ‹“æ‰‘æ’åº
/**
 * æ‹“æ‰‘æ’åº ï¼š æœ‰å‘æ— ç¯å›¾
 * 
 * @author chs
 *
 */
public class Code03_TopologySort &#123;

	// directed graph and no loop
	public static List&lt;Node> sortedTopology(Graph graph) &#123;
		// key æŸä¸ªèŠ‚ç‚¹   value å‰©ä½™çš„å…¥åº¦
		HashMap&lt;Node, Integer> inMap = new HashMap&lt;>();
		// åªæœ‰å‰©ä½™å…¥åº¦ä¸º0çš„ç‚¹ï¼Œæ‰è¿›å…¥è¿™ä¸ªé˜Ÿåˆ—
		Queue&lt;Node> zeroInQueue = new LinkedList&lt;>();
		for (Node node : graph.nodes.values()) &#123;
			inMap.put(node, node.in);
			if (node.in == 0) &#123;
				zeroInQueue.add(node);
			&#125;
		&#125;
		List&lt;Node> result = new ArrayList&lt;>();
		while (!zeroInQueue.isEmpty()) &#123;
			Node cur = zeroInQueue.poll();
			result.add(cur);
			for (Node next : cur.nexts) &#123;
				inMap.put(next, inMap.get(next) - 1);
				if (inMap.get(next) == 0) &#123;
					zeroInQueue.add(next);
				&#125;
			&#125;
		&#125;
		return result;
	&#125;
&#125;

]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
</search>
